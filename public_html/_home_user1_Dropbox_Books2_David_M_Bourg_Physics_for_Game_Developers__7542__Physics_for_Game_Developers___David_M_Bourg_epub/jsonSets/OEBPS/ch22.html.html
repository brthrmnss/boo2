<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><html><head><title>Chapter&#xA0;22.&#xA0;Gaming from One Place to Another</title><link rel="stylesheet" type="text/css" href="core.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="up" href="pt04.html" title="Part&#xA0;IV.&#xA0;Digital Physics"><link rel="prev" href="ch21.html" title="Chapter&#xA0;21.&#xA0;Accelerometers"><link rel="next" href="ch23.html" title="Chapter&#xA0;23.&#xA0;Pressure Sensors and Load Cells"></head><body>
         
        <script>
        function ok(){ 
            window.gggs()
            return;
            //$('#musicPlayer').parent().remove();
            //speakTransportPanelDialogV2.closeEmoteDialog()
            //speakTransportPanelDialog.closeEmoteDialog()
            //
            debugger
            let url = 'http://127.0.0.1:8080/uploads/extracted/' +
             'Crazy Rich Asians  Kevin Kwanepub/' +
              'jsonSets/OEBPS/Kwan_9780385536981_epub_prl_r1.htm.html.sentences.json'
            speakTransportPanelDialogV2.sideLoadSentences2(null, null, null, url)
            
        }
        setTimeout(ok, 1500)
        </script>
        <div style="background:white">````````</div><section class="chapter" title="Chapter&#xA0;22.&#xA0;Gaming from One Place to Another" epub:type="chapter" id="gaming_from_one_place_to_another"><div class="titlepage"><div><div><h2 class="title"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">1</span><span sentence-index="11854" class="">Chapter&#xA0;22.&#xA0;Gaming  from  One  Place  to  Another</span></span></h2></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">2</span><span sentence-index="11855" class="nonQuoteStr">Once  a  tool  meant  to  help  the  </span></span><a id="I_indexterm3_id355966" class="indexterm"></a><a id="I_indexterm3_id355976" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">4</span><span sentence-index="11857" class="">United  States  guide  intercontinental  ballistic  missiles,  the    </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">4</span><span sentence-index="11857" class="">Global  Positioning  System</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11857</span><span sentence-index="11857" class="">  (GPS)  has  evolved  to  be  a    part  of  our  everyday  lives. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11858</span><span sentence-index="11858" class="">  The  current  generation  will  never  have  known  a    world  where  getting  lost  was  something  that  couldn&apos;t  be  fixed  by    trilaterating  their  position  between  satellites  orbiting  the  planet. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11859</span><span sentence-index="11859" class="">    Although  GPS  has  become  commonplace  in  the  navigational  world,  the    proliferation  of  smartphones  is  just  now  opening  the  doors  to  GPS  gaming. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11860</span><span sentence-index="11860" class="">    While  this  genre  is  just  emerging,  we&apos;d  like  to  give  you  an  introduction  to    the  physics  behind  GPS  and  the  current  applications  in  the  gaming    world.</span></span></a></p><p><a id="I_indexterm3_id355976" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">10</span><span sentence-index="11863" class="">Let&apos;s  recall  that  </span></span></a><a id="I_indexterm3_id356000" class="indexterm"></a><a id="I_indexterm3_id356013" class="indexterm"></a><a id="I_indexterm3_id356019" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">13</span><span sentence-index="11866" class="">positions  near  the  earth&apos;s  surface  are  generally  given  in  the    </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">13</span><span sentence-index="11866" class="">geographic  coordinate  system</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11866</span><span sentence-index="11866" class=""> ,  more  often  described  as    latitude,  longitude,  and  altitude. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">14</span><span sentence-index="11867" class=""> </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">14</span><span sentence-index="11867" class="">Latitude</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">14</span><span sentence-index="11867" class=""> is  a    </span></span></a><a id="I_indexterm3_id356038" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11868</span><span sentence-index="11868" class="">measure  in  degrees  of  how  far  north  or  south  you  are  from  the    equator. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">16</span><span sentence-index="11869" class=""> </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">16</span><span sentence-index="11869" class="">Longitude</span></span></em></span> </a><a id="I_indexterm3_id356053" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11870</span><span sentence-index="11870" class="">is  the  measure  in  degrees  of  how  far  east  or  west  you  are  from    the  prime  meridian. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11871</span><span sentence-index="11871" class="">  A  meridian  is  a  line  of  constant  latitude  that  runs  from    the  North  Pole  to  the  South  Pole. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">19</span><span sentence-index="11872" class=""> The  prime  meridian  is  arbitrarily  defined    as  the  meridian  that  passes  through  the  </span></span></a><a id="I_indexterm3_id356066" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">20</span><span sentence-index="11873" class="">Greenwich  Observatory  in  the  </span></span></a><a id="I_indexterm3_id356074" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11875</span><span sentence-index="11875" class="">UK. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">23</span><span sentence-index="11876" class=""> </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">23</span><span sentence-index="11876" class="">Altitude</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11876</span><span sentence-index="11876" class="">  is  usually  given  as  the    measure  of  how  far  above  or  below  sea  level  you  are  at  the  point  described    by  latitude  and  longitude.</span></span></a></p><div class="sect1" title="Location-Based Gaming"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="location-based_gaming"><a id="I_indexterm3_id356074" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">26</span><span sentence-index="11879" class="">Location-Based  Gaming</span></span></a></h2></div></div></div><p><a id="I_indexterm3_id356074" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">28</span><span sentence-index="11881" class="">Before  getting  </span></span></a><a id="I_indexterm3_id356101" class="indexterm"></a><a id="I_indexterm3_id356111" class="indexterm"></a><a id="I_indexterm3_id356121" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11884</span><span sentence-index="11884" class="">to  the  physics  behind  GPS,  we&apos;d  like  to  take  a  moment  to        discuss  how  GPS  is  being  implemented  into  games. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11885</span><span sentence-index="11885" class="">  Right  now,  this  is  an        emerging  market  that  is  just  starting  to  gain  traction. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11886</span><span sentence-index="11886" class="">  There  are  several        broad  categories  into  which  games  fall. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11887</span><span sentence-index="11887" class="">  Another  step  beyond  what  the        accelerometer  did,  GPS  enables  users  to  move  computer  games  not  only  off        the  couch  but  also  out  into  the  world.</span></span></a></p><div class="sect2" title="Geocaching and Reverse Geocaching"><div class="titlepage"><div><div><h3 class="title" id="geocaching_and_reverse_geocaching"><a id="I_indexterm3_id356121" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">37</span><span sentence-index="11890" class="">Geocaching  and  Reverse  Geocaching</span></span></a></h3></div></div></div><p><a id="I_indexterm3_id356121" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">39</span><span sentence-index="11892" class="">Geocaching  is  the  </span></span></a><a id="I_indexterm3_id356148" class="indexterm"><span class="nonQuoteStr" gspkNameUnknown="narrator" gsIndex="1"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11893</span><span sentence-index="11893" class="">oldest  form  of  gaming  involving  GPS. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11894</span><span sentence-index="11894" class="">  It  originated  after            selective  availability  was  removed  from  GPS,  making  it  more  accurate,  in            the  year  2000. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11895</span><span sentence-index="11895" class="">  In  its  most  basic  form,  it  is  the  process  of  hunting  down            a  </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11896</span><span sentence-index="11896" class="" gspkNameUnknown="narrator" gsIndex="1"> &quot;cache&quot; </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11897</span><span sentence-index="11897" class="">  using  provided  GPS  coordinates. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11898</span><span sentence-index="11898" class="">  The  cache  usually  has  a            logbook  and  may  contain  other  items  such  as  coins  with  serial  numbers            that  the  finder  can  move  to  another  cache  and  track  online.</span></span></a></p><p><a id="I_indexterm3_id356148" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11901</span><span sentence-index="11901" class="">Because  of  the  large  amount  of  setup  involved  in  implementing  a            geocaching  game  on  a  commercial  scale,  most  implementations  are            community  based. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">49</span><span sentence-index="11902" class=""> However,  </span></span></a><a id="I_indexterm3_id356165" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11903</span><span sentence-index="11903" class="">reverse  geocaching  has  more  promise  for  the  gaming            industry. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11904</span><span sentence-index="11904" class="">  In  this  variation  there  is  nothing  at  the  supplied            coordinates,  but  traveling  to  them  is  required  to  execute  some  action. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11905</span><span sentence-index="11905" class="">            Think  of  it  as  carrying  around  a  cache  that  cannot  be  unlocked  until  it            is  within  range  of  some  specific  coordinate. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11906</span><span sentence-index="11906" class="">  This  could  be  used  to  force            users  to  travel  in  order  to  unlock  a  game  item. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11907</span><span sentence-index="11907" class="">  For  instance,  perhaps  to            gain  the  ability  to  use  a  sword  in  a  game,  the  user  must  travel  to  the            nearest  sporting  goods  store. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11908</span><span sentence-index="11908" class="">  The  commercial  possibility  of  corporate            tie-ins  is  an  obvious  plus.</span></span></a></p></div><div class="sect2" title="Mixed Reality"><div class="titlepage"><div><div><h3 class="title" id="mixed_reality"><a id="I_indexterm3_id356165" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">58</span><span sentence-index="11911" class="">Mixed  Reality</span></span></a></h3></div></div></div><p><a id="I_indexterm3_id356165" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span sentence-index="11913" class="">Mixed-reality  games  </span></span></a><a id="I_indexterm3_id356191" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11914</span><span sentence-index="11914" class="">are  similar  to  geocaching. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11915</span><span sentence-index="11915" class="">  They  go  beyond  just  using  the  coordinates  of  the  user                to  trigger  events,  to  using  reality-based  locals. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">63</span><span sentence-index="11916" class=""> A  current  example  is  Gbanga&apos;s                    </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">63</span><span sentence-index="11916" class="">Famiglia</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11916</span><span sentence-index="11916" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11917</span><span sentence-index="11917" class="">  In  this  game  your  movement  in  the  real  world  allows  you  to                discover  virtual  establishments  in  the  game  world. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11918</span><span sentence-index="11918" class="">  This  divorces  it  from  the  actual  physical                locations  that  your  GPS  is  reporting  but  requires  moving  between  locations  in  the  real  world                to  move  your  character  in  the  virtual  world. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">66</span><span sentence-index="11919" class=""> Popular  right  now  is  the  </span></span></a><a id="I_indexterm3_id356206" class="indexterm"><span class="nonQuoteStr" gspkNameUnknown="narrator" gsIndex="1"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11920</span><span sentence-index="11920" class="">FourSquare  app  on  mobile  devices. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11921</span><span sentence-index="11921" class="">  This  is  the  simplest  possible  implementation                of  mixed-reality  gaming. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11922</span><span sentence-index="11922" class="">  FourSquare  allows  a  user  to  become  the  mayor  of  a  place  if  she                </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11923</span><span sentence-index="11923" class="" gspkNameUnknown="narrator" gsIndex="1"> &quot;checks  in&quot; </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11924</span><span sentence-index="11924" class="">  at  the  locale  more  than  anyone  else.</span></span></a></p></div><div class="sect2" title="Street Games"><div class="titlepage"><div><div><h3 class="title" id="street_games"><a id="I_indexterm3_id356206" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">74</span><span sentence-index="11927" class="">Street  Games</span></span></a></h3></div></div></div><p><a id="I_indexterm3_id356206" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">76</span><span sentence-index="11929" class="">Street  games  </span></span></a><a id="I_indexterm3_id356228" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11930</span><span sentence-index="11930" class="">are  another  step  beyond  mixed  reality. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11931</span><span sentence-index="11931" class="">  These  turn  the            environment  around  the  user  into  a  virtual  game  board. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">79</span><span sentence-index="11932" class=""> One  example  is            the  recent  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">79</span><span sentence-index="11932" class="">Pac-Manhattan</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">79</span><span sentence-index="11932" class=""> multiplayer  game  using  GPS            in  smartphones  to  play  a  live  version  of  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">79</span><span sentence-index="11932" class="">Pac-Man</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11932</span><span sentence-index="11932" class="">  in            Washington  Square  Park. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11933</span><span sentence-index="11933" class="">  In  general,  the  idea  is  to  create  a  court  for            game  play  using  the  environment  surrounding  the  user. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11934</span><span sentence-index="11934" class="">  The  relationship            between  users  is  tracked  in  the  virtual  space  of  the  game  and  provides            the  interactive  elements.</span></span></a></p></div></div><div class="sect1" title="What Time Is It?"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="what_time_is_it_question"><a id="I_indexterm3_id356228" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11937</span><span sentence-index="11937" class="">What  Time  Is  It?</span></span></a></h2></div></div></div><p><a id="I_indexterm3_id356228" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">87</span><span sentence-index="11940" class="">The  story  of  GPS</span></span></a><a id="I_indexterm3_id356263" class="indexterm"></a><a id="I_indexterm3_id356274" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">89</span><span sentence-index="11942" class=""> really  begins  with  a  prize  offered  by  the  British        government  in  1717  for  a  simple  way  to  determine  your  </span></span></a><a id="I_indexterm3_id356286" class="indexterm"></a><a id="ti22.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11944</span><span sentence-index="11944" class="">longitude. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">92</span><span sentence-index="11945" class=""> Awarded  in  1773,  the  accepted  solution  was  to        compare  local  noon  to  the  official  noon  sighted  at  the  </span></span></a><a id="I_indexterm3_id356312" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11946</span><span sentence-index="11946" class="">Greenwich  Observatory. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11947</span><span sentence-index="11947" class="">  The  difference  between  these  two        times  would  allow  you  to  tell  how  far  around  the  world  you  were  from  the        observatory. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11948</span><span sentence-index="11948" class="">  Fast-forward  three  centuries,  and  we  have  satellites  orbiting        the  earth,  broadcasting  time-stamped  messages. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11949</span><span sentence-index="11949" class="">  By  calculating  the        difference  between  the  time  the  message  was  received  and  the  time  it  was        transmitted,  we  can  calculate  our  distance  from  the  satellite. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11950</span><span sentence-index="11950" class="">  In  both        cases  you  need  an  accurate  way  to  keep  or  measure  time. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11951</span><span sentence-index="11951" class="">  For  sailors  in  the        1800s,  the  device  was  the  newly  invented  chronometer. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11952</span><span sentence-index="11952" class="">  For  us,  it  is  the        atomic  clock.</span></span></a></p><p><a id="I_indexterm3_id356312" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11955</span><span sentence-index="11955" class="">Because  the  signals  from  a  GPS  satellite  are  moving  at  the  speed  of        light,  you  need  a  very  accurate  clock  to  keep  track  of  how  long  it  took  to        travel  to  you. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11956</span><span sentence-index="11956" class="">  For  instance,  if  the  clock  you  are  using  to  time  when  the        signal  arrives  is  1  microsecond  off,  you  will  estimate  a  distance  over  900        miles  in  error. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11957</span><span sentence-index="11957" class="">  On  the  supply  side  of  the  signal,  each  satellite  has  an        atomic  clock,  and  internal  GPS  time  is  accurate  to  about  14  nanoseconds. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11958</span><span sentence-index="11958" class="">        The  problem  is  that  you  also  need  a  very  accurate  clock  in  the  receiver,        and  it  would  be  pretty  hard  to  fit  an  atomic  clock  into  a  phone        economically. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11959</span><span sentence-index="11959" class="">  To  get  around  this,  the  receiver  must  figure  out  the  correct        current  time  based  on  the  signals  from  the  satellites.</span></span></a></p><div class="sect2" title="Two-Dimensional Mathematical Treatment"><div class="titlepage"><div><div><h3 class="title" id="two-dimensional_mathematical_treatment"><a id="I_indexterm3_id356312" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">109</span><span sentence-index="11962" class="">Two-Dimensional  Mathematical  Treatment</span></span></a></h3></div></div></div><p><a id="I_indexterm3_id356312" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">111</span><span sentence-index="11964" class="">This  section  will  </span></span></a><a id="gp22.2" class="indexterm"></a><a id="gl22.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11966</span><span sentence-index="11966" class="">give  you  a  good  idea  of  how  GPS  systems  determine  their            location. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11967</span><span sentence-index="11967" class="">  This  background  will  help  you  in  many  applications  of  geometry            in  games  in  general,  but  most  GPS  devices  do  the  heavy  lifting  and            report  through  an  API  your  current  latitude  and  longitude. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">115</span><span sentence-index="11968" class=""> Some  APIs  may            include  more  information&#x2014;for  example,  the  current  iOS  API,  called  Core            Location,  gives  the  current  </span></span></a><a id="la22.2.1" class="indexterm"></a><a id="lo22.2.1" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11970</span><span sentence-index="11970" class="">latitude  and  longitude,  the  direction  of  travel,  the            distance  traveled,  and  the  distance  in  meters  to  a  given  coordinate. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11971</span><span sentence-index="11971" class="">  It            also  gives  an  estimate  for  the  error  associated  with  its  position  fix  in            meters.</span></span></a></p><p><a id="lo22.2.1" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">121</span><span sentence-index="11974" class="">One  way  to  get  your  position  via  the  kind  of  information  that  GPS            provides  is  a  technique  </span></span></a><a id="tr22.2.1" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">122</span><span sentence-index="11975" class="">called  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">122</span><span sentence-index="11975" class="">trilateration</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11976</span><span sentence-index="11976" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11977</span><span sentence-index="11977" class="">  We  are  going  to            give  this  problem  a  mathematical  treatment  in  two  dimensions. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11978</span><span sentence-index="11978" class="">  You  could            extend  this  to  three  dimensions  by  using  spheres  instead  of            circles.</span></span></a></p><p><a id="tr22.2.1" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">128</span><span sentence-index="11981" class="">To  begin,  we  can  list  our  unknowns:  our  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">128</span><span sentence-index="11981" class="">x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">128</span><span sentence-index="11981" class="">           coordinate  and  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">128</span><span sentence-index="11981" class="">y</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">128</span><span sentence-index="11981" class=""> coordinate  in  space,  and  the  error            in  our  receiver&apos;s  clock  (or  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">128</span><span sentence-index="11981" class="">bias</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">128</span><span sentence-index="11981" class="">),            </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">128</span><span sentence-index="11981" class="">b</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11981</span><span sentence-index="11981" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11982</span><span sentence-index="11982" class="">  In  a  two-dimensional  plane,  trilateration  among            three  circles  gives  you  an  exact  position;  in  three-dimensional  space,            four  spheres  are  required  to  determine  all  three  special  coordinates. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11983</span><span sentence-index="11983" class="">            Note  that  if  we  included  an  assumption  about  being  on  the  surface  of            some  geometric  shape,  such  as  the  earth,  we  could  reduce  the  number  of            unknowns. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11984</span><span sentence-index="11984" class="">  No  such  simplification  is  used  here  to  provide  you  with  the            most  general  case.</span></span></a></p><p><a id="tr22.2.1" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">134</span><span sentence-index="11987" class="">In  our  example,  we  are  somewhere  on  the  surface  of  the            two-dimensional  earth,  shown  in  </span></span></a><a class="xref" href="ch22.html#trilateration_in_2d" title="Figure&#xA0;22-1.&#xA0;Trilateration in 2D"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">135</span><span sentence-index="11988" class="">Figure&#xA0;22-1</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11989</span><span sentence-index="11989" class="">            as  a  light  gray  solid  disk. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11990</span><span sentence-index="11990" class="">  This  disk  is  being  orbited  by  several  GPS            satellites. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11991</span><span sentence-index="11991" class="">  The  satellites&apos;  orbits  are  regular,  and  their  positions  at            any  time  are  tabulated  in  an  almanac  that  is  stored  in  the  receiver. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="11992" class=""> The            time  of  transmission  is  encoded  in  the  signal  so  that  the  givens  are            </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="11992" class="">x</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span>i</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="11992" class="">,            </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="11992" class="">y</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span>i</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="11992" class="">,  and            </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="11992" class="">t</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span>i</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="11992" class="">,  with            </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="11992" class="">i</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11992</span><span sentence-index="11992" class="">  =1,2,3.</span></span></p><div class="figure"><a id="trilateration_in_2d"></a><div class="figure-contents"><a id="trilateration_in_2d"></a><div class="mediaobject"><a id="trilateration_in_2d"></a><a id="I_mediaobject3_id356508"><img src="httpatomoreillycomsourceoreillyimages1599001.png" alt="Trilateration in 2D"></a></div></div><div class="figure-title"><a id="I_mediaobject3_id356508"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">145</span><span sentence-index="11998" class="">Figure&#xA0;22-1.&#xA0;Trilateration  in  2D</span></span></a></div></div><p><a id="I_mediaobject3_id356508"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12000</span><span sentence-index="12000" class="">To  make  things  easier  for  us,  we  are  going  to  abandon  the            coordinate  system  of  the  earth  and  use  the  coordinate  system  defined  by            our  three  satellites. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12001</span><span sentence-index="12001" class="">  The  origin  will  be  at  satellite  1,  the  x-axis            going  directly  from  satellite  1  straight  to  satellite  2  and  the  y-axis            being  perpendicular  to  that. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">149</span><span sentence-index="12002" class=""> This  is  shown  in  </span></span></a><a class="xref" href="ch22.html#satellite_coordinate_system" title="Figure&#xA0;22-2.&#xA0;Satellite coordinate system"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">150</span><span sentence-index="12003" class="">Figure&#xA0;22-2</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12004</span><span sentence-index="12004" class=""> .</span></span></p><div class="figure"><a id="satellite_coordinate_system"></a><div class="figure-contents"><a id="satellite_coordinate_system"></a><div class="mediaobject"><a id="satellite_coordinate_system"></a><a id="I_mediaobject3_id356549"><img src="httpatomoreillycomsourceoreillyimages1599002.png" alt="Satellite coordinate system"></a></div></div><div class="figure-title"><a id="I_mediaobject3_id356549"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">157</span><span sentence-index="12010" class="">Figure&#xA0;22-2.&#xA0;Satellite  coordinate  system</span></span></a></div></div><p><a id="I_mediaobject3_id356549"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span sentence-index="12012" class="">The  equations  of  the  three  circles  are  therefore:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>r</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>2</span></span></sup><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span sentence-index="12012" class="">1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span sentence-index="12012" class=""> =                x</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>+y</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>2</span></span></sup></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>r</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>2</span></span></sup><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span sentence-index="12012" class=""> =                (x&#x2013;d)</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span sentence-index="12012" class="">+y</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>2</span></span></sup></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span sentence-index="12012" class="">r</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>2</span></span></sup><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span sentence-index="12012" class="">3</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span sentence-index="12012" class=""> =                (x&#x2013;i)</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span sentence-index="12012" class="">+(y&#x2013;j)</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">159</span><span sentence-index="12012" class="">2</span></span></sup></td></tr></tbody></table><p><a id="I_mediaobject3_id356549"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">161</span><span sentence-index="12014" class="">Each  radius  is  found  by  subtracting  the  transmission  time,                    </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">161</span><span sentence-index="12014" class="">t</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">161</span><span sentence-index="12014" class="">i</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12014</span><span sentence-index="12014" class=""> ,  from  the  current  time  and  multiplying  by                the  speed  of  light. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">162</span><span sentence-index="12015" class=""> As  the  speed  of  light  is  very  large,  and  our  current  time  is  only  a                rough  estimate,  these  radii  are  commonly  referred    </span></span></a><a id="I_indexterm3_id356637" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">163</span><span sentence-index="12016" class="">to  as  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">163</span><span sentence-index="12016" class="">pseudoranges</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12017</span><span sentence-index="12017" class="">  to  remind  us  they  are  still  approximate. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">165</span><span sentence-index="12018" class="">               The  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">165</span><span sentence-index="12018" class="">x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">165</span><span sentence-index="12018" class=""> and  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">165</span><span sentence-index="12018" class="">y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12018</span><span sentence-index="12018" class="">  values  that  satisfy  these  equations                are  our  current  location  in  two-dimensional  space. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span sentence-index="12019" class=""> We  now  subtract  the  second  equation  from                the  first:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>1</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span> &#x2013;                r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>2</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span> =                x</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span sentence-index="12019" class=""> +  y</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span> &#x2013;                (x-d)</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span sentence-index="12019" class=""> &#x2013;                y</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>2</span></span></sup></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span sentence-index="12019" class="">r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span sentence-index="12019" class="">1</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span sentence-index="12019" class=""> &#x2013;                r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>2</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span sentence-index="12019" class=""> =                x</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span sentence-index="12019" class=""> &#x2013;                (x-d)</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">166</span><span sentence-index="12019" class="">2</span></span></sup></td></tr></tbody></table><p><a id="I_indexterm3_id356637" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span sentence-index="12021" class="nonQuoteStr">Solving  for  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span>x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span sentence-index="12021" class="nonQuoteStr"> gives:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span sentence-index="12021" class="nonQuoteStr">x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span sentence-index="12021" class="nonQuoteStr"> =                (r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span sentence-index="12021" class="nonQuoteStr">1</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span sentence-index="12021" class="nonQuoteStr"> &#x2013;                r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span>2</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span sentence-index="12021" class="nonQuoteStr">+d</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span sentence-index="12021" class="nonQuoteStr">2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span sentence-index="12021" class="nonQuoteStr">)                /  2d</span></span></td></tr></tbody></table><p><a id="I_indexterm3_id356637" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">170</span><span sentence-index="12023" class="">where  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">170</span><span sentence-index="12023" class="">d</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12023</span><span sentence-index="12023" class="">  is  the  distance  between  the  known            locations  of  satellite  1  and  satellite  2. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class=""> We  now  substitute  our            </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class="">x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class=""> coordinate  back  into  the  first  circle&apos;s            equation:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class="">y</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class=""> =                r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span>1</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class=""> &#x2013;                [((r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class="">1</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class=""> &#x2013;                r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span>2</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class=""> +                d</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class="">)</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class="">)  /                (4d</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class="">2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="12024" class="">)]</span></span></td></tr></tbody></table><p><a id="I_indexterm3_id356637" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">173</span><span sentence-index="12026" class="">and  finally  after  we  take  the  square  root:</span></span></a></p><div class="informalequation"><div class="mediaobject"><a id="I_indexterm3_id356637" class="indexterm"><img src="eq_2201.png" alt="Satellite coordinate system"></a></div></div><p><a id="I_indexterm3_id356637" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">176</span><span sentence-index="12029" class="">notice  that  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">176</span><span sentence-index="12029" class="">y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12029</span><span sentence-index="12029" class="">  value  is  now  expressed  as  a            positive  or  negative  square  root. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12030</span><span sentence-index="12030" class="">  This  means  there  can  be  zero,  one,  or            two  real-number  solutions. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">178</span><span sentence-index="12031" class=""> If  the  circles  do  not  intersect,  then  the            quantity  under  the  square  root  will  be  negative  and  the            </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">178</span><span sentence-index="12031" class="">y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12031</span><span sentence-index="12031" class="">  value  will  have  zero  real  solutions. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="12032" class=""> This  is            unlikely  for  the  first  two  satellites  because  you  have  already  received            pseudoranges  to  them  in  the  form  of            </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span>r</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="12032" class="">1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="12032" class=""> and            </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="12032" class="">r</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="12032" class="">2</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12032</span><span sentence-index="12032" class=""> ,  which  the  algorithm            assumes  to  have  zero  error. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">180</span><span sentence-index="12033" class=""> If  the  two  circles  happen  to  intersect  at            only  a  single  tangent  point,  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">180</span><span sentence-index="12033" class="">y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12033</span><span sentence-index="12033" class="">  will  have  one            solution  and  will  be  equal  to  0. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12034</span><span sentence-index="12034" class="">  This  is  also  unlikely. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">182</span><span sentence-index="12035" class=""> The  most  likely            result  will  be  that  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">182</span><span sentence-index="12035" class="">y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12035</span><span sentence-index="12035" class="">  will  be  the  set  of  two            values,  plus  or  minus  the  square  root  of  a  positive  value,  and  that            those  two  points  will  be  widely  separated.</span></span></a></p><p><a id="I_indexterm3_id356637" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12038</span><span sentence-index="12038" class="">Now  if  we  included  the  assumption  that  we  were  on  the  earth&apos;s            surface,  we  could  already  break  the  tie  between  the  two  points  by            picking  whichever  was  closest  to  the  earth&apos;s  surface. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12039</span><span sentence-index="12039" class="">  However,  we  still            would  have  to  deal  with  the  likelihood  that  there  is  a  large  error  in            our  position  given  the  imprecise  clock  in  the  receiver.</span></span></a></p><p><a id="I_indexterm3_id356637" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">189</span><span sentence-index="12042" class="">We  can  fix  our  position  (</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">189</span><span sentence-index="12042" class="">x,y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12042</span><span sentence-index="12042" class=""> )  with  no  assumptions  and  account  for                clock  bias  by  introducing  the  third  point  and  its  pseudorange. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12043</span><span sentence-index="12043" class="">  Now,  it  was  very  likely  that                the  circles  obtained  from  the  first  two  satellites  would  intersect  because  of  the  way  that                GPS  satellites  are  arranged  around  the  earth. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12044</span><span sentence-index="12044" class="">  However,  because  our  calculations  use                pseudoranges,  it  is  relatively  unlikely  that  the  third  circle  will  pass  directly  through  one                of  the  two  points  defined  by  the  intersection  of  the  first  two  circles. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">192</span><span sentence-index="12045" class=""> To  remove  such                clock-related  distance  errors,  we  first  calculate  which  point  (</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">192</span><span sentence-index="12045" class="">x,y</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">192</span><span sentence-index="12045" class="">)  or                    (</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">192</span><span sentence-index="12045" class="">x,&#x2013;y</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">192</span><span sentence-index="12045" class="">)  is  closer  to  (</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">192</span><span sentence-index="12045" class="">i,j</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12045</span><span sentence-index="12045" class=""> )  and  choose  that  to  be                our  assumed  location. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="12046" class=""> The  difference  between  the  smaller  of  these  two  distances  and  the                pseudorange  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="12046" class="">r</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="12046" class="">3</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="12046" class=""> is  then  our  distance  correction,                    </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="12046" class="">d</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="12046" class="">a</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12046</span><span sentence-index="12046" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">194</span><span sentence-index="12047" class=""> As  the  signal  is  traveling  at  the  </span></span></a><a id="I_indexterm3_id356904" class="indexterm"></a><a id="I_indexterm3_id356916" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="12049" class="nonQuoteStr">speed  of  light,  the  following  quotient  provides  an  estimate  of  the  error  between                the  correct  time  and  the  receiver&apos;s  time:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="12049" class="nonQuoteStr">b  =  d</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="12049" class="nonQuoteStr">a</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="12049" class="nonQuoteStr">/c</span></span></td></tr></tbody></table><p><a id="I_indexterm3_id356916" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12051</span><span sentence-index="12051" class="">As  all  the  GPS  satellites  have  synchronized  atomic  clocks,  the            same  bias  exists  for  each. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12052</span><span sentence-index="12052" class="">  This  means  that  the  bias  we  calculated  would            actually  affect  the  first  pseudoranges  we  used  to  find  our  initial  bias. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12053</span><span sentence-index="12053" class="">            Therefore  an  iterative  approach  is  required  to  adjust  all  the  variables            in  real  time  until  they  converge. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">201</span><span sentence-index="12054" class=""> A  more  direct,  but  less  obvious,            algebraic  solution  that  requires  no  iteration  was  developed  by            </span></span></a><a id="I_indexterm3_id356948" class="indexterm"><span class="nonQuoteStr" gspkNameUnknown="narrator" gsIndex="1"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12055</span><span sentence-index="12055" class="">Stephen  Bancroft. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12056</span><span sentence-index="12056" class="">  It  is  detailed  in  his  paper  </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12057</span><span sentence-index="12057" class="" gspkNameUnknown="narrator" gsIndex="1"> &quot;An            Algebraic  Solution  of  the  GPS  Equations&quot; </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">205</span><span sentence-index="12058" class=""> in  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">205</span><span sentence-index="12058" class="">IEEE            Transactions  on  Aerospace  and  Electronics  Systems</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12058</span><span sentence-index="12058" class="">            journal.</span></span></a></p><p><a id="I_indexterm3_id356948" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">208</span><span sentence-index="12061" class="">Besides  clock  errors,  other  errors  are  introduced  by  the            atmosphere,  signals  bouncing  off  the  ground  and  back  to  the  receiver,            relativistic  effects  (discussed  in  </span></span></a><a class="xref" href="ch02.html" title="Chapter&#xA0;2.&#xA0;Kinematics"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">209</span><span sentence-index="12062" class="">Chapter&#xA0;2</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">209</span><span sentence-index="12062" class="">),  and            </span></span><a id="I_indexterm3_id356970" class="indexterm"></a><a id="I_indexterm3_id356977" class="indexterm"></a><a id="I_indexterm3_id356983" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12066</span><span sentence-index="12066" class="">atomic  clock  drift. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12067</span><span sentence-index="12067" class="">  These  are  all  accounted  for  in            mathematical  models  applied  to  the  raw  position  data. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12068</span><span sentence-index="12068" class="">  For  instance,  the            GPS  clocks  lose  about  7,214  nanoseconds  every  day  due  to  their  velocity            according  to  special  relativity. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12069</span><span sentence-index="12069" class="">  However,  because  they  are  higher  up  in            the  earth&apos;s  gravity  well,  they  gain  45,850  nanoseconds  every  day            according  to  general  relativity. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12070</span><span sentence-index="12070" class="">  The  net  effect  is  found  by  adding  these            values  together:  they  run  38,640  nanoseconds  faster  each  day,  which            would  cause  about  10  kilometers  inaccuracy  to  build  each  day  they  are  in            orbit. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12071</span><span sentence-index="12071" class="">  To  account  for  this,  the  clocks  in  the  GPS  receivers  are            pre-adjusted  from  10.23  MHz  to  10.22999999543  MHz. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12072</span><span sentence-index="12072" class="">  The  fact  that  we  are            giving  you  a  number  to  11  decimal  places  demonstrates  the  amount  of            accuracy  the  modern  age  enjoys  in  its  time  keeping.</span></span></a></p><p><a id="I_indexterm3_id356983" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12075</span><span sentence-index="12075" class="">Once  the  bias  is  taken  care  of  and  all  the  other  possible  errors            adjusted  for,  the  converged  solution  can  be  translated  back  into            whatever  coordinate  system  is  convenient  to  give  to  the  end  user. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">223</span><span sentence-index="12076" class="">           Usually  this  is  latitude,  longitude,  and  </span></span></a><a id="I_indexterm3_id357009" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12077</span><span sentence-index="12077" class="">altitude. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">225</span><span sentence-index="12078" class=""> Next,  we  will  learn  how  to  calculate  different            quantities  based  in  the  </span></span></a><a id="I_indexterm3_id357020" class="indexterm"></a><a id="I_indexterm3_id357025" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">227</span><span sentence-index="12080" class="">geographic  coordinate  </span></span></a><a id="I_indexterm3_id357036" class="indexterm"></a><a id="I_indexterm3_id357046" class="indexterm"></a><a id="I_indexterm3_id357055" class="indexterm"></a><a id="I_indexterm3_id357065" class="indexterm"></a><a id="I_indexterm3_id357074" class="indexterm"></a><a id="I_indexterm3_id357083" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12086</span><span sentence-index="12086" class="">system.</span></span></a></p></div></div><div class="sect1" title="Location, Location, Location"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="location_comma_location_comma_location"><a id="I_indexterm3_id357083" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">236</span><span sentence-index="12089" class="">Location,  Location,  Location</span></span></a></h2></div></div></div><p><a id="I_indexterm3_id357083" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="12091" class="">Let&apos;s  take  a  minute  to  discuss  distance  between  two  </span></span></a><a id="gl22.3" class="indexterm"></a><a id="gp22.3" class="indexterm"></a><a id="la22.3" class="indexterm"></a><a id="lo22.3" class="indexterm"></a><a id="di22.3" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12096</span><span sentence-index="12096" class="">latitude  and  longitude  coordinates. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12097</span><span sentence-index="12097" class="">  You  might  be  tempted  to        calculate  it  as  the  distance  between  two  points. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12098</span><span sentence-index="12098" class="">  For  very  small  distances,        this  approximation  is  probably  accurate  enough. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12099</span><span sentence-index="12099" class="">  However,  because  the  earth        is  actually  a  sphere,  over  great  distances  the  calculated  route  will  be        much  shorter  than  the  actual  distance  along  the  surface.</span></span></a></p><p><a id="di22.3" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">249</span><span sentence-index="12102" class="">The  shortest  distance  between  two  points  on  a  sphere,  especially  in        problems  of  navigation,  is  </span></span></a><a id="I_indexterm3_id357185" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">250</span><span sentence-index="12103" class="">called  a  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">250</span><span sentence-index="12103" class="">great  circle</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12104</span><span sentence-index="12104" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12105</span><span sentence-index="12105" class="">  A  great  circle        is  the  intersection  of  a  sphere  and  a  plane  defined  by  the  center  point  of        the  sphere,  the  origin,  and  the  destination. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12106</span><span sentence-index="12106" class="">  The  resulting  course  actually        has  a  heading  that  constantly  changes. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="12107" class=""> On  ships,  this  is  avoided  in  favor        of  </span></span></a><a id="I_indexterm3_id357198" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">255</span><span sentence-index="12108" class="">using  a  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">255</span><span sentence-index="12108" class="">rhumb  line</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12109</span><span sentence-index="12109" class=""> ,  which  is  the        shortest  path  of  constant  heading. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12110</span><span sentence-index="12110" class="">  This  makes  navigation  easier  at  the        expense  of  time. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12111</span><span sentence-index="12111" class="">  Airplanes,  however,  do  follow  great-circle  routes  to        minimize  fuel  burn.</span></span></a></p><div class="sect2" title="Distance"><div class="titlepage"><div><div><h3 class="title" id="distance"><a id="I_indexterm3_id357198" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">261</span><span sentence-index="12114" class="">Distance</span></span></a></h3></div></div></div><p><a id="I_indexterm3_id357198" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="12116" class="">There  are  several  ways  of  </span></span></a><a id="I_indexterm3_id357227" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12117</span><span sentence-index="12117" class="">calculating  the  distance  along  a  great  circle. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="12118" class=""> The  one  we  will  discuss  here  </span></span></a><a id="I_indexterm3_id357238" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">266</span><span sentence-index="12119" class="">is  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">266</span><span sentence-index="12119" class="">haversine  formula</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12120</span><span sentence-index="12120" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="12121" class=""> There  are  other  methods  like  </span></span></a><a id="I_indexterm3_id357249" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="12122" class="">the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="12122" class="">spherical  law  of  cosines</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="12122" class=""> and  </span></span></a><a id="I_indexterm3_id357259" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">271</span><span sentence-index="12124" class="">the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">271</span><span sentence-index="12124" class="">Vincenty  formula</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12124</span><span sentence-index="12124" class=""> ,  but  the  haversine  is  more  accurate                for  small  distances  than  the  spherical  law  of  cosines  while  remaining  much  simpler  than  the                Vincenty  formula.</span></span></a></p><p><a id="I_indexterm3_id357259" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="12127" class="">The  haversine  formula  for  distance  is:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="12127" class="">d  =  (R)(c)</span></span></td></tr></tbody></table><p><a id="I_indexterm3_id357259" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">276</span><span sentence-index="12129" class="">where  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">276</span><span sentence-index="12129" class="">R</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">276</span><span sentence-index="12129" class=""> =  earth&apos;s  radius  and            </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">276</span><span sentence-index="12129" class="">c</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">276</span><span sentence-index="12129" class=""> is  the  angular  distance  in  radians  given            by:</span></span></a></p><div class="informalequation"><div class="mediaobject"><a id="I_indexterm3_id357259" class="indexterm"><img src="eq_2202.png" alt="Distance"></a></div></div><p><a id="I_indexterm3_id357259" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">Here,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">a</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class=""> is  the  square  of  half  the  chord            length  between  the  two  points,  calculated  as:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">a  =                sin</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>(&#x394;</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">lat</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">/2)  +                cos(lat</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">)cos(lat</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">)sin</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">(&#x394;</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">long</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="12132" class="">               /2)</span></span></td></tr></tbody></table><p><a id="I_indexterm3_id357259" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="12134" class="">Finally:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span>&#x394;</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="12134" class="">long</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="12134" class=""> =  long</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span>2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="12134" class=""> &#x2013;                long</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span>1</span></span></sub></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="12134" class="">&#x394;</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="12134" class="">lat</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="12134" class=""> =  lat</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="12134" class="">2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="12134" class=""> &#x2013;                lat</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="12134" class="">1</span></span></sub></td></tr></tbody></table><p><a id="I_indexterm3_id357259" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12136</span><span sentence-index="12136" class="">Remember  to  first  convert  the  angles  to  radians  before  using  them  in  the  trig  function. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">284</span><span sentence-index="12137" class="">               Next  we  will  begin  showing  you  an  implementation  of  several  different  formulas  in  </span></span></a><a id="I_indexterm3_id357389" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12138</span><span sentence-index="12138" class="">Objective-C;  however,  these  should  translate  to  C  with  little  modification. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">286</span><span sentence-index="12139" class="">               These  all  use  the  following  data  structure  to  hold  latitude  and  longitude                information:</span></span></a></p><a id="I_programlisting3_id357403"><pre class="programlisting">typedef enum {
float lat;
float lon;
} Coordinate2D;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">288</span><span sentence-index="12141" class="nonQuoteStr">Given  this,  the  haversine  implementation  would  look  like:</span></span></p></a><a id="I_programlisting3_id357412"><pre class="programlisting">float distanceGreatCircle(Coordinate2D startPoint, Coordinate2D endPoint){

    //Convert location from degrees to radians
    float lat1 = (M_PI/180.) * startPoint.lat;
    float lon1 = (M_PI/180.) * endPoint.longi;
    float lat2 = (M_PI/180.) * endPoint.lat;
    float lon2 = (M_PI/180.) * endPoint.longi;

    //Calculate deltas
float dLat = lat2 - lat1;
    float dLon = lon2 - lon1;

    //Calculate half chord legnth
float a = sin(dLat/2) * sin(dLat/2) + cos(lat1) * cos(lat2) * sin(dLon/2) 
                                                           * sin(dLon/2);

//Calculate angular distance
    float C = 2 * atan(sqrt(a)/sqrt(1-a));

//Find arclength
    float distance = 6371 * C; //6371 is radius of earth in km
    return distance;
}</pre></a><p><a id="I_programlisting3_id357412"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">291</span><span sentence-index="12144" class="">One  limitation  of  the  preceding  method  is  that  if  the  two  locations  are  </span></span></a><a id="I_indexterm3_id357428" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="12145" class="">nearly  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="12145" class="">antipodal</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12146</span><span sentence-index="12146" class=""> &#x2014;that  is,  on  opposite  sides  of  the                earth&#x2014;then  the  haversine  formula  may  have  round-off  issues  that  could  results  in  errors  on                the  order  of  2  km. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12147</span><span sentence-index="12147" class="">  These,  however,  will  be  over  a  distance  of  20,000  km. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12148</span><span sentence-index="12148" class="">  If  extreme  accuracy                is  required  for  nearly  antipodal  coordinates,  you  can  fall  back  to  the  spherical  law  of                cosines,  which  is  best  suited  for  large  distances  such  as  the  antipodal  case.</span></span></a></p></div><div class="sect2" title="Great-Circle Heading"><div class="titlepage"><div><div><h3 class="title" id="great-circle_heading"><a id="I_indexterm3_id357428" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">298</span><span sentence-index="12151" class="nonQuoteStr">Great-Circle  Heading</span></span></a></h3></div></div></div><p><a id="I_indexterm3_id357428" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">300</span><span sentence-index="12153" class="">As  discussed  before,  to  follow  the  shortest  path  between  two            points  on  a  </span></span></a><a id="I_indexterm3_id357455" class="indexterm"></a><a id="I_indexterm3_id357466" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12155</span><span sentence-index="12155" class="">sphere  you  must  travel  along  a  great  circle. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12156</span><span sentence-index="12156" class="">  However,  this            requires  that  your  heading  be  constantly  changing  with  time. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">304</span><span sentence-index="12157" class=""> The  formula            to  calculate  your  initial  heading,  </span></span></a><a id="I_indexterm3_id357474" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">or  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">forward  azimuth</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">,  is:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">&#x398;</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">i</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class=""> =                atan2[sin(&#x394;</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span>long</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span>)cos(lat</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span>2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">),                cos(lat</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span>1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">)sin(lat</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span>2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">)  &#x2013;                sin(lat</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">)cos(lat</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">)cos(&#x394;</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">long</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="12158" class="">)]</span></span></td></tr></tbody></table><p><a id="I_indexterm3_id357474" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">308</span><span sentence-index="12161" class="">Recall  that  </span></span></a><a id="I_indexterm3_id357529" class="indexterm"><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="12162" class="">atan2</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="12162" class=""> is  the  two-argument  variation  of  the                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="12162" class="">arctangent</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12163</span><span sentence-index="12163" class="">  function. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12164</span><span sentence-index="12164" class="">  It  returns  a  normalized  angle  in  radians  between                &#x2212;&#x3C0;  and  &#x3C0;  (&#x2212;180&#xB0;  and  180&#xB0;). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">312</span><span sentence-index="12165" class=""> The  code  that  calculates  the  value  and  returns  the  compass                bearing  is  as  follows:</span></span></a></p><a id="I_programlisting3_id357546"><pre class="programlisting">float initialBearing (Coordinate2D startPoint, Coordinate2D endPoint){
    //Convert location from degrees to radians
    float lat1 = (M_PI/180.) * startPoint.lat;
    float lon1 = (M_PI/180.) * startPoint.longi;
    float lat2 = (M_PI/180.) * endPoint.lat;
    float lon2 = (M_PI/180.) * endPoint.longi;

    //Calculate deltas
float dLat = lat2 - lat1;
    float dLon = lon2 - lon1;

    // Calculate bearing in radians
float theta = atan2f( sin(dlon) * cos(lat2), cos(lat1)*sin(lat2)-sin(lat1)*cos(lat2)
                                                                        *cos(dlon));

//Convert to compass bearing
Float bearing = theta * (180 / M_PI); //radians to degrees
bearing = ( bearing &gt; 0 ? bearing : (360.0 + bearing)); //fix range
return bearing;
}</pre><p><span class="nonQuoteStr" gspkNameUnknown="narrator" gsIndex="1"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12167</span><span sentence-index="12167" class="">A  negative  angle  involves  starting  at  0&#xB0;  and  rotating  in  the  decreasing-heading                direction,  but  compasses  aren&apos;t  labeled  with  negative  values! </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12168</span><span sentence-index="12168" class="">  To  fix  this,  the  line  that  has                the  comment  </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12169</span><span sentence-index="12169" class="" gspkNameUnknown="narrator" gsIndex="1"> &quot;fix  range&quot; </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12170</span><span sentence-index="12170" class="">  is  using  a  ternary  operator  to  say  that  if  the  bearing  is  less  than                0,  return  the  value  the  compass  would  read. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12171</span><span sentence-index="12171" class="">  For  example,  if  the  bearing  were  &#x2212;10&#xB0;,  then  the                compass  bearing  is  &#x2212;10&#xB0;  +  360&#xB0;  =  350&#xB0;. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12172</span><span sentence-index="12172" class="">  If  the  value  is  positive,  then  it  just  returns  the                same  value.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12174</span><span sentence-index="12174" class="">To  find  the  final  bearing,  we  simply  take  the  initial  bearing            going  from  the  end  point  to  the  start  point  and  then  reverse  it. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">322</span><span sentence-index="12175" class=""> The            code  is  produced  as  follows:</span></span></p></a><a id="I_programlisting3_id357571"><pre class="programlisting">float finalBearing (Coordinate2D startPoint, Coordinate2D endPoint){
    //Convert location from degrees to radians
    float lat1 = (M_PI/180.) * endPoint.lat;
    float lon1 = (M_PI/180.) * endPoint.longi;
float lat2 = (M_PI/180.) * startPoint.lat;
    float lon2 = (M_PI/180.) * startPoint.longi;

    //Calculate deltas
float dLat = lat2 - lat1;
    float dLon = lon2 - lon1;

    //Calculate bearing in radians
float theta = atan2f( sin(dlon) * cos(lat2), cos(lat1)*sin(lat2)-sin(lat1)*cos(lat2)
                                                                        *cos(dlon));

//Convert to compass bearing
float bearing = theta * (180 / M_PI); //radians to degrees
bearing = ( bearing &gt; 0 ? bearing : (360.0 + bearing)); //fix range
bearing = ((bearing + 180) % 360) //reverse heading
return bearing;
}</pre></a><p><a id="I_programlisting3_id357571"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span sentence-index="12178" class="">The  difference  here  is  that  we  have  flipped  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span sentence-index="12178" class="">lat1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span>,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span sentence-index="12178" class="">long1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span sentence-index="12178" class="">           and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span sentence-index="12178" class="">lat2</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span sentence-index="12178" class="">,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span sentence-index="12178" class="">long2</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12178</span><span sentence-index="12178" class="">  while  converting  the  locations  to            radians. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12179</span><span sentence-index="12179" class="">  Also,  before  we  return  the  bearing  value,  we  reverse  it  by            adding  180&#xB0;  degrees  to  it. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">327</span><span sentence-index="12180" class=""> The  modulo  operator  (</span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">327</span><span sentence-index="12180" class="">%</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12180</span><span sentence-index="12180" class=""> )  ensures  that  values  over  360&#xB0;  are  rolled            over  into  compass  coordinates. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12181</span><span sentence-index="12181" class="">  For  example,  if  we  calculate  a  bearing  of            350&#xB0;  and  add  180&#xB0;  to  it,  we  get  530&#xB0;  degrees. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12182</span><span sentence-index="12182" class="">  If  you  start  at  0&#xB0;  and  go            around  530&#xB0;,  you&apos;ll  end  up  at  170&#xB0;. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">330</span><span sentence-index="12183" class=""> The  modulo  operator</span></span></a><a id="I_indexterm3_id357622" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12184</span><span sentence-index="12184" class="">  will  result  in  the  bearing  being  calculated  with  this            correct  compass  value.</span></span></a></p></div><div class="sect2" title="Rhumb Line"><div class="titlepage"><div><div><h3 class="title" id="rhumb_line"><a id="I_indexterm3_id357622" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="12187" class="">Rhumb  Line</span></span></a></h3></div></div></div><p><a id="I_indexterm3_id357622" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="12189" class="">As  discussed  before,  it  is  </span></span></a><a id="I_indexterm3_id357643" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12190</span><span sentence-index="12190" class="">sometimes  preferable  to  take  a  longer  path  of  constant            heading,  called  a  rhumb  line,  as  compared  to  constantly  changing  your            heading  to  follow  a  great  circle  path. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="12191" class=""> The  rhumb  line  will  be  longer            than  the  great  circle,  and  the  distance  you  are  from  the  great  circle            route  at  any  moment  is  called  </span></span></a><a id="I_indexterm3_id357654" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">339</span><span sentence-index="12192" class="">the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">339</span><span sentence-index="12192" class="">cross  track  error</span></span></em></span><span class="nonQuoteStr" gspkNameUnknown="narrator" gsIndex="1"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12193</span><span sentence-index="12193" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12194</span><span sentence-index="12194" class="">  To  cross  the            Atlantic  is  about  5%  longer  if  you  follow  a  rhumb  line. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12195</span><span sentence-index="12195" class="">  The  extreme            example  of  going  from  the  East  Coast  of  the  United  States  to  China  is            about  30%  longer. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12196</span><span sentence-index="12196" class="">  However,  such  large  penalties  are  rarely  encountered            because  ships  have  to  alter  course  to  avoid  land! </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12197</span><span sentence-index="12197" class="">  This  makes  </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12198</span><span sentence-index="12198" class="" gspkNameUnknown="narrator" gsIndex="1"> &quot;as  the            crow  flies&quot; </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12199</span><span sentence-index="12199" class="">  examples  unrealistic.</span></span></a></p><p><a id="I_indexterm3_id357654" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12202</span><span sentence-index="12202" class="">If  your  game  is  providing  navigation  information  to  anyone  but  pilots,  it  will  probably                be  using  rhumb  lines. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12203</span><span sentence-index="12203" class="">  The  following  are  the  formulas  used  to  calculate  distance  and  bearing                between  two  coordinates  on  a  rhumb  line. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12204</span><span sentence-index="12204" class="">  The  easiest  way  to  begin  is  to  flatten  the  globe. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">352</span><span sentence-index="12205" class="">               In  a  </span></span></a><a id="I_indexterm3_id357674" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12206</span><span sentence-index="12206" class="">Mercator  projection,  rhumb  lines  are  straight. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12207</span><span sentence-index="12207" class="">  In  fact,  this  makes  graphically                solving  the  problem  very  simple. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12208</span><span sentence-index="12208" class="">  You  use  a  ruler. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12209</span><span sentence-index="12209" class="">  Mathematically,  things  get  a  bit  more                complicated. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">357</span><span sentence-index="12210" class=""> The  following  equation  gives  &#x394;&#x3C6;,  which  is  the  difference  in  latitude  after                taking  into  account  that  we  have  stretched  them  in  order  to  flatten  the  sphere:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">357</span><span sentence-index="12210" class="">&#x394;&#x3C6;  =  ln[tan(lat2/2  +  &#x3C0;/4)  /  tan(lat1/2  +  &#x3C0;/4)]</span></span></td></tr></tbody></table><p><a id="I_indexterm3_id357674" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">359</span><span sentence-index="12212" class="">The  distance  between  two  points  on  a  rhumb  line  is  given            by:</span></span></a></p><div class="informalequation"><div class="mediaobject"><a id="I_indexterm3_id357674" class="indexterm"><img src="eq_2203.png" alt="Rhumb Line"></a></div></div><p><a id="I_indexterm3_id357674" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">362</span><span sentence-index="12215" class="">The  variable  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">362</span><span sentence-index="12215" class="">q</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12215</span><span sentence-index="12215" class="">  is  a  value  whose  formula            depends  on  &#x394;&#x3C6;. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12216</span><span sentence-index="12216" class="">  If  &#x394;&#x3C6;  is  equal  to  0,  that  means  that  the  calculated            course  is  going  to  be  either  directly  east  or  west. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">364</span><span sentence-index="12217" class=""> If  that  is  the  case,            then  the  intermediate  value  of  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">364</span><span sentence-index="12217" class="">q</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">364</span><span sentence-index="12217" class=""> is:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">364</span><span sentence-index="12217" class="">q  =  cos(lat1)</span></span></td></tr></tbody></table><p><a id="I_indexterm3_id357674" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">366</span><span sentence-index="12219" class="">if  &#x394;&#x3C6;  is  not  equal  to  0,  then:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">366</span><span sentence-index="12219" class="">q  =  &#x394;</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">366</span><span sentence-index="12219" class="">lat</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">366</span><span sentence-index="12219" class="">/&#x394;&#x3C6;</span></span></td></tr></tbody></table><p><a id="I_indexterm3_id357674" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12221</span><span sentence-index="12221" class="">You  can  see  that  if  not  properly  implemented,  a  direct  east  or            west  course  would  result  in  division  by  0. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">369</span><span sentence-index="12222" class=""> Finally,  the  constant  bearing            is:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">369</span><span sentence-index="12222" class="">&#x398;</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">369</span><span sentence-index="12222" class="">rhumb</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">369</span><span sentence-index="12222" class=""> =                atan2(&#x394;</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">369</span><span sentence-index="12222" class="">long</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">369</span><span sentence-index="12222" class="">,  &#x394;&#x3C6;)</span></span></td></tr></tbody></table><p><a id="I_indexterm3_id357674" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12224</span><span sentence-index="12224" class="">There  are,  in  fact,  an  infinite  number  of  rhumb  lines  that  will  get  us  to  our  end  point. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12225</span><span sentence-index="12225" class="">                However,  the  longer  ones  will  either  take  us  the  wrong  way  around  the  globe,  or  spiral                around  the  globe  before  hitting  our  end  point. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">373</span><span sentence-index="12226" class=""> At  any  rate,  the  shortest  route  will  be  the                one  in  which  &#x394;</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">373</span><span sentence-index="12226" class="">long</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12226</span><span sentence-index="12226" class="">  is  less  that  180&#xB0;. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">374</span><span sentence-index="12227" class=""> The  preceding  is  implemented  in  </span></span></a><a id="I_indexterm3_id357781" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">375</span><span sentence-index="12228" class="">Objective-C  as  follows:</span></span></a></p><a id="I_programlisting3_id357793"><pre class="programlisting">float rhumbBearing ( Coordinate2D startPoint, Coordinate2D endPoint){
    //Convert location from degrees to radians
float lat1 = (M_PI/180.) * startPoint.lat;
    float lon1 = (M_PI/180.) * startPoint.longi;
    float lat2 = (M_PI/180.) * endPoint.lat;
    float lon2 = (M_PI/180.) * endPoint.longi;

    //Calculate deltas
float dLat = lat2 - lat1;
    float dLon = lon2 - lon1;

    //find delta phi
    float deltaPhi = log(tan(lat2/2+(M_PI)/4)/tan(lat1+M_PI/4))
    float q=(deltaPhi==0 ? dlat/deltaPhi : cos(lat1); //avoids division by 0

if (abs(dLon) &gt; M_PI){
        dLon = (dLon&gt;0 ? &#x2212;(2*(M_PI-dLon):(2*M_PI+dLon));
}

float D = sqrt(dLat*dLat + q*q*dLon*dLo)* 6371;
float theta = atan2f(dLon, deltaPhi);

//now convert to compass heading
float bearing = theta * (180 / M_PI); //radians to degrees
bearing = ( bearing &gt; 0 ? bearing : (360.0 + bearing)); //fix range

return bearing;
}</pre><p><span class="nonQuoteStr" gspkNameUnknown="narrator" gsIndex="1"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12231</span><span sentence-index="12231" class="">There  are  a  few  things  worth  pointing  out. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12232</span><span sentence-index="12232" class="">  First  is  that  we  are            using  a  ternary  function  in  the  line  commented  by  </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12233</span><span sentence-index="12233" class="" gspkNameUnknown="narrator" gsIndex="1"> &quot;avoids  division  by  0&quot; </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">381</span><span sentence-index="12234" class="">           to  take  care  of  the  case  when  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">381</span><span sentence-index="12234" class="">deltaPhi</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12234</span><span sentence-index="12234" class="">  is  equal  to  0. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="12235" class=""> If  it  is  0,            </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="12235" class="">q</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="12235" class=""> is  set  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="12235" class="">cos(lat1)</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="12235" class="">;  if  not,  then  it  is  set  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="12235" class="">dlat/deltaPhi</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12235</span><span sentence-index="12235" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">383</span><span sentence-index="12236" class=""> The  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">383</span><span sentence-index="12236" class="">if</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">383</span><span sentence-index="12236" class=""> statement  immediately  following  ensures            that  if  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">383</span><span sentence-index="12236" class="">dLon</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12236</span><span sentence-index="12236" class="">  is  greater  than  &#x3C0;            (180&#xB0;),  hence  putting  us  on  a  longer-than-required  rhumb  line,  then  we            should  correct  the  value  to  correspond  to  the  shortest  route. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">384</span><span sentence-index="12237" class=""> This  is            achieved  via  the  ternary,  which  ensures  that  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">384</span><span sentence-index="12237" class="">dLon</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12237</span><span sentence-index="12237" class="">  is  less  than  &#x3C0;  and  nonnegative. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12238</span><span sentence-index="12238" class="">  Lastly,            we  convert  from  a  normalized  radian  answer  to  a  compass            direction.</span></span></p></a><p><a id="I_programlisting3_id357793"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">388</span><span sentence-index="12241" class="">Now  that  you  have  a  good  idea  about  how  to  calculate  position  and            distance  in  the  geographic  coordinate  system,  you  can  use  the  earlier            chapters  to  determine  other  quantities  like  speed  and  </span></span></a><a id="I_indexterm3_id357858" class="indexterm"></a><a id="I_indexterm3_id357868" class="indexterm"></a><a id="I_indexterm3_id357878" class="indexterm"></a><a id="I_indexterm3_id357887" class="indexterm"></a><a id="I_indexterm3_id357896" class="indexterm"><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">12246</span><span sentence-index="12246" class="">acceleration.</span></span></a></p></div></div></section><a id="I_indexterm3_id357896" class="indexterm">
</a></body></html>