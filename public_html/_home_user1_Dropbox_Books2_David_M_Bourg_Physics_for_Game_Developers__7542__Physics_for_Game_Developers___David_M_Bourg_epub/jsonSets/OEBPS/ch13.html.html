<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><html><head><title>Chapter&#xA0;13.&#xA0;Connecting Objects</title><link rel="stylesheet" type="text/css" href="core.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="up" href="pt02.html" title="Part&#xA0;II.&#xA0;Rigid-Body Dynamics"><link rel="prev" href="ch12.html" title="Chapter&#xA0;12.&#xA0;3D Rigid-Body Simulator"><link rel="next" href="ch14.html" title="Chapter&#xA0;14.&#xA0;Physics Engines"></head><body>
         
        <script>
        function ok(){ 
            window.gggs()
            return;
            //$('#musicPlayer').parent().remove();
            //speakTransportPanelDialogV2.closeEmoteDialog()
            //speakTransportPanelDialog.closeEmoteDialog()
            //
            debugger
            let url = 'http://127.0.0.1:8080/uploads/extracted/' +
             'Crazy Rich Asians  Kevin Kwanepub/' +
              'jsonSets/OEBPS/Kwan_9780385536981_epub_prl_r1.htm.html.sentences.json'
            speakTransportPanelDialogV2.sideLoadSentences2(null, null, null, url)
            
        }
        setTimeout(ok, 1500)
        </script>
        <div style="background:white">````````</div><section class="chapter" title="Chapter&#xA0;13.&#xA0;Connecting Objects" epub:type="chapter" id="connecting_objects"><div class="titlepage"><div><div><h2 class="title"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">1</span><span sentence-index="7125" class="">Chapter&#xA0;13.&#xA0;Connecting  Objects</span></span></h2></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">2</span><span sentence-index="7126" class="">Simulating  particles  and  rigid  bodies  is  </span></span><a id="ob13.0" class="indexterm"></a><a id="I_indexterm7_id333789" class="indexterm"></a><a id="mo13.0" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7129</span><span sentence-index="7129" class="">great  fun,  and  with  these  simple  entities  you  can  achieve  a    wide  variety  of  effects  or  simulate  a  wide  variety  of  objects. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7130</span><span sentence-index="7130" class="">  In  this    chapter  we&apos;ll  take  things  a  step  further,  showing  you  how  to  simulate    connected  particles  and  rigid  bodies. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7131</span><span sentence-index="7131" class="">  Doing  so  opens  a  whole  new  realm  of    possibilities. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">8</span><span sentence-index="7132" class=""> In  this  book&apos;s  first  edition,  David  showed  you  how  to  use    </span></span></a><a id="I_indexterm7_id333818" class="indexterm"></a><a id="I_indexterm7_id333827" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7134</span><span sentence-index="7134" class="">springs  and  particles  to  simulate  cloth. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">11</span><span sentence-index="7135" class=""> </span></span></a><a class="xref" href="ch17.html" title="Chapter&#xA0;17.&#xA0;Cars and Hovercraft"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">12</span><span sentence-index="7136" class="">Chapter&#xA0;17</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">12</span><span sentence-index="7136" class=""> in  the  first  edition  covers  that,  and  the    </span></span><a id="I_indexterm7_id333844" class="indexterm"></a><a id="I_indexterm7_id333850" class="indexterm"><span class="nonQuoteStr" gspkNameUnknown="narrator" gsIndex="1"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7138</span><span sentence-index="7138" class="">corresponding  </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7139</span><span sentence-index="7139" class="" gspkNameUnknown="narrator" gsIndex="1"> &quot;Cloth  Simulation&quot; </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7140</span><span sentence-index="7140" class="">  example  on  the  book&apos;s  website    implements  the  model. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">17</span><span sentence-index="7141" class=""> As  shown  in  </span></span></a><a class="xref" href="ch13.html#network_of_particles_and_springs" title="Figure&#xA0;13-1.&#xA0;Network of particles and springs"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">18</span><span sentence-index="7142" class="">Figure&#xA0;13-1</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">18</span><span sentence-index="7142" class="">,  the  </span></span><a id="I_indexterm7_id333867" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7144</span><span sentence-index="7144" class="">flag  model  is  simply  a  collection  of  particles  initially  laid    out  in  a  grid  pattern  connected  by  linear  springs  that  are  then  rendered  to    look  like  cloth. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7145</span><span sentence-index="7145" class="">  The  springs  give  structure  to  the  particles,  keeping  them    organized  in  a  mesh  that  can  be  rendered  while  allowing  them  to  move,    emulating  the  movement  of  a  flowing  fabric.</span></span></a></p><div class="figure"><a id="network_of_particles_and_springs"></a><div class="figure-contents"><a id="network_of_particles_and_springs"></a><div class="mediaobject"><a id="network_of_particles_and_springs"></a><a id="I_mediaobject7_id333887"><img src="httpatomoreillycomsourceoreillyimages1598954.png.jpg" alt="Network of particles and springs"></a></div></div><div class="figure-title"><a id="I_mediaobject7_id333887"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">27</span><span sentence-index="7151" class="">Figure&#xA0;13-1.&#xA0;Network  of  particles  and  springs</span></span></a></div></div><p><a id="I_mediaobject7_id333887"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">29</span><span sentence-index="7153" class="">Each  line  in  the  wireframe  flag  shown  in  </span></span></a><a class="xref" href="ch13.html#network_of_particles_and_springs" title="Figure&#xA0;13-1.&#xA0;Network of particles and springs"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">30</span><span sentence-index="7154" class="">Figure&#xA0;13-1</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7155</span><span sentence-index="7155" class="">  represents  a  spring-damper    element,  while  the  nodes  where  these  springs  intersect  represent  the    particles. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">32</span><span sentence-index="7156" class=""> We  modeled  the  springs  using  the  </span></span><a id="I_indexterm7_id333914" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">33</span><span sentence-index="7157" class="">spring-damper  formulas  that  we  showed  you  back  in  </span></span></a><a class="xref" href="ch03.html" title="Chapter&#xA0;3.&#xA0;Force"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">35</span><span sentence-index="7159" class="">Chapter&#xA0;3</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7159</span><span sentence-index="7159" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7160</span><span sentence-index="7160" class="">  The  (initially)  horizontal  and  vertical  springs  provide    the  basic  structure  for  the  flag,  while  the  diagonal  springs  are  there  to    resist  shear  forces  and  lend  further  strength  to  the  cloth. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7161</span><span sentence-index="7161" class="">  Without  these    shear  springs,  the  cloth  would  be  quite  stretchy. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7162</span><span sentence-index="7162" class="">  Note  that  there  are  no    particles  located  at  the  intersection  of  the  diagonal  springs.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7164</span><span sentence-index="7164" class="">In  this  chapter,  we&apos;ll  show  you  how  to  use  those  same  techniques  to    simulate  something  like  a  hanging  rope  or  vine. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7165</span><span sentence-index="7165" class="">  You  can  use  these  techniques    to  simulate  all  sorts  of  things  besides  cloth  and  rope  or  vines. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7166</span><span sentence-index="7166" class="">  For    example,  you  can  model  the  swing  of  a  golf  club  if  you  can  imagine  one  rigid    body  representing  the  arm  and  another  representing  the  golf  club. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">43</span><span sentence-index="7167" class=""> We&apos;ll  get    to  that  example  in  </span></span><a class="xref" href="ch19.html" title="Chapter&#xA0;19.&#xA0;Sports"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">44</span><span sentence-index="7168" class="">Chapter&#xA0;19</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7169</span><span sentence-index="7169" class=""> ,  but  for  now  let&apos;s  see  how  to    model  a  hanging  rope  or  vine  and  some  other  springy  objects.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7171</span><span sentence-index="7171" class="">Application  of  linear  springs  is  not  the  only  method  available  to  connect  objects,  but  it        has  the  advantages  of  being  conceptually  simple,  easy  to  implement,  and  effective. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7172</span><span sentence-index="7172" class="">  One  of  the        potential  disadvantages  is  that  you  can  run  into  numerical  stability  problems  if  the  springs  are        too  stiff. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7173</span><span sentence-index="7173" class="">  We&apos;ll  talk  more  about  these  issues  throughout  this  chapter. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7174</span><span sentence-index="7174" class="">  Also,  the  examples  we&apos;ll        cover  are  in  2D  for  simplicity,  but  the  techniques  apply  in  3D,  too.</span></span></p><div class="sect1" title="Springs and Dampers"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="springs_and_dampers-id1"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">52</span><span sentence-index="7176" class="">Springs  and  Dampers</span></span></h2></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">53</span><span sentence-index="7177" class="">You  learned  in  </span></span><a class="xref" href="ch03.html" title="Chapter&#xA0;3.&#xA0;Force"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">54</span><span sentence-index="7178" class="">Chapter&#xA0;3</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">54</span><span sentence-index="7178" class=""> that  </span></span><a id="I_indexterm7_id333971" class="indexterm"></a><a id="I_indexterm7_id333981" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7181</span><span sentence-index="7181" class="">springs  are  structural  elements  that,  when  connected  between        two  objects,  apply  equal  and  opposite  forces  to  each  object. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">58</span><span sentence-index="7182" class=""> This  spring        force  follows  </span></span></a><a id="I_indexterm7_id333993" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7183</span><span sentence-index="7183" class="">Hooke&apos;s  law  and  is  a  function  of  the  stretched  or  compressed        length  of  the  spring  relative  to  the  rest  length  of  the  spring  and  the        spring  constant. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span sentence-index="7184" class=""> The  spring  constant</span></span></a><a id="I_indexterm7_id334002" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="7185" class=""> is  a  quantity  that  relates  the  force  exerted  by  the  spring        to  its  deflection:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="7185" class="">F</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span>s</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="7185" class=""> =  &#x2013;k</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="7185" class="">s</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="7185" class=""> (L  &#x2013;            r)</span></span></td></tr></tbody></table><p><a id="I_indexterm7_id334002" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span sentence-index="7188" class="">Here,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span sentence-index="7188" class="">F</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span>s</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span sentence-index="7188" class=""> is  the  spring        force,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span sentence-index="7188" class="">k</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span sentence-index="7188" class="">s</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span sentence-index="7188" class=""> is  the  spring        constant,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span sentence-index="7188" class="">L</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span sentence-index="7188" class=""> is  the  stretched  or  compressed  length  of        the  spring,  and  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span sentence-index="7188" class="">r</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7188</span><span sentence-index="7188" class="">  is  the  rest  length  of  the  spring. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7189</span><span sentence-index="7189" class="">        The  negative  sign  in  the  preceding  equation  just  means  that  the  force  is        in  the  opposite  direction  of  the  displacement.</span></span></a></p><p><a id="I_indexterm7_id334002" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7192</span><span sentence-index="7192" class="">Dampers  are  usually  used  in  conjunction  with  springs  in  numerical        simulations. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7193</span><span sentence-index="7193" class="">  They  act  like  viscous  drag  in  that  dampers  act  against        velocity. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">70</span><span sentence-index="7194" class=""> The  force  developed  by  a  damper  is  proportional  to  the  relative        velocity  of  the  connected  objects  and  a</span></span></a><a id="I_indexterm7_id334062" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">71</span><span sentence-index="7195" class=""> damping  constant,        </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">71</span><span sentence-index="7195" class="">k</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">71</span><span sentence-index="7195" class="">d</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7196</span><span sentence-index="7196" class=""> ,  that  relates  relative        velocity  to  damping  force.</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">73</span><span sentence-index="7197" class="">F</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">73</span><span>d</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">73</span><span sentence-index="7197" class=""> =  &#x2013;k</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">73</span><span sentence-index="7197" class="">d</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">73</span><span sentence-index="7197" class="">           (v</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">73</span><span sentence-index="7197" class="">1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">73</span><span sentence-index="7197" class=""> &#x2013;  v</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">73</span><span sentence-index="7197" class="">2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">73</span><span sentence-index="7197" class="">)</span></span></td></tr></tbody></table><p><a id="I_indexterm7_id334062" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">75</span><span sentence-index="7199" class="">This  equation  shows  the  damping  force,        </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">75</span><span sentence-index="7199" class="">F</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">75</span><span sentence-index="7199" class="">d</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7199</span><span sentence-index="7199" class=""> ,  as  a  function  of  the        damping  constant  and  the  relative  velocity  of  the  connected  points  on  the        two  connected  bodies.</span></span></a></p><p><a id="I_indexterm7_id334062" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">78</span><span sentence-index="7202" class="">Typically,  springs  and  dampers  are  combined  into  a  single  </span></span></a><a id="I_indexterm7_id334119" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7203</span><span sentence-index="7203" class="">spring-damper  element  where  a  single  formula  is  used  to        represent  the  combined  force. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class=""> In  vector  notation,  the  formula  for  a        spring-damper  element  connecting  two  bodies  is:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class="">F</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span>1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class=""> =            &#x2013;{k</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class="">s</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class=""> (L  &#x2013;  r)  +  k</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class="">d</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class="">           ((</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class="">1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class=""> &#x2013;            </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class="">v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class="">2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class="">)  &#x2022;            </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span>L</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class="">)/L}  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class="">L</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="7204" class="">/L</span></span></td></tr></tbody></table><p><a id="I_indexterm7_id334119" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span sentence-index="7206" class="">Here,  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span>F</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span>1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span sentence-index="7206" class="">       is  the  force  exerted  on  body  1,  while  the  force,  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span>F</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span>2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span sentence-index="7206" class="">,  exerted  on  body  2        is:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span>F</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span sentence-index="7206" class="">2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span sentence-index="7206" class=""> =            &#x2013;</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span sentence-index="7206" class="">F</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span sentence-index="7206" class="">1</span></span></sub></td></tr></tbody></table><p><a id="I_indexterm7_id334119" class="indexterm"><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">84</span><span>L</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">84</span><span sentence-index="7208" class=""> is  the  length  of  the        spring-damper  (</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">84</span><span>L</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">84</span><span sentence-index="7208" class="">,  not  in  bold  print,  is  the  magnitude        of  the  vector  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">84</span><span sentence-index="7208" class="">L</span></span></strong></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7208</span><span sentence-index="7208" class=""> ),  which  is  equal  to  the        vector  difference  in  position  between  the  connected  points  on  bodies  1  and        2. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">85</span><span sentence-index="7209" class=""> If  the  connected  objects  are  particles,  then  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">85</span><span sentence-index="7209" class="">L</span></span></strong></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7209</span><span sentence-index="7209" class="">  is  equal  to  the  position  of  body  1  minus  the        position  of  body  2. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">86</span><span sentence-index="7210" class=""> Similarly,  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">86</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">86</span><span sentence-index="7210" class="">1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">86</span><span sentence-index="7210" class=""> and  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">86</span><span sentence-index="7210" class="">v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">86</span><span sentence-index="7210" class="">2</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7210</span><span sentence-index="7210" class="">  are  the  velocities  of        the  connected  points  on  bodies  1  and  2. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">87</span><span sentence-index="7211" class=""> The  quantity  (</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">87</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">87</span><span sentence-index="7211" class="">1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">87</span><span sentence-index="7211" class=""> &#x2013;  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">87</span><span sentence-index="7211" class="">v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">87</span><span sentence-index="7211" class="">2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">87</span><span sentence-index="7211" class="">)  represents  the        </span></span></a><a id="I_indexterm7_id334288" class="indexterm"></a><a id="I_indexterm7_id334299" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7213</span><span sentence-index="7213" class="">relative  velocity  between  the  connected  bodies.</span></span></a></p><p><a id="I_indexterm7_id334299" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7216</span><span sentence-index="7216" class="">It&apos;s  fairly  straightforward  to  connect  particles  with  springs  (and        dampers);  you  need  only  specify  the  particles  to  which  the  spring  is        connected  and  compute  the  stretched  or  compressed  length  of  the  spring  as        the  particles  move  relative  to  each  other. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7217</span><span sentence-index="7217" class="">  The  force  generated  by  the        spring  is  then  applied  equally  (but  in  opposite  directions)  to  the        connected  particles. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7218</span><span sentence-index="7218" class="">  This  is  a  linear  force.</span></span></a></p><p><a id="I_indexterm7_id334299" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7221</span><span sentence-index="7221" class="">For  rigid  bodies,  things  are  a  bit  more  complicated. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7222</span><span sentence-index="7222" class="">  First,  not  only        do  you  have  to  specify  to  which  body  the  spring  is  attached,  but  you  must        also  specify  the  precise  points  on  each  object  where  the  spring  attaches. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7223</span><span sentence-index="7223" class="">        Then,  in  addition  to  the  linear  force  applied  by  the  spring  to  each  body,        you  must  also  compute  the  resulting  moment  on  each  body  causing  each  to        rotate.</span></span></a></p></div><div class="sect1" title="Connecting Particles"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="connecting_particles"><a id="I_indexterm7_id334299" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">102</span><span sentence-index="7226" class="">Connecting  Particles</span></span></a></h2></div></div></div><p><a id="I_indexterm7_id334299" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">104</span><span sentence-index="7228" class="">From  </span></span></a><a id="co13.2" class="indexterm"></a><a id="pa13.2" class="indexterm"></a><a id="cop13.2" class="indexterm"></a><a id="pc13.2" class="indexterm"></a><a id="ro13.2" class="indexterm"></a><a id="vi13.2" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">110</span><span sentence-index="7234" class="">swinging  vines  in  Activision&apos;s  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">110</span><span sentence-index="7234" class="">Pitfall</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">110</span><span sentence-index="7234" class="">       to  barnacle  tongues  in  Valve  Corporation&apos;s  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">110</span><span sentence-index="7234" class="">Half-Life</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7234</span><span sentence-index="7234" class=""> ,        dangling  rope-like  objects  have  appeared  in  video  games  in  various        incarnations  since  the  very  early  days  of  video  gaming. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">111</span><span sentence-index="7235" class=""> Some        implementations,  such  as  those  in  the  1982  versions  of        </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">111</span><span sentence-index="7235" class="">Pitfall</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7235</span><span sentence-index="7235" class=""> ,  are  implemented  rather  simply  and        unrealistically,  while  others,  such  as  barnacle  tongues,  are  implemented        more  realistically  in  how  they  dangle  and  swing. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7236</span><span sentence-index="7236" class="">  Whether  it&apos;s  a  vine,        rope,  chain,  or  tongue,  you  can  use  particles  and  springs  to  simulate        realistic  rope-like  behavior. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7237</span><span sentence-index="7237" class="">  We&apos;ll  show  you  how  in  the  following  simple        example.</span></span></a></p><div class="sect2" title="Rope"><div class="titlepage"><div><div><h3 class="title" id="rope"><a id="vi13.2" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">116</span><span sentence-index="7240" class="">Rope</span></span></a></h3></div></div></div><p><a id="vi13.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7242</span><span sentence-index="7242" class="">You  know  from  your  real-life  experience  that  ropes  are  flexible,  although  some  are  more                flexible  than  others. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7243</span><span sentence-index="7243" class="">  Ropes  are  elastic  and  stretch  to  varying  extents. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7244</span><span sentence-index="7244" class="">  They  drape  when                suspended  by  their  two  ends. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7245</span><span sentence-index="7245" class="">  They  bend  when  swinging  or  when  collapsing  on  the  ground. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7246</span><span sentence-index="7246" class="">  We                can  capture  all  these  behaviors  using  simple  particles  connected  with  springs. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">123</span><span sentence-index="7247" class=""> </span></span></a><a class="xref" href="ch13.html#swinging_rope" title="Figure&#xA0;13-2.&#xA0;Swinging rope"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">124</span><span sentence-index="7248" class="">Figure&#xA0;13-2</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7249</span><span sentence-index="7249" class="">  illustrates  the  rope  example  we&apos;ll  cover  here.</span></span></p><div class="figure"><a id="swinging_rope"></a><div class="figure-contents"><a id="swinging_rope"></a><div class="mediaobject"><a id="swinging_rope"></a><a id="I_mediaobject7_id334464"><img src="httpatomoreillycomsourceoreillyimages1598955.png" alt="Swinging rope"></a></div></div><div class="figure-title"><a id="I_mediaobject7_id334464"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">131</span><span sentence-index="7255" class="">Figure&#xA0;13-2.&#xA0;Swinging  rope</span></span></a></div></div><p><a id="I_mediaobject7_id334464"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7257</span><span sentence-index="7257" class="">The  example  consists  of  a  rope  comprising  10  particles  and  9            springs. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7258</span><span sentence-index="7258" class="">  At  the  start  of  the  simulation,  the  rope,  originally  extended            straight  out  to  the  right,  falls  under  the  influence  of  gravity,            swinging  left  and  right  until  it  comes  to  rest  (hanging  straight  down). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">135</span><span sentence-index="7259" class="">           The  dots  represent  particles  and  the  lines  represent  </span></span></a><a id="sp13.2.1" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7260</span><span sentence-index="7260" class="">springs. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">137</span><span sentence-index="7261" class=""> The  topmost  particle  is  fixed,  and  the            illustration  on  the  left  in  </span></span></a><a class="xref" href="ch13.html#swinging_rope" title="Figure&#xA0;13-2.&#xA0;Swinging rope"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">138</span><span sentence-index="7262" class="">Figure&#xA0;13-2</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7263</span><span sentence-index="7263" class="">  shows  the            rope  swinging  down  from  right  to  left  while  the  illustration  on  the            right  shows  the  rope  swinging  back  from  left  to  right.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">141</span><span sentence-index="7265" class="">This  example  uses  all  the  same  code  and  techniques  presented  in            </span></span><a class="xref" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Real-Time Simulations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">142</span><span sentence-index="7266" class="">Chapter&#xA0;7</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">142</span><span sentence-index="7266" class=""> through  </span></span><a class="xref" href="ch09.html" title="Chapter&#xA0;9.&#xA0;2D Rigid-Body Simulator"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">144</span><span sentence-index="7268" class="">Chapter&#xA0;9</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7268</span><span sentence-index="7268" class="">  for  simulating  particles  and  rigid            bodies. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7269</span><span sentence-index="7269" class="">  Really,  the  only  difference  is  that  we  have  to  compute  a  new            force&#x2014;the  spring  force  on  each  object. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7270</span><span sentence-index="7270" class="">  But  before  we  do  that,  we  have  to            define  and  initialize  the  springs.</span></span></p><div class="sect3" title="Spring structure and variables"><div class="titlepage"><div><div><h4 class="title" id="spring_structure_and_variables"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">148</span><span sentence-index="7272" class="">Spring  structure  and  variables</span></span></h4></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">149</span><span sentence-index="7273" class="">The  following  code  sample  shows  the  spring  data  structure  we  set                up  to  store  each  spring&apos;s  information:</span></span></p><a id="I_programlisting7_id334542"><pre class="programlisting">typedef struct _Spring {
    int        End1;
    int        End2;
    float      k;
    float      d;
    float      InitialLength;
} Spring, *pSpring;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">151</span><span sentence-index="7275" class="">Specifically,  this  information  includes:</span></span></p><div class="variablelist"><dl><dt><span class="term"><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">151</span><span sentence-index="7275" class="">End1</span></span></code></span></dt><dd><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">152</span><span sentence-index="7276" class="">A  reference  to  the  first  particle  to  which  the  spring  is                            connected</span></span></p></dd><dt><span class="term"><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">152</span><span sentence-index="7276" class="">End2</span></span></code></span></dt><dd><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="7277" class="">A  reference  to  the  second  particle  to  which  the  spring  is                            connected</span></span></p></dd><dt><span class="term"><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="7277" class="">k</span></span></code></span></dt><dd><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">154</span><span sentence-index="7278" class="">The  spring  constant</span></span></p></dd><dt><span class="term"><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">154</span><span sentence-index="7278" class="">d</span></span></code></span></dt><dd><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">155</span><span sentence-index="7279" class="">The  damping  constant</span></span></p></dd><dt><span class="term"><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">155</span><span sentence-index="7279" class="">InitialLength</span></span></code></span></dt><dd><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">156</span><span sentence-index="7280" class="">The  unstretched  length  of  the  spring</span></span></p></dd></dl></div><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7281</span><span sentence-index="7281" class="">This  structure  is  appropriate  for  connecting  particles. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7282</span><span sentence-index="7282" class="">  We&apos;ll                make  a  slight  modification  to  this  structure  later,  when  we  get  to  the                example  where  we&apos;re  connecting  rigid  bodies.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">160</span><span sentence-index="7284" class="">There  are  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">160</span><span sentence-index="7284" class="">define</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">160</span><span sentence-index="7284" class="">s  and                variables  unique  to  this  example  that  must  be  set  up  as                follows:</span></span></p></a><a id="I_programlisting7_id334665"><pre class="programlisting">#define        _NUM_OBJECTS     10
#define        _NUM_SPRINGS     9
#define        _SPRING_K        1000
#define        _SPRING_D        100

Particle        Objects[_NUM_OBJECTS];
Spring          Springs[_NUM_SPRINGS];</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7286</span><span sentence-index="7286" class="">As  stated  earlier,  there  are  10  particles  (objects)  and  9                springs  in  this  simulation. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">163</span><span sentence-index="7287" class=""> The  arrays  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">163</span><span sentence-index="7287" class="">Objects</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">163</span><span sentence-index="7287" class=""> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">163</span><span sentence-index="7287" class="">Springs</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7287</span><span sentence-index="7287" class="">  are  used  to  keep  track  of  them. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">164</span><span sentence-index="7288" class=""> We                also  set  up  a  few  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">164</span><span sentence-index="7288" class="">define</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7288</span><span sentence-index="7288" class="">s                representing  the  spring  and  damping  constants. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7289</span><span sentence-index="7289" class="">  The  values  shown  here                are  arbitrary,  and  you  can  change  them  to  suit  whatever  behavior  you                desire. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7290</span><span sentence-index="7290" class="">  The  higher  the  spring  constant,  the  stiffer  the  springs;                whereas  the  lower  the  spring  constant,  the  stretchier  the  springs. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7291</span><span sentence-index="7291" class="">                Stretchy  springs  make  your  rope  more  elastic. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7292</span><span sentence-index="7292" class="">  Keep  in  mind  while                tuning  these  values  that  if  you  make  the  spring  constant  too  high,                you&apos;ll  probably  have  to  make  the  simulation  time  step  smaller  and/or                use  a  robust  integration  scheme  to  avoid  numerical                instabilities.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7294</span><span sentence-index="7294" class="">The  damping  constant  controls  how  quickly  the  springiness  of  the                springs  dampens  out. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7295</span><span sentence-index="7295" class="">  You&apos;ll  end  up  tuning  this  value  to  get  the                behavior  you  desire. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7296</span><span sentence-index="7296" class="">  A  small  value  can  make  the  rope  seem  jittery,                while  a  large  value  will  make  the  stretchiness  appear  smoother. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7297</span><span sentence-index="7297" class="">  Higher                damping  also  helps  alleviate  numerical  instabilities  to  some  extent,                although  it&apos;s  no  substitute  for  a  robust  integration  scheme.</span></span></p></a></div><div class="sect3" title="Initialize the particles and springs"><div class="titlepage"><div><div><h4 class="title" id="initialize_the_particles_and_springs"><a id="I_programlisting7_id334665"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">176</span><span sentence-index="7300" class="">Initialize  the  particles  and  springs</span></span></a></h4></div></div></div><p><a id="I_programlisting7_id334665"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">178</span><span sentence-index="7302" class="">Initially,  our  particle  rope  is  set  up  horizontally,  as  shown  in                </span></span></a><a class="xref" href="ch13.html#particle_rope_setup" title="Figure&#xA0;13-3.&#xA0;Particle rope setup"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="7303" class="">Figure&#xA0;13-3</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="7303" class="">,  with  the  leftmost  particle,                </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span>p0</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="7303" class="">,  fixed&#x2014;that  is,  the  particle                </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span>p0</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="7303" class=""> will  not  move,  and  the  remainder  of  the  rope                will  pivot  about  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="7303" class="">p0</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7304</span><span sentence-index="7304" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7305</span><span sentence-index="7305" class="">  For  convenience,  all                remaining  particles  are  incrementally  indexed  from  left  to                right.</span></span></p><div class="figure"><a id="particle_rope_setup"></a><div class="figure-contents"><a id="particle_rope_setup"></a><div class="mediaobject"><a id="particle_rope_setup"></a><a id="I_mediaobject7_id334748"><img src="httpatomoreillycomsourceoreillyimages1598956.png" alt="Particle rope setup"></a></div></div><div class="figure-title"><a id="I_mediaobject7_id334748"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">187</span><span sentence-index="7311" class="">Figure&#xA0;13-3.&#xA0;Particle  rope  setup</span></span></a></div></div><p><a id="I_mediaobject7_id334748"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">189</span><span sentence-index="7313" class="">There  are  nine  springs,  which  are  indexed  from  left  to  right  as  illustrated  in  </span></span></a><a class="xref" href="ch13.html#particle_rope_setup" title="Figure&#xA0;13-3.&#xA0;Particle rope setup"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">190</span><span sentence-index="7314" class="">Figure&#xA0;13-3</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7315</span><span sentence-index="7315" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7316</span><span sentence-index="7316" class="">  Spring  0  connects  particle  0  to  particle  1,  spring  1                    connects  particle  1  to  particle  2,  and  so  on. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="7317" class=""> The  following  code  sample  shows  how  all  this                    is  initialized:</span></span></p><a id="I_programlisting7_id334777"><pre class="programlisting">bool    Initialize(void)
{
    Vector    r;
    int       i;

    Objects[0].bLocked = true;

    // Initialize particle locations from left to right.
    for(i=0; i&lt;_NUM_OBJECTS; i++)
    {
        Objects[i].vPosition.x = _WINWIDTH/2 + Objects[0].fLength * i;
        Objects[i].vPosition.y = _WINHEIGHT/8;
    }

    // Initialize springs connecting particles from left to right.
    for(i=0; i&lt;_NUM_SPRINGS; i++)
    {
        Springs[i].End1 = i;
        Springs[i].End2 = i+1;
        r = Objects[i+1].vPosition - Objects[i].vPosition;

        Springs[i].InitialLength = r.Magnitude();
        Springs[i].k = _SPRING_K;
        Springs[i].d = _SPRING_D;
    }
    return true;
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">195</span><span sentence-index="7319" class="">First,  the  local  variables  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">195</span><span sentence-index="7319" class="">r</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">195</span><span sentence-index="7319" class="">               and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">195</span><span sentence-index="7319" class="">i</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7319</span><span sentence-index="7319" class="">  are  declared. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="7320" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="7320" class="">r</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="7320" class=""> will  be  used  to  compute  the  initial,                unstretched  length  of  the  springs,  and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="7320" class="">i</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="7320" class=""> will  be  used  to  index  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="7320" class="">Objects</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="7320" class=""> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="7320" class="">Springs</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7320</span><span sentence-index="7320" class="">  arrays. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">197</span><span sentence-index="7321" class=""> Second,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">197</span><span sentence-index="7321" class="">Objects[0]</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">197</span><span sentence-index="7321" class="">,  the  one  that  is  fixed,  has  its                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">197</span><span sentence-index="7321" class="">bLocked</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">197</span><span sentence-index="7321" class=""> property  set  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">197</span><span sentence-index="7321" class="">true</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7321</span><span sentence-index="7321" class=""> ,  indicating  that  it  does  not  move  (that                is,  it&apos;s  locked).</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">199</span><span sentence-index="7323" class="">Next,  the  particle  positions  are  initialized  starting  from  the  first  particle&#x2014;the                    fixed  one  positioned  at  the  middle  of  the  screen&#x2014;and  proceeding  to  the  rest  of  the                    particles,  offsetting  each  to  the  right  by  an  amount  equal  to  property  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">199</span><span sentence-index="7323" class="">fLength</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7323</span><span sentence-index="7323" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="7324" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="7324" class="">fLength</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7324</span><span sentence-index="7324" class="">  is  an                    arbitrary  length  that  you  can  define,  that  represents  the  spacing  of  the  particles  and,                    subsequently,  the  initial  length  of  the  springs  connecting  the  particles.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7326</span><span sentence-index="7326" class="">Finally,  we  set  up  the  springs,  connecting  each  particle  to  its                neighbor  on  the  right. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="7327" class=""> Starting  at  the  first  spring,  we  set  its  end                references  to  the  index  of  the  particle  to  its  left  and  right  in  the                properties  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="7327" class="">End1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="7327" class=""> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="7327" class="">End2</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7327</span><span sentence-index="7327" class=""> ,  respectively. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">204</span><span sentence-index="7328" class=""> These  indices  are  simply                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">204</span><span sentence-index="7328" class="">i</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">204</span><span sentence-index="7328" class=""> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">204</span><span sentence-index="7328" class="">i+1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">204</span><span sentence-index="7328" class="">,  as  shown  in  the  preceding  code  sample                within  the  last  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">204</span><span sentence-index="7328" class="">for</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7328</span><span sentence-index="7328" class="">  loop. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">205</span><span sentence-index="7329" class=""> The                initial  length  vector  of  the  spring  is  computed  and  stored  in  the                vector  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">205</span><span sentence-index="7329" class="">r</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">205</span><span sentence-index="7329" class="">,  where  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">205</span><span sentence-index="7329" class="">r  =  Objects[i+1].vPosition  -                Objects[i].vPosition</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7329</span><span sentence-index="7329" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">206</span><span sentence-index="7330" class=""> The  magnitude  of  this  vector  is  the                initial  spring  length,  which  is  stored  in  the  spring&apos;s  property,                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">206</span><span sentence-index="7330" class="">InitialLength</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7330</span><span sentence-index="7330" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">207</span><span sentence-index="7331" class=""> This  step  isn&apos;t                strictly  necessary  in  this  example  since  you  already  know  that  the                property  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">207</span><span sentence-index="7331" class="">fLength</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7331</span><span sentence-index="7331" class="">  discussed  earlier                is  the  initial  length  of  each  spring. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7332</span><span sentence-index="7332" class="">  However,  we&apos;ve  done  it  this                general  way  since  you  may  not  necessarily  initialize  the  particle                positions  as  we  have  simply  done.</span></span></p></a></div><div class="sect3" title="Update the simulation"><div class="titlepage"><div><div><h4 class="title" id="update_the_simulation"><a id="I_programlisting7_id334777"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">211</span><span sentence-index="7335" class="">Update  the  simulation</span></span></a></h4></div></div></div><p><a id="I_programlisting7_id334777"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">213</span><span sentence-index="7337" class="">Updating  the  particle  positions  at  </span></span></a><a id="si13.2.1.3" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">214</span><span sentence-index="7338" class="">each  simulation  time  step,  under  the  influence  of  gravity  and  spring  forces                    proceeds  just  like  in  the  earlier  examples  of  </span></span></a><a class="xref" href="ch08.html" title="Chapter&#xA0;8.&#xA0;Particles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">216</span><span sentence-index="7340" class="">Chapter&#xA0;8</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">216</span><span sentence-index="7340" class=""> and  </span></span><a class="xref" href="ch09.html" title="Chapter&#xA0;9.&#xA0;2D Rigid-Body Simulator"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="7341" class="">Chapter&#xA0;9</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7342</span><span sentence-index="7342" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7343</span><span sentence-index="7343" class="">  Essentially,  you  must  compute  the  forces  on  the                    particles,  integrate  the  equations  of  motion,  and  redraw  the  scene. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">220</span><span sentence-index="7344" class=""> As  usual  in  our                    examples,  the  function  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">220</span><span sentence-index="7344" class="">UpdateSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7344</span><span sentence-index="7344" class="">  is  called  on  to                    perform  these  tasks. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">221</span><span sentence-index="7345" class=""> For  the  current  example,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">221</span><span sentence-index="7345" class="">UpdateSimulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">221</span><span sentence-index="7345" class=""> looks  like  this:</span></span></p><a id="I_programlisting7_id334990"><pre class="programlisting">void    UpdateSimulation(void)
{
    double    dt = _TIMESTEP;
    int       i;
    double    f, dl;
    Vector    pt1, pt2;
    int       j;
    Vector    r;
    Vector    F;
    Vector    v1, v2, vr;

    // Initialize the spring forces on each object to zero.
    for(i=0; i&lt;_NUM_OBJECTS; i++)
    {
        Objects[i].vSprings.x = 0;
        Objects[i].vSprings.y = 0;
        Objects[i].vSprings.z = 0;
    }

    // Calculate all spring forces based on positions of connected objects.
    for(i=0; i&lt;_NUM_SPRINGS; i++)
    {
        j = Springs[i].End1;
        pt1 = Objects[j].vPosition;
        v1 = Objects[j].vVelocity;

        j = Springs[i].End2;
        pt2 = Objects[j].vPosition;
        v2 = Objects[j].vVelocity;

        vr = v2 - v1;
        r = pt2 - pt1;
        dl = r.Magnitude() - Springs[i].InitialLength;
        f = Springs[i].k * dl; // - means compression, + means tension
        r.Normalize();
        F = (r*f) + (Springs[i].d*(vr*r))*r;

        j = Springs[i].End1;
        Objects[j].vSprings += F;

        j = Springs[i].End2;
        Objects[j].vSprings -= F;
    }

    .
    .
    .
    // Integrate equations of motion as usual.
    .
    .
    .
    // Render the scene as usual.
    .
    .
    .
}</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7347</span><span sentence-index="7347" class="">As  you  can  see,  there  are  several  local  variables  here. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7348</span><span sentence-index="7348" class="">  We&apos;ll  explain  each  one  as  we                    get  to  the  code  where  it&apos;s  used. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7349</span><span sentence-index="7349" class="">  After  the  local  variable  declarations,  this  function&apos;s                    first  task  is  to  reset  the  aggregate  spring  forces  on  each  particle  to  0. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">226</span><span sentence-index="7350" class=""> Each  particle                    stores  the  aggregate  spring  force  in  the  property  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">226</span><span sentence-index="7350" class="">vSprings</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7350</span><span sentence-index="7350" class=""> ,  which  is  a  vector. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7351</span><span sentence-index="7351" class="">  In  this  example,  each  particle  will  have  up  to                    two  springs  acting  on  it  at  any  given  time.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">229</span><span sentence-index="7353" class="">The  next  block  of  code  in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">229</span><span sentence-index="7353" class="">for</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7353</span><span sentence-index="7353" class="">  loop  computes  the  springs  forces  acting                on  each  particle. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7354</span><span sentence-index="7354" class="">  There  are  several  steps  to  this,  so  we&apos;ll  go  through                each  one. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7355</span><span sentence-index="7355" class="">  First  the  loop  is  set  up  to  step  through  the  list  of                springs. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7356</span><span sentence-index="7356" class="">  Recall  that  each  spring  is  connected  to  two  particles,  so                each  step  through  the  loop  will  compute  a  spring  force  and  apply  it  to                two  separate  particles.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">234</span><span sentence-index="7358" class="">Within  the  loop,  the  variable  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">234</span><span sentence-index="7358" class="">j</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">234</span><span sentence-index="7358" class=""> is  used  as  a  convenience  to  temporarily                store  the  index  that  refers  to  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">234</span><span sentence-index="7358" class="">Object</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7358</span><span sentence-index="7358" class="">  to  which  the  spring  is  attached. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">235</span><span sentence-index="7359" class=""> For                each  spring  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">235</span><span sentence-index="7359" class="">j</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">235</span><span sentence-index="7359" class=""> is  first  set  to  the                spring&apos;s  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">235</span><span sentence-index="7359" class="">End1</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7359</span><span sentence-index="7359" class="">  property. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">236</span><span sentence-index="7360" class=""> A  temporary                variable,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">236</span><span sentence-index="7360" class="">pt1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">236</span><span sentence-index="7360" class="">,  is  then  set  equal  to                the  position  of  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">236</span><span sentence-index="7360" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">236</span><span sentence-index="7360" class=""> to  which                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">236</span><span sentence-index="7360" class="">j</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7360</span><span sentence-index="7360" class="">  refers. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">237</span><span sentence-index="7361" class=""> Another  temporary                variable,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">237</span><span sentence-index="7361" class="">v1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">237</span><span sentence-index="7361" class="">,  is  set  to  the                velocity  of  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">237</span><span sentence-index="7361" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">237</span><span sentence-index="7361" class=""> to  which                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">237</span><span sentence-index="7361" class="">j</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7361</span><span sentence-index="7361" class="">  refers. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="7362" class=""> Next,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="7362" class="">j</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="7362" class=""> is  set  to  the  index  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="7362" class="">End2</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="7362" class="">,  the  other  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="7362" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="7362" class=""> to  which  the  current  spring  is                attached,  and  that  object&apos;s  position  and  velocity  are  stored  in                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="7362" class="">pt2</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="7362" class=""> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="7362" class="">v2</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7362</span><span sentence-index="7362" class=""> ,  respectively. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7363</span><span sentence-index="7363" class="">  This  sort  of  temporary                variable  use  isn&apos;t  necessary,  of  course,  but  it  makes  the  following                lines  of  code  that  compute  the  spring  force  more  readable  in  our                opinion.</span></span></p><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">241</span><span sentence-index="7365" class="">vr</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7365</span><span sentence-index="7365" class="">  is  a  vector  that  stores                the  relative  velocity  between  the  two  ends  of  the  spring. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">242</span><span sentence-index="7366" class=""> We  compute                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">242</span><span sentence-index="7366" class="">vr</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">242</span><span sentence-index="7366" class=""> by  subtracting  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">242</span><span sentence-index="7366" class="">v1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">242</span><span sentence-index="7366" class=""> from  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">242</span><span sentence-index="7366" class="">v2</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7366</span><span sentence-index="7366" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">243</span><span sentence-index="7367" class=""> Similarly,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">243</span><span sentence-index="7367" class="">r</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7367</span><span sentence-index="7367" class="">  is  a  vector  that  stores  the  relative                distance  between  the  two  ends  of  the  spring. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">244</span><span sentence-index="7368" class=""> We  compute  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">244</span><span sentence-index="7368" class="">r</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">244</span><span sentence-index="7368" class=""> by  subtracting  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">244</span><span sentence-index="7368" class="">pt1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">244</span><span sentence-index="7368" class=""> from  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">244</span><span sentence-index="7368" class="">pt2</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7368</span><span sentence-index="7368" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">245</span><span sentence-index="7369" class=""> The  magnitude  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">245</span><span sentence-index="7369" class="">r</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7369</span><span sentence-index="7369" class="">  represents  the  stretched  or  compressed                length  of  the  spring. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">246</span><span sentence-index="7370" class=""> The  change  in  spring  length  is  computed  and                stored  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">246</span><span sentence-index="7370" class="">dl</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">246</span><span sentence-index="7370" class=""> as  follows:</span></span></p></a><a id="I_programlisting7_id335196"><pre class="programlisting">        dl = r.Magnitude() - Springs[i].InitialLength;</pre><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">248</span><span sentence-index="7372" class="">dl</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7372</span><span sentence-index="7372" class="">  will  be  negative  if  the                computed  length  is  shorter  than  the  initial  length  of  the  spring. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7373</span><span sentence-index="7373" class="">  This                implies  that  the  spring  is  in  compression  and  should  act  to  push  the                particles  away  from  each  other. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">250</span><span sentence-index="7374" class=""> A  positive  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">250</span><span sentence-index="7374" class="">dl</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7374</span><span sentence-index="7374" class="">  means  the  spring  is  in  tension  and  should                act  to  pull  the  particles  toward  each  other. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="7375" class=""> The  line:</span></span></p></a><a id="I_programlisting7_id335220"><pre class="programlisting">        f = Springs[i].k * dl;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">253</span><span sentence-index="7377" class="">computes  the  corresponding  spring  force  as  a  function  of                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">253</span><span sentence-index="7377" class="">dl</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7377</span><span sentence-index="7377" class="">  and  the  spring  constant. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="7378" class=""> Note                that  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="7378" class="">f</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="7378" class=""> is  a  scalar  and  we  have  not                yet  computed  its  line  of  action,  although  we  know  it  acts  along  the                line  connecting  the  particles  at  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="7378" class="">End1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="7378" class=""> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="7378" class="">End2</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7378</span><span sentence-index="7378" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">255</span><span sentence-index="7379" class=""> That  line  is  represented  by  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">255</span><span sentence-index="7379" class="">r</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7379</span><span sentence-index="7379" class=""> ,  which  we  computed  earlier. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">256</span><span sentence-index="7380" class=""> And  the  spring                force  is  just  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">256</span><span sentence-index="7380" class="">f</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">256</span><span sentence-index="7380" class=""> times  the  unit                vector  along  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">256</span><span sentence-index="7380" class="">r</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7380</span><span sentence-index="7380" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">257</span><span sentence-index="7381" class=""> Since  we&apos;re                including  damping,  we  have  to  use  the  spring-damper  equation  for  the                total  force  acting  on  each  particle,  which  we  call  the  vector  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">257</span><span sentence-index="7381" class="">F</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7381</span><span sentence-index="7381" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">258</span><span sentence-index="7382" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">258</span><span sentence-index="7382" class="">F</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">258</span><span sentence-index="7382" class=""> is                computed  as  follows:</span></span></p></a><a id="I_programlisting7_id335287"><pre class="programlisting">        F = (r*f) + (Springs[i].d*(vr*r))*r;</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7384</span><span sentence-index="7384" class="">The  first  term  on  the  right  side  of  the  equals  sign  is  the                Hooke&apos;s  law&#x2013;based  spring  force,  and  the  second  term  is  the  damping                force. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">261</span><span sentence-index="7385" class=""> Note  here  that  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">261</span><span sentence-index="7385" class="">r</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">261</span><span sentence-index="7385" class=""> is  a  unit                vector  previously  computed  using  the  line:</span></span></p></a><a id="I_programlisting7_id335304"><pre class="programlisting">        r.Normalize();</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7387</span><span sentence-index="7387" class="">Finally,  the  spring  force  is  applied  to  each  particle  connected                by  the  spring. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7388</span><span sentence-index="7388" class="">  Remember,  the  force  is  equal  in  magnitude  but  opposite                in  direction  for  each  particle. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="7389" class=""> The  lines:</span></span></p></a><a id="I_programlisting7_id335316"><pre class="programlisting">        j = Springs[i].End1;
        Objects[j].vSprings += F;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">267</span><span sentence-index="7391" class="">apply  the  spring  force  to  the  particle  at  the  first  end  of  the                spring,  whereas  the  lines:</span></span></p></a><a id="I_programlisting7_id335327"><pre class="programlisting">        j = Springs[i].End2;
        Objects[j].vSprings -= F;</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7393</span><span sentence-index="7393" class="">apply  the  opposite  spring  force  to  the  particle  at  the  second                end  of  the  spring.</span></span></p></a><p><a id="I_programlisting7_id335327"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7396</span><span sentence-index="7396" class="">That&apos;s  it  for  computing  and  applying  the  spring  forces. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7397</span><span sentence-index="7397" class="">  The                remainder  of  the  code  is  business  as  usual,  where  we  compute  the  force                due  to  gravity  and  add  it  to  the  aggregate  spring  force  for  each                particle  and  then  integrate  the  equations  of  motion. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="7398" class=""> Finally,  we                render  the  scene  at  each  time  </span></span></a><a id="I_indexterm7_id335343" class="indexterm"></a><a id="I_indexterm7_id335352" class="indexterm"></a><a id="I_indexterm7_id335362" class="indexterm"></a><a id="I_indexterm7_id335371" class="indexterm"></a><a id="I_indexterm7_id335380" class="indexterm"></a><a id="I_indexterm7_id335390" class="indexterm"></a><a id="I_indexterm7_id335399" class="indexterm"></a><a id="I_indexterm7_id335408" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7406</span><span sentence-index="7406" class="">step.</span></span></a></p></div></div></div><div class="sect1" title="Connecting Rigid Bodies"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="connecting_rigid_bodies"><a id="I_indexterm7_id335408" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">285</span><span sentence-index="7409" class="">Connecting  Rigid  Bodies</span></span></a></h2></div></div></div><p><a id="I_indexterm7_id335408" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">287</span><span sentence-index="7411" class="">As  with  particles,</span></span></a><a id="cl13.3" class="indexterm"></a><a id="rl13.3" class="indexterm"></a><a id="cc13.3" class="indexterm"></a><a id="rc13.3" class="indexterm"></a><a id="li13.3" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7416</span><span sentence-index="7416" class="">  you  can  connect  rigid  bodies  with  springs  to  simulate  some  interesting  things. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7417</span><span sentence-index="7417" class="">            For  example,  you  may  want  to  simulate  something  as  simple  as  a  linked  chain,  where  each  link            is  connected  to  the  other  in  series. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7418</span><span sentence-index="7418" class="">  Or  perhaps  you  want  to  simulate  connected  body  parts  to            simulate  rag  doll  physics  or  maybe  a  golfer&apos;s  swing. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7419</span><span sentence-index="7419" class="">  All  these  require  some  means  of            connecting  rigid  bodies. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7420</span><span sentence-index="7420" class="">  In  this  section  we&apos;ll  show  you  how  to  use  linear  spring-dampers,  the            same  we&apos;ve  discussed  already,  to  connect  rigid  bodies. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7421</span><span sentence-index="7421" class="">  We&apos;ll  start  with  a  simple  analog  to  the            rope  example  discussed  earlier. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7422</span><span sentence-index="7422" class="">  Instead  of  connecting  particles  with  springs  to  simulate  a            dangling  rope,  we&apos;ll  connect  rigid  links  to  simulate  a  dangling  rope  or  chain. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7423</span><span sentence-index="7423" class="">  Later,  we&apos;ll            show  you  how  linear  springs  can  be  used  to  restrain  angular  motion.</span></span></a></p><div class="sect2" title="Links"><div class="titlepage"><div><div><h3 class="title" id="links"><a id="li13.3" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">302</span><span sentence-index="7426" class="">Links</span></span></a></h3></div></div></div><p><a id="li13.3" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7428</span><span sentence-index="7428" class="">In  this  example,  each  link  is  rigid  in  that  it  does  not  deform;  however,  the  links  are                connected  by  springs  in  a  way  that  allows  the  ensemble  to  swing,  stretch,  and  bend  in  a                manner  similar  to  a  hanging  chain. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="7429" class=""> </span></span></a><a class="xref" href="ch13.html#swinging_links" title="Figure&#xA0;13-4.&#xA0;Swinging links"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span sentence-index="7430" class="">Figure&#xA0;13-4</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7431</span><span sentence-index="7431" class="">  illustrates  our  swinging                linked  chain  as  it  swings  from  right  to  left  and  then  back  toward  the  right.</span></span></p><div class="figure"><a id="swinging_links"></a><div class="figure-contents"><a id="swinging_links"></a><div class="mediaobject"><a id="swinging_links"></a><a id="I_mediaobject7_id335538"><img src="httpatomoreillycomsourceoreillyimages1598957.png" alt="Swinging links"></a></div></div><div class="figure-title"><a id="I_mediaobject7_id335538"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">313</span><span sentence-index="7437" class="">Figure&#xA0;13-4.&#xA0;Swinging  links</span></span></a></div></div><p><a id="I_mediaobject7_id335538"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7439</span><span sentence-index="7439" class="">As  in  the  rope  example,  the  topmost  link  is  connected  to  a  fixed            point  by  a  spring,  such  that  the  linked  chain  pivots  around  and  hangs            from  the  fixed  point. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7440</span><span sentence-index="7440" class="">  The  rectangles  represent  each  rigid  link,  with  the            lines  connecting  the  rectangles  representing  springs.</span></span></a></p><p><a id="I_mediaobject7_id335538"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7443</span><span sentence-index="7443" class="">To  model  this  linked  chain,  we  need  only  make  a  few  changes  to  the            rope  example  to  address  the  fact  that  we&apos;re  now  dealing  with  rigid            bodies  that  can  rotate  versus  particles. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7444</span><span sentence-index="7444" class="">  This  requires  us  to  specify  the            point  on  each  body  to  which  the  springs  are  attached,  and  in  addition  to            computing  the  spring  forces  acting  on  each  body,  we  must  also  compute            the  moments  due  to  those  forces. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">321</span><span sentence-index="7445" class=""> Aside  from  these  spring  force  and            moment  computations,  the  remainder  of  the  simulation  is  the  same  as            those  discussed  in  </span></span></a><a class="xref" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Real-Time Simulations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">322</span><span sentence-index="7446" class="">Chapter&#xA0;7</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">322</span><span sentence-index="7446" class=""> through            </span></span><a class="xref" href="ch12.html" title="Chapter&#xA0;12.&#xA0;3D Rigid-Body Simulator"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">324</span><span sentence-index="7448" class="">Chapter&#xA0;12</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7448</span><span sentence-index="7448" class=""> .</span></span></p><div class="sect3" title="Basic structures and variables"><div class="titlepage"><div><div><h4 class="title" id="basic_structures_and_variables"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">326</span><span sentence-index="7450" class="">Basic  structures  and  variables</span></span></h4></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">327</span><span sentence-index="7451" class="">We  can  use  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">327</span><span sentence-index="7451" class="">Spring</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7451</span><span sentence-index="7451" class="">                structure  shown  earlier  in  the  rope  example  again  here  with  one  small                modification. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">328</span><span sentence-index="7452" class=""> Basically,  we  need  to  change  the  type  of  the  endpoint                references,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">328</span><span sentence-index="7452" class="">End1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">328</span><span sentence-index="7452" class=""> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">328</span><span sentence-index="7452" class="">End2</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">328</span><span sentence-index="7452" class="">,  from  integers  to  a  new  structure  we&apos;ll                call  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">328</span><span sentence-index="7452" class="">EndPoint</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7452</span><span sentence-index="7452" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">329</span><span sentence-index="7453" class=""> The  new  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">329</span><span sentence-index="7453" class="">Spring</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">329</span><span sentence-index="7453" class=""> structure  looks  like  this:</span></span></p><a id="I_programlisting7_id335626"><pre class="programlisting">typedef struct _Spring {
    EndPoint    End1;
    EndPoint    End2;
    float        k;
    float        d;
    float        InitialLength;
} Spring, *pSpring;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">331</span><span sentence-index="7455" class="">The  new  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">331</span><span sentence-index="7455" class="">EndPoint</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">331</span><span sentence-index="7455" class=""> structure  is                as  follows:</span></span></p></a><a id="I_programlisting7_id335642"><pre class="programlisting">typedef struct _EndPointRef {
    int       ref;
    Vector    pt;
} EndPoint;</pre></a><p><a id="I_programlisting7_id335642"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="7458" class="">Here,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="7458" class="">ref</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="7458" class=""> is  the  index                referring  to  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span>Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="7458" class=""> to  which                the  spring  is  attached,  and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="7458" class="">pt</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="7458" class=""> is                the  point  in  the  attached  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="7458" class="">Object</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7458</span><span sentence-index="7458" class=""> &apos;s                local  coordinate  system  to  which  the  spring  is  attached. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">335</span><span sentence-index="7459" class=""> Notice  from                </span></span></a><a class="xref" href="ch13.html#swinging_links" title="Figure&#xA0;13-4.&#xA0;Swinging links"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="7460" class="">Figure&#xA0;13-4</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7461</span><span sentence-index="7461" class="">  that  the  first  spring,  the  topmost                one,  is  connected  to  a  single  object;  the  other  end  of  it  is  connected                to  a  fixed  point  in  space. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="7462" class=""> We&apos;ll  use  a  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="7462" class="">ref</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="7462" class=""> of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="7462" class="">&#x2212;1</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7462</span><span sentence-index="7462" class="">                to  indicate  that  a  spring&apos;s  endpoint  is  connected  to  a  fixed  point  in                space  instead  of  an  object.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">340</span><span sentence-index="7464" class="nonQuoteStr">As  in  the  rope  example,  we  have  a  few  important  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">340</span><span sentence-index="7464" class="nonQuoteStr">define</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">340</span><span sentence-index="7464" class="nonQuoteStr">s  and  variables  to  set  up:</span></span></p><a id="I_programlisting7_id335706"><pre class="programlisting">#define        _NUM_OBJECTS     10
#define        _NUM_SPRINGS     10
#define        _SPRING_K        1000
#define        _SPRING_D        100

RigidBody2D       Objects[_NUM_OBJECTS];
Spring            Springs[_NUM_SPRINGS];</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">342</span><span sentence-index="7466" class="">These  are  the  same  as  before  except  now  we  have  10  springs                instead  of  9,  and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">342</span><span sentence-index="7466" class="">Objects</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">342</span><span sentence-index="7466" class=""> is  of                type  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">342</span><span sentence-index="7466" class="">RigidBody2D</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">342</span><span sentence-index="7466" class=""> instead  of                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">342</span><span sentence-index="7466" class="">Particle</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7466</span><span sentence-index="7466" class=""> .</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7468</span><span sentence-index="7468" class="">The  damping  and  spring  constants  play  the  same  role  here  as  they                did  in  the  rope  example.</span></span></p></a></div><div class="sect3" title="Initialize"><div class="titlepage"><div><div><h4 class="title" id="initialize"><a id="I_programlisting7_id335706"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">347</span><span sentence-index="7471" class="">Initialize</span></span></a></h4></div></div></div><p><a id="I_programlisting7_id335706"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">349</span><span sentence-index="7473" class="">Initially  our  linked  chain  is  set  up  horizontally,  just  like  the                rope  example,  but  with  the  link  and  spring  indices  shown  in  </span></span></a><a class="xref" href="ch13.html#linked-chain_setup" title="Figure&#xA0;13-5.&#xA0;Linked-chain setup"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">350</span><span sentence-index="7474" class="">Figure&#xA0;13-5</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7475</span><span sentence-index="7475" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7476</span><span sentence-index="7476" class="">  Each  rectangle  represents  a  rigid                link,  and  a  spring  attached  to  the  left  end  of  each  link  connects  the                link  to  its  neighbor  to  the  left. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">353</span><span sentence-index="7477" class=""> In  the  case  of  the  first  link,                </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">353</span><span sentence-index="7477" class="">L0</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7477</span><span sentence-index="7477" class=""> ,  the  spring  connects  the  left  end  of  the  link                to  a  fixed  point  in  space.</span></span></p><div class="figure"><a id="linked-chain_setup"></a><div class="figure-contents"><a id="linked-chain_setup"></a><div class="mediaobject"><a id="linked-chain_setup"></a><a id="I_mediaobject7_id335779"><img src="httpatomoreillycomsourceoreillyimages1598958.png" alt="Linked-chain setup"></a></div></div><div class="figure-title"><a id="I_mediaobject7_id335779"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">359</span><span sentence-index="7483" class="">Figure&#xA0;13-5.&#xA0;Linked-chain  setup</span></span></a></div></div><p><a id="I_mediaobject7_id335779"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7485</span><span sentence-index="7485" class="">The  code  for  this  setup  is  only  a  little  more  involved  than  that                for  the  rope  example;  the  additional  complexity  is  due  to  having  to                deal  with  specific  points  on  the  rigid  bodies  to  which  each  spring  is                attached. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">362</span><span sentence-index="7486" class=""> The  following  code  sample  contains  the  modified  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">362</span><span sentence-index="7486" class="">Initialize</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">362</span><span sentence-index="7486" class=""> function:</span></span></a></p><a id="I_programlisting7_id335809"><pre class="programlisting">bool    Initialize(void)
{
    Vector    r;
    Vector    pt;
    int       i;

    // Initialize objects for linked chain.
    for(i=0; i&lt;_NUM_LINKS; i++)
    {
        Objects[i].vPosition.x = _WINWIDTH/2 + Objects[0].fLength * i;
        Objects[i].vPosition.y = _WINHEIGHT/8;
        Objects[i].fOrientation = 0;
    }

    // Connect end of the first object to a fixed point in space.
    Springs[0].End1.ref = &#x2212;1;
    Springs[0].End1.pt.x = _WINWIDTH/2-Objects[0].fLength/2;
    Springs[0].End1.pt.y = _WINHEIGHT/8;

    Springs[0].End2.ref = 0;
    Springs[0].End2.pt.x = -Objects[0].fLength/2;
    Springs[0].End2.pt.y = 0;

    pt = VRotate2D(Objects[0].fOrientation, Springs[0].End2.pt)
         + Objects[0].vPosition;
    r = pt - Springs[0].End1.pt;

    Springs[0].InitialLength = r.Magnitude();
    Springs[0].k = _SPRING_K;
    Springs[0].d = _SPRING_D;

    // Connect end of all remaining springs.
    for(i=1; i&lt;_NUM_LINKS; i++)
    {
        Springs[i].End1.ref = i-1;
        Springs[i].End1.pt.x = Objects[i-1].fLength/2;
        Springs[i].End1.pt.y = 0;

        Springs[i].End2.ref = i;
        Springs[i].End2.pt.x = -Objects[i].fLength/2;
        Springs[i].End2.pt.y = 0;

        pt = VRotate2D(Objects[i].fOrientation, Springs[i].End2.pt)
              + Objects[i].vPosition;
        r = pt - (VRotate2D(Objects[i-1].fOrientation, Springs[i].End1.pt)
                  + Objects[i-1].vPosition);

        Springs[i].InitialLength = r.Magnitude();
        Springs[i].k = _SPRING_K;
        Springs[i].d = _SPRING_D;
    }

    return true;
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">364</span><span sentence-index="7488" class="">The  local  variables  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">364</span><span sentence-index="7488" class="">r</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">364</span><span sentence-index="7488" class=""> and                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">364</span><span sentence-index="7488" class="">i</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">364</span><span sentence-index="7488" class=""> are  the  same  as  before;  however,                there&apos;s  a  new  variable,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">364</span><span sentence-index="7488" class="">pt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7488</span><span sentence-index="7488" class=""> ,  that  we                use  to  temporarily  store  the  coordinates  of  specific  points  when                converting  from  one  coordinate  system  to  another. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7489</span><span sentence-index="7489" class="">  We&apos;ll  see  how  this                is  done  shortly.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">367</span><span sentence-index="7491" class="">After  the  local  variables  are  declared,  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">367</span><span>Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">367</span><span sentence-index="7491" class=""> positions  are  initialized,  starting                from  the  first  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">367</span><span>Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">367</span><span sentence-index="7491" class=""> positioned  at                the  middle  of  the  screen  and  proceeding  to  the  rest  of  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">367</span><span sentence-index="7491" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">367</span><span sentence-index="7491" class="">s,  offsetting  each  to  the  right  by  an                amount  equal  to  property  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">367</span><span sentence-index="7491" class="">fLength</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7491</span><span sentence-index="7491" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">368</span><span sentence-index="7492" class="">               Here,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">368</span><span sentence-index="7492" class="">fLength</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7492</span><span sentence-index="7492" class="">  is  an  arbitrary                length  representing  the  length  of  each  rigid  body,  not  the  length  of                the  springs  connecting  each  rigid  body. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7493</span><span sentence-index="7493" class="">  As  you&apos;ll  see  momentarily,  the                initial  length  of  all  the  springs  in  this  example  is  0.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7495</span><span sentence-index="7495" class="">You  should  be  aware  that  the  coordinates  for  each  object                computed  here  are  the  coordinates  of  the  object&apos;s  center  of  gravity,                which  in  this  example  we  defined  as  the  middle  of  the  rectangle                representing  each  object. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7496</span><span sentence-index="7496" class="">  Since  these  are  rigid  bodies,  not  only  must                you  specify  their  initial  positions,  but  you  must  also  specify  their                initial  orientations  as  shown  in  the  preceding  code  sample. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7497</span><span sentence-index="7497" class="">  The  way  we                have  this  example  set  up,  each  object  is  initialized  with  an                orientation  of  0  degrees.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7499</span><span sentence-index="7499" class="">The  next  task  is  to  set  up  the  spring  connecting  the  first  link,                the  one  on  the  left,  to  a  fixed  point  in  space. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">376</span><span sentence-index="7500" class=""> The  following  code                handles  this  task:</span></span></p></a><a id="I_programlisting7_id335902"><pre class="programlisting">    // Connect end of the first object to a fixed point in space.
    Springs[0].End1.ref = &#x2212;1;
    Springs[0].End1.pt.x = _WINWIDTH/2-Objects[0].fLength/2;
    Springs[0].End1.pt.y = _WINHEIGHT/8;

    Springs[0].End2.ref = 0;
    Springs[0].End2.pt.x = -Objects[0].fLength/2;
    Springs[0].End2.pt.y = 0;

    pt = VRotate2D(Objects[0].fOrientation, Springs[0].End2.pt)
         + Objects[0].vPosition;
    r = pt - Springs[0].End1.pt;

    Springs[0].InitialLength = r.Magnitude();
    Springs[0].k = _SPRING_K;
    Springs[0].d = _SPRING_D;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">378</span><span sentence-index="7502" class="">The  first  spring,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">378</span><span sentence-index="7502" class="">Spring[0]</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">378</span><span sentence-index="7502" class="">,                has  its  first  endpoint,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">378</span><span sentence-index="7502" class="">End1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">378</span><span sentence-index="7502" class="">,  set                to  refer  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">378</span><span sentence-index="7502" class="">&#x2212;1</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7502</span><span sentence-index="7502" class=""> ,  which,  as  explained                earlier,  means  that  this  end  of  the  spring  is  connected  to  some  fixed                point  in  space. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">379</span><span sentence-index="7503" class=""> The  location  of  the  point,  stored  in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">379</span><span sentence-index="7503" class="">End1.pt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7503</span><span sentence-index="7503" class="">  property,  must  be  specified  in                global  coordinates  as  shown  previously.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">381</span><span sentence-index="7505" class="">Now  the  second  end  of  the  first  spring  is  connected  to  the  left                end  of  the  first  link;  therefore,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">381</span><span sentence-index="7505" class="">End2.ref</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">381</span><span sentence-index="7505" class=""> of  the  first  spring  is  set  to                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">381</span><span sentence-index="7505" class="">0</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">381</span><span sentence-index="7505" class="">,  which  is  the  index  to  the  first                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">381</span><span sentence-index="7505" class="">Object</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7505</span><span sentence-index="7505" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="7506" class=""> The  point  on  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="7506" class="">Object[0]</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="7506" class=""> to  which  the  spring  is  attached  is                the  leftmost  end  on  the  centerline  of  the  object;  thus,  its                coordinates&#x2014;relative  to  the  object&apos;s  center  of  gravity  location  and                specified  in  local,  body-fixed  coordinates&#x2014;are:</span></span></p></a><a id="I_programlisting7_id335972"><pre class="programlisting">    Springs[0].End2.pt.x = -Objects[0].fLength/2;
    Springs[0].End2.pt.y = 0;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">384</span><span sentence-index="7508" class="">Now  remember,  the  points  on  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">384</span><span sentence-index="7508" class="">Objects</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">384</span><span sentence-index="7508" class=""> to  which  springs  are  attached  are                specified  in  body-fixed,  local  coordinates  of  each  referenced  object,                whereas  any  point  fixed  in  space  to  which  a  spring  is  attached  and  not                on  an  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">384</span><span sentence-index="7508" class="">Object</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7508</span><span sentence-index="7508" class="">  must  be  specified  in                global,  earth-fixed  coordinates. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7509</span><span sentence-index="7509" class="">  You  have  to  keep  these  coordinates                straight  and  make  the  appropriate  rotations  when  computing  spring                lengths  throughout  the  simulation. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">386</span><span sentence-index="7510" class=""> The  code;</span></span></p></a><a id="I_programlisting7_id335998"><pre class="programlisting">    pt = VRotate2D(Objects[0].fOrientation, Springs[0].End2.pt)
         + Objects[0].vPosition;
    r = pt - Springs[0].End1.pt;</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7512</span><span sentence-index="7512" class="">illustrates  how  to  do  this. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7513</span><span sentence-index="7513" class="">  To  compute  the  initial  spring                length,  we  need  to  compute  the  relative  distance  between  the  endpoints                of  the  spring. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="7514" class=""> In  case  of  the  first  spring,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="7514" class="">End1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="7514" class=""> was  specified  in  global  coordinates,                but  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="7514" class="">End2</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="7514" class=""> was  specified  in  the  local                coordinate  system  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="7514" class="">Object[0]</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7514</span><span sentence-index="7514" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">391</span><span sentence-index="7515" class="">               Therefore,  we  have  to  convert  the  coordinates  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">391</span><span sentence-index="7515" class="">End2</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7515</span><span sentence-index="7515" class="">  from  local  coordinates  to  global                coordinates  before  calculating  the  relative  distance  between  the  ends. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="7516" class="">               The  preceding  line,  which  calls  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="7516" class="">VRotate2D</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="7516" class=""> function  you  saw  in  earlier                chapters,  rotates  the  locally  specified  point,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="7516" class="">End2.pt</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="7516" class="">,  from  local  to  global  coordinates;                it  then  adds  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="7516" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="7516" class="">&apos;s  position                to  the  result,  arriving  at  a  point,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="7516" class="">pt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7516</span><span sentence-index="7516" class=""> ,  in  global  coordinates  coincident  with                the  second  endpoint  of  the  spring. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">393</span><span sentence-index="7517" class=""> The  relative  distance,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">393</span><span sentence-index="7517" class="">r</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">393</span><span sentence-index="7517" class="">,  is  the  second  endpoint,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">393</span><span sentence-index="7517" class="">pt</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">393</span><span sentence-index="7517" class="">,  minus  the  first  endpoint,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">393</span><span sentence-index="7517" class="">End1.pt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7517</span><span sentence-index="7517" class=""> .</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">395</span><span sentence-index="7519" class="">Finally,  we  compute  the  initial  length  of  the  spring  by  taking                the  magnitude  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">395</span><span sentence-index="7519" class="">r</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">395</span><span sentence-index="7519" class=""> and  storing  the                result  in  the  spring&apos;s  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">395</span><span sentence-index="7519" class="">InitialLength</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7519</span><span sentence-index="7519" class="">  property.</span></span></p></a><p><a id="I_programlisting7_id335998"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">398</span><span sentence-index="7522" class="">With  the  first  spring  out  of  the  way,  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">398</span><span sentence-index="7522" class="">Initialize</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7522</span><span sentence-index="7522" class="">  function  enters  a  loop  to  set  up                the  remaining  springs. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">399</span><span sentence-index="7523" class=""> Proceeding  from  left  to  right  in  </span></span></a><a class="xref" href="ch13.html#linked-chain_setup" title="Figure&#xA0;13-5.&#xA0;Linked-chain setup"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">400</span><span sentence-index="7524" class="">Figure&#xA0;13-5</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">400</span><span sentence-index="7524" class="">,  the  first  endpoint,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">400</span><span sentence-index="7524" class="">End1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">400</span><span sentence-index="7524" class="">,  is  connected  to  the  right  side  of                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">400</span><span sentence-index="7524" class="">Object[i-1]</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">400</span><span sentence-index="7524" class="">,  and  the  second                endpoint,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">400</span><span sentence-index="7524" class="">End2</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">400</span><span sentence-index="7524" class="">,  is  connected  to  the                left  side  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">400</span><span sentence-index="7524" class="">Object[i]</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7525</span><span sentence-index="7525" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7526</span><span sentence-index="7526" class="">  Be  aware                that  each  endpoint  of  each  spring  is  specified  in  different  coordinate                systems. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">403</span><span sentence-index="7527" class=""> The  left  end  is  in  the  coordinate  system  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">403</span><span sentence-index="7527" class="">Object[i-1]</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">403</span><span sentence-index="7527" class="">,  while  the  right  end  is  in  the                coordinate  system  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">403</span><span sentence-index="7527" class="">Object[i]</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7527</span><span sentence-index="7527" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7528</span><span sentence-index="7528" class="">  It                may  seem  trivial  during  this  setup,  but  when  things  start  moving  and                rotating  it  is  critically  important  to  keep  these  coordinate  systems                straight. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7529</span><span sentence-index="7529" class="">  Doing  so  involves  transforming  each  endpoint  coordinate  from                the  local  system  of  the  body  to  which  it&apos;s  attached  to  the  global                coordinate  system. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">406</span><span sentence-index="7530" class=""> This  is  illustrated  as  follows:</span></span></p><a id="I_programlisting7_id336154"><pre class="programlisting">        pt = VRotate2D(Objects[i].fOrientation, Springs[i].End2.pt)
              + Objects[i].vPosition;
        r = pt - (VRotate2D(Objects[i-1].fOrientation, Springs[i].End1.pt)
                  + Objects[i-1].vPosition);</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">408</span><span sentence-index="7532" class="">The  first  line  converts  the  spring  attachment  point  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">408</span><span sentence-index="7532" class="">End2</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">408</span><span sentence-index="7532" class=""> from  the  local  coordinate  system  of                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">408</span><span sentence-index="7532" class="">Object[i]</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7532</span><span sentence-index="7532" class="">  to  global  coordinates  by                performing  a  rotation  and  translation  using  functions  you&apos;ve  already                seen  numerous  times  now. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">409</span><span sentence-index="7533" class=""> The  result  is  temporarily  stored  in  the  local                variable,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">409</span><span sentence-index="7533" class="">pt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7533</span><span sentence-index="7533" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">410</span><span sentence-index="7534" class=""> The  second  line                converts  the  spring  attachment  point  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">410</span><span sentence-index="7534" class="">End1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">410</span><span sentence-index="7534" class=""> from  the  local  coordinate  system  of                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">410</span><span sentence-index="7534" class="">Object[i-1]</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">410</span><span sentence-index="7534" class=""> to  global  coordinates                and  then  subtracts  the  result  from  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">410</span><span sentence-index="7534" class="">pt</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">410</span><span sentence-index="7534" class="">,  yielding  a  vector,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">410</span><span sentence-index="7534" class="">r</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7534</span><span sentence-index="7534" class=""> ,  representing  the  relative  distance                between  the  spring&apos;s  endpoints. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">411</span><span sentence-index="7535" class=""> The  magnitude  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">411</span><span sentence-index="7535" class="">r</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7535</span><span sentence-index="7535" class="">  is  the  spring&apos;s  initial  length. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7536</span><span sentence-index="7536" class="">  Performing                these  same  calculations  during  the  simulation  will  result  in  the                spring&apos;s  stretched  or  compressed  length. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">413</span><span sentence-index="7537" class=""> That  calculation  is  performed                in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">413</span><span sentence-index="7537" class="">UpdateSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7537</span><span sentence-index="7537" class=""> .</span></span></p></a></div><div class="sect3" title="Update"><div class="titlepage"><div><div><h4 class="title" id="update"><a id="I_programlisting7_id336154"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">416</span><span sentence-index="7540" class="">Update</span></span></a></h4></div></div></div><p><a id="I_programlisting7_id336154"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">418</span><span sentence-index="7542" class="">The  function  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">418</span><span sentence-index="7542" class="">UpdateSimulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">418</span><span sentence-index="7542" class="">               is  substantially  </span></span></a><a id="si13.3.1.3" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7543</span><span sentence-index="7543" class="">the  same  as  that  discussed  in  the  rope  example. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7544</span><span sentence-index="7544" class="">  There                are  a  few  differences  that  we&apos;ll  highlight  here. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7545</span><span sentence-index="7545" class="">  Again,  these                differences  are  due  to  the  fact  that  we&apos;re  now  dealing  with  rigid                bodies  that  rotate  rather  than  simple  particles. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">422</span><span sentence-index="7546" class=""> The  following  code                sample  shows  the  additions  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">422</span><span sentence-index="7546" class="">UpdateSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7546</span><span sentence-index="7546" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">423</span><span sentence-index="7547" class=""> You  can  see  there  are  a                couple  of  new  variables,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">423</span><span sentence-index="7547" class="">M</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">423</span><span sentence-index="7547" class=""> and                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">423</span><span sentence-index="7547" class="">Fo</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7547</span><span sentence-index="7547" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">424</span><span sentence-index="7548" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">424</span><span sentence-index="7548" class="">M</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">424</span><span sentence-index="7548" class=""> is  used  to  temporarily  store  moments  due                to  spring  forces  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">424</span><span sentence-index="7548" class="">Fo</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">424</span><span sentence-index="7548" class=""> in  the  local                coordinates  of  each  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">424</span><span sentence-index="7548" class="">Object</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7548</span><span sentence-index="7548" class=""> .</span></span></a></p><p><a id="si13.3.1.3" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">427</span><span sentence-index="7551" class="">Just  as  the  property  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">427</span><span sentence-index="7551" class="">vSprings</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">427</span><span sentence-index="7551" class=""> was  initialized  to  0                    at  the  start  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">427</span><span sentence-index="7551" class="">UpdateSimulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">427</span><span sentence-index="7551" class="">,  so  too  must  we                    initialize  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">427</span><span sentence-index="7551" class="">vMSprings</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7551</span><span sentence-index="7551" class="">  to  0. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">428</span><span sentence-index="7552" class=""> Recall,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">428</span><span sentence-index="7552" class="">vSprings</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">428</span><span sentence-index="7552" class=""> aggregates  the  spring  forces  acting  on  each  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">428</span><span sentence-index="7552" class="">Object</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7552</span><span sentence-index="7552" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">429</span><span sentence-index="7553" class=""> For  rigid  bodies  that  rotate,  we&apos;ll  use  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">429</span><span sentence-index="7553" class="">vMSprings</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">429</span><span sentence-index="7553" class=""> to  aggregate  the  moments  on  each  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">429</span><span sentence-index="7553" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">429</span><span sentence-index="7553" class=""> resulting  from  those  spring  forces:</span></span></a></p><a id="I_programlisting7_id336348"><pre class="programlisting">void    UpdateSimulation(void)
{
    .
    .
    .
    Vector    M;
    Vector    Fo;

    // Initialize the spring forces and moments on each object to zero.
    for(i=0; i&lt;_NUM_OBJECTS; i++)
    {
        .
        .
        .

        Objects[i].vMSprings.x = 0;
        Objects[i].vMSprings.y = 0;
        Objects[i].vMSprings.z = 0;
    }

    // Calculate all spring forces based on positions of connected objects
    for(i=0; i&lt;_NUM_SPRINGS; i++)
    {
        if(Springs[i].End1.ref == &#x2212;1)
        {
            pt1 = Springs[i].End1.pt;
            v1.x = v1.y = v1.z = 0; // point is not moving
        } else {
            j = Springs[i].End1.ref;
            pt1 = Objects[j].vPosition + VRotate2D(Objects[j].fOrientation,
                                                   Springs[i].End1.pt);
            v1 = Objects[j].vVelocity + VRotate2D(Objects[j].fOrientation,
                 Objects[j].vAngularVelocity^Springs[i].End1.pt);
        }

        if(Springs[i].End2.ref == &#x2212;1)
        {
            pt2 = Springs[i].End2.pt;
            v2.x = v2.y = v2.z = 0;
        } else {
            j = Springs[i].End2.ref;
            pt2 = Objects[j].vPosition + VRotate2D(Objects[j].fOrientation,
                                                   Springs[i].End2.pt);
            v2 = Objects[j].vVelocity + VRotate2D(Objects[j].fOrientation,
                 Objects[j].vAngularVelocity^Springs[i].End2.pt);
        }

        // Compute spring-damper force.
        vr = v2 - v1;
        r = pt2 - pt1;
        dl = r.Magnitude() - Springs[i].InitialLength;
        f = Springs[i].k * dl;
        r.Normalize();
        F = (r*f) + (Springs[i].d*(vr*r))*r;

        // Aggregate the spring force on each connected object
        j = Springs[i].End1.ref;
        if(j != &#x2212;1)
            Objects[j].vSprings += F;

        j = Springs[i].End2.ref;
        if(j != &#x2212;1)
            Objects[j].vSprings &#x2212;= F;


        // convert force to first ref local coords
        // Get local lever
        // calc moment

        // Compute and aggregate moments due to spring force
        // on each connected object.
        j = Springs[i].End1.ref;
        if(j != &#x2212;1)
        {
            Fo = VRotate2D(-Objects[j].fOrientation, F);
            r = Springs[i].End1.pt;
            M = r^Fo;
            Objects[j].vMSprings += M;
        }

        j = Springs[i].End2.ref;
        if(j!= &#x2212;1)
        {
            Fo = VRotate2D(-Objects[j].fOrientation, F);
            r = Springs[i].End2.pt;
            M = r^Fo;
            Objects[j].vMSprings &#x2212;= M;
        }
    }
    .
    .
    .
    // Integrate equations of motion as usual.
    .
    .
    .
    // Render the scene as usual.
    .
    .
    .
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">431</span><span sentence-index="7555" class="">As  in  the  rope  example,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">431</span><span sentence-index="7555" class="">UpdateSimulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">431</span><span sentence-index="7555" class=""> steps  through  all  the                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">431</span><span sentence-index="7555" class="">Springs</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7555</span><span sentence-index="7555" class=""> ,  computing  their  stretched                or  compressed  length,  the  relative  velocity  of  each  spring&apos;s                endpoints,  and  the  resulting  spring  forces. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7556</span><span sentence-index="7556" class="">  These  calculations  are  a                bit  different  in  this  current  example  because  we  have  to  handle                rotation,  as  explained  earlier.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">434</span><span sentence-index="7558" class="">Upon  entering  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">434</span><span sentence-index="7558" class="">for</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">434</span><span sentence-index="7558" class=""> loop  in                the  preceding  code  sample,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">434</span><span sentence-index="7558" class="">End1</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7558</span><span sentence-index="7558" class="">  of                the  current  spring  is  checked  to  see  if  it&apos;s  connected  to  a  fixed                point  in  space. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">435</span><span sentence-index="7559" class=""> If  so,  the  temporary  variable  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">435</span><span sentence-index="7559" class="">pt1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">435</span><span sentence-index="7559" class=""> stores  the  global  coordinates  of  the                endpoint,  and  the  variable  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">435</span><span sentence-index="7559" class="">v1</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7559</span><span sentence-index="7559" class="">                stores  the  velocity  of  the  endpoint,  which  is  0. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">436</span><span sentence-index="7560" class=""> If  the  endpoint                reference  is  a  valid  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">436</span><span sentence-index="7560" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">436</span><span sentence-index="7560" class="">,  then                we  compute  the  position  of  the  endpoint,  stored  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">436</span><span sentence-index="7560" class="">pt1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">436</span><span sentence-index="7560" class="">,  just  like  we  did  in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">436</span><span sentence-index="7560" class="">Initialize</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">436</span><span sentence-index="7560" class=""> function,  using  a  coordinate                transform  as  follows:</span></span></p></a><a id="I_programlisting7_id336442"><pre class="programlisting">pt1 = Objects[j].vPosition + VRotate2D(Objects[j].fOrientation,
                                       Springs[i].End1.pt);</pre></a><p><a id="I_programlisting7_id336442"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">439</span><span sentence-index="7563" class="">We  compute  the  velocity  of  that  point  as  shown  in  </span></span></a><a class="xref" href="ch09.html" title="Chapter&#xA0;9.&#xA0;2D Rigid-Body Simulator"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">440</span><span sentence-index="7564" class="">Chapter&#xA0;9</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">440</span><span sentence-index="7564" class=""> by  first  computing  the  velocity  of                the  point  due  to  rotation  in  body-fixed  coordinates,  converting  that                to  global  coordinates,  and  then  adding  the  result  to  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">440</span><span sentence-index="7564" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">440</span><span sentence-index="7564" class="">&apos;s  </span></span><a id="I_indexterm7_id336465" class="indexterm"></a><a id="I_indexterm7_id336476" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7567</span><span sentence-index="7567" class="">linear  velocity. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">444</span><span sentence-index="7568" class=""> This  is  accomplished  in  the  following                code:</span></span></a></p><a id="I_programlisting7_id336488"><pre class="programlisting">v1 = Objects[j].vVelocity + VRotate2D(Objects[j].fOrientation,
     Objects[j].vAngularVelocity^Springs[i].End1.pt);</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7570</span><span sentence-index="7570" class="">We  then  repeat  these  calculations  for  the  second  endpoint  of  the                spring.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7572</span><span sentence-index="7572" class="">Once  we&apos;ve  obtained  the  positions  and  velocities  of  the  spring                endpoints,  we  compute  the  spring-damper  force  in  the  same  manner  as  in                the  rope  example. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">449</span><span sentence-index="7573" class=""> The  resulting  spring  forces  are  aggregated  in  the                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">449</span><span sentence-index="7573" class="">vSprings</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7573</span><span sentence-index="7573" class="">  property  of  each  object. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7574</span><span sentence-index="7574" class="">                Note  that  if  the  spring  endpoint  reference  is  a  fixed  point  in  space,                we  do  not  aggregate  the  force  on  that  fixed  point.</span></span></p></a><p><a id="I_programlisting7_id336488"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">453</span><span sentence-index="7577" class="">Since  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">453</span><span sentence-index="7577" class="">Object</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7577</span><span sentence-index="7577" class="">s  are  rigid                bodies  here,  we  now  have  to  compute  the  moment  due  to  the  spring  force                acting  on  each  object. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">454</span><span sentence-index="7578" class=""> You  must  do  this  so  that  when  we  integrate  the                </span></span></a><a id="I_indexterm7_id336522" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7579</span><span sentence-index="7579" class="">equations  of  motion,  the  objects  rotate  properly.</span></span></a></p><p><a id="I_indexterm7_id336522" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">458</span><span sentence-index="7582" class="">For  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">458</span><span sentence-index="7582" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">458</span><span sentence-index="7582" class=""> connected  to                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">458</span><span sentence-index="7582" class="">End1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">458</span><span sentence-index="7582" class=""> of  the  current  spring,  the                following  lines  compute  the  moment:</span></span></a></p><a id="I_programlisting7_id336550"><pre class="programlisting">            Fo = VRotate2D(-Objects[j].fOrientation, F);
            r = Springs[i].End1.pt;
            M = r^Fo;
            Objects[j].vMSprings += M;</pre><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">460</span><span sentence-index="7584" class="">Fo</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">460</span><span sentence-index="7584" class=""> is  a  vector  representing                the  spring  force  computed  earlier  on  the  current  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">460</span><span>Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">460</span><span sentence-index="7584" class=""> in  the  current  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">460</span><span sentence-index="7584" class="">Object</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7584</span><span sentence-index="7584" class=""> &apos;s  local,  body-fixed  coordinate                system. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">461</span><span sentence-index="7585" class=""> The  line:</span></span></p></a><a id="I_programlisting7_id336578"><pre class="programlisting">            Fo = VRotate2D(-Objects[j].fOrientation, F);</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">463</span><span sentence-index="7587" class="">transforms  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">463</span><span sentence-index="7587" class="">F</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">463</span><span sentence-index="7587" class=""> from  global  to                local  coordinates  of  the  current  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">463</span><span sentence-index="7587" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">463</span><span sentence-index="7587" class="">,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">463</span><span sentence-index="7587" class="">Object[j]</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7587</span><span sentence-index="7587" class=""> .</span></span></p><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">465</span><span>r</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">465</span><span sentence-index="7589" class=""> is  set  to  the  local,                body-fixed  coordinates  of  the  spring  attachment  point  for  the  current                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">465</span><span sentence-index="7589" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">465</span><span sentence-index="7589" class="">,  and  we  compute  the                resulting  moment  by  taking  the  vector  cross  product  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">465</span><span sentence-index="7589" class="">r</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">465</span><span sentence-index="7589" class=""> with  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">465</span><span sentence-index="7589" class="">Fo</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7589</span><span sentence-index="7589" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">466</span><span sentence-index="7590" class=""> The  result  is  stored  in  the  vector                variable  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">466</span><span sentence-index="7590" class="">M</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">466</span><span sentence-index="7590" class="">,  which  gets  aggregated                in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">466</span><span sentence-index="7590" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">466</span><span sentence-index="7590" class=""> property  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">466</span><span sentence-index="7590" class="">vMSprings</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7590</span><span sentence-index="7590" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">467</span><span sentence-index="7591" class=""> We  then  perform  these  same  sorts                of  calculations  for  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">467</span><span sentence-index="7591" class="">Object</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7591</span><span sentence-index="7591" class="">                connected  to  the  other  end  of  the  spring.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">469</span><span sentence-index="7593" class="">After  these  calculations,  the  rest  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">469</span><span sentence-index="7593" class="">UpdateSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7593</span><span sentence-index="7593" class="">  is  the  same  as  that  shown                earlier;  the  function  integrates  the  equations  of  motion  and  renders                the  scene.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7595</span><span sentence-index="7595" class="">Upon  running  this  simulation,  you&apos;ll  see  the  linked  chain  swing                down  and  to  the  left  and  then  back  and  forth  until  the  motion  dampens                out. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7596</span><span sentence-index="7596" class="">  You&apos;ll  also  notice  there&apos;s  some  stretch  to  the  springs  between                the  objects  that  appears  to  increase  as  you  look  from  the  lower  link                to  the  upper  link. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7597</span><span sentence-index="7597" class="">  This  is  indeed  a  non-uniform  stretch  in  the                springs,  which  makes  sense  when  you  consider  that  the  upper  spring  has                more  weight,  thus  more  force,  pulling  down  on  it  than  does  the  lower                spring.</span></span></p></a><p><a id="I_programlisting7_id336578"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7600</span><span sentence-index="7600" class="">As  in  this  rope  example,  you  can  tune  the  spring  and  damping                constants  to  minimize  the  spring  stretch  if  that  gap  created  by  the                stretched  spring  bothers  you. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">477</span><span sentence-index="7601" class=""> You  must  keep  in  mind  numerical                stability  if  your  springs  are  too  stiff,  and  here  again,  you  must                implement  a  robust  </span></span></a><a id="I_indexterm7_id336684" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7602</span><span sentence-index="7602" class="">integrator.</span></span></a></p></div></div><div class="sect2" title="Rotational Restraint"><div class="titlepage"><div><div><h3 class="title" id="rotational_restraint"><a id="I_indexterm7_id336684" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">481</span><span sentence-index="7605" class="">Rotational  Restraint</span></span></a></h3></div></div></div><p><a id="I_indexterm7_id336684" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7607</span><span sentence-index="7607" class="">So  far  we&apos;ve  used  springs  only  to  attach  objects  in  a  way  that  keeps  the  attachment                points  together  but  allows  the  objects  to  rotate  about  the  attachment  point. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">484</span><span sentence-index="7608" class=""> This  is  a                so-called  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">484</span><span sentence-index="7608" class="">pinned  joint</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7608</span><span sentence-index="7608" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">485</span><span sentence-index="7609" class=""> </span></span></a><a id="I_indexterm7_id336711" class="indexterm"></a><a id="ro13.3.2" class="indexterm"></a><a id="rr13.3.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7612</span><span sentence-index="7612" class="">If  you  want  a  fixed  joint  that  minimizes  the  amount  of  rotation  between  the                connected  objects,  you  can  add  another  spring  to  restrain  the  connected  objects&apos;                rotation.</span></span></a></p><p><a class="xref" href="ch13.html#rotation_restraint_setup" title="Figure&#xA0;13-6.&#xA0;Rotation restraint setup"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">491</span><span sentence-index="7615" class="">Figure&#xA0;13-6</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7615</span><span sentence-index="7615" class="">  illustrates  an  example            comprising  two  rigid  objects  connected  at  their  ends,  forming  a            ninety-degree  angle. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7616</span><span sentence-index="7616" class="">  The  uppermost  end  of  the  first  object  is  connected            to  a  fixed  point  in  space  as  in  our  rope  and  linked-chain  examples. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7617</span><span sentence-index="7617" class="">            Under  gravity,  the  assembly  would  rotate  and  swing  around  this  fixed            point. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">494</span><span sentence-index="7618" class=""> However,  unlike  the  linked-chain  example,  the  extra  spring            prevents  the  lower  link  from  pivoting  around  the  other  end  of  the  first            link,  as  illustrated  in  </span></span><a class="xref" href="ch13.html#rotation_restraint_in_action" title="Figure&#xA0;13-7.&#xA0;Rotation restraint in action"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">495</span><span sentence-index="7619" class="">Figure&#xA0;13-7</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7620</span><span sentence-index="7620" class=""> .</span></span></p><div class="figure"><a id="rotation_restraint_setup"></a><div class="figure-contents"><a id="rotation_restraint_setup"></a><div class="mediaobject"><a id="rotation_restraint_setup"></a><a id="I_mediaobject7_id336773"><img style="width: 212.59842519685; " src="httpatomoreillycomsourceoreillyimages1598959.png" alt="Rotation restraint setup"></a></div></div><div class="figure-title"><a id="I_mediaobject7_id336773"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">502</span><span sentence-index="7626" class="">Figure&#xA0;13-6.&#xA0;Rotation  restraint  setup</span></span></a></div></div><div class="figure"><a id="rotation_restraint_in_action"></a><div class="figure-contents"><a id="rotation_restraint_in_action"></a><div class="mediaobject"><a id="rotation_restraint_in_action"></a><a id="I_mediaobject7_id336804"><img src="httpatomoreillycomsourceoreillyimages1598960.png" alt="Rotation restraint in action"></a></div></div><div class="figure-title"><a id="I_mediaobject7_id336804"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">507</span><span sentence-index="7631" class="">Figure&#xA0;13-7.&#xA0;Rotation  restraint  in  action</span></span></a></div></div><p><a id="I_mediaobject7_id336804"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7633</span><span sentence-index="7633" class="">The  setup  for  this  example  is  relatively  straightforward  and            consists  of  setting  the  initial  positions  and  orientations  of  two  rigid            bodies  and  connecting  three  springs.</span></span></a></p><p><a id="I_mediaobject7_id336804"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">512</span><span sentence-index="7636" class="">This  example&apos;s  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">512</span><span sentence-index="7636" class="">Initialize</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">512</span><span sentence-index="7636" class="">           function  is  as  follows:</span></span></a></p><a id="I_programlisting7_id336837"><pre class="programlisting">bool    Initialize(void)
{
    Vector    r;
    Vector    pt;
    int       i;

    // Position objects
    Objects[0].vPosition.x = _WINWIDTH/2;
    Objects[0].vPosition.y = _WINHEIGHT/8+Objects[0].fLength/2;
    Objects[0].fOrientation = 90;

    Objects[1].vPosition.x = _WINWIDTH/2+Objects[1].fLength/2;
    Objects[1].vPosition.y = _WINHEIGHT/8+Objects[0].fLength;
    Objects[1].fOrientation = 0;

    // Connect end of the first object to the earth:
    Springs[0].End1.ref = &#x2212;1;
    Springs[0].End1.pt.x = _WINWIDTH/2;
    Springs[0].End1.pt.y = _WINHEIGHT/8;

    Springs[0].End2.ref = 0;
    Springs[0].End2.pt.x = -Objects[0].fLength/2;
    Springs[0].End2.pt.y = 0;

    pt = VRotate2D(Objects[0].fOrientation, Springs[0].End2.pt) +
         Objects[0].vPosition;
    r = pt - Springs[0].End1.pt;

    Springs[0].InitialLength = r.Magnitude();
    Springs[0].k = _SPRING_K;
    Springs[0].d = _SPRING_D;

    // Connect other end of first object to end of second object
    i = 1;
    Springs[i].End1.ref = i-1;
    Springs[i].End1.pt.x = Objects[i-1].fLength/2;
    Springs[i].End1.pt.y = 0;

    Springs[i].End2.ref = i;
    Springs[i].End2.pt.x = -Objects[i].fLength/2;
    Springs[i].End2.pt.y = 0;

    pt = VRotate2D(Objects[i].fOrientation, Springs[i].End2.pt) +
         Objects[i].vPosition;
    r = pt - (VRotate2D(Objects[i-1].fOrientation, Springs[i].End1.pt) +
              Objects[i-1].vPosition);

    Springs[i].InitialLength = r.Magnitude();
    Springs[i].k = _SPRING_K;
    Springs[i].d = _SPRING_D;

    // Connect CG of objects to each other
    Springs[2].End1.ref = 0;
    Springs[2].End1.pt.x = 0;
    Springs[2].End1.pt.y = 0;

    Springs[2].End2.ref = 1;
    Springs[2].End2.pt.x = 0;
    Springs[2].End2.pt.y = 0;

    r = Objects[1].vPosition - Objects[0].vPosition;

    Springs[2].InitialLength = r.Magnitude();
    Springs[2].k = _SPRING_K;
    Springs[2].d = _SPRING_D;
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">514</span><span sentence-index="7638" class="">The  two  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">514</span><span sentence-index="7638" class="">Objects</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">514</span><span sentence-index="7638" class=""> are  positioned            with  the  lines:</span></span></p></a><a id="I_programlisting7_id336868"><pre class="programlisting">    Objects[0].vPosition.x = _WINWIDTH/2;
    Objects[0].vPosition.y = _WINHEIGHT/8+Objects[0].fLength/2;
    Objects[0].fOrientation = 90;

    Objects[1].vPosition.x = _WINWIDTH/2+Objects[1].fLength/2;
    Objects[1].vPosition.y = _WINHEIGHT/8+Objects[0].fLength;
    Objects[1].fOrientation = 0;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">516</span><span sentence-index="7640" class="">Basically,  the  first  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">516</span><span sentence-index="7640" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">516</span><span sentence-index="7640" class="">,            </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">516</span><span sentence-index="7640" class="">Object[0]</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7640</span><span sentence-index="7640" class=""> ,  is  located  somewhere            toward  the  top  middle  of  the  screen  with  an  initial  rotation  of  ninety            degrees  so  that  it  stands  vertically. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">517</span><span sentence-index="7641" class=""> The  second  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">517</span><span sentence-index="7641" class="">Object</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">517</span><span sentence-index="7641" class="">,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">517</span><span sentence-index="7641" class="">Object[1]</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7641</span><span sentence-index="7641" class=""> ,  is  positioned  so  that  it  lies            horizontally  with  its  left  end  coincident  with  the  lower  end  of  the            first  object. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7642</span><span sentence-index="7642" class="">  We&apos;ll  put  a  spring  there  momentarily,  but  first,  we&apos;ll            connect  a  spring  to  the  upper  end  of  the  first  object  to  connect  it  to  a            fixed  point. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">519</span><span sentence-index="7643" class=""> The  following  code  takes  care  of  that  spring  using  the  same            techniques  discussed  earlier:</span></span></p></a><a id="I_programlisting7_id336909"><pre class="programlisting">    // Connect end of the first object to the earth:
    Springs[0].End1.ref = &#x2212;1;
    Springs[0].End1.pt.x = _WINWIDTH/2;
    Springs[0].End1.pt.y = _WINHEIGHT/8;

    Springs[0].End2.ref = 0;
    Springs[0].End2.pt.x = -Objects[0].fLength/2;
    Springs[0].End2.pt.y = 0;

    pt = VRotate2D(Objects[0].fOrientation, Springs[0].End2.pt) +
         Objects[0].vPosition;
    r = pt - Springs[0].End1.pt;

    Springs[0].InitialLength = r.Magnitude();
    Springs[0].k = _SPRING_K;
    Springs[0].d = _SPRING_D;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">521</span><span sentence-index="7645" class="">Now,  we  connect  a  spring  at  the  corner  formed  by  the  two  objects            using  the  following  code:</span></span></p></a><a id="I_programlisting7_id336923"><pre class="programlisting">    // Connect other end of first object to end of second object
    i = 1;
    Springs[i].End1.ref = i-1;
    Springs[i].End1.pt.x = Objects[i-1].fLength/2;
    Springs[i].End1.pt.y = 0;

    Springs[i].End2.ref = i;
    Springs[i].End2.pt.x = -Objects[i].fLength/2;
    Springs[i].End2.pt.y = 0;

    pt = VRotate2D(Objects[i].fOrientation, Springs[i].End2.pt) +
         Objects[i].vPosition;
    r = pt - (VRotate2D(Objects[i-1].fOrientation, Springs[i].End1.pt) +
              Objects[i-1].vPosition);

    Springs[i].InitialLength = r.Magnitude();
    Springs[i].k = _SPRING_K;
    Springs[i].d = _SPRING_D;</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7647</span><span sentence-index="7647" class="">If  we  stop  here,  the  simulation  will  behave  just  like  the            linked-chain  example,  albeit  we&apos;ll  have  a  very  short  chain. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7648</span><span sentence-index="7648" class="">  So,  to            prevent  rotation  at  the  corner,  we&apos;ll  add  another  spring  connecting  the            centers  of  gravity  of  the  objects. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7649</span><span sentence-index="7649" class="">  You  can  use  other  points  if  you            desire;  we  chose  the  centers  of  gravity  for  convenience. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">526</span><span sentence-index="7650" class=""> The  following            code  adds  this  rotational  restraint  spring:</span></span></p></a><a id="I_programlisting7_id336941"><pre class="programlisting">    // Connect CG of objects to each other
    Springs[2].End1.ref = 0;
    Springs[2].End1.pt.x = 0;
    Springs[2].End1.pt.y = 0;

    Springs[2].End2.ref = 1;
    Springs[2].End2.pt.x = 0;
    Springs[2].End2.pt.y = 0;

    r = Objects[1].vPosition - Objects[0].vPosition;

    Springs[2].InitialLength = r.Magnitude();
    Springs[2].k = _SPRING_K;
    Springs[2].d = _SPRING_D;</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7652</span><span sentence-index="7652" class="">The  rest  of  this  simulation  is  the  same  as  in  the  linked-chain            example. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7653</span><span sentence-index="7653" class="">  There  are  no  other  code  modifications  required. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7654</span><span sentence-index="7654" class="">  It&apos;s  all  in  the            setup.</span></span></p></a><p><a id="I_programlisting7_id336941"><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7657</span><span sentence-index="7657" class="">Now,  if  you  want  to  allow  some  amount  of  rotation  or  flexibility            in  the  joint,  you  can  do  so  by  tuning  the  spring  constant  for  the            rotation  restraint  spring. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">534</span><span sentence-index="7658" class=""> Using  linear  springs  creatively,  you  can            model  all  sorts  of  joints  </span></span></a><a id="I_indexterm7_id336962" class="indexterm"></a><a id="I_indexterm7_id336971" class="indexterm"></a><a id="I_indexterm7_id336981" class="indexterm"></a><a id="I_indexterm7_id336990" class="indexterm"></a><a id="I_indexterm7_id336999" class="indexterm"></a><a id="I_indexterm7_id337009" class="indexterm"></a><a id="I_indexterm7_id337018" class="indexterm"></a><a id="I_indexterm7_id337027" class="indexterm"></a><a id="I_indexterm7_id337037" class="indexterm"><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">7667</span><span sentence-index="7667" class="">very  simply.</span></span></a></p></div></div></section><a id="I_indexterm7_id337037" class="indexterm">
</a></body></html>