<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><html><head><title>Chapter&#xA0;19.&#xA0;Sports</title><link rel="stylesheet" type="text/css" href="core.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="up" href="pt03.html" title="Part&#xA0;III.&#xA0;Physical Modeling"><link rel="prev" href="ch18.html" title="Chapter&#xA0;18.&#xA0;Guns and Explosions"><link rel="next" href="pt04.html" title="Part&#xA0;IV.&#xA0;Digital Physics"></head><body>
         
        <script>
        function ok(){ 
            window.gggs()
            return;
            //$('#musicPlayer').parent().remove();
            //speakTransportPanelDialogV2.closeEmoteDialog()
            //speakTransportPanelDialog.closeEmoteDialog()
            //
            debugger
            let url = 'http://127.0.0.1:8080/uploads/extracted/' +
             'Crazy Rich Asians  Kevin Kwanepub/' +
              'jsonSets/OEBPS/Kwan_9780385536981_epub_prl_r1.htm.html.sentences.json'
            speakTransportPanelDialogV2.sideLoadSentences2(null, null, null, url)
            
        }
        setTimeout(ok, 1500)
        </script>
        <div style="background:white">````````</div><section class="chapter" title="Chapter&#xA0;19.&#xA0;Sports" epub:type="chapter" id="sports"><div class="titlepage"><div><div><h2 class="title"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">1</span><span sentence-index="10404" class="highlight2">Chapter&#xA0;19.&#xA0;Sports</span></span></h2></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">2</span><span sentence-index="10405" class="highlight3">The  topic  of  </span></span><a id="I_indexterm5_id348297" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10406</span><span sentence-index="10406" class="highlight4">sports  is  nearly  as  vast  as  all  of  the  subjects  we&apos;ve  covered  combined. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10407</span><span sentence-index="10407" class="highlight2">  There  is  a        sport  for  everyone,  and  a  sport  that  takes  advantage  of  each  of  the  physical  models  we&apos;ve        discussed  so  far. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10408</span><span sentence-index="10408" class="highlight3">  The  topic  ranges  from  games  full  of  accessories,  such  as  golf  or  polo,  to        running,  where  all  you  need  are  your  own  two  feet.</span></span></a></p><p><a id="I_indexterm5_id348297" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10411</span><span sentence-index="10411" class="highlight4">One  of  the  most  attractive  aspects  of  sports  for  the  game  programmer  is  that  they  take  place        in  a  limited  physical  space  by  design. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10412</span><span sentence-index="10412" class="highlight2">  Unlike  a  first-person  shooter  where  the  player  will        eventually  reach  an  artificial  boundary,  in  a  sports  game  the  player  will  not  expect  to  be  able        to  walk  out  of  the  court. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10413</span><span sentence-index="10413" class="highlight3">  Almost  all  sports  have  defined  dimensions  that  are  relatively  easy  to        model. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">11</span><span sentence-index="10414" class="highlight4"> </span></span></a><a class="xref" href="ch19.html#various_field_dimensions" title="Table&#xA0;19-1.&#xA0;Various field dimensions"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">12</span><span sentence-index="10415" class="highlight2">Table&#xA0;19-1</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10416</span><span sentence-index="10416" class="highlight3">  lists  a  few  sports  and  their  professional        field  dimensions.</span></span></p><div class="table"><a id="various_field_dimensions"><div class="table-title"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">15</span><span sentence-index="10418" class="highlight4">Table&#xA0;19-1.&#xA0;Various  field  dimensions</span></span></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"><col class="col2"></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">16</span><span sentence-index="10419" class="highlight2">Sport</span></span></p>
          </td><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">17</span><span sentence-index="10420" class="highlight3">Field  size</span></span></p>
          </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">18</span><span sentence-index="10421" class="highlight4">Soccer  (football)</span></span></p>
          </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">19</span><span sentence-index="10422" class="highlight2">90&#x2013;120  m  long  by  45&#x2013;90  m  wide</span></span></p>
          </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">20</span><span sentence-index="10423" class="highlight3">Football  (including  end  zones)</span></span></p>
          </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">21</span><span sentence-index="10424" class="highlight4">109.7  m  long  by  48.8  m  wide</span></span></p>
          </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">22</span><span sentence-index="10425" class="highlight2">Baseball</span></span></p>
          </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">23</span><span sentence-index="10426" class="highlight3">27.4  m  between  bases;  18.39  from  pitcher&apos;s  mound  to  home  base;  outfield                            varies</span></span></p>
          </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">24</span><span sentence-index="10427" class="highlight4">Basketball  (international)</span></span></p>
          </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">25</span><span sentence-index="10428" class="highlight2">28  m  by  15  m</span></span></p>
          </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">26</span><span sentence-index="10429" class="highlight3">Ice  hockey  (international)</span></span></p>
          </td><td style="text-align: left; vertical-align: top; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">27</span><span sentence-index="10430" class="highlight4">61  m  by  30  m</span></span></p>
          </td></tr></tbody></table></div></a></div><p><a id="various_field_dimensions"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10432</span><span sentence-index="10432" class="highlight2">As  you  can  see,  other  than  baseball&#x2014;where  the  shape  of  the  outfield  changes  depending  on        what  stadium  you  are  in&#x2014;modeling  these  field  sizes  is  a  rather  straightforward  exercise.</span></span></a></p><p><a id="various_field_dimensions"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10435</span><span sentence-index="10435" class="highlight3">Additionally,  the  one  thing  that  sports  have  in  common  is  that  they  have  a  human  actor. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10436</span><span sentence-index="10436" class="highlight4">  In        this  chapter  we&apos;ll  explore  how  the  human  action  can  be  simulated  as  input  for  the  other  physical        simulations  we&apos;ve  discussed. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10437</span><span sentence-index="10437" class="highlight2">  Specifically,  we&apos;ll  show  you  an  example  of  how  to  model  a  person        swinging  a  golf  club  using  accurate  physiological  models. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">35</span><span sentence-index="10438" class="highlight3"> </span></span></a><a id="I_indexterm5_id348542" class="indexterm"></a><a id="I_indexterm5_id348548" class="indexterm"></a><a id="I_indexterm5_id348558" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">38</span><span sentence-index="10441" class="highlight4">This  is  called  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">38</span><span sentence-index="10441" class="highlight2">biomechanics</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10441</span><span sentence-index="10441" class="highlight3"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10442</span><span sentence-index="10442" class="highlight4">  Before  we  get  into  that,  another        important  thing  to  understand  when  you&apos;re  modeling  sports  is  the  limits  of  the  human  body. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10443</span><span sentence-index="10443" class="highlight2">        Although  records  are  broken  in  every  Olympics,  no  human  being  is  able  to  jump  10  feet  vertically        into  the  air. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10444</span><span sentence-index="10444" class="highlight3">  Unless  you  are  breaking  the  limits  of  biomechanics  on  purpose,  doing  so  will        decrease  the  realism  of  your  game. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">42</span><span sentence-index="10445" class="highlight4"> The  biomechanical  statistics  of  what  would  be  considered  an        outstanding  athlete  are  given  in  </span></span></a><a class="xref" href="ch19.html#table_of_human_performance" title="Table&#xA0;19-2.&#xA0;Table of human performance"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">43</span><span sentence-index="10446" class="highlight2">Table&#xA0;19-2</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10447</span><span sentence-index="10447" class="highlight3"> .</span></span></p><div class="table"><a id="table_of_human_performance"><div class="table-title"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">46</span><span sentence-index="10449" class="highlight4">Table&#xA0;19-2.&#xA0;Table  of  human  performance</span></span></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"><col class="col2"><col class="col3"></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">47</span><span sentence-index="10450" class="highlight2">Physical  attribute</span></span></p>
          </td><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">48</span><span sentence-index="10451" class="highlight3">Average  value</span></span></p>
          </td><td style="text-align: center; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">49</span><span sentence-index="10452" class="highlight4">Record  value</span></span></p>
          </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">50</span><span sentence-index="10453" class="highlight2">Jump  from  standstill  (vertical)</span></span></p>
          </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">51</span><span sentence-index="10454" class="highlight3">81  cm</span></span></p>
          </td><td style="text-align: center; vertical-align: top; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">52</span><span sentence-index="10455" class="highlight4">155  cm</span></span></p>
          </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">53</span><span sentence-index="10456" class="highlight2">Running  jump  height  (high  jump)</span></span></p>
          </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">54</span><span sentence-index="10457" class="highlight3">1.83  m</span></span></p>
          </td><td style="text-align: center; vertical-align: top; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="10458" class="highlight4">2.45  m</span></span></p>
          </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">56</span><span sentence-index="10459" class="highlight2">Jump  distance</span></span></p>
          </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">57</span><span sentence-index="10460" class="highlight3">5.0  m</span></span></p>
          </td><td style="text-align: center; vertical-align: top; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">58</span><span sentence-index="10461" class="highlight4">8.95  m</span></span></p>
          </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">59</span><span sentence-index="10462" class="highlight2">Throwing  speed</span></span></p>
          </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span sentence-index="10463" class="highlight3">24.5  m/s</span></span></p>
          </td><td style="text-align: center; vertical-align: top; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="10464" class="highlight4">46.0  m/s</span></span></p>
          </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">62</span><span sentence-index="10465" class="highlight2">Running  speed  over  100  m</span></span></p>
          </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">63</span><span sentence-index="10466" class="highlight3">7.5  m/s</span></span></p>
          </td><td style="text-align: center; vertical-align: top; border-bottom: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span sentence-index="10467" class="highlight4">10  m/s</span></span></p>
          </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">65</span><span sentence-index="10468" class="highlight2">Running  speed  over  10,000  m</span></span></p>
          </td><td style="text-align: center; vertical-align: top; border-right: 0.5pt solid ; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">66</span><span sentence-index="10469" class="highlight3">3.7  m/s</span></span></p>
          </td><td style="text-align: center; vertical-align: top; ">
            <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">67</span><span sentence-index="10470" class="highlight4">6.3  m/s</span></span></p>
          </td></tr></tbody></table></div></a></div><p><a id="table_of_human_performance"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">69</span><span sentence-index="10472" class="highlight2">Almost  all  sports  records  are  available  online  somewhere,  so  </span></span></a><a class="xref" href="ch19.html#table_of_human_performance" title="Table&#xA0;19-2.&#xA0;Table of human performance"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">70</span><span sentence-index="10473" class="highlight3">Table&#xA0;19-2</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10474</span><span sentence-index="10474" class="highlight4">  is  by  no  means  exhaustive. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10475</span><span sentence-index="10475" class="highlight2">  However,  it  is  a  good  idea        to  use  these  values  to  limit  your  simulations  of  human  actions  in  your  video  games. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10476</span><span sentence-index="10476" class="highlight3">  Obviously,        part  of  the  excitement  of  playing  video  games  is  to  be  able  to  jump  higher  and  run  faster  than        you  otherwise  could,  but  a  good  survey  of  biomechanics  will  at  least  let  you  know  what  is        extraordinary  and  what  is  not. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10477</span><span sentence-index="10477" class="highlight4">  Now  let&apos;s  take  a  look  at  how  we  would  model  a  human  actor  in  a        sports  game.</span></span></p><div class="sect1" title="Modeling a Golf Swing"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="modeling_a_golf_swing"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">76</span><span sentence-index="10479" class="highlight2">Modeling  a  Golf  Swing</span></span></h2></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">77</span><span sentence-index="10480" class="highlight3">Let&apos;s  say  you&apos;re  writing  a  </span></span><a id="sp19.1" class="indexterm"></a><a id="go19.1" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10482</span><span sentence-index="10482" class="highlight4">golf  game  and  you  want  include  a  little  realism. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10483</span><span sentence-index="10483" class="highlight2">  An  obvious  important  element  of            the  game  is  the  golf  swing. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10484</span><span sentence-index="10484" class="highlight3">  Another  is  the  club-to-ball  impact,  and  still  another  is  the            trajectory  of  the  ball  in  flight. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span sentence-index="10485" class="highlight4"> You  can  use  the  </span></span></a><a id="I_indexterm5_id348968" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">83</span><span sentence-index="10486" class="highlight2">projectile  motion  modeling  techniques  discussed  earlier  in  </span></span></a><a class="xref" href="ch02.html" title="Chapter&#xA0;2.&#xA0;Kinematics"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">85</span><span sentence-index="10488" class="highlight3">Chapter&#xA0;2</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">85</span><span sentence-index="10488" class="highlight4">,  </span></span><a class="xref" href="ch04.html" title="Chapter&#xA0;4.&#xA0;Kinetics"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">86</span><span sentence-index="10489" class="highlight2">Chapter&#xA0;4</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">86</span><span sentence-index="10489" class="highlight3">,  and  </span></span><a class="xref" href="ch06.html" title="Chapter&#xA0;6.&#xA0;Projectiles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">88</span><span sentence-index="10491" class="highlight4">Chapter&#xA0;6</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">88</span><span sentence-index="10491" class="highlight2"> to            model  the  ball&apos;s  flight,  and  the  collision  response  techniques  in  </span></span><a class="xref" href="ch05.html" title="Chapter&#xA0;5.&#xA0;Collisions"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">89</span><span sentence-index="10492" class="highlight3">Chapter&#xA0;5</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10493</span><span sentence-index="10493" class="highlight4">            to  model  the  club-to-ball  impact. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10494</span><span sentence-index="10494" class="highlight2">  But  what  about  the  golf  swing?</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10496</span><span sentence-index="10496" class="highlight3">Well,  before  we  show  you  one  way  to  model  a  golf  swing,  let&apos;s  talk  about  why  you  would            want  to  do  so  in  the  first  place. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10497</span><span sentence-index="10497" class="highlight4">  To  model  club-to-ball  impact,  you  need  to  know  the  club  head            velocity  at  the  time  of  impact. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10498</span><span sentence-index="10498" class="highlight2">  That  velocity  is  a  function  of  the  swing. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10499</span><span sentence-index="10499" class="highlight3">  The  golfer  raises            the  club  through  his  backswing,  torques  his  body,  and  brings  the  club  head  down  in  an  arc            while  applying  a  torque  with  his  wrists. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10500</span><span sentence-index="10500" class="highlight4">  As  the  club  swings  down,  the  wrist  torque  reverses,            and  the  club  whips  through  the  downswing  until  the  club  head  collides  with  the  ball. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10501</span><span sentence-index="10501" class="highlight2">  (Or,  in            our  case,  collides  with  the  ground!)  Now,  there  are  many  subtle  details  we&apos;ve  omitted  here            with  regard  to  technique  and  the  physics,  but  you  get  the  idea. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10502</span><span sentence-index="10502" class="highlight3">  At  any  rate,  the  swing            determines  the  club  head  velocity  at  the  moment  of  impact,  which  in  turn  determines  the            velocity  of  the  ball  after  impact.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10504</span><span sentence-index="10504" class="highlight4">If  you  were  writing  a  game  for  the  Wii  or  some  other  platform  that  can  capture  a  player&apos;s            motion,  then  you  can  relate  the  player&apos;s  swing  motion  to  the  initial  torque  applied  to  a            virtual  golf  club,  thus  determining,  through  some  model,  the  swing  dynamics  and  resulting  club            head  velocity.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10506</span><span sentence-index="10506" class="highlight2">Golfers  take  swing  technique  seriously  and  so  do  scientists  who  study  golf  swing  dynamics. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10507</span><span sentence-index="10507" class="highlight3">            In  an  effort  to  understand  what  makes  a  good  swing  or  how  to  improve  a  swing,  there  are  many            scientists  out  there  actively  studying  the  golf  swing  physics. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10508</span><span sentence-index="10508" class="highlight4">  As  a  result,  there  are  many            mathematical  models  of  varying  degrees  of  realism  and  complexity  that  aim  to  examine  the  golf            swing. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">106</span><span sentence-index="10509" class="highlight2"> One  example  is  the  so-called  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">106</span><span sentence-index="10509" class="highlight3">two-rod  model</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">106</span><span sentence-index="10509" class="highlight4"> as  </span></span><a id="I_indexterm5_id349028" class="indexterm"></a><a id="I_indexterm5_id349034" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">108</span><span sentence-index="10511" class="highlight2">described  in  </span></span></a><a id="jo19.1" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">109</span><span sentence-index="10512" class="highlight3">Theodore  P.  Jorgensen&apos;s  book  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">109</span><span sentence-index="10512" class="highlight4">The  Physics  of  Golf</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10513</span><span sentence-index="10513" class="highlight2"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10514</span><span sentence-index="10514" class="highlight3">  In  his            book,  Dr.  Jorgensen  describes  the  two-rod  model  in  detail,  including  assumptions  and            simplifications,  and  provides  the  resulting  equations  that  must  be  solved  to  simulate  a  golf            swing  based  on  this  model. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10515</span><span sentence-index="10515" class="highlight4">  He  even  provides  empirical  data  used  to  validate  the  results  of  the            mathematical  model. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">113</span><span sentence-index="10516" class="highlight2"> As  shown  in  </span></span></a><a class="xref" href="ch19.html#two-rod_model_of_golf_swing" title="Figure&#xA0;19-1.&#xA0;Two-rod model of golf swing"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">114</span><span sentence-index="10517" class="highlight3">Figure&#xA0;19-1</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10518</span><span sentence-index="10518" class="highlight4"> ,  the  two-rod            model  assumes  that  the  golfer&apos;s  arm  is  one  rod  that  extends  from  the  shoulders  to  the  wrists. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">116</span><span sentence-index="10519" class="highlight2">           This  is  the</span></span><a id="I_indexterm5_id349069" class="indexterm">
      <span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">117</span><span sentence-index="10520" class="highlight3">arm  rod</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10521</span><span sentence-index="10521" class="highlight4"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10522</span><span sentence-index="10522" class="highlight2">  The  club  is  represented  by  another  rod  that  extends  from  the            wrist  end  of  the  arm  rod  to  the  club  head.</span></span></a></p><div class="figure"><a id="two-rod_model_of_golf_swing"></a><div class="figure-contents"><a id="two-rod_model_of_golf_swing"></a><div class="mediaobject"><a id="two-rod_model_of_golf_swing"></a><a id="I_mediaobject5_id349091"><img src="httpatomoreillycomsourceoreillyimages1598987.png" alt="Two-rod model of golf swing"></a></div></div><div class="figure-title"><a id="I_mediaobject5_id349091"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">125</span><span sentence-index="10528" class="highlight3">Figure&#xA0;19-1.&#xA0;Two-rod  model  of  golf  swing</span></span></a></div></div><p><a id="I_mediaobject5_id349091"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10530</span><span sentence-index="10530" class="highlight4">This  model  is  essentially  a  double  pendulum. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10531</span><span sentence-index="10531" class="highlight2">  More  specifically,  it  is  a  driven  double            pendulum  since  the  model  assumes  a  torque  applied  at  the  shoulder  end  of  the  arm  rod,  and            another  torque  applied  at  the  wrist  joint  connecting  the  arm  rod  to  the  club  rod. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">129</span><span sentence-index="10532" class="highlight3 nonQuoteStr"> We  won&apos;t            repeat  Dr.  Jorgensen&apos;s  development  of  the  model  here;  instead,  we&apos;ll  show  you  how  to  solve  the            resulting  equations:</span></span></a></p><p><a id="I_mediaobject5_id349091"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10534</span><span sentence-index="10534" class="highlight4">Those  equations  can  be  found  in  the  Technical  Appendix&#x2014;Section  4  of  Dr.  Jorgensen&apos;s            book&#x2014;but  are  listed  here  for  convenience.</span></span></a></p><p><a id="I_mediaobject5_id349091"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">134</span><span sentence-index="10537" class="highlight2">Equation  1:</span></span></a></p><div class="informalfigure"><a id="image_no_caption-id2"></a><div class="mediaobject"><a id="image_no_caption-id2"></a><a id="I_mediaobject5_id349136"><img src="httpatomoreillycomsourceoreillyimages1598988.png" alt="image with no caption"></a></div></div><p><a id="I_mediaobject5_id349136"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="10542" class="highlight3">Equation  2:</span></span></a></p><div class="informalfigure"><a id="image_no_caption-id3"></a><div class="mediaobject"><a id="image_no_caption-id3"></a><a id="I_mediaobject5_id349164"><img src="httpatomoreillycomsourceoreillyimages1598989.png" alt="image with no caption"></a></div></div><p><a class="xref" href="ch19.html#symbols_used_in_golf_swing_model" title="Table&#xA0;19-3.&#xA0;Symbols used in golf swing model"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">144</span><span sentence-index="10547" class="highlight4">Table&#xA0;19-3</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10547</span><span sentence-index="10547" class="highlight2">  explains  what  each  symbol            represents.</span></span></p><div class="table"><a id="symbols_used_in_golf_swing_model"><div class="table-title"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">146</span><span sentence-index="10549" class="highlight3">Table&#xA0;19-3.&#xA0;Symbols  used  in  golf  swing  model</span></span></div><div class="table-contents"><table style="border-collapse: collapse; border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="col1"><col class="col2"></colgroup><thead><tr><td style="text-align: left; vertical-align: bottom; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">147</span><span sentence-index="10550" class="highlight4">Symbol</span></span></p>
            </td><td style="text-align: left; vertical-align: bottom; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">148</span><span sentence-index="10551" class="highlight2">Meaning</span></span></p>
            </td></tr></thead><tbody><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">149</span><span sentence-index="10552" class="highlight3">J</span></span></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10553</span><span sentence-index="10553" class="highlight4">Mass  moment  of  inertia  of  the  rod  representing  the  arm. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">151</span><span sentence-index="10554" class="highlight3"> Units  are                                    kg-m</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">151</span><span sentence-index="10554" class="highlight2">2</span></span></sup><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10554</span><span sentence-index="10554" class="highlight4"> .</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="10556" class="highlight2">I</span></span></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10557</span><span sentence-index="10557" class="highlight3">Mass  moment  of  inertia  of  the  rod  representing  the  club. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">155</span><span sentence-index="10558" class="highlight2"> Units  are                                    kg-m</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">155</span><span sentence-index="10558" class="highlight4">2</span></span></sup><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10558</span><span sentence-index="10558" class="highlight3"> .</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">157</span><span sentence-index="10560" class="highlight4">M</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">157</span><span sentence-index="10560" class="highlight2">c</span></span></sub></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10561</span><span sentence-index="10561" class="highlight3">Mass  of  the  club. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10562</span><span sentence-index="10562" class="highlight4">  Units  are  kg.</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">161</span><span sentence-index="10564" class="highlight2">R</span></span></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10565</span><span sentence-index="10565" class="highlight3">Length  of  the  rod  representing  the  arm. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10566</span><span sentence-index="10566" class="highlight4">  Units  are  m.</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">165</span><span sentence-index="10568" class="highlight2">S</span></span></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10569</span><span sentence-index="10569" class="highlight3">First  moment  of  the  rod  representing  the  club  about  the  wrist  axis  (where  the                                club  rod  connects  to  the  arm  rod). </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10570</span><span sentence-index="10570" class="highlight4">  Units  are  kg-m.</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">169</span><span sentence-index="10572" class="highlight2">&#x3B1;</span></span></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10573</span><span sentence-index="10573" class="highlight3">Angle  swept  by  arm  rod  from  initial  backswing  position. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10574</span><span sentence-index="10574" class="highlight4">  Units  are                                radians.</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">173</span><span sentence-index="10576" class="highlight2">&#x3B2;</span></span></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10577</span><span sentence-index="10577" class="highlight3">Wrist-cock  angle. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10578</span><span sentence-index="10578" class="highlight4">  Units  are  radians.</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">177</span><span sentence-index="10580" class="highlight2">g</span></span></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10581</span><span sentence-index="10581" class="highlight3">Acceleration  due  to  gravity. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="10582" class="highlight2"> Constant  9.8                                m/s</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="10582" class="highlight4">2</span></span></sup><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10582</span><span sentence-index="10582" class="highlight3"> .</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">181</span><span sentence-index="10584" class="highlight4">&#x398;</span></span></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10585</span><span sentence-index="10585" class="highlight2">Angle  between  arm  rod  and  vertical  axis. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10586</span><span sentence-index="10586" class="highlight3">  Units  are  radians.</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">185</span><span sentence-index="10588" class="highlight4">a</span></span></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10589</span><span sentence-index="10589" class="highlight2">Horizontal  acceleration  of  the  shoulder. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">187</span><span sentence-index="10590" class="highlight4"> Units  are                                    m/s</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">187</span><span sentence-index="10590" class="highlight3">2</span></span></sup><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10590</span><span sentence-index="10590" class="highlight2"> .</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">189</span><span sentence-index="10592" class="highlight3">S</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">189</span><span sentence-index="10592" class="highlight4">A</span></span></sub></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10593</span><span sentence-index="10593" class="highlight2">First  moment  of  the  arm  rod  about  the  shoulder  axis. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10594</span><span sentence-index="10594" class="highlight3">  Units  are  kg-m.</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="10596" class="highlight4">Q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="10596" class="highlight2">&#x3B1;</span></span></sub></p>
            </td><td style="text-align: left; vertical-align: top; border-bottom: 0.5pt solid ; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10597</span><span sentence-index="10597" class="highlight3">Torque  applied  at  the  shoulder  to  the  arm  rod. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10598</span><span sentence-index="10598" class="highlight4">  Units  are  N-m.</span></span></p>
            </td></tr><tr><td style="text-align: left; vertical-align: top; border-right: 0.5pt solid ; ">
              <p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">197</span><span sentence-index="10600" class="highlight2">Q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">197</span><span sentence-index="10600" class="highlight3">&#x3B2;</span></span></sub></p>
            </td><td style="text-align: left; vertical-align: top; ">
              <p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10601</span><span sentence-index="10601" class="highlight4">Torque  applied  at  the  wrist  joint  to  the  club  rod. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10602</span><span sentence-index="10602" class="highlight2">  Units  are  N-m.</span></span></p>
            </td></tr></tbody></table></div></a></div><p><a id="symbols_used_in_golf_swing_model"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10605</span><span sentence-index="10605" class="highlight3">These  equations  represent  a  coupled  system  of  nonlinear  differential  equations. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10606</span><span sentence-index="10606" class="highlight4">  They  are            coupled  in  that  they  both  depend  on  the  unknown  quantities  &#x3B1;  and  &#x3B2;. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10607</span><span sentence-index="10607" class="highlight2">  They  are  clearly            differential  equations,  as  they  both  include  time  derivatives  of  the  unknown  quantities. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10608</span><span sentence-index="10608" class="highlight3">  And            they  are  nonlinear  because  they  include  sines  and  cosines  of  one  of  the  unknowns  along  with            derivatives  of  the  other  unknown  raised  to  some  power  greater  than  1.</span></span></a></p><p><a id="symbols_used_in_golf_swing_model"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10611</span><span sentence-index="10611" class="highlight4">So,  how  do  we  solve  these  equations? </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10612</span><span sentence-index="10612" class="highlight2">  Well,  we  can&apos;t  do  so  in  closed  form  and  must  resort            to  numerical  means. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">210</span><span sentence-index="10613" class="highlight3"> There  are  a  number  of  ways  to  proceed,  but  the  approach  we&apos;ll  use  is  to            first  solve  Equation  2  for  </span></span><span class="inlinemediaobject"><img src="inleq_1901.png" alt=""></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10613</span><span sentence-index="10613" class="highlight4">  and  substitute  the  result  into  Equation  1. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">211</span><span sentence-index="10614" class="highlight2"> Then,  we&apos;ll  numerically  integrate            the  result  using  a  fourth-order  </span></span></a><a id="I_indexterm5_id349673" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="10615" class="highlight3">Runge-Kutta  scheme,  as  described  in  </span></span></a><a class="xref" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Real-Time Simulations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">214</span><span sentence-index="10617" class="highlight4">Chapter&#xA0;7</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10617</span><span sentence-index="10617" class="highlight2"> .</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">216</span><span sentence-index="10619" class="highlight3">More  specifically,  at  each  time  step  Equation  1  with  </span></span><span class="inlinemediaobject"><img src="inleq_1902.png" alt=""></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">216</span><span sentence-index="10619" class="highlight4"> replaced  by  the  expression  derived  from  Equation  1  will  be  solved  for  </span></span><span class="inlinemediaobject"><img src="inleq_1903.png" alt=""></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10619</span><span sentence-index="10619" class="highlight2"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="10620" class="highlight3"> Once  </span></span><span class="inlinemediaobject"><img src="inleq_1904.png" alt=""></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="10620" class="highlight4"> is  found,  we  can  find  </span></span><span class="inlinemediaobject"><img src="inleq_1905.png" alt=""></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="10620" class="highlight2"> using  the  second  equation  previously  solved  for  </span></span><span class="inlinemediaobject"><img src="inleq_1906.png" alt=""></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10620</span><span sentence-index="10620" class="highlight3"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">218</span><span sentence-index="10621" class="highlight4"> Next,  we  can  integrate  </span></span><span class="inlinemediaobject"><img src="inleq_1907.png" alt=""></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">218</span><span sentence-index="10621" class="highlight2"> and  </span></span><span class="inlinemediaobject"><img src="inleq_1908.png" alt=""></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10621</span><span sentence-index="10621" class="highlight3">  to  find  &#x3B1;  and  &#x3B2;. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10622</span><span sentence-index="10622" class="highlight4">  This  process  then  repeats  for  each  time  step.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10624</span><span sentence-index="10624" class="highlight2">Again,  this  is  only  one  method  of  solving  these  equations. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10625</span><span sentence-index="10625" class="highlight3">  Normally,  when  faced  with  a            system  of  equations,  practitioners  use  matrix  schemes  to  solve  the  equations  simultaneously. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10626</span><span sentence-index="10626" class="highlight4">            This  is  almost  necessary  for  systems  of  equations  that  involve  more  than  two  equations. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10627</span><span sentence-index="10627" class="highlight2">            However,  with  just  two  equations,  as  we  have  here,  we  can  avoid  expensive  matrix  inversion            computation  by  using  the  technique  we  just  described.</span></span></p><div class="sect2" title="Solving the Golf Swing Equations"><div class="titlepage"><div><div><h3 class="title" id="solving_the_golf_swing_equations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">226</span><span sentence-index="10629" class="highlight3 nonQuoteStr">Solving  the  Golf  Swing  Equations</span></span></h3></div></div></div><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10630</span><span sentence-index="10630" class="highlight4">Now  we&apos;ll  show  you  how  to  implement  the  solution  we  described  in  a  simple  console                application. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">228</span><span sentence-index="10631" class="highlight2"> The  example  solves  the  two  governing  equations  for  &#x3B1;  and  &#x3B2;  over  time,  the                results  of  which  can  then  be  used  to  determine  the  club  head  velocity  at  any  time  instant                using  kinematic  equations  as  described  in  </span></span><a class="xref" href="ch02.html" title="Chapter&#xA0;2.&#xA0;Kinematics"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">229</span><span sentence-index="10632" class="highlight3">Chapter&#xA0;2</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">229</span><span sentence-index="10632" class="highlight4"> (see  the  section                    </span></span><a class="xref" href="ch02.html#rigid-body_kinematics" title="Rigid-Body Kinematics"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">231</span><span sentence-index="10634" class="highlight2">Rigid-Body  Kinematics</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10634</span><span sentence-index="10634" class="highlight3"> ). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="10635" class="highlight4"> Alternatively,  you  can  use  the  following                equation,  which  Dr.  Jorgensen  gives  for  the  club  head  velocity  in  his  book:</span></span></p><div class="informalfigure"><a id="image_no_caption-id4"></a><div class="mediaobject"><a id="image_no_caption-id4"></a><a id="I_mediaobject5_id349805"><img src="httpatomoreillycomsourceoreillyimages1598990.png" alt="image with no caption"></a></div></div><p><a id="I_mediaobject5_id349805"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10640</span><span sentence-index="10640" class="highlight2">We&apos;ll  use  Jorgensen&apos;s  equation  in  this  example.</span></span></a></p><p><a id="I_mediaobject5_id349805"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">240</span><span sentence-index="10643" class="highlight3">Since  the  angles  of  interest  are  computed  in  units  of  radians,  but  we  want  to  report                them  in  units  of  degrees,  we  first  create  a  few  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">240</span><span sentence-index="10643" class="highlight4">define</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">240</span><span sentence-index="10643" class="highlight2">s                to  make  the  conversions  for  us:</span></span></a></p><a id="I_programlisting5_id349838"><pre class="programlisting">#define    RADIANS(d)    (d/180.0*3.14159)
#define    DEGREES(r)    (r*180.0/3.14159)</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10645</span><span sentence-index="10645" class="highlight3">Next,  we  declare  and  initialize  all  of  the  variables. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10646</span><span sentence-index="10646" class="highlight4">  The  initial  values  used  here  are                some  typical  values  that  we  assumed. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">244</span><span sentence-index="10647" class="highlight2"> You  can  change  these  values  to  simulate  different                swings:</span></span></p></a><a id="I_programlisting5_id349849"><pre class="programlisting">// Variables
double alpha = 0.0;
double alpha_dot = 0.0;
double alpha_dotdot = 0.0;
double beta = RADIANS(120.0);
double beta_dot = 0.0;
double beta_dotdot = 0.0;

double J = 1.15; // kg m^2
double I = 0.08; // kg m^2
double Mc = 0.4; // kg
double R = 0.62; // m
double L = 1.1; // m
double S = 0.4*1.1*0.75; // kg m
double g = 9.8; // m/s^2
double gamma = RADIANS(135.0);
double theta = gamma - alpha;
double SA = 7.3*0.62*0.5; // kg m
double Qalpha = 100; // N m
double Qbeta = &#x2212;10; // N m
double a = 0.1*g; // m/s^2
double dt = 0.0025; // s
double time = 0; // s
double Vc = 0;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">246</span><span sentence-index="10649" class="highlight3">Next  we  define  two  functions  that  we  will  use  to  compute  the  second  time  derivatives  of                &#x3B1;  and  &#x3B2;  (i.e.,  </span></span><span class="inlinemediaobject"><img src="inleq_1909.png" alt=""></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">246</span><span sentence-index="10649" class="highlight4"> and  </span></span><span class="inlinemediaobject"><img src="inleq_1910.png" alt=""></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10649</span><span sentence-index="10649" class="highlight2"> ). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="10650" class="highlight3"> These  functions  simply  use  Equations  1  and  2  solved  for  </span></span><span class="inlinemediaobject"><img src="inleq_1911.png" alt=""></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="10650" class="highlight4"> and  </span></span><span class="inlinemediaobject"><img src="inleq_1912.png" alt=""></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10650</span><span sentence-index="10650" class="highlight2"> ,  respectively.</span></span></p><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">249</span><span sentence-index="10652" class="highlight3 nonQuoteStr">ComputeAlphaDotDot</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">249</span><span sentence-index="10652" class="highlight4 nonQuoteStr">,  which  solves  for  </span></span><span class="inlinemediaobject"><img src="inleq_1913.png" alt=""></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">249</span><span sentence-index="10652" class="highlight2 nonQuoteStr">,  is  shown  here:</span></span></p></a><a id="I_programlisting5_id349925"><pre class="programlisting">double ComputeAlphaDotDot(void)
{
    double A, B, C, D, F, G;
    double num, denom;

    A = (J + I + Mc * R * R + 2 * R * S * cos(beta));
    B = -(I + R * S * cos(beta));
    F = Qalpha - (beta_dot * beta_dot - 2 * alpha_dot * beta_dot) * R * S *
        sin(beta) + S * (g * sin(theta + beta) - a * cos(theta + beta))
        + (SA + Mc * R) * (g * sin(theta) - a * cos(theta));

    C = B;
    D = I;
    G = Qbeta - alpha_dot * alpha_dot * R * S * sin(beta) &#x2212;
        S * (g * sin(theta + beta) - a * cos(theta + beta));

    num = (F - (B * G / D));
    denom = (A-(B*C/D));
    return (F - (B * G / D)) / (A-(B*C/D));
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="10654" class="highlight3">The  local  variables  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="10654" class="highlight4">A</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span>,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="10654" class="highlight3">B</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span>,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="10654" class="highlight4">C</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="10654" class="highlight2">,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="10654" class="highlight2">D</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="10654" class="highlight3">,                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="10654" class="highlight4">F</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="10654" class="highlight2">,  and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="10654" class="highlight3">G</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10654</span><span sentence-index="10654" class="highlight4">  are                convenience  variables  used  to  organize  the  terms  in  Equation  1. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10655</span><span sentence-index="10655" class="highlight2">  This  function  returns  the                second  derivative  of  &#x3B1;.</span></span></p><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="10657" class="highlight3">ComputeBetaDotDot</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="10657" class="highlight4">,  shown  next,  is  very  similar  to                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="10657" class="highlight2">ComputeAlphaDotDot</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10657</span><span sentence-index="10657" class="highlight3">  but  solves  Equation  2  instead. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">255</span><span sentence-index="10658" class="highlight4"> This                function  returns  the  second  derivative  of  &#x3B2;:</span></span></p></a><a id="I_programlisting5_id349993"><pre class="programlisting">double ComputeBetaDotDot(void)
{
    double C, D, G;

    C = -(I + R * S * cos(beta));
    D = I;
    G = Qbeta - alpha_dot * alpha_dot * R * S * sin(beta) &#x2212;
        S * (g * sin(theta + beta) - a * cos(theta + beta));

    return (G - C * alpha_dotdot) / D;
}</pre></a><p><a id="I_programlisting5_id349993"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">258</span><span sentence-index="10661" class="highlight2">The  solution  to  Equations  1  and  2  follows  the  </span></span></a><a id="I_indexterm5_id350004" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">259</span><span sentence-index="10662" class="highlight3">Runge-Kutta  scheme  we  showed  you  in  </span></span></a><a class="xref" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Real-Time Simulations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">261</span><span sentence-index="10664" class="highlight4">Chapter&#xA0;7</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10664</span><span sentence-index="10664" class="highlight2"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10665</span><span sentence-index="10665" class="highlight3">                Four  intermediate  steps  are  taken  for  each  time  step. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="10666" class="highlight4"> The  time  step  size  is  controlled  by                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="10666" class="highlight2">dt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10666</span><span sentence-index="10666" class="highlight3"> ,  which  we&apos;ve  set  to  0.0025s. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">264</span><span sentence-index="10667" class="highlight4"> If  you  simply  used  </span></span><a id="I_indexterm5_id350023" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10668</span><span sentence-index="10668" class="highlight2">Euler&apos;s  method,  you&apos;d  have  to  reduce  this  step  size  quite  a  bit  to  obtain  a                stable  solution. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10669</span><span sentence-index="10669" class="highlight3">  We  implemented  the  solution  in  the  main  function  of  our  console  example. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">267</span><span sentence-index="10670" class="highlight4">               The  code  is  as  follows:</span></span></a></p><a id="I_programlisting5_id350037"><pre class="programlisting">int _tmain(int argc, _TCHAR* argv[])
{
    double    a, at;
    double    b, bt;
    int       i;
    FILE*     fp;
    double    phi;
    double    Vc2;

    double  ak1, ak2, ak3, ak4;
    double  bk1, bk2, bk3, bk4;

    FILE*     fdebug;

    fp = fopen(&quot;results.txt&quot;, &quot;w&quot;);
    fdebug = fopen(&quot;debug.txt&quot;, &quot;w&quot;);

    for(i = 0; i&lt;200; i++)
    {
        time += dt;

        if(time&gt;=0.1)
        {
            Qbeta = 0;
        }

        // save results of previous time step
        a = alpha;
        b = beta;
        at = alpha_dot;
        bt = beta_dot;

        // integrate alpha&apos;&apos; and beta&apos;&apos;

        // The K1 Step:
        alpha_dotdot = ComputeAlphaDotDot();
        beta_dotdot = ComputeBetaDotDot();

        ak1 = alpha_dotdot * dt;
        bk1 = beta_dotdot * dt;

        alpha_dot = at + ak1/2;
        beta_dot = bt + bk1/2;

        // The K2 Step:
        alpha_dotdot = ComputeAlphaDotDot();
        beta_dotdot = ComputeBetaDotDot();

        ak2 = alpha_dotdot * dt;
        bk2 = beta_dotdot * dt;

        alpha_dot = at + ak2/2;
        beta_dot = bt + bk2/2;

        // The K3 Step:
        alpha_dotdot = ComputeAlphaDotDot();
        beta_dotdot = ComputeBetaDotDot();

        ak3 = alpha_dotdot * dt;
        bk3 = beta_dotdot * dt;

        alpha_dot = at + ak3;
        beta_dot = bt + bk3;

        // The K3 Step:
        alpha_dotdot = ComputeAlphaDotDot();
        beta_dotdot = ComputeBetaDotDot();

        ak4 = alpha_dotdot * dt;
        bk4 = beta_dotdot * dt;

        alpha_dot = at + (ak1 + 2*ak2 + 2*ak3 + ak4) / 6;
        beta_dot = bt + (bk1 + 2*bk2 + 2*bk3 + bk4) / 6;

        alpha = a + alpha_dot * dt;
        beta = b + beta_dot * dt;

        theta = gamma - alpha;
        Vc2 = (R*R + L*L + 2 * R * L * cos(beta)) * ( alpha_dot * alpha_dot)
             + L*L * beta_dot * beta_dot
              - 2 * (L*L + R * L * cos(beta)) * alpha_dot * beta_dot;

        Vc = sqrt(Vc2);

        phi = theta + beta;
        fprintf(fp, &quot;%f, %f, %f, %f, %f, %f\n&quot;, time, DEGREES(theta),
                      DEGREES(alpha), DEGREES(beta), DEGREES(phi), Vc);

        fprintf(fdebug, &quot;%f, %f, %f, %f, %f, %f, %f\n&quot;, time, DEGREES(alpha),
                 alpha_dot, alpha_dotdot, DEGREES(beta), beta_dot, beta_dotdot);
    }

    fclose(fp);
    fclose(fdebug);
    return 0;
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="10672" class="highlight2">Local  variables  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="10672" class="highlight3">a</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span>,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="10672" class="highlight2">at</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="10672" class="highlight4">,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="10672" class="highlight3">b</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="10672" class="highlight4">,  and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="10672" class="highlight2">bt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10672</span><span sentence-index="10672" class="highlight3">  are  used  to  temporarily  store  the  previous  time  step&apos;s  results  for  &#x3B1;  and  &#x3B2;                and  their  first  derivatives. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">270</span><span sentence-index="10673" class="highlight4"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">270</span><span sentence-index="10673" class="highlight2">i</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10673</span><span sentence-index="10673" class="highlight3">  is  a  counter  variable. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">271</span><span sentence-index="10674" class="highlight4">                   </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">271</span><span sentence-index="10674" class="highlight2">fp</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10674</span><span sentence-index="10674" class="highlight3">  is  a  file  pointer  that  we&apos;ll  use  to  write  results                out  to  a  text  file. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">272</span><span sentence-index="10675" class="highlight4"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">272</span><span sentence-index="10675" class="highlight2">phi</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10675</span><span sentence-index="10675" class="highlight3">  is  used  to  store  the  sum  of  &#x3B8;  +                &#x3B2;. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">273</span><span sentence-index="10676" class="highlight4"> And  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">273</span><span sentence-index="10676" class="highlight2">Vc2</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10676</span><span sentence-index="10676" class="highlight3">  is  the  square  of  the  club  head  velocity                calculated  according  to  Jorgensen&apos;s  equation. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="10677" class="highlight4"> The  variables  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="10677" class="highlight2">ak1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span> through  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="10677" class="highlight4">ak4</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="10677" class="highlight2">,  and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="10677" class="highlight3">bk1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="10677" class="highlight3"> through  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="10677" class="highlight4">bk4</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10677</span><span sentence-index="10677" class="highlight2"> ,  are  used  to                store  intermediate  results  of  the  Runge-Kutta  integration  scheme. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">275</span><span sentence-index="10678" class="highlight3"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">275</span><span sentence-index="10678" class="highlight4">fdebug</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10678</span><span sentence-index="10678" class="highlight2">  is  a  file  pointer  to  a  file  we  used  for  writing  debugging                information.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10680</span><span sentence-index="10680" class="highlight3">After  the  output  and  debug  files  are  opened,  the  function  enters  a  loop  to  perform  the                integration  over  200  time  steps. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10681</span><span sentence-index="10681" class="highlight4">  You  can  change  the  number  of  time  steps  as  you  see  fit  for                your  application. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10682</span><span sentence-index="10682" class="highlight2">  Keep  in  mind  that  the  swing  event,  from  start  to  striking  the  ball,  takes                place  over  a  very  short  period  of  time&#x2014;only  fractions  of  a  second  long.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="10684" class="highlight3">Upon  entering  the  loop,  you&apos;ll  see  some  code  that  checks  how  much  time  has  elapsed;  if                that  time  is  greater  than  0.1s,  the  wrist  torque,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="10684" class="highlight4">Qbeta</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10684</span><span sentence-index="10684" class="highlight2"> ,                is  set  to  0. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10685</span><span sentence-index="10685" class="highlight3">  This  is  a  crude  model  of  how  the  wrist  torque  that&apos;s  initially  applied  is                released,  allowing  the  club  to  swing  past  the  arm. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10686</span><span sentence-index="10686" class="highlight4">  Depending  on  the  swing  you&apos;re  modeling,                this  torque  could  actually  reverse  direction,  forcing  the  club  past  the  arm  even  more. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10687</span><span sentence-index="10687" class="highlight2">  Dr.                Jorgensen&apos;s  book  explains  all  this  in  detail,  even  giving  experimental  results.</span></span></p></a><p><a id="I_programlisting5_id350037"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">287</span><span sentence-index="10690" class="highlight3">Next,  results  of  the  previous  time  step  are  saved  in  the  variables  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">287</span><span sentence-index="10690" class="highlight4">a</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">287</span><span>,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">287</span><span sentence-index="10690" class="highlight3">b</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">287</span><span sentence-index="10690" class="highlight2">,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">287</span><span sentence-index="10690" class="highlight4">at</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">287</span><span sentence-index="10690" class="highlight2">,  and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">287</span><span sentence-index="10690" class="highlight3">bt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10690</span><span sentence-index="10690" class="highlight4"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10691</span><span sentence-index="10691" class="highlight2">  The  first  time                step  simply  stores  the  initial  values. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">289</span><span sentence-index="10692" class="highlight3"> Now,  the  integration  starts  for  the  first  step,                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">289</span><span sentence-index="10692" class="highlight4">k1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">289</span><span sentence-index="10692" class="highlight2"> (see  </span></span></a><a class="xref" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Real-Time Simulations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="10693" class="highlight3">Chapter&#xA0;7</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10694</span><span sentence-index="10694" class="highlight4"> ). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="10695" class="highlight2"> Each                of  these  steps  involves  computing  </span></span><span class="inlinemediaobject"><img src="inleq_1914.png" alt=""></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="10695" class="highlight3"> and  </span></span><span class="inlinemediaobject"><img src="inleq_1915.png" alt=""></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="10695" class="highlight4"> using  the  functions  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="10695" class="highlight2">ComputeAlphaDotDot</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="10695" class="highlight3">               and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="10695" class="highlight4">ComputeBetaDotDot</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10695</span><span sentence-index="10695" class="highlight2"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">293</span><span sentence-index="10696" class="highlight3"> The  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">293</span><span sentence-index="10696" class="highlight4">k1</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10696</span><span sentence-index="10696" class="highlight2">  results  are  then  calculated  and  used  to  compute  intermediate  results  for  the                first  time  derivatives  of  &#x3B1;  and  &#x3B2;. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10697</span><span sentence-index="10697" class="highlight3">  All  four  intermediate  steps  are  carried  out  in  a  similar                manner.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="10699" class="highlight4">Finally,  the  current  time  step&apos;s  results  for  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="10699" class="highlight2">alpha_dot</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="10699" class="highlight4">beta_dot</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="10699" class="highlight2">,  along  with  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="10699" class="highlight3">alpha</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="10699" class="highlight3"> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="10699" class="highlight4">beta</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10699</span><span sentence-index="10699" class="highlight2"> ,  are  computed. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">297</span><span sentence-index="10700" class="highlight3">               Also,  the  square  of  the  club  head  velocity,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">297</span><span>Vc2</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">297</span><span sentence-index="10700" class="highlight2">,  is                computed  using  Jorgensen&apos;s  equation  shown  earlier;  and  the  club  head  velocity,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">297</span><span sentence-index="10700" class="highlight3">Vc</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">297</span><span sentence-index="10700" class="highlight4">,  results  from  the  square  root  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">297</span><span sentence-index="10700" class="highlight4">Vc2</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10700</span><span sentence-index="10700" class="highlight2"> .</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10702</span><span sentence-index="10702" class="highlight3">Results  of  interest  are  then  written  to  the  output  and  debug  files. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10703</span><span sentence-index="10703" class="highlight4">  So,  that&apos;s  pretty                much  it. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10704</span><span sentence-index="10704" class="highlight2">  After  the  loop  finishes,  the  files  are  closed  and  the  application                terminates.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">303</span><span sentence-index="10706" class="highlight3 nonQuoteStr">If  this  were  an  actual  game,  you  would  use  the  club  head  velocity  results  along  with  the                collision  response  method  we  showed  in  </span></span><a class="xref" href="ch03.html" title="Chapter&#xA0;3.&#xA0;Force"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">304</span><span sentence-index="10707" class="highlight4">Chapter&#xA0;3</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10708</span><span sentence-index="10708" class="highlight2">  to  determine  the  golf  ball&apos;s                trajectory. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span sentence-index="10709" class="highlight3"> You  could  model  the  flight  path  of  the  golf  ball  using  the  methods  we  </span></span><a id="I_indexterm5_id350314" class="indexterm"></a><a id="I_indexterm5_id350323" class="indexterm"></a><a id="I_indexterm5_id350332" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="10712" class="highlight4">showed  you  in  </span></span></a><a class="xref" href="ch06.html" title="Chapter&#xA0;6.&#xA0;Projectiles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">310</span><span sentence-index="10713" class="highlight2">Chapter&#xA0;6</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10714</span><span sentence-index="10714" class="highlight3"> .</span></span></p></div></div><div class="sect1" title="Billiards"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="billiards"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">313</span><span sentence-index="10716" class="highlight4">Billiards</span></span></h2></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">314</span><span sentence-index="10717" class="highlight2">Now  let&apos;s  take  </span></span><a id="sp19.2" class="indexterm"></a><a id="bi19.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10719</span><span sentence-index="10719" class="highlight3">a  look  at  a  different  example. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10720</span><span sentence-index="10720" class="highlight4">  You  may  not  think  of  billiards  as  a  sport,  but  it            is  recognized  internationally  as  a  cue  sport. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10721</span><span sentence-index="10721" class="highlight2">  Cue  sports  are  a  family  of  sports  that  include            billiards,  pool,  snooker,  and  other  related  variations. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">319</span><span sentence-index="10722" class="highlight3"> For  simplicity,  we&apos;ll  stick  with  the            term  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">319</span><span sentence-index="10722" class="highlight4">billiards</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10722</span><span sentence-index="10722" class="highlight2"> ,  although  the  topics  presented  apply  to  all  cue            sports.</span></span></a></p><p><a id="bi19.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10725</span><span sentence-index="10725" class="highlight3">Billiards  is  a  good  example  of  an  activity  that  takes  place  over  a  limited  physical  space. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10726</span><span sentence-index="10726" class="highlight4">            Thus,  when  writing  a  billiards  video  game  you  need  only  concern  yourself  with  a  very  finite            space  composed  of  well-established  geometry. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10727</span><span sentence-index="10727" class="highlight2">  Billiard  tables  are  typically  1.37  m  &#xD7;  2.74  m            (4.5  ft  &#xD7;  9  ft),  with  some  longer  and  some  smaller  depending  on  the  game,  style,  and  space            available. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10728</span><span sentence-index="10728" class="highlight3">  Tables  are  typically  cloth-covered  slate. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10729</span><span sentence-index="10729" class="highlight4">  Balls  vary  in  size  between  games  and            regions,  with  American-style  pool  balls  measuring  about  57  mm  (2.25  inches)  in  diameter. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10730</span><span sentence-index="10730" class="highlight2">  Balls            used  to  be  made  of  wood,  clay,  or  ivory,  but  nowadays  they  are  plastic.</span></span></a></p><p><a id="bi19.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10733</span><span sentence-index="10733" class="highlight3">All  these  characteristics  are  important  little  details  that  you  must  consider  if  you&apos;re            going  to  make  a  realistic  billiards  video  game. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">331</span><span sentence-index="10734" class="highlight4"> The  slate  table  and  hard  plastic  balls  have            certain  </span></span></a><a id="I_indexterm5_id350406" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10735</span><span sentence-index="10735" class="highlight2">impact  characteristics. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10736</span><span sentence-index="10736" class="highlight3">  The  cloth-covered  table  provides  some  resistance  to            rolling. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10737</span><span sentence-index="10737" class="highlight4">  Side  bumpers  are  not  as  hard  as  the  slate  table,  thus  yielding  different  impact            characteristics. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10738</span><span sentence-index="10738" class="highlight2">  Fortunately,  data  on  billiard  tables  and  balls  is  readily  available  on  the            Web. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10739</span><span sentence-index="10739" class="highlight3">  And  simulating  billiards  in  a  video  game  is  fairly  straightforward.</span></span></a></p><p><a id="I_indexterm5_id350406" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">339</span><span sentence-index="10742" class="highlight4">Billiards  makes  an  interesting  example  because  </span></span></a><a id="I_indexterm5_id350424" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10743</span><span sentence-index="10743" class="highlight2">collisions  are  the  heart  of  the  game,  and  such  an  example  also  gives  us  an            opportunity  to  demonstrate  rolling  contact. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">341</span><span sentence-index="10744" class="highlight3"> </span></span></a><a class="xref" href="ch19.html#elapsed_time_equals_0.398s" title="Figure&#xA0;19-2.&#xA0;Elapsed time = 0.398s"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">342</span><span sentence-index="10745" class="highlight4">Figure&#xA0;19-2</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">342</span><span sentence-index="10745" class="highlight2"> and                </span></span><a class="xref" href="ch19.html#elapsed_time_equals_0.440s" title="Figure&#xA0;19-3.&#xA0;Elapsed time = 0.440s"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">343</span><span sentence-index="10746" class="highlight3">Figure&#xA0;19-3</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10747</span><span sentence-index="10747" class="highlight4">  illustrate  the  example  we&apos;ll  focus  on. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10748</span><span sentence-index="10748" class="highlight2">  We  have            three  object  balls  (the  ones  that  get  struck  with  the  cue  ball)  set  up  in  the  middle  of  the            table  in  a  loose  triangle  configuration.</span></span></p><div class="figure"><a id="elapsed_time_equals_0.398s"></a><div class="figure-contents"><a id="elapsed_time_equals_0.398s"></a><div class="mediaobject"><a id="elapsed_time_equals_0.398s"></a><a id="I_mediaobject5_id350458"><img style="width: 394.2; " src="httpatomoreillycomsourceoreillyimages1598991.png.jpg" alt="Elapsed time = 0.398s"></a></div></div><div class="figure-title"><a id="I_mediaobject5_id350458"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">351</span><span sentence-index="10754" class="highlight3">Figure&#xA0;19-2.&#xA0;Elapsed  time  =  0.398s</span></span></a></div></div><p><a id="I_mediaobject5_id350458"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">353</span><span sentence-index="10756" class="highlight4">The  cue  ball  comes  from  the  right  at  a  set  speed  (see  </span></span></a><a class="xref" href="ch19.html#elapsed_time_equals_0.398s" title="Figure&#xA0;19-2.&#xA0;Elapsed time = 0.398s"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">354</span><span sentence-index="10757" class="highlight2">Figure&#xA0;19-2</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">354</span><span sentence-index="10757" class="highlight3">)  and  then  impacts  the  eight  ball  (see  </span></span><a class="xref" href="ch19.html#elapsed_time_equals_0.440s" title="Figure&#xA0;19-3.&#xA0;Elapsed time = 0.440s"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">356</span><span sentence-index="10759" class="highlight4">Figure&#xA0;19-3</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10759</span><span sentence-index="10759" class="highlight2"> ).</span></span></p><div class="figure"><a id="elapsed_time_equals_0.440s"></a><div class="figure-contents"><a id="elapsed_time_equals_0.440s"></a><div class="mediaobject"><a id="elapsed_time_equals_0.440s"></a><a id="I_mediaobject5_id350503"><img style="width: 394.2; " src="httpatomoreillycomsourceoreillyimages1598992.png.jpg" alt="Elapsed time = 0.440s"></a></div></div><div class="figure-title"><a id="I_mediaobject5_id350503"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">362</span><span sentence-index="10765" class="highlight3">Figure&#xA0;19-3.&#xA0;Elapsed  time  =  0.440s</span></span></a></div></div><p><a id="I_mediaobject5_id350503"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10767</span><span sentence-index="10767" class="highlight4">After  the  initial  impact  between  the  cue  ball  and  the  eight  ball,  the  eight  ball  moves  to            the  left  and  impacts  two  more  balls. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10768</span><span sentence-index="10768" class="highlight2">  These  balls  then  shoot  off  diagonally. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10769</span><span sentence-index="10769" class="highlight3">  Most  of  the  energy            from  the  eight  ball  is  transferred  to  the  two  other  balls,  so  the  eight  ball  quickly  comes  to            rest  while  being  kissed  by  the  cue  ball. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">367</span><span sentence-index="10770" class="highlight4"> The  other  two  balls  continue  rolling  away  diagonally            (see  </span></span></a><a class="xref" href="ch19.html#elapsed_time_equals_0.566s" title="Figure&#xA0;19-4.&#xA0;Elapsed time = 0.566s"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">368</span><span sentence-index="10771" class="highlight2">Figure&#xA0;19-4</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10772</span><span sentence-index="10772" class="highlight3"> ).</span></span></p><div class="figure"><a id="elapsed_time_equals_0.566s"></a><div class="figure-contents"><a id="elapsed_time_equals_0.566s"></a><div class="mediaobject"><a id="elapsed_time_equals_0.566s"></a><a id="I_mediaobject5_id350546"><img src="httpatomoreillycomsourceoreillyimages1598993.png.jpg" alt="Elapsed time = 0.566s"></a></div></div><div class="figure-title"><a id="I_mediaobject5_id350546"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">375</span><span sentence-index="10778" class="highlight4">Figure&#xA0;19-4.&#xA0;Elapsed  time  =  0.566s</span></span></a></div></div><p><a id="I_mediaobject5_id350546"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="10780" class="highlight2">In  this  example,  we&apos;ll  show  you  how  to  handle  ball-ball  collisions,  ball-table  collisions,            ball-table  contact,  aerodynamic  drag  on  the  ball,  rolling  resistance,  friction  between  balls            at  the  time  of  impact,  and  friction  between  the  balls  and  </span></span></a><a id="I_indexterm5_id350569" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10781</span><span sentence-index="10781" class="highlight3">table.</span></span></a></p><div class="sect2" title="Implementation"><div class="titlepage"><div><div><h3 class="title" id="implementation"><a id="I_indexterm5_id350569" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">381</span><span sentence-index="10784" class="highlight4">Implementation</span></span></a></h3></div></div></div><p><a id="I_indexterm5_id350569" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">383</span><span sentence-index="10786" class="highlight2">If  you&apos;ve  read  and  </span></span></a><a id="bi19.2.1" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">384</span><span sentence-index="10787" class="highlight3">studied  the  examples  presented  in  </span></span></a><a class="xref" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Real-Time Simulations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">386</span><span sentence-index="10789" class="highlight4">Chapter&#xA0;7</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">386</span><span sentence-index="10789" class="highlight2">               through  </span></span><a class="xref" href="ch13.html" title="Chapter&#xA0;13.&#xA0;Connecting Objects"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">387</span><span sentence-index="10790" class="highlight3">Chapter&#xA0;13</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10791</span><span sentence-index="10791" class="highlight4"> ,  then  the  implementation  of  this  billiards                example  will  be  very  familiar  to  you;  we  use  the  same  basic  approach. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10792</span><span sentence-index="10792" class="highlight2">  During  each  simulation                time  step,  we  calculate  all  the  forces  acting  on  each  ball;  integrate  the  equations  of                motion,  updating  each  ball&apos;s  position  and  velocity;  and  then  check  for  and  deal  with                collisions.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">391</span><span sentence-index="10794" class="highlight3">The  rigid-body  class  used  in  </span></span><a id="I_indexterm5_id350626" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="10795" class="highlight4">this  example  is  very  similar  to  that  used  for  the  airplane  example  in  </span></span></a><a class="xref" href="ch15.html" title="Chapter&#xA0;15.&#xA0;Aircraft"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">394</span><span sentence-index="10797" class="highlight2">Chapter&#xA0;15</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10797</span><span sentence-index="10797" class="highlight3"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">395</span><span sentence-index="10798" class="highlight4"> Even  though  the  balls  are  compact  and  round,  and  it&apos;s  tempting  to                treat  them  as  particles,  you  must  treat  them  as  </span></span><a id="I_indexterm5_id350644" class="indexterm"></a><a id="I_indexterm5_id350656" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10800</span><span sentence-index="10800" class="highlight2"> 3D  rigid  bodies  in  order  to  capture  rolling  and  spinning,  which  are  important                elements  of  billiard  ball  dynamics. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10801</span><span sentence-index="10801" class="highlight3">  The  rigid-body  class  adopted  for  this  billiards  example                is  as  follows.</span></span></a></p><a id="I_programlisting5_id350672"><pre class="programlisting">typedef struct _RigidBody {
    float        fMass;      // Total mass (constant)
    Matrix3x3    mInertia;   // Mass moment of inertia in body coordinates
    Matrix3x3    mInertiaInverse;// Inverse of mass moment of inertia matrix
    Vector    vPosition;     // Position in earth coordinates
    Vector    vVelocity;     // Velocity in earth coordinates
    Vector    vVelocityBody;  // Velocity in body coordinates
    Vector    vAcceleration;  // Acceleration of cg in earth space
    Vector    vAngularAcceleration; //Angular acceleration in body coordinates
    Vector    vAngularAccelerationGlobal; // Angular acceleration
                                          // in global coordinates
    Vector    vAngularVelocity; // Angular velocity in body coordinates
    Vector    vAngularVelocityGlobal; // Angular velocity in global coordinates
    Vector    vEulerAngles;   // Euler angles in body coordinates
    float     fSpeed;      // Speed (magnitude of the velocity)
    Quaternion  qOrientation;    // Orientation in earth coordinates
    Vector    vForces;        // Total force on body
    Vector    vMoments;       // Total moment (torque) on body
    Matrix3x3  mIeInverse;  // Inverse of moment of inertia in earth coordinates
    float      fRadius;     // Ball radius
} RigidBody, *pRigidBody;</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10804</span><span sentence-index="10804" class="highlight4">As  you  can  see,  this  class  looks  very  similar  to  the  rigid-body  classes  we&apos;ve  used                throughout  this  book,  and  in  particular  that  used  in  the  airplane  example. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10805</span><span sentence-index="10805" class="highlight2">  All  the  usual                suspects  are  here,  and  the  comments  in  this  code  sample  state  what  each  class  member                represents. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">403</span><span sentence-index="10806" class="highlight3"> One  particular  property  you  have  not  seen  yet  is  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">403</span><span sentence-index="10806" class="highlight4">fRadius</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10806</span><span sentence-index="10806" class="highlight2"> &#x2014;this  is  simply  the  billiard  ball&apos;s  radius,  which  is  used  when  we  are                checking  for  collisions  and  calculating  drag  forces.</span></span></p></a><p><a id="I_programlisting5_id350672"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">406</span><span sentence-index="10809" class="highlight3">As  we  discussed  in  </span></span></a><a class="xref" href="ch14.html" title="Chapter&#xA0;14.&#xA0;Physics Engines"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">407</span><span sentence-index="10810" class="highlight4">Chapter&#xA0;14</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10811</span><span sentence-index="10811" class="highlight2"> ,  since  there  are  multiple  objects                in  this  simulation  that  may  collide,  we&apos;re  going  to  iterate  through  all  the  objects,                checking  for  collisions  while  storing  the  collision  data. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">409</span><span sentence-index="10812" class="highlight3"> Since  there  are  not  that  many                objects  in  this  simulation,  we  don&apos;t  really  need  to  partition  the  game  space  in  order  to                optimize  the  collision  detection  checks  (refer  to  </span></span><a class="xref" href="ch14.html" title="Chapter&#xA0;14.&#xA0;Physics Engines"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">410</span><span sentence-index="10813" class="highlight4">Chapter&#xA0;14</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10814</span><span sentence-index="10814" class="highlight2"> ). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">412</span><span sentence-index="10815" class="highlight3"> The                data  we  need  to  store  for  each  collision  is  included  in  the  following  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">412</span><span sentence-index="10815" class="highlight4">Collision</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">412</span><span sentence-index="10815" class="highlight2"> structure:</span></span></p><a id="I_programlisting5_id350724"><pre class="programlisting">typedef struct    _Collision {
    int       body1;
    int       body2;
    Vector    vCollisionNormal;
    Vector    vCollisionPoint;
    Vector    vRelativeVelocity;
    Vector    vRelativeAcceleration;
    Vector    vCollisionTangent;
}   Collision, *pCollision;</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10817</span><span sentence-index="10817" class="highlight3">The  first  two  properties  are  indices  to  the  two  bodies  involved  in  the  collision. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">415</span><span sentence-index="10818" class="highlight4"> The                next  property,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">415</span><span sentence-index="10818" class="highlight2">vCollisionNormal</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">415</span><span sentence-index="10818" class="highlight3">,  stores  the  normal  vector                at  the  point  of  contact  of  the  collision  with  the  vector  pointing  outward  from  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">415</span><span sentence-index="10818" class="highlight4">body2</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10818</span><span sentence-index="10818" class="highlight2"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">416</span><span sentence-index="10819" class="highlight3"> The  next  property,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">416</span><span sentence-index="10819" class="highlight4">vCollisionPoint</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10819</span><span sentence-index="10819" class="highlight2"> ,  stores  the  coordinates  of  the  point  of  contact  in  global                coordinates. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10820</span><span sentence-index="10820" class="highlight3">  Since  we&apos;re  dealing  with  spheres  (billiard  balls),  the  collision  manifold  will                always  consist  of  a  single  point  for  each  ball-ball  or  ball-table  collision. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10821</span><span sentence-index="10821" class="highlight4">  The  next  two                properties  store  the  relative  velocity  and  acceleration  between  the  two  bodies  at  the  point                of  collision. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">419</span><span sentence-index="10822" class="highlight2"> The  data  is  stored  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">419</span><span sentence-index="10822" class="highlight3">vRelativeVelocity</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">419</span><span sentence-index="10822" class="highlight4"> and                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">419</span><span sentence-index="10822" class="highlight2">vRelativeAcceleration</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10822</span><span sentence-index="10822" class="highlight3"> ,  respectively. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10823</span><span sentence-index="10823" class="highlight4">  To  capture                friction  at  the  point  of  contact,  we  need  to  know  the  tangent  vector  to  the  bodies  at  the                point  of  contact. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">421</span><span sentence-index="10824" class="highlight2"> This  tangent  is  stored  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">421</span><span sentence-index="10824" class="highlight3">vCollisionTangent</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10824</span><span sentence-index="10824" class="highlight4"> .</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">423</span><span sentence-index="10826" class="highlight2">We  set  up  several  global  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">423</span><span sentence-index="10826" class="highlight3">define</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">423</span><span sentence-index="10826" class="highlight4">s  to  hold  key  data,                allowing  us  to  easily  tune  the  simulation:</span></span></p></a><a id="I_programlisting5_id350788"><pre class="programlisting">#define    BALLDIAMETER              0.05715f
#define    BALLWEIGHT                1.612f
#define    GRAVITY                   &#x2212;9.87f
#define    LINEARDRAGCOEFFICIENT     0.5f
#define    ANGULARDRAGCOEFFICIENT    0.05f
#define    FRICTIONFACTOR            0.5f
#define    COEFFICIENTOFRESTITUTION  0.8f
#define    COEFFICIENTOFRESTITUTIONGROUND  0.1f
#define    FRICTIONCOEFFICIENTBALLS     0.1f
#define    FRICTIONCOEFFICIENTGROUND    0.1f
#define    ROLLINGRESISTANCECOEFFICIENT 0.025f</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">425</span><span sentence-index="10828" class="highlight3">The  first  three  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">425</span><span sentence-index="10828" class="highlight4">define</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">425</span><span sentence-index="10828" class="highlight2">s  represent  the  billiard  ball                diameter  in  meters,  the  ball  weight  in  newtons,  and  the  acceleration  due  to  gravity  in                    m/s</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">425</span><span sentence-index="10828" class="highlight2">2</span></span></sup><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10828</span><span sentence-index="10828" class="highlight3"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10829</span><span sentence-index="10829" class="highlight4">  The  ball  diameter  and  weight  are  typical  values  for                American-style  billiard  balls  (i.e.,  2.25  inches  and  5.8  oz  on  average).</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10831</span><span sentence-index="10831" class="highlight2">The  remaining  defines  are  self-explanatory  and  represent  nondimensional  coefficients                such  as  drag  coefficients  and  coefficients  of  restitution. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10832</span><span sentence-index="10832" class="highlight3">  The  values  you  see  are  what  we                came  up  with  after  tuning  the  simulation. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10833</span><span sentence-index="10833" class="highlight4">  You&apos;ll  surely  tune  these  yourself  if  you  develop                your  own  billiards  game.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">432</span><span sentence-index="10835" class="highlight2 nonQuoteStr">We  use  three  important  global  variables  for  this  simulation,  as  shown  here:</span></span></p></a><a id="I_programlisting5_id350824"><pre class="programlisting">RigidBody      Bodies[NUMBODIES];
Collision      Collisions[NUMBODIES*8];
int            NumCollisions = 0;</pre></a><p><a id="I_programlisting5_id350824"><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">435</span><span sentence-index="10838" class="highlight3">Bodies</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">435</span><span sentence-index="10838" class="highlight4"> is  an  array  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">435</span><span sentence-index="10838" class="highlight2">RigidBody</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10838</span><span sentence-index="10838" class="highlight3">  types  and  represents  the  collection  of  the  billiard  balls. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">436</span><span sentence-index="10839" class="highlight4"> Here  we&apos;ve                defined  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">436</span><span sentence-index="10839" class="highlight2">NUMBODIES</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10839</span><span sentence-index="10839" class="highlight3">  as  4,  so  there  are  four  billiard  balls                in  this  simulation. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">437</span><span sentence-index="10840" class="highlight4"> We&apos;ve  adopted  the  convention  that  the  cue  ball  will  always  </span></span></a><a id="I_indexterm5_id350853" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">438</span><span sentence-index="10841" class="highlight2">be  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">438</span><span sentence-index="10841" class="highlight3">Bodies[0]</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10842</span><span sentence-index="10842" class="highlight4"> .</span></span></a></p></div><div class="sect2" title="Initialization"><div class="titlepage"><div><div><h3 class="title" id="initialization"><a id="I_indexterm5_id350853" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">442</span><span sentence-index="10845" class="highlight2">Initialization</span></span></a></h3></div></div></div><p><a id="I_indexterm5_id350853" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">444</span><span sentence-index="10847" class="highlight3">At  the  beginning  </span></span></a><a id="bi19.2.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10848</span><span sentence-index="10848" class="highlight4">of  the  simulation,  we  have  to  initialize  all  four  billiard  balls. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">446</span><span sentence-index="10849" class="highlight2"> We  use  one                function,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">446</span><span sentence-index="10849" class="highlight3">InitializeObjects</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10849</span><span sentence-index="10849" class="highlight4"> ,  for  this  task. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10850</span><span sentence-index="10850" class="highlight2">  It&apos;s  a  long                function,  but  it&apos;s  really  simple. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10851</span><span sentence-index="10851" class="highlight3">  The  code  is  shown  on  this  and  the  following  pages. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">449</span><span sentence-index="10852" class="highlight4">                   </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">449</span><span sentence-index="10852" class="highlight2">Bodies[0]</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10852</span><span sentence-index="10852" class="highlight3">  is  the  cue  ball,  and  it  is  positioned  50  ball                diameters  along  the  negative  x-axis  away  from  the  object  balls. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10853</span><span sentence-index="10853" class="highlight4">  There&apos;s  no  magic  to  this                number;  we  picked  it  arbitrarily. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10854</span><span sentence-index="10854" class="highlight2">  Now,  we  did  deliberately  set  the  z-position  of  the  cue                ball  (all  the  balls,  for  that  matter)  to  one-half  the  diameter  so  that  the  balls  would  be                just  touching  the  table  at  the  start  of  the  simulation.</span></span></a></p><p><a id="bi19.2.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10857</span><span sentence-index="10857" class="highlight3">To  have  the  cue  ball  roll  from  right  to  left,  we  gave  it  an  initial  velocity  of  7  m/s                along  the  positive  x-axis. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10858</span><span sentence-index="10858" class="highlight4">  With  this  initial  velocity,  the  cue  ball  will  begin  sliding                across  the  table  for  some  short  distance  as  it  also  starts  to  roll  due  to  the  friction                between  the  ball  and  table. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10859</span><span sentence-index="10859" class="highlight2">  You  can  see  in  the  upcoming  code  sample  that  all  the  other                kinematic  properties  are  set  to  0  for  the  cue  ball. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10860</span><span sentence-index="10860" class="highlight3">  For  the  object  balls,  all  of  their                kinematic  properties  are  set  to  0.</span></span></a></p><p><a id="bi19.2.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10863</span><span sentence-index="10863" class="highlight4">We  encourage  you  to  experiment  with  different  initial  values  for  the  cue  ball&apos;s                kinematic  properties. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10864</span><span sentence-index="10864" class="highlight2">  For  example,  try  setting  the  angular  velocity  about  any  of  the                coordinate  axes  to  something  other  than  0. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10865</span><span sentence-index="10865" class="highlight3">  Doing  so  will  allow  you  to  see  how  a  spinning                ball  may  move  slightly  left  or  right  depending  on  the  spin. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10866</span><span sentence-index="10866" class="highlight4">  It&apos;s  also  fun  to  see  how  spin                affects  the  object  balls  upon  collision  with  the  cue  ball.</span></span></a></p><p><a id="bi19.2.2" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">466</span><span sentence-index="10869" class="highlight2">Aside  from  setting  the  positions  and  kinematic  properties  of  the  balls,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">466</span><span sentence-index="10869" class="highlight3">InitializeObjects</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10869</span><span sentence-index="10869" class="highlight4">  also  initializes  mass  properties. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">467</span><span sentence-index="10870" class="highlight2"> We  used  the                previously  defined  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">467</span><span sentence-index="10870" class="highlight3">BALLWEIGHT</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10870</span><span sentence-index="10870" class="highlight4">  divided  by  the  acceleration                due  to  gravity  to  determine  the  ball  mass. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">468</span><span sentence-index="10871" class="highlight2"> For  mass  moment  of  inertia,  we  simply  used  the                equations  for  a  solid  sphere  we  showed  you  way  back  in  </span></span></a><a class="xref" href="ch01.html" title="Chapter&#xA0;1.&#xA0;Basic Concepts"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">469</span><span sentence-index="10872" class="highlight3">Chapter&#xA0;1</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">469</span><span sentence-index="10872" class="highlight4">:</span></span></p><a id="I_programlisting5_id350954"><pre class="programlisting">void InitializeObjects(int configuration)
{
    float      iRoll, iPitch, iYaw;
    int        i;
    float      Ixx, Iyy, Izz;
    float      s;

    /////////////////////////////////////////////////////
    // Initialize the cue ball:
    // Set initial position
    Bodies[0].vPosition.x = -BALLDIAMETER*50.0f;
    Bodies[0].vPosition.y = 0.0f;
    Bodies[0].vPosition.z = BALLDIAMETER/2.0f;

    // Set initial velocity
    s = 7.0;
    Bodies[0].vVelocity.x = s;
    Bodies[0].vVelocity.y = 0.0f;
    Bodies[0].vVelocity.z = 0.0f;
    Bodies[0].fSpeed = s;

    // Set initial angular velocity
    Bodies[0].vAngularVelocity.x = 0.0f; // rotate about long&apos;l axis
    Bodies[0].vAngularVelocity.y = 0.0f; // rotate about transverse axis
    Bodies[0].vAngularVelocity.z = 0.0f; // rotate about vertical axis

    Bodies[0].vAngularAcceleration.x = 0.0f;
    Bodies[0].vAngularAcceleration.y = 0.0f;
    Bodies[0].vAngularAcceleration.z = 0.0f;

    Bodies[0].vAcceleration.x = 0.0f;
    Bodies[0].vAcceleration.y = 0.0f;
    Bodies[0].vAcceleration.z = 0.0f;

    // Set the initial forces and moments
    Bodies[0].vForces.x = 0.0f;
    Bodies[0].vForces.y = 0.0f;
    Bodies[0].vForces.z = 0.0f;

    Bodies[0].vMoments.x = 0.0f;
    Bodies[0].vMoments.y = 0.0f;
    Bodies[0].vMoments.z = 0.0f;

    // Zero the velocity in body space coordinates
    Bodies[0].vVelocityBody.x = 0.0f;
    Bodies[0].vVelocityBody.y = 0.0f;
    Bodies[0].vVelocityBody.z = 0.0f;

    // Set the initial orientation
    iRoll = 0.0f;
    iPitch = 0.0f;
    iYaw = 0.0f;
    Bodies[0].qOrientation = MakeQFromEulerAngles(iRoll, iPitch, iYaw);

    // Set the mass properties
    Bodies[0].fMass = BALLWEIGHT/(-g);

    Ixx = 2.0f * Bodies[0].fMass / 5.0f * (BALLDIAMETER/2*BALLDIAMETER/2);
    Izz = Iyy = Ixx;

    Bodies[0].mInertia.e11 = Ixx;
    Bodies[0].mInertia.e12 = 0;
    Bodies[0].mInertia.e13 = 0;
    Bodies[0].mInertia.e21 = 0;
    Bodies[0].mInertia.e22 = Iyy;
    Bodies[0].mInertia.e23 = 0;
    Bodies[0].mInertia.e31 = 0;
    Bodies[0].mInertia.e32 = 0;
    Bodies[0].mInertia.e33 = Izz;

    Bodies[0].mInertiaInverse = Bodies[0].mInertia.Inverse();

    Bodies[0].fRadius = BALLDIAMETER/2;


    /////////////////////////////////////////////////////
    // Initialize the other balls
    for(i=1; i&lt;NUMBODIES; i++)
    {
        // Set initial position
        if(i==1)
        {
            Bodies[i].vPosition.x = 0.0;
            Bodies[i].vPosition.y = -(BALLDIAMETER/2.0f+0.25*BALLDIAMETER);
            Bodies[i].vPosition.z = BALLDIAMETER/2.0f;
        } else if(i==2) {
            Bodies[i].vPosition.x = 0.0;
            Bodies[i].vPosition.y = BALLDIAMETER/2.0f+0.25*BALLDIAMETER;
            Bodies[i].vPosition.z = BALLDIAMETER/2.0f;
        } else {
            Bodies[i].vPosition.x = -BALLDIAMETER;
            Bodies[i].vPosition.y = 0.0f;
            Bodies[i].vPosition.z = BALLDIAMETER/2.0f;
        }

        // Set initial velocity
        Bodies[i].vVelocity.x = 0.0f;
        Bodies[i].vVelocity.y = 0.0f;
        Bodies[i].vVelocity.z = 0.0f;
        Bodies[i].fSpeed = 0.0f;

        // Set initial angular velocity
        Bodies[i].vAngularVelocity.x = 0.0f;
        Bodies[i].vAngularVelocity.y = 0.0f;
        Bodies[i].vAngularVelocity.z = 0.0f;

        Bodies[i].vAngularAcceleration.x = 0.0f;
        Bodies[i].vAngularAcceleration.y = 0.0f;
        Bodies[i].vAngularAcceleration.z = 0.0f;

        Bodies[i].vAcceleration.x = 0.0f;
        Bodies[i].vAcceleration.y = 0.0f;
        Bodies[i].vAcceleration.z = 0.0f;

        // Set the initial forces and moments
        Bodies[i].vForces.x = 0.0f;
        Bodies[i].vForces.y = 0.0f;
        Bodies[i].vForces.z = 0.0f;

        Bodies[i].vMoments.x = 0.0f;
        Bodies[i].vMoments.y = 0.0f;
        Bodies[i].vMoments.z = 0.0f;

        // Zero the velocity in body space coordinates
        Bodies[i].vVelocityBody.x = 0.0f;
        Bodies[i].vVelocityBody.y = 0.0f;
        Bodies[i].vVelocityBody.z = 0.0f;

        // Set the initial orientation
        iRoll = 0.0f;
        iPitch = 0.0f;
        iYaw = 0.0f;
        Bodies[i].qOrientation = MakeQFromEulerAngles(iRoll, iPitch, iYaw);

        // Set the mass properties
        Bodies[i].fMass = BALLWEIGHT/(-g);
        Ixx = 2.0f * Bodies[i].fMass / 5.0f * (BALLDIAMETER*BALLDIAMETER);
        Izz = Iyy = Ixx;

        Bodies[i].mInertia.e11 = Ixx;
        Bodies[i].mInertia.e12 = 0;
        Bodies[i].mInertia.e13 = 0;
        Bodies[i].mInertia.e21 = 0;
        Bodies[i].mInertia.e22 = Iyy;
        Bodies[i].mInertia.e23 = 0;
        Bodies[i].mInertia.e31 = 0;
        Bodies[i].mInertia.e32 = 0;
        Bodies[i].mInertia.e33 = Izz;

        Bodies[i].mInertiaInverse = Bodies[i].mInertia.Inverse();
        Bodies[i].fRadius = BALLDIAMETER/2;
    }
}</pre></a></div><div class="sect2" title="Stepping the Simulation"><div class="titlepage"><div><div><h3 class="title" id="stepping_the_simulation"><a id="I_programlisting5_id350954"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">473</span><span sentence-index="10876" class="highlight2">Stepping  the  Simulation</span></span></a></h3></div></div></div><p><a id="I_programlisting5_id350954"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">475</span><span sentence-index="10878" class="highlight3">During  each  time  </span></span></a><a id="I_indexterm5_id351012" class="indexterm"></a><a id="I_indexterm5_id351022" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">477</span><span sentence-index="10880" class="highlight4">step,  the  simulation&apos;s  main  loop  makes  a  call  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">477</span><span sentence-index="10880" class="highlight2">StepSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10880</span><span sentence-index="10880" class="highlight3"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">478</span><span sentence-index="10881" class="highlight4"> This  function,  shown  next,  is  almost  identical  to  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">478</span><span sentence-index="10881" class="highlight2">StepSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10881</span><span sentence-index="10881" class="highlight3">  functions  we  covered  in  the  other  examples  shown                throughout  this  book,  so  there  really  are  no  surprises  here. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">479</span><span sentence-index="10882" class="highlight4"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">479</span><span sentence-index="10882" class="highlight2">StepSimulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">479</span><span sentence-index="10882" class="highlight3"> first  makes  a  call  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">479</span><span sentence-index="10882" class="highlight4">CalcObjectForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10882</span><span sentence-index="10882" class="highlight2"> ,  which  we&apos;ll  discuss  momentarily,  and  then  proceeds  to                integrate  the  equations  of  motion  for  each  ball. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">480</span><span sentence-index="10883" class="highlight3"> We  use  a  basic  </span></span></a><a id="I_indexterm5_id351060" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10884</span><span sentence-index="10884" class="highlight4">Euler  scheme  here  for  simplicity. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">482</span><span sentence-index="10885" class="highlight2"> After  integrating,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">482</span><span sentence-index="10885" class="highlight3">StepSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10885</span><span sentence-index="10885" class="highlight4">  makes  a  few  function  calls  to  deal  with  collisions. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10886</span><span sentence-index="10886" class="highlight2">  We&apos;ll  cover                those  shortly.</span></span></a></p><a id="I_programlisting5_id351080"><pre class="programlisting">void StepSimulation(float dtime)
{
    Vector     Ae;
    int        i;
    float      dt = dtime;
    int        check = NOCOLLISION;
    int        c = 0;

    // Calculate all of the forces and moments on the balls:
    CalcObjectForces();

    // Integrate the equations of motion:
    for(i=0; i&lt;NUMBODIES; i++)
    {
        // Calculate the acceleration in earth space:
        Ae = Bodies[i].vForces / Bodies[i].fMass;
        Bodies[i].vAcceleration = Ae;

        // Calculate the velocity in earth space:
        Bodies[i].vVelocity += Ae * dt;

        // Calculate the position in earth space:
        Bodies[i].vPosition += Bodies[i].vVelocity * dt;

        // Now handle the rotations:
        float    mag;

        Bodies[i].vAngularAcceleration = Bodies[i].mInertiaInverse *
                                    (Bodies[i].vMoments -
                                    (Bodies[i].vAngularVelocity^
                                    (Bodies[i].mInertia *
        Bodies[i].vAngularVelocity)));

        Bodies[i].vAngularVelocity += Bodies[i].vAngularAcceleration * dt;

        // Calculate the new rotation quaternion:
        Bodies[i].qOrientation += (Bodies[i].qOrientation *
                                   Bodies[i].vAngularVelocity) *
                                   (0.5f * dt);

        // Now normalize the orientation quaternion:
        mag = Bodies[i].qOrientation.Magnitude();
        if (mag != 0)
            Bodies[i].qOrientation /= mag;

        // Calculate the velocity in body space:
        Bodies[i].vVelocityBody = QVRotate(~Bodies[i].qOrientation,
                                    Bodies[i].vVelocity);

        // Get the angular velocity in global coords:
        Bodies[i].vAngularVelocityGlobal = QVRotate(Bodies[i].qOrientation,
                                    Bodies[i].vAngularVelocity);

        // Get the angular acceleration in global coords:
        Bodies[i].vAngularAccelerationGlobal = QVRotate(Bodies[i].qOrientation,
                                    Bodies[i].vAngularAcceleration);

        // Get the inverse intertia tensor in global coordinates
        Matrix3x3 R, RT;
        R = MakeMatrixFromQuaternion(Bodies[i].qOrientation);
        RT = R.Transpose();
        Bodies[i].mIeInverse = R * Bodies[i].mInertiaInverse * RT;

        // Calculate the air speed:
        Bodies[i].fSpeed = Bodies[i].vVelocity.Magnitude();

        // Get the Euler angles for our information
        Vector u;

        u = MakeEulerAnglesFromQ(Bodies[i].qOrientation);
        Bodies[i].vEulerAngles.x = u.x;    // roll
        Bodies[i].vEulerAngles.y = u.y;    // pitch
        Bodies[i].vEulerAngles.z = u.z;    // yaw
    }

    // Handle Collisions    :
    check = CheckForCollisions();
    if(check == COLLISION)
        ResolveCollisions();
}</pre></a></div><div class="sect2" title="Calculating Forces"><div class="titlepage"><div><div><h3 class="title" id="calculating_forces"><a id="I_programlisting5_id351080"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">487</span><span sentence-index="10890" class="highlight3">Calculating  Forces</span></span></a></h3></div></div></div><p><a id="I_programlisting5_id351080"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">489</span><span sentence-index="10892" class="highlight4">The  first  </span></span></a><a id="bi19.2.4" class="indexterm"></a><a id="fo19.2.4" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">491</span><span sentence-index="10894" class="highlight2">function  call  made  by  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">491</span><span sentence-index="10894" class="highlight3">StepSimulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">491</span><span sentence-index="10894" class="highlight4"> is  a                call  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">491</span><span sentence-index="10894" class="highlight2">CalcObjectForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10894</span><span sentence-index="10894" class="highlight3"> ,  which  is  responsible  for                computing  all  the  forces  on  each  ball  except  collision  forces. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10895</span><span sentence-index="10895" class="highlight4">  This  is  the  same  approach                used  in  previous  examples. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">493</span><span sentence-index="10896" class="highlight2"> The  entire  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">493</span><span sentence-index="10896" class="highlight3">CalcObjectForces</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">493</span><span sentence-index="10896" class="highlight4">               source  code  is  included  here:</span></span></a></p><a id="I_programlisting5_id351175"><pre class="programlisting">void CalcObjectForces(void)
{
    Vector    Fb, Mb;
    Vector    vDragVector;
    Vector    vAngularDragVector;
    int       i, j;
    Vector    ContactForce;
    Vector    pt;
    int       check = NOCOLLISION;
    pCollision    pCollisionData;
    Vector    FrictionForce;
    Vector    fDir;
    double    speed;
    Vector    FRn, FRt;

    for(i=0; i&lt;NUMBODIES; i++)
    {
        // Reset forces and moments:
        Bodies[i].vForces.x = 0.0f;
        Bodies[i].vForces.y = 0.0f;
        Bodies[i].vForces.z = 0.0f;

        Bodies[i].vMoments.x = 0.0f;
        Bodies[i].vMoments.y = 0.0f;
        Bodies[i].vMoments.z = 0.0f;

        Fb.x = 0.0f;    Mb.x = 0.0f;
        Fb.y = 0.0f;    Mb.y = 0.0f;
        Fb.z = 0.0f;    Mb.z = 0.0f;

        // Do drag force:
        vDragVector = -Bodies[i].vVelocityBody;
        vDragVector.Normalize();
        speed = Bodies[i].vVelocityBody.Magnitude();
        Fb += vDragVector * ((1.0f/2.0f)*speed * speed * rho *
            LINEARDRAGCOEFFICIENT * pow(Bodies[i].fRadius,2) *
            Bodies[i].fRadius*pi);

        vAngularDragVector = -Bodies[i].vAngularVelocity;
        vAngularDragVector.Normalize();
        Mb += vAngularDragVector * (Bodies[i].vAngularVelocity.Magnitude() *
            Bodies[i].vAngularVelocity.Magnitude() * rho * ANGULARDRAGCOEFFICIENT
            * 4 * pow(Bodies[i].fRadius,2)*pi);

        // Convert forces from model space to earth space:
        Bodies[i].vForces = QVRotate(Bodies[i].qOrientation, Fb);

        // Apply gravity:
        Bodies[i].vForces.z += GRAVITY * Bodies[i].fMass;

        // Save the moments:
        Bodies[i].vMoments += Mb;

        // Handle contacts with ground plane:
        Bodies[i].vAcceleration = Bodies[i].vForces / Bodies[i].fMass;
        Bodies[i].vAngularAcceleration = Bodies[i].mInertiaInverse *
                                    (Bodies[i].vMoments -
                                    (Bodies[i].vAngularVelocity^
                                    (Bodies[i].mInertia *
                                     Bodies[i].vAngularVelocity)));


        // Resolve ground plane contacts:
        FlushCollisionData();
        pCollisionData = Collisions;
        NumCollisions = 0;
        if(DOCONTACT)
            check = CheckGroundPlaneContacts(pCollisionData, i);
        if((check == CONTACT) &amp;&amp; DOCONTACT)
        {    j = 0;
            {
                assert(NumCollisions &lt;= 1);

                ContactForce = (Bodies[i].fMass * (-Bodies[i].vAcceleration *
                            Collisions[j].vCollisionNormal)) *
                            Collisions[j].vCollisionNormal;

                if(DOFRICTION)
                {
                    double vt = fabs(Collisions[j].vRelativeVelocity *
                            Collisions[j].vCollisionTangent);
                    if(vt &gt; VELOCITYTOLERANCE)
                    {
                        // Kinetic:
                        FrictionForce = (ContactForce.Magnitude() *
                                    FRICTIONCOEFFICIENTGROUND) *
                                    Collisions[j].vCollisionTangent;
                    } else {
                        // Static:
                        FrictionForce = (ContactForce.Magnitude() *
                                    FRICTIONCOEFFICIENTGROUND * 2 *
                                    vt/VELOCITYTOLERANCE) *
                                    Collisions[j].vCollisionTangent;
                    }

                } else
                    FrictionForce.x = FrictionForce.y = FrictionForce.z = 0;

                // Do rolling resistance:
                if(Bodies[i].vAngularVelocity.Magnitude() &gt; VELOCITYTOLERANCE)
                {
                    FRn = ContactForce.Magnitude() *
                          Collisions[j].vCollisionNormal;
                    Collisions[j].vCollisionTangent.Normalize();
                    Vector m = (Collisions[j].vCollisionTangent
                                *(ROLLINGRESISTANCECOEFFICIENT *
                                Bodies[i].fRadius))^FRn;
                    double mag = m.Magnitude();
                    Vector a = Bodies[i].vAngularVelocity;
                    a.Normalize();
                    Bodies[i].vMoments += -a * mag;
                }

                // accumlate contact and friction forces and moments
                Bodies[i].vForces += ContactForce;
                Bodies[i].vForces += FrictionForce;

                ContactForce = QVRotate(~Bodies[i].qOrientation, ContactForce);
                FrictionForce = QVRotate(~Bodies[i].qOrientation,
                                   FrictionForce);
                pt = Collisions[j].vCollisionPoint - Bodies[i].vPosition;
                pt = QVRotate(~Bodies[i].qOrientation, pt);
                Bodies[i].vMoments += pt^ContactForce;
                Bodies[i].vMoments += pt^FrictionForce;

            }
        }

    }
}</pre></a><p><a id="I_programlisting5_id351175"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">496</span><span sentence-index="10899" class="highlight2">As  you  can  see,  upon  entering  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">496</span><span sentence-index="10899" class="highlight3">CalcObjectForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10899</span><span sentence-index="10899" class="highlight4">  the                code  enters  a  loop  that  cycles  through  all  the  billiard  ball  objects,  computing  the  forces                acting  on  each. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">497</span><span sentence-index="10900" class="highlight2"> The  first  force  computed  is  simple  </span></span></a><a id="I_indexterm5_id351232" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10901</span><span sentence-index="10901" class="highlight3">aerodynamic  drag. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10902</span><span sentence-index="10902" class="highlight4">  Both  linear  and  angular  drag  are  computed. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">500</span><span sentence-index="10903" class="highlight3"> We  compute  the                magnitude  of  the  linear  drag  by  multiplying  the  linear  drag  coefficient  by                    1/2&#x3C1;</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">500</span><span>V</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">500</span><span sentence-index="10903" class="highlight2">2</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">500</span><span>r</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">500</span><span sentence-index="10903" class="highlight3">2&#x3C0;</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">500</span><span>r</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">500</span><span sentence-index="10903" class="highlight4">,  where  &#x3C1;  is  the                density  of  air,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">500</span><span sentence-index="10903" class="highlight4">V</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">500</span><span sentence-index="10903" class="highlight2"> is  the  ball&apos;s  linear  speed,  and                    </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">500</span><span sentence-index="10903" class="highlight2">r</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10903</span><span sentence-index="10903" class="highlight3">  is  the  ball&apos;s  radius. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">501</span><span sentence-index="10904" class="highlight4"> We  compute  the  magnitude  of  the  angular  drag                moment  by  multiplying  the  angular  drag  coefficient  by  &#x3C9;&#x3C1;4</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">501</span><span sentence-index="10904" class="highlight2">r</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10904</span><span sentence-index="10904" class="highlight3"> 2&#x3C0;,  where  &#x3C9;                is  angular  speed. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10905</span><span sentence-index="10905" class="highlight4">  Since  drag  retards  motion,  the  linear  drag  and  angular  drag  vectors  are                simply  the  opposite  of  the  linear  and  angular  velocity  vectors,  respectively. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10906</span><span sentence-index="10906" class="highlight2">  Normalizing                those  vectors  and  then  multiplying  by  the  respective  drag  magnitudes  yields  the  linear  and                angular  drag  force  and  moment  vectors.</span></span></a></p><p><a id="I_indexterm5_id351232" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">506</span><span sentence-index="10909" class="highlight3">The  next  set  of  forces  calculated  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">506</span><span sentence-index="10909" class="highlight4">CalcObjectForces</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">506</span><span sentence-index="10909" class="highlight2">               is  the  </span></span></a><a id="I_indexterm5_id351282" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10910</span><span sentence-index="10910" class="highlight3">contact  forces  between  the  table  top  and  each  ball. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10911</span><span sentence-index="10911" class="highlight4">  There  are  three  contact                forces. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10912</span><span sentence-index="10912" class="highlight2">  One  is  the  vertical  force  that  keeps  the  balls  from  falling  through  the  table,                another  is  the  friction  force  that  arises  as  the  balls  slide  along  the  table,  and  the  third                is  rolling  resistance. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10913</span><span sentence-index="10913" class="highlight3">  These  forces  arise  only  if  the  ball  is  in  contact  with  the  table. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10914</span><span sentence-index="10914" class="highlight4">                We&apos;ll  address  how  to  determine  whether  a  ball  is  in  contact  with  the  table  later  in  this                chapter. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10915</span><span sentence-index="10915" class="highlight2">  For  now,  we&apos;ll  assume  there&apos;s  contact  and  show  you  how  to  compute  the  contact                forces.</span></span></a></p><p><a id="I_indexterm5_id351282" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">515</span><span sentence-index="10918" class="highlight3">To  compute  the  vertical  force</span></span></a><a id="I_indexterm5_id351305" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">516</span><span sentence-index="10919" class="highlight4"> required  to  keep  the  ball  from  falling  through  the  table,  we  must  first  compute                the  ball&apos;s  linear  acceleration</span></span></a><a id="I_indexterm5_id351313" class="indexterm"></a><a id="I_indexterm5_id351325" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10922</span><span sentence-index="10922" class="highlight2"> ,  which  is  equal  to  the  sum  of  forces  (excluding  contact  forces)  acting  on  the                ball  divided  by  the  ball&apos;s  mass. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10923</span><span sentence-index="10923" class="highlight3">  Next,  we  take  the  negative  dot  product  of  that  acceleration                and  the  vector  perpendicular  to  the  table  surface  and  multiply  the  result  by  the  ball&apos;s                mass. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10924</span><span sentence-index="10924" class="highlight4">  This  yields  the  magnitude  of  the  contact  force,  and  to  get  the  vector  we  multiply  that                magnitude  by  the  unit  vector  perpendicular  to  the  table&apos;s  surface. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">522</span><span sentence-index="10925" class="highlight2"> The  following  two  lines                of  code  perform  these  calculations:</span></span></a></p><a id="I_programlisting5_id351342"><pre class="programlisting">Bodies[i].vAcceleration = Bodies[i].vForces / Bodies[i].fMass;

ContactForce = (Bodies[i].fMass * (-Bodies[i].vAcceleration *
                            Collisions[j].vCollisionNormal)) *
                            Collisions[j].vCollisionNormal;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">524</span><span sentence-index="10927" class="highlight3">The  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">524</span><span sentence-index="10927" class="highlight4">vCollisionNormal</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">524</span><span sentence-index="10927" class="highlight2"> vector  is  determined  by  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">524</span><span sentence-index="10927" class="highlight3">CheckGroundPlaneContacts</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10927</span><span sentence-index="10927" class="highlight4"> ,  which  we&apos;ll  cover  later. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">525</span><span sentence-index="10928" class="highlight2"> As  with                collisions,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">525</span><span sentence-index="10928" class="highlight3">CheckGroundPlaneContacts</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10928</span><span sentence-index="10928" class="highlight4">  fills  in  a  data                structure  containing  the  point  of  contact,  relative  velocity  between  the  ball  and  table  at                the  point  of  contact,  and  the  contact  normal  and  tangent  vectors,  among  other  data.</span></span></p></a><p><a id="I_programlisting5_id351342"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">528</span><span sentence-index="10931" class="highlight2">To  compute  the  </span></span></a><a id="I_indexterm5_id351376" class="indexterm"></a><a id="I_indexterm5_id351383" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10933</span><span sentence-index="10933" class="highlight3">sliding  friction  force,  we  must  first  determine  the  tangential  component  of  the                relative  velocity  between  the  ball  and  table. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10934</span><span sentence-index="10934" class="highlight4">  If  the  ball  is  sliding  or  slipping  as  it                rolls,  then  the  relative  tangential  velocity  will  be  greater  than  0. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10935</span><span sentence-index="10935" class="highlight2">  If  the  ball  is  rolling                without  sliding,  then  the  relative  velocity  will  be  0. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10936</span><span sentence-index="10936" class="highlight3">  In  either  case,  there  will  be  a                friction  force;  in  the  former  case,  we&apos;ll  use  the  kinetic  friction  coefficient,  and  in  the                latter  we&apos;ll  use  the  static  friction  coefficient. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">534</span><span sentence-index="10937" class="highlight4"> Friction  force  is  computed  in  the  same  way                we  showed  you  in  </span></span></a><a class="xref" href="ch03.html" title="Chapter&#xA0;3.&#xA0;Force"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">535</span><span sentence-index="10938" class="highlight2">Chapter&#xA0;3</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10939</span><span sentence-index="10939" class="highlight3"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">537</span><span sentence-index="10940" class="highlight4"> The  following  lines  of  code  perform  all  these                calculations:</span></span></p><a id="I_programlisting5_id351407"><pre class="programlisting">                ContactForce = (Bodies[i].fMass * (-Bodies[i].vAcceleration *
                            Collisions[j].vCollisionNormal)) *
                            Collisions[j].vCollisionNormal;

                double vt = fabs(Collisions[j].vRelativeVelocity *
                            Collisions[j].vCollisionTangent);
                if(vt &gt; VELOCITYTOLERANCE)
                {
                    // Kinetic:
                    FrictionForce = (ContactForce.Magnitude() *
                                FRICTIONCOEFFICIENTGROUND) *
                                Collisions[j].vCollisionTangent;
                } else {
                    // Static:
                    FrictionForce = (ContactForce.Magnitude() *
                                FRICTIONCOEFFICIENTGROUND * 2 *
                                vt/VELOCITYTOLERANCE) *
                                Collisions[j].vCollisionTangent;
                }</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10942</span><span sentence-index="10942" class="highlight2">Keep  in  mind  that  these  forces  will  create  moments  if  they  do  not  act  through  the  ball&apos;s                center  of  gravity. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10943</span><span sentence-index="10943" class="highlight3">  So,  after  computing  and  aggregating  these  forces,  you  must  also  resolve                any  moments  created  and  aggregate  those  using  the  same  formulas  we&apos;ve  shown  through  this                book. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">541</span><span sentence-index="10944" class="highlight4"> The  following  lines  of  code  take  care  of  these  tasks:</span></span></p></a><a id="I_programlisting5_id351428"><pre class="programlisting">                // accumlate contact and friction forces and moments
                Bodies[i].vForces += ContactForce;
                Bodies[i].vForces += FrictionForce;

                ContactForce = QVRotate(~Bodies[i].qOrientation, ContactForce);
                FrictionForce = QVRotate(~Bodies[i].qOrientation,
                                FrictionForce);
                pt = Collisions[j].vCollisionPoint - Bodies[i].vPosition;
                pt = QVRotate(~Bodies[i].qOrientation, pt);
                Bodies[i].vMoments += pt^ContactForce;
                Bodies[i].vMoments += pt^FrictionForce;</pre></a><p><a id="I_programlisting5_id351428"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">544</span><span sentence-index="10947" class="highlight2">Rolling  resistance  </span></span></a><a id="I_indexterm5_id351441" class="indexterm"></a><a id="I_indexterm5_id351447" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10949</span><span sentence-index="10949" class="highlight3">arises  by  virtue  of  small  deformations  in  the  cloth-covered  table  creating  a                little  divot  that  the  ball  must  overcome  as  it  rolls. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10950</span><span sentence-index="10950" class="highlight4">  This  divot  shifts  the  center  of                application  of  the  contact  force  just  a  little  bit  in  the  direction  of  rolling. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10951</span><span sentence-index="10951" class="highlight2">  That  small                offset  results  in  a  moment  when  multiplied  by  the  contact  force. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10952</span><span sentence-index="10952" class="highlight3">  The  resulting  moment                opposes  rolling;  otherwise,  without  some  other  resistance  the  ball  would  continue  rolling                unrealistically. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">550</span><span sentence-index="10953" class="highlight4"> The  following  code  </span></span></a><a id="I_indexterm5_id351463" class="indexterm"></a><a id="I_indexterm5_id351472" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">552</span><span sentence-index="10955" class="highlight2">computes  the  rolling  resistance:</span></span></a></p><a id="I_programlisting5_id351484"><pre class="programlisting">                // Do rolling resistance:
                if(Bodies[i].vAngularVelocity.Magnitude() &gt; VELOCITYTOLERANCE)
                {
                    FRn = ContactForce.Magnitude() *
                          Collisions[j].vCollisionNormal;
                    Collisions[j].vCollisionTangent.Normalize();
                    Vector m = (Collisions[j].vCollisionTangent
                                *(ROLLINGRESISTANCECOEFFICIENT *
                                Bodies[i].fRadius))^FRn;
                    double mag = m.Magnitude();
                    Vector a = Bodies[i].vAngularVelocity;
                    a.Normalize();
                    Bodies[i].vMoments += -a * mag;
                }</pre></a></div><div class="sect2" title="Handling Collisions"><div class="titlepage"><div><div><h3 class="title" id="handling_collisions"><a id="I_programlisting5_id351484"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">555</span><span sentence-index="10958" class="highlight3 nonQuoteStr">Handling  Collisions</span></span></a></h3></div></div></div><p><a id="I_programlisting5_id351484"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">557</span><span sentence-index="10960" class="highlight4">Earlier  you  </span></span></a><a id="bi19.2.5" class="indexterm"></a><a id="cr19.2.5" class="indexterm"></a><a id="cd19.2.5" class="indexterm"></a><a id="co19.2.5" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">561</span><span sentence-index="10964" class="highlight2">saw  where  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">561</span><span sentence-index="10964" class="highlight3">StepSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10964</span><span sentence-index="10964" class="highlight4">  makes  a  few  function                calls  to  deal  with  collision  checking  and  response. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">562</span><span sentence-index="10965" class="highlight2"> You  also  saw  where  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">562</span><span sentence-index="10965" class="highlight3">CalcObjectForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10965</span><span sentence-index="10965" class="highlight4">  makes  a  function  call  that  checks  for  contacts. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">563</span><span sentence-index="10966" class="highlight2">               The  functions  that  check  for  collisions  or  contacts  make  use  of  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">563</span><span sentence-index="10966" class="highlight3">Collisions</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10966</span><span sentence-index="10966" class="highlight4">  array  we  showed  you  earlier. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">564</span><span sentence-index="10967" class="highlight2"> This  array  stores  all  the  relevant                information  pertaining  to  collisions  or  contacts&#x2014;the  collision  or  contact  manifold,  </span></span></a><a id="I_indexterm5_id351590" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10968</span><span sentence-index="10968" class="highlight3">normal  and  tangent  vectors,  relative  velocity,  etc.</span></span></a></p><p><a id="I_indexterm5_id351590" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">568</span><span sentence-index="10971" class="highlight4">The  first  function  we&apos;ll  consider  is  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">568</span><span sentence-index="10971" class="highlight2">CheckForCollisions</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">568</span><span sentence-index="10971" class="highlight3">,  which  is  called  toward  the  end  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">568</span><span sentence-index="10971" class="highlight4">StepSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10971</span><span sentence-index="10971" class="highlight2"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">569</span><span sentence-index="10972" class="highlight3"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">569</span><span sentence-index="10972" class="highlight4">CheckForCollisions</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10972</span><span sentence-index="10972" class="highlight2">  checks                for  ball-ball  collisions;  we  have  a  separate  function  to  check  for  ball-table  collisions                that  we&apos;ll  get  to  later. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">570</span><span sentence-index="10973" class="highlight3"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">570</span><span sentence-index="10973" class="highlight4">CheckForCollisions</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10973</span><span sentence-index="10973" class="highlight2">  relies  on                concepts  we&apos;ve  already  discussed  and  showed  you  in  earlier  chapters,  so  we&apos;ll  summarize  its                action  here. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10974</span><span sentence-index="10974" class="highlight3">  Basically,  two  billiard  balls  are  colliding  if  1)  they  are  headed  toward  each                other,  and  2)  the  distance  separating  their  centers  is  less  than  or  equal  to  the  sum  of                their  radii. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">572</span><span sentence-index="10975" class="highlight4"> If  both  of  these  criteria  are  met,  then  a  collision  is  recorded  and  all                relevant  data  is  stored  in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">572</span><span sentence-index="10975" class="highlight2">Collisions</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">572</span><span sentence-index="10975" class="highlight3"> array:</span></span></a></p><a id="I_programlisting5_id351636"><pre class="programlisting">int    CheckForCollisions(void)
{
    int         status = NOCOLLISION;
    int         i, j;
    Vector      d;
    pCollision  pCollisionData;
    int         check = NOCOLLISION;
    float       r;
    float       s;
    Vector      tmp;

    FlushCollisionData();
    pCollisionData = Collisions;
    NumCollisions = 0;

    // check object collisions with each other
    for(i=0; i&lt;NUMBODIES; i++)
    {
        for(j=0; j&lt;NUMBODIES; j++)
            if((j!=i) &amp;&amp; !CollisionRecordedAlready(i, j))
            {
                // do a bounding sphere check
                d = Bodies[i].vPosition - Bodies[j].vPosition;
                r = Bodies[i].fRadius + Bodies[j].fRadius;
                s = d.Magnitude() - r;
                if(s &lt; COLLISIONTOLERANCE)
                {// possible collision
                    Vector   pt1, pt2, vel1, vel2, n, Vr;
                    float    Vrn;

                    pt1 = (Bodies[i].vPosition + Bodies[j].vPosition)/2;
                    tmp = pt2 = pt1;

                    pt1 = pt1-Bodies[i].vPosition;
                    pt2 = pt2-Bodies[j].vPosition;

                    vel1 = Bodies[i].vVelocity +
                           (Bodies[i].vAngularVelocityGlobal^pt1);
                    vel2 = Bodies[j].vVelocity +
                           (Bodies[j].vAngularVelocityGlobal^pt2);

                    n = d;
                    n.Normalize();

                    Vr = (vel1 - vel2);
                    Vrn = Vr * n;

                    if(Vrn &lt; -VELOCITYTOLERANCE)
                    {
                        // Have a collision so fill the data structure
                        assert(NumCollisions &lt; (NUMBODIES*8));
                        if(NumCollisions &lt; (NUMBODIES*8))
                        {
                            pCollisionData-&gt;body1 = i;
                            pCollisionData-&gt;body2 = j;
                            pCollisionData-&gt;vCollisionNormal = n;
                            pCollisionData-&gt;vCollisionPoint = tmp;
                            pCollisionData-&gt;vRelativeVelocity = Vr;
                            pCollisionData-&gt;vCollisionTangent = (n^Vr)^n;
                            pCollisionData-&gt;vCollisionTangent.Normalize();

                            pCollisionData++;
                            NumCollisions++;
                            status = COLLISION;
                        }                                                }
                }
            }
    }

    for(i=0; i&lt;NUMBODIES; i++)
        {
            check = NOCOLLISION;

            assert(NumCollisions &lt; (NUMBODIES*8));
            check = CheckGroundPlaneCollisions(pCollisionData, i);
            if(check == COLLISION)
            {
                status = COLLISION;
                pCollisionData++;
                NumCollisions++;
            }
        }

    return status;
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">574</span><span sentence-index="10977" class="highlight4">Since  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">574</span><span sentence-index="10977" class="highlight2">CheckForCollisions</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10977</span><span sentence-index="10977" class="highlight3">  loops  through  all  of  the                balls  checking  for  collisions  with  every  other  ball,  it  is  possible  that  a  collision  would                be  recorded  twice. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">575</span><span sentence-index="10978" class="highlight4"> For  example,  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">575</span><span>i</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">575</span><span sentence-index="10978" class="highlight3">th  ball  may  be  found  to  be                colliding  with  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">575</span><span>j</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">575</span><span sentence-index="10978" class="highlight2">th  ball,  and  later  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">575</span><span sentence-index="10978" class="highlight4">j</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">575</span><span sentence-index="10978" class="highlight3">th                ball  would  also  be  found  to  be  colliding  with  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">575</span><span sentence-index="10978" class="highlight2">i</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10978</span><span sentence-index="10978" class="highlight4">th  ball. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10979</span><span sentence-index="10979" class="highlight2">  We  don&apos;t                want  to  record  that  information  twice,  so  we  use  the  following  function  to  check  if  a                collision  between  two  particular  balls  is  already  recorded. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">577</span><span sentence-index="10980" class="highlight3"> If  so,  we  skip  re-recording  the                data:</span></span></p></a><a id="I_programlisting5_id351695"><pre class="programlisting">bool CollisionRecordedAlready(int i, int j)
{
    int k;
    int b1, b2;

    for(k=0; k&lt;NumCollisions; k++)
    {
        b1 = Collisions[k].body1;
        b2 = Collisions[k].body2;

        if( ((b1 == i) &amp;&amp; (b2 == j)) ||
            ((b1 == j) &amp;&amp; (b2 == i)) )
            return true;
    }

    return false;
}</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10982</span><span sentence-index="10982" class="highlight4">Checking  ball-table  collisions  is  fairly  straightforward  as  well. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10983</span><span sentence-index="10983" class="highlight2">  If  1)  a  ball  is  found                to  be  headed  toward  the  table  with  some  velocity  greater  than  0  (or  some  small  threshold),                and  2)  the  ball&apos;s  vertical  position  to  its  center  is  less  than  or  equal  to  its  radius,  then                we  record  a  collision. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">581</span><span sentence-index="10984" class="highlight3"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">581</span><span sentence-index="10984" class="highlight4">CheckGroundPlaneCollisions</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">581</span><span sentence-index="10984" class="highlight2"> handles                this  for  us:</span></span></p></a><a id="I_programlisting5_id351715"><pre class="programlisting">int    CheckGroundPlaneCollisions(pCollision CollisionData, int body1)
{
    Vector    tmp;
    Vector    vel1;
    Vector    pt1;
    Vector    Vr;
    float     Vrn;
    Vector    n;
    int       status = NOCOLLISION;

    if(Bodies[body1].vPosition.z &lt;= (Bodies[body1].fRadius))
    {
        pt1 = Bodies[body1].vPosition;
        pt1.z = COLLISIONTOLERANCE;
        tmp = pt1;
        pt1 = pt1-Bodies[body1].vPosition;
        vel1 = Bodies[body1].vVelocity/*Body*/ +
               (Bodies[body1].vAngularVelocityGlobal^pt1);

        n.x = 0;
        n.y = 0;
        n.z = 1;

        Vr = vel1;
        Vrn = Vr * n;

        if(Vrn &lt; -VELOCITYTOLERANCE)
        {
            // Have a collision so fill the data structure
            assert(NumCollisions &lt; (NUMBODIES*8));
            if(NumCollisions &lt; (NUMBODIES*8))
            {
                CollisionData-&gt;body1 = body1;
                CollisionData-&gt;body2 = &#x2212;1;
                CollisionData-&gt;vCollisionNormal = n;
                CollisionData-&gt;vCollisionPoint = tmp;
                CollisionData-&gt;vRelativeVelocity = Vr;

                CollisionData-&gt;vCollisionTangent = (n^Vr)^n;
                CollisionData-&gt;vCollisionTangent.Reverse();

                CollisionData-&gt;vCollisionTangent.Normalize();
                status = COLLISION;
            }
        }
    }

    return status;
}</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10986</span><span sentence-index="10986" class="highlight3">Resolving  collisions,  whether  ball-ball  or  ball-table  collisions,  uses  the  same  approach                we&apos;ve  already  shown  you. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">584</span><span sentence-index="10987" class="highlight4"> Thus,  we  won&apos;t  go  over  the  code  again,  and  will  instead  just  show                you  the  function  that  implements  collision  response:</span></span></p></a><a id="I_programlisting5_id351737"><pre class="programlisting">void ResolveCollisions(void)
{
    int       i;
    double    j;
    Vector    pt1, pt2, vB1V, vB2V, vB1AV, vB2AV;
    float     fCr = COEFFICIENTOFRESTITUTION;
    int       b1, b2;
    float     Vrt;
    float     muB = FRICTIONCOEFFICIENTBALLS;
    float     muG = FRICTIONCOEFFICIENTGROUND;
    bool      dofriction = DOFRICTION;

    for(i=0; i&lt;NumCollisions; i++)
    {
        b1 = Collisions[i].body1;
        b2 = Collisions[i].body2;

        if( (b1 != &#x2212;1) &amp;&amp; (b1 != b2) )
        {
            if(b2 != &#x2212;1) // not ground plane
            {
                pt1 = Collisions[i].vCollisionPoint - Bodies[b1].vPosition;
                pt2 = Collisions[i].vCollisionPoint - Bodies[b2].vPosition;

                // Calculate impulse:
                j = (-(1+fCr) * (Collisions[i].vRelativeVelocity *
                    Collisions[i].vCollisionNormal)) /
                    ((1/Bodies[b1].fMass + 1/Bodies[b2].fMass) +
                    (Collisions[i].vCollisionNormal * ( ( (pt1 ^
                     Collisions[i].vCollisionNormal) *
                     Bodies[b1].mIeInverse )^pt1) ) +
                    (Collisions[i].vCollisionNormal * ( ( (pt2 ^
                     Collisions[i].vCollisionNormal) *
                     Bodies[b2].mIeInverse )^pt2) ) );

                Vrt = Collisions[i].vRelativeVelocity *
                      Collisions[i].vCollisionTangent;

                if(fabs(Vrt) &gt; 0.0 &amp;&amp; dofriction) {
                    Bodies[b1].vVelocity +=
                            ((j * Collisions[i].vCollisionNormal) +
                            ((muB * j) * Collisions[i].vCollisionTangent)) /
                            Bodies[b1].fMass;
                    Bodies[b1].vAngularVelocityGlobal +=
                            (pt1 ^ ((j * Collisions[i].vCollisionNormal) +
                            ((muB * j) * Collisions[i].vCollisionTangent))) *
                            Bodies[b1].mIeInverse;
                    Bodies[b1].vAngularVelocity =
                            QVRotate(~Bodies[b1].qOrientation,
                            Bodies[b1].vAngularVelocityGlobal);

                    Bodies[b2].vVelocity +=
                            ((-j * Collisions[i].vCollisionNormal) + ((muB *
                            j) * Collisions[i].vCollisionTangent)) /
                            Bodies[b2].fMass;
                    Bodies[b2].vAngularVelocityGlobal +=
                            (pt2 ^ ((-j * Collisions[i].vCollisionNormal) +
                            ((muB * j) * Collisions[i].vCollisionTangent)))
                            * Bodies[b2].mIeInverse;

                    Bodies[b2].vAngularVelocity =
                            QVRotate(~Bodies[b2].qOrientation,
                            Bodies[b2].vAngularVelocityGlobal);

                } else {
                    // Apply impulse:
                    Bodies[b1].vVelocity +=
                            (j * Collisions[i].vCollisionNormal) /
                            Bodies[b1].fMass;
                    Bodies[b1].vAngularVelocityGlobal +=
                            (pt1 ^ (j * Collisions[i].vCollisionNormal)) *
                            Bodies[b1].mIeInverse;
                    Bodies[b1].vAngularVelocity =
                            QVRotate(~Bodies[b1].qOrientation,
                            Bodies[b1].vAngularVelocityGlobal);

                    Bodies[b2].vVelocity -=
                            (j * Collisions[i].vCollisionNormal) /
                            Bodies[b2].fMass;
                    Bodies[b2].vAngularVelocityGlobal -=
                            (pt2 ^ (j * Collisions[i].vCollisionNormal)) *
                            Bodies[b2].mIeInverse;
                    Bodies[b2].vAngularVelocity =
                            QVRotate(~Bodies[b2].qOrientation,
                            Bodies[b2].vAngularVelocityGlobal);
                }

            } else { // Ground plane:
                fCr = COEFFICIENTOFRESTITUTIONGROUND;
                pt1 = Collisions[i].vCollisionPoint - Bodies[b1].vPosition;

                // Calculate impulse:
                j = (-(1+fCr) * (Collisions[i].vRelativeVelocity *
                    Collisions[i].vCollisionNormal)) /
                    ( (1/Bodies[b1].fMass) +
                    (Collisions[i].vCollisionNormal *
                    ( ( (pt1 ^ Collisions[i].vCollisionNormal) *
                    Bodies[b1].mIeInverse )^pt1)));

                Vrt = Collisions[i].vRelativeVelocity *
                     Collisions[i].vCollisionTangent;

                if(fabs(Vrt) &gt; 0.0 &amp;&amp; dofriction) {
                    Bodies[b1].vVelocity +=
                            ( (j * Collisions[i].vCollisionNormal) + ((muG *
                            j) * Collisions[i].vCollisionTangent) ) /
                            Bodies[b1].fMass;
                    Bodies[b1].vAngularVelocityGlobal +=
                            (pt1 ^ ((j * Collisions[i].vCollisionNormal) +
                            ((muG * j) * Collisions[i].vCollisionTangent))) *
                            Bodies[b1].mIeInverse;
                    Bodies[b1].vAngularVelocity =
                            QVRotate(~Bodies[b1].qOrientation,
                            Bodies[b1].vAngularVelocityGlobal);
                } else {
                    // Apply impulse:
                    Bodies[b1].vVelocity +=
                            (j * Collisions[i].vCollisionNormal) /
                            Bodies[b1].fMass;
                    Bodies[b1].vAngularVelocityGlobal +=
                            (pt1 ^ (j * Collisions[i].vCollisionNormal)) *
                            Bodies[b1].mIeInverse;
                    Bodies[b1].vAngularVelocity =
                            QVRotate(~Bodies[b1].qOrientation,
                            Bodies[b1].vAngularVelocityGlobal);
                }
            }
        }
    }
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">586</span><span sentence-index="10989" class="highlight2">The  final  function  we  need  to  show  you  is  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">586</span><span sentence-index="10989" class="highlight3">CheckGroundPlaneContacts</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10989</span><span sentence-index="10989" class="highlight4"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">587</span><span sentence-index="10990" class="highlight2"> Recall  that  this  function  is  called  from  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">587</span><span sentence-index="10990" class="highlight3">CalcObjectForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10990</span><span sentence-index="10990" class="highlight4">  in  order  to  determine  if  a  ball  is  in  resting                contact  with  the  table. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10991</span><span sentence-index="10991" class="highlight2">  If  the  ball&apos;s  vertical  position  is  less  than  or  equal  to  its  radius                plus  some  small  tolerance,  and  if  the  ball&apos;s  vertical  velocity  is  0  (or  nearly  so  within                some  small  tolerance),  then  we  consider  the  ball  in  contact  with  the  table. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">589</span><span sentence-index="10992" class="highlight3"> If  there&apos;s  a                contact,  the  relevant  data  gets  stored  in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">589</span><span sentence-index="10992" class="highlight4">Collisions</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">589</span><span sentence-index="10992" class="highlight2">               array  and  used  to  resolve  the  contact,  not  the  collision,  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">589</span><span sentence-index="10992" class="highlight3">CalcObjectForces</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">589</span><span sentence-index="10992" class="highlight4">:</span></span></p></a><a id="I_programlisting5_id351825"><pre class="programlisting">int    CheckGroundPlaneContacts(pCollision CollisionData, int body1)
{

    Vector    v1[8];
    Vector    tmp;
    Vector    u, v;
    Vector    f[4];
    Vector    vel1;
    Vector    pt1;
    Vector    Vr;
    float     Vrn;
    Vector    n;
    int       status = NOCOLLISION;
    Vector    Ar;
    float     Arn;

    if(Bodies[body1].vPosition.z &lt;= (Bodies[body1].fRadius + COLLISIONTOLERANCE))
    {
        pt1 = Bodies[body1].vPosition;
        pt1.z = COLLISIONTOLERANCE;
        tmp = pt1;
        pt1 = pt1-Bodies[body1].vPosition;
        vel1 = Bodies[body1].vVelocity/*Body*/ +
              (Bodies[body1].vAngularVelocityGlobal^pt1);

        n.x = 0;
        n.y = 0;
        n.z = 1;

        Vr = vel1;
        Vrn = Vr * n;

        if(fabs(Vrn) &lt;= VELOCITYTOLERANCE) // at rest
        {
            // Check the relative acceleration:
            Ar = Bodies[body1].vAcceleration +
                (Bodies[body1].vAngularVelocityGlobal ^
                (Bodies[body1].vAngularVelocityGlobal^pt1)) +
                (Bodies[body1].vAngularAccelerationGlobal ^ pt1);

            Arn = Ar * n;

            if(Arn &lt;= 0.0f)
            {
                // We have a contact so fill the data structure
                assert(NumCollisions &lt; (NUMBODIES*8));
                if(NumCollisions &lt; (NUMBODIES*8))
                {
                    CollisionData-&gt;body1 = body1;
                    CollisionData-&gt;body2 = &#x2212;1;
                    CollisionData-&gt;vCollisionNormal = n;
                    CollisionData-&gt;vCollisionPoint = tmp;
                    CollisionData-&gt;vRelativeVelocity = Vr;
                    CollisionData-&gt;vRelativeAcceleration = Ar;

                    CollisionData-&gt;vCollisionTangent = (n^Vr)^n;
                    CollisionData-&gt;vCollisionTangent.Reverse();

                    CollisionData-&gt;vCollisionTangent.Normalize();
                    CollisionData++;
                    NumCollisions++;
                    status = CONTACT;
                }
            }
        }
    }

    return status;
}</pre></a><p><a id="I_programlisting5_id351825"><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10995</span><span sentence-index="10995" class="highlight2">That&apos;s  all  there  is  to  this  billiards  example. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10996</span><span sentence-index="10996" class="highlight3">  As  you  can  see,  we  used  substantially  the                same  methods  shown  in  other  examples  throughout  this  book  to  implement  this  example. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">10997</span><span sentence-index="10997" class="highlight4">  About                the  only  new  information  we&apos;ve  shown  here  is  how  to  compute  rolling  resistance. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">595</span><span sentence-index="10998" class="highlight2"> With  a                little  effort,  you  can  combine  the  material  presented  in  this  example  with  the  projectile                motion  material  presented  in  </span></span></a><a class="xref" href="ch06.html" title="Chapter&#xA0;6.&#xA0;Projectiles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">596</span><span sentence-index="10999" class="highlight3">Chapter&#xA0;6</span></span></a><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11000</span><span sentence-index="11000" class="highlight4">  to  model  all  sorts  of  sports                balls. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11001</span><span sentence-index="11001" class="highlight2">  Whether  you&apos;re  modeling  a  billiard  ball  bouncing  off  a  table  or  a  basketball  bouncing                off  a  backboard,  the  methods  are  the  same. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11002</span><span sentence-index="11002" class="highlight3">  The  only  things  that  will  change  are  the                empirical  coefficients  you  use  to  model  each  ball  and  surface. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">600</span><span sentence-index="11003" class="highlight4"> Have  </span></span><a id="I_indexterm5_id351860" class="indexterm"></a><a id="I_indexterm5_id351871" class="indexterm"></a><a id="I_indexterm5_id351880" class="indexterm"></a><a id="I_indexterm5_id351889" class="indexterm"></a><a id="I_indexterm5_id351899" class="indexterm"><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">11008</span><span sentence-index="11008" class="highlight2">fun.</span></span></a></p></div></div></section><a id="I_indexterm5_id351899" class="indexterm">
</a></body></html>