<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><html><head><title>Chapter&#xA0;8.&#xA0;Particles</title><link rel="stylesheet" type="text/css" href="core.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="up" href="pt02.html" title="Part&#xA0;II.&#xA0;Rigid-Body Dynamics"><link rel="prev" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Real-Time Simulations"><link rel="next" href="ch09.html" title="Chapter&#xA0;9.&#xA0;2D Rigid-Body Simulator"></head><body>
         
        <script>
        function ok(){ 
            window.gggs()
            return;
            //$('#musicPlayer').parent().remove();
            //speakTransportPanelDialogV2.closeEmoteDialog()
            //speakTransportPanelDialog.closeEmoteDialog()
            //
            debugger
            let url = 'http://127.0.0.1:8080/uploads/extracted/' +
             'Crazy Rich Asians  Kevin Kwanepub/' +
              'jsonSets/OEBPS/Kwan_9780385536981_epub_prl_r1.htm.html.sentences.json'
            speakTransportPanelDialogV2.sideLoadSentences2(null, null, null, url)
            
        }
        setTimeout(ok, 1500)
        </script>
        <div style="background:white">````````</div><section class="chapter" title="Chapter&#xA0;8.&#xA0;Particles" epub:type="chapter" id="particles"><div class="titlepage"><div><div><h2 class="title"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">1</span><span sentence-index="5089" class="">Chapter&#xA0;8.&#xA0;Particles</span></span></h2></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">2</span><span sentence-index="5090" class="">In  this  chapter  we&apos;ll  show  </span></span><a id="si8.0" class="indexterm"></a><a id="pa8.0" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">4</span><span sentence-index="5092" class="">you  how  to  apply  what  you&apos;ve  learned  in  </span></span></a><a class="xref" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Real-Time Simulations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">5</span><span sentence-index="5093" class="">Chapter&#xA0;7</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5094</span><span sentence-index="5094" class="">  in  a        simple  particle  simulator. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5095</span><span sentence-index="5095" class="">  Before  getting  to  the  specifics  of  the  example  we&apos;ll  present,  let&apos;s        consider  particles  in  general. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5096</span><span sentence-index="5096" class="">  Particles  are  simple  idealizations  that  can  be  used  to  simulate        all  sorts  of  phenomena  or  special  effects  within  a  game. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5097</span><span sentence-index="5097" class="">  For  example,  particle  simulations  are        often  used  to  simulate  smoke,  fire,  and  explosions. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5098</span><span sentence-index="5098" class="">  They  can  also  be  used  to  simulate  water,        dust  clouds,  and  swarms  of  insects,  among  many  other  things. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5099</span><span sentence-index="5099" class="">  Really,  your  imagination  is  the        only  limit. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5100</span><span sentence-index="5100" class="">  Particles  lend  themselves  to  simulating  both  discrete  objects  like  bouncing  balls        and  continua  like  water. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5101</span><span sentence-index="5101" class="">  Plus,  you  can  easily  ascribe  an  array  of  attributes  to  particles        depending  on  what  you&apos;re  modeling.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5103</span><span sentence-index="5103" class="">For  example,  say,  you&apos;re  modeling  fire  using  particles. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5104</span><span sentence-index="5104" class="">  Each  particle  will  rise  in  the  air,        and  as  it  cools  its  color  will  change  until  it  fades  away. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5105</span><span sentence-index="5105" class="">  You  can  tie  the  particle&apos;s  color  to        its  temperature,  which  is  modeled  using  thermodynamics. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5106</span><span sentence-index="5106" class="">  The  attribute  you&apos;d  want  to  track  is  the        particle&apos;s  temperature. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">19</span><span sentence-index="5107" class=""> In  a  previous  work,  </span></span><a class="ulink" href="http://shop.oreilly.com/product/9780596005559.do" target="_top"><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">20</span><span sentence-index="5108" class="">AI  for  Game                Programmers</span></span></em></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">20</span><span sentence-index="5108" class=""> (O&apos;Reilly),  this  book&apos;s  coauthor  </span></span><a id="I_indexterm2_id322138" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5110</span><span sentence-index="5110" class="">David  M.  Bourg  used  particles  to  represent  swarms  of  insects  that  would  swarm,        flock,  chase,  and  evade  depending  on  the  artificial  intelligence  (AI). </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5111</span><span sentence-index="5111" class="">  The  AI  controlled  their        behavior,  which  was  then  implemented  as  a  system  of  particles  using  principles  very  similar  to        what  you&apos;ll  see  in  this  chapter.</span></span></a></p><p><a id="I_indexterm2_id322138" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5114</span><span sentence-index="5114" class="">Particles  are  not  limited  to  collections  of  independent  objects  either. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5115</span><span sentence-index="5115" class="">  Later  in  this  book,        you&apos;ll  learn  how  to  connect  particles  together  using  springs  to  create  deformable  objects  such        as  cloth. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5116</span><span sentence-index="5116" class="">  Particles  are  extremely  versatile,  and  you&apos;ll  do  well  to  learn  how  to  leverage  their        simplicity.</span></span></a></p><p><a id="I_indexterm2_id322138" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">31</span><span sentence-index="5119" class="">You  can  use  </span></span></a><a id="I_indexterm2_id322157" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5120</span><span sentence-index="5120" class="">particles  to  model  sand  in  a  simple  phone  application  that  simulates  an  hourglass. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">33</span><span sentence-index="5121" class="">       Couple  this  sand  model  with  the  accelerometer  techniques  you&apos;ll  learn  about  in  </span></span></a><a class="xref" href="ch21.html" title="Chapter&#xA0;21.&#xA0;Accelerometers"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">34</span><span sentence-index="5122" class="">Chapter&#xA0;21</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5123</span><span sentence-index="5123" class=""> ,  and  you&apos;ll  be  able  to  make  the  sand  flow  by  turning  the  phone        over.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5125</span><span sentence-index="5125" class="">You  can  easily  use  particles  to  simulate  bullets  flying  out  of  a  gun. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5126</span><span sentence-index="5126" class="">  Imagine  a  Gatling  gun        spewing  forth  a  hail  of  lead,  all  simulated  using  simple  particles. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5127</span><span sentence-index="5127" class="">  Speaking  of  spewing,  how        about  using  particles  to  simulate  debris  flung  from  an  erupting  volcano  as  a  special  effect  in        your  adventure  game  set  in  prehistoric  times? </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5128</span><span sentence-index="5128" class="">  Remember  the  Wooly  Willy  toy? </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5129</span><span sentence-index="5129" class="">  To  make  particles  a        direct  part  of  game  play,  consider  a  diversionary  application  where  you  drag  piles  of  virtual        magnetic  particles  around  a  portrait  photograph,  giving  someone  a  lovely  beard  or  mustache  much        like  Wooly  Willy.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5131</span><span sentence-index="5131" class="">Hopefully,  you&apos;re  now  thinking  of  creative  ways  to  use  particles  in  your  games. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5132</span><span sentence-index="5132" class="">  So,  let&apos;s        address  implementation. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">45</span><span sentence-index="5133" class=""> There  are  two  basic  ingredients  to  implementing  a  particle  simulator:        the  particle  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">45</span><span sentence-index="5133" class="">model</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">45</span><span sentence-index="5133" class=""> and  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">45</span><span sentence-index="5133" class="">integrator</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5133</span><span sentence-index="5133" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">46</span><span sentence-index="5134" class=""> (Well,  you        could  argue  that  a  third  basic  ingredient  is  </span></span><a id="I_indexterm2_id322196" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">47</span><span sentence-index="5135" class="">the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">47</span><span sentence-index="5135" class="">renderer</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">47</span><span sentence-index="5135" class="">,  where  you  actually  draw  the  particles,  but  that&apos;s        more  graphics  than  physics,  and  we&apos;re  focusing  on  modeling  and  integrating  in  this  book.)</span></span></a></p><p><a id="I_indexterm2_id322196" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">50</span><span sentence-index="5138" class="">The  model  very  </span></span></a><a id="I_indexterm2_id322217" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5139</span><span sentence-index="5139" class="">simply  describes  the  attributes  of  the  particles  in  the  simulation  along  with  their        rules  of  behavior. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5140</span><span sentence-index="5140" class="">  We  mean  this  in  the  physics  sense  and  not  the  AI  sense  in  this  book,  although        in  general  the  model  you  implement  may  very  well  include  suitable  AI  rules. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">53</span><span sentence-index="5141" class=""> Now,  the  integrator        is  </span></span></a><a id="I_indexterm2_id322230" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5142</span><span sentence-index="5142" class="">responsible  for  updating  the  state  of  the  particles  throughout  the  simulation. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5143</span><span sentence-index="5143" class="">  In        this  chapter,  the  particles&apos;  states  will  be  described  by  their  position  and  velocity  at  any        given  time. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5144</span><span sentence-index="5144" class="">  The  integrator  will  update  each  particle&apos;s  state  under  the  influence  of  several        external  stimuli&#x2014;forces  such  as  gravity,  aerodynamic  drag,  and  collisions.</span></span></a></p><p><a id="I_indexterm2_id322230" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5147</span><span sentence-index="5147" class="">The  rest  of  this  chapter  will  walk  you  through  the  details  of  a  simple  particle  simulation        in  an  incremental  manner. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5148</span><span sentence-index="5148" class="">  The  first  task  will  be  to  simulate  a  set  of  particles  falling  under        the  influence  of  gravity  alone. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5149</span><span sentence-index="5149" class="">  Even  though  this  sounds  elementary,  such  an  example  encompasses        all  of  the  basic  ingredients  mentioned  earlier. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5150</span><span sentence-index="5150" class="">  Once  gravity  is  under  control,  we&apos;ll  show  you        how  to  implement  still  air  drag  and  wind  forces  to  influence  the  particles&apos;  motion. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5151</span><span sentence-index="5151" class="">  Then,  we&apos;ll        make  things  more  interesting  by  showing  you  how  to  implement  collision  response  between  the        particles  and  a  ground  plane  plus  random  obstacles. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">64</span><span sentence-index="5152" class=""> This  collision  stuff  will  draw  on  material        presented  in  </span></span></a><a class="xref" href="ch05.html" title="Chapter&#xA0;5.&#xA0;Collisions"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">65</span><span sentence-index="5153" class="">Chapter&#xA0;5</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5154</span><span sentence-index="5154" class=""> ,  so  be  sure  to  read  that  chapter  first  if  you  have  not        already  done  so.</span></span></p><p><a class="xref" href="ch08.html#particles_falling_under_the_influence_of" title="Figure&#xA0;8-1.&#xA0;Particles falling under the influence of gravity"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">69</span><span sentence-index="5157" class="">Figure&#xA0;8-1</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">69</span><span sentence-index="5157" class=""> through  </span></span><a class="xref" href="ch08.html#particles_coming_to_rest_on_the_ground" title="Figure&#xA0;8-4.&#xA0;Particles coming to rest on the ground plane"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">70</span><span sentence-index="5158" class="">Figure&#xA0;8-4</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5159</span><span sentence-index="5159" class="">  show  a  few  frames  of  this  example        simulation  complete  with  obstacles  and  collisions. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5160</span><span sentence-index="5160" class="">  Use  your  imagination  here  to  visualize  the        particles  falling  under  the  influence  of  gravity  until  they  impact  the  circular  objects,  at        which  time  they  bounce  around  and  ultimately  settle  on  the  ground.</span></span></p><div class="figure"><a id="particles_falling_under_the_influence_of"></a><div class="figure-contents"><a id="particles_falling_under_the_influence_of"></a><div class="mediaobject"><a id="particles_falling_under_the_influence_of"></a><a id="I_mediaobject2_id322285"><img src="httpatomoreillycomsourceoreillyimages1598934.png" alt="Particles falling under the influence of gravity"></a></div></div><div class="figure-title"><a id="I_mediaobject2_id322285"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">78</span><span sentence-index="5166" class="">Figure&#xA0;8-1.&#xA0;Particles  falling  under  the  influence  of  gravity</span></span></a></div></div><div class="figure"><a id="particles_impacting_circular_objects"></a><div class="figure-contents"><a id="particles_impacting_circular_objects"></a><div class="mediaobject"><a id="particles_impacting_circular_objects"></a><a id="I_mediaobject2_id322314"><img src="httpatomoreillycomsourceoreillyimages1598935.png" alt="Particles impacting circular objects"></a></div></div><div class="figure-title"><a id="I_mediaobject2_id322314"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">83</span><span sentence-index="5171" class="">Figure&#xA0;8-2.&#xA0;Particles  impacting  circular  objects</span></span></a></div></div><div class="figure"><a id="more_collisions"></a><div class="figure-contents"><a id="more_collisions"></a><div class="mediaobject"><a id="more_collisions"></a><a id="I_mediaobject2_id322343"><img src="httpatomoreillycomsourceoreillyimages1598936.png" alt="More collisions"></a></div></div><div class="figure-title"><a id="I_mediaobject2_id322343"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">88</span><span sentence-index="5176" class="">Figure&#xA0;8-3.&#xA0;More  collisions</span></span></a></div></div><div class="figure"><a id="particles_coming_to_rest_on_the_ground"></a><div class="figure-contents"><a id="particles_coming_to_rest_on_the_ground"></a><div class="mediaobject"><a id="particles_coming_to_rest_on_the_ground"></a><a id="I_mediaobject2_id322373"><img src="httpatomoreillycomsourceoreillyimages1598937.png" alt="Particles coming to rest on the ground plane"></a></div></div><div class="figure-title"><a id="I_mediaobject2_id322373"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">93</span><span sentence-index="5181" class="">Figure&#xA0;8-4.&#xA0;Particles  coming  to  rest  on  the  ground  plane</span></span></a></div></div><p><a id="I_mediaobject2_id322373"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5183</span><span sentence-index="5183" class="">While  working  through  this  chapter,  keep  in  mind  that  everything  you&apos;re  learning  here  will        be  directly  applicable  to  2D  and  3D  simulations. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5184</span><span sentence-index="5184" class="">  Chapters  following  this  one  will  build  on  the        material  covered  here. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5185</span><span sentence-index="5185" class="">  We&apos;ll  focus  on  two  dimensions  in  this  chapter  and  later  in  the  book  we&apos;ll        show  you  how  to  extend  the  simulation  to  3D. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5186</span><span sentence-index="5186" class="">  Actually,  for  particle  simulations  it&apos;s  almost        trivial  to  make  the  leap  from  2D  to  3D. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span sentence-index="5187" class=""> Trust  us  on  this  </span></span></a><a id="I_indexterm2_id322397" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5188</span><span sentence-index="5188" class="">for  now.</span></span></a></p><div class="sect1" title="Simple Particle Model"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="simple_particle_model"><a id="I_indexterm2_id322397" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">103</span><span sentence-index="5191" class="">Simple  Particle  Model</span></span></a></h2></div></div></div><p><a id="I_indexterm2_id322397" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">105</span><span sentence-index="5193" class="">The  particle  model  </span></span></a><a id="pa8.1" class="indexterm"></a><a id="mo8.1" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5195</span><span sentence-index="5195" class="">we&apos;ll  begin  with  is  very  simple. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">108</span><span sentence-index="5196" class=""> All  we  want  to  achieve  at  first  is  to  have  the            particles  fall  under  the  </span></span></a><a id="gr8.1" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5197</span><span sentence-index="5197" class="">influence  of  gravity. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5198</span><span sentence-index="5198" class="">  The  particles  will  be  initialized  with  an  altitude  above  a            ground  plane. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5199</span><span sentence-index="5199" class="">  Upon  the  start  of  the  simulation,  gravity  will  act  on  each  particle,            continuously  causing  each  to  accelerate  toward  the  ground  plane,  gaining  speed  as  it  goes. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5200</span><span sentence-index="5200" class="">            Imagine  holding  a  handful  of  small  rocks  up  high  and  then  releasing  them. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5201</span><span sentence-index="5201" class="">  Simple,  huh?</span></span></a></p><p><a id="gr8.1" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5204</span><span sentence-index="5204" class="">There  are  several  particle  attributes  we  must  consider  even  for  this  simple  example. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5205</span><span sentence-index="5205" class="">  Our            model  assumes  that  each  particle  has  mass,  and  a  set  diameter  (we&apos;re  assuming  our  particles            are  circles  in  2D  or  spheres  in  3D),  occupies  some  position  in  space,  and  is  traveling  at  some            velocity. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5206</span><span sentence-index="5206" class="">  Additionally,  each  particle  is  acted  upon  by  some  net  external  force,  which  is  the            aggregate  of  all  forces  acting  on  the  particle. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5207</span><span sentence-index="5207" class="">  These  forces  will  be  gravity  alone  to  start            with,  but  will  eventually  include  drag  and  impact  forces. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">120</span><span sentence-index="5208" class=""> We  set  up  a  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">120</span><span sentence-index="5208" class="">Particle</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">120</span><span sentence-index="5208" class=""> class  to  encapsulate  these  attributes  as  follows:</span></span></a></p><a id="I_programlisting2_id322489"><pre class="programlisting">class Particle {
public:
  float   fMass;      // Total mass
  Vector  vPosition;  // Position
  Vector  vVelocity;  // Velocity
  float   fSpeed;     // Speed (magnitude of the velocity)
  Vector  vForces;    // Total force acting on the particle
  float   fRadius;    // Particle radius used for collision detection
  Vector  vGravity;   // Gravity force vector

  Particle(void);     // Constructor
  void  CalcLoads(void);  // Aggregates forces acting on the particle
  void  UpdateBodyEuler(double dt); // Integrates one time step
  void  Draw(void);   // Draws the particle
};</pre></a><p><a id="I_programlisting2_id322489"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5211</span><span sentence-index="5211" class="">Most  of  these  attributes  are  self-explanatory  given  the  comments  we&apos;ve  included. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">124</span><span sentence-index="5212" class=""> Notice            that  several  of  these  attributes  are  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">124</span><span sentence-index="5212" class="">Vector</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5212</span><span sentence-index="5212" class="">  types. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">125</span><span sentence-index="5213" class=""> These            vectors  are  defined  in  the  custom  math  library  we&apos;ve  included  in  </span></span></a><a class="xref" href="apa.html" title="Appendix&#xA0;A.&#xA0;Vector Operations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">126</span><span sentence-index="5214" class="">Appendix&#xA0;A</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5215</span><span sentence-index="5215" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5216</span><span sentence-index="5216" class="">  This  type  makes  managing  vectors  and  performing  arithmetic            operations  with  them  a  breeze. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">129</span><span sentence-index="5217" class=""> Take  a  look  at  </span></span><a class="xref" href="apa.html" title="Appendix&#xA0;A.&#xA0;Vector Operations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">130</span><span sentence-index="5218" class="">Appendix&#xA0;A</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5219</span><span sentence-index="5219" class="">  to  see  what            this  custom  type  does. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">132</span><span sentence-index="5220" class=""> We&apos;ll  just  remind  you  of  the  data  structure  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">132</span><span sentence-index="5220" class="">Vector</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">132</span><span sentence-index="5220" class=""> uses:  </span></span><a id="I_indexterm2_id322527" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">133</span><span sentence-index="5221" class="">three  scalars  called  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">133</span><span sentence-index="5221" class="">x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">133</span><span sentence-index="5221" class="">,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">133</span><span sentence-index="5221" class="">y</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">133</span><span sentence-index="5221" class="">,  and                </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">133</span><span sentence-index="5221" class="">z</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5222</span><span sentence-index="5222" class="">  representing  the  three  dimensions  of  a  location  or  of  a  movement  in            some  direction. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">135</span><span sentence-index="5223" class=""> The  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">135</span><span sentence-index="5223" class="">z</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5223</span><span sentence-index="5223" class="">  component  will  always  be  set  to  0  in  this  chapter&apos;s            examples.</span></span></a></p><p><a id="I_indexterm2_id322527" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">138</span><span sentence-index="5226" class="">You  should  have  noticed  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">138</span><span sentence-index="5226" class="">fSpeed</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">138</span><span sentence-index="5226" class=""> property  in  the                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">138</span><span sentence-index="5226" class="">Particle</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5226</span><span sentence-index="5226" class="">  class. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5227</span><span sentence-index="5227" class="">  This  property  stores  the  magnitude  of  the            velocity  vector,  the  particle&apos;s  speed. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5228</span><span sentence-index="5228" class="">  We&apos;ll  use  this  later  when  computing  aerodynamic  drag            forces. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">141</span><span sentence-index="5229" class=""> We&apos;ve  also  included  a  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">141</span><span sentence-index="5229" class="">Vector</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">141</span><span sentence-index="5229" class=""> type  property  called                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">141</span><span sentence-index="5229" class="">vGravity</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5229</span><span sentence-index="5229" class=""> ,  which  stores  the  gravity  force  vector  defining            the  magnitude  and  the  direction  in  which  the  gravity  force  acts. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5230</span><span sentence-index="5230" class="">  This  is  not  really  necessary,            as  you  could  hardcode  the  gravity  force  vector  or  use  a  global  variable;  however,  we&apos;ve            included  it  here  to  illustrate  some  creative  flexibility. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">143</span><span sentence-index="5231" class=""> For  example,  you  could  redefine  the            gravity  vector  in  a  game  that  uses  </span></span></a><a id="I_indexterm2_id322589" class="indexterm"></a><a id="I_indexterm2_id322599" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">145</span><span sentence-index="5233" class="">accelerometer  input  to  determine  gravity&apos;s  direction  with  respect  to  a  particular            device&apos;s  orientation  (see  </span></span></a><a class="xref" href="ch21.html" title="Chapter&#xA0;21.&#xA0;Accelerometers"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">146</span><span sentence-index="5234" class="">Chapter&#xA0;21</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5235</span><span sentence-index="5235" class=""> ). </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5236</span><span sentence-index="5236" class="">  And  you  may  have  a  game  where            some  particles  react  to  different  gravities  depending  on  their  type,  which  can  be  of  your  own            concoction.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">150</span><span sentence-index="5238" class="">Aside  from  properties,  you&apos;ll  notice  several  methods  in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">150</span><span sentence-index="5238" class="">Particle</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5238</span><span sentence-index="5238" class="">  class. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5239</span><span sentence-index="5239" class="">  The  constructor  is  trivial. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5240</span><span sentence-index="5240" class="">  It  sets  everything  to  0  except  the            particle&apos;s  mass,  radius,  and  the  gravity  force  vector. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="5241" class=""> The  following  code  illustrates  how            everything  is  initialized:</span></span></p><a id="I_programlisting2_id322628"><pre class="programlisting">Particle::Particle(void)
{
  fMass = 1.0;
  vPosition.x = 0.0;
  vPosition.y = 0.0;
  vPosition.z = 0.0;
  vVelocity.x = 0.0;
  vVelocity.y = 0.0;
  vVelocity.z = 0.0;
  fSpeed = 0.0;
  vForces.x = 0.0;
  vForces.y = 0.0;
  vForces.z = 0.0;
  fRadius = 0.1;
  vGravity.x = 0;
  vGravity.y = fMass * _GRAVITYACCELERATION;
}</pre></a><p><a id="I_programlisting2_id322628"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">156</span><span sentence-index="5244" class="">Now  is  probably  a  good  time  to  explain  the  </span></span></a><a id="I_indexterm2_id322640" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5245</span><span sentence-index="5245" class="">coordinate  system  we&apos;ve  assumed. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">158</span><span sentence-index="5246" class=""> Our  world  origin  is  located  at  the  lower-left            corner  of  the  example  program&apos;s  window  with  positive  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">158</span><span sentence-index="5246" class="">x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">158</span><span sentence-index="5246" class=""> pointing  to  the            right  and  positive  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">158</span><span sentence-index="5246" class="">y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5246</span><span sentence-index="5246" class="">  pointing  up. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5247</span><span sentence-index="5247" class="">  The  acceleration  due  to  gravity  acts            downward  (i.e.,  in  the  negative  y-direction). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">160</span><span sentence-index="5248" class=""> We&apos;re  using  the  SI  system  of  units  and  have            defined  the  acceleration  due  to  gravity  as  follows:</span></span></a></p><a id="I_programlisting2_id322665"><pre class="programlisting">#define  _GRAVITYACCELERATION  &#x2212;9.8f</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">162</span><span sentence-index="5250" class="">That&apos;s  9.8  m/s</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">162</span><span sentence-index="5250" class="">2</span></span></sup><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5250</span><span sentence-index="5250" class="">  in  the  negative  y-direction. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">163</span><span sentence-index="5251" class=""> We&apos;ve  set  the  mass            of  each  particle  to  1  kg  by  default,  which  means  the  force  due  to  gravity  is  1  kg  times  9.8                m/s</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">163</span><span sentence-index="5251" class="">2</span></span></sup><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5251</span><span sentence-index="5251" class=""> ,  or  9.8  newtons  of  force. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5252</span><span sentence-index="5252" class="">  We&apos;ve  set  the  radius  of  each            particle  to  one-tenth  of  a  meter. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5253</span><span sentence-index="5253" class="">  These  masses  and  radii  are  really  arbitrary;  you  can  set            them  to  anything  suitable  for  what  you&apos;re  modeling.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">167</span><span sentence-index="5255" class="">The  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">167</span><span sentence-index="5255" class="">CalcLoads</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5255</span><span sentence-index="5255" class="">  method  is  responsible  for  computing  all            the  loads&#x2014;forces&#x2014;acting  on  the  particle,  with  the  exception  of  impact  forces  (we&apos;ll  handle            those  later). </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5256</span><span sentence-index="5256" class="">  For  now,  the  only  force  acting  on  the  particles  is  that  due  to  gravity,  or            simply,  the  weight  of  each  particle. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">169</span><span sentence-index="5257" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">169</span><span sentence-index="5257" class="">CalcLoads</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">169</span><span sentence-index="5257" class=""> is  very            simple  at  this  point:</span></span></p></a><a id="I_programlisting2_id322702"><pre class="programlisting">void  Particle::CalcLoads(void)
{
  // Reset forces:
  vForces.x = 0.0f;
  vForces.y = 0.0f;

  // Aggregate forces:
  vForces += vGravity;
}</pre></a><p><a id="I_programlisting2_id322702"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">172</span><span sentence-index="5260" class="">The  first  order  of  business  is  to  reset  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">172</span><span sentence-index="5260" class="">vForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5260</span><span sentence-index="5260" class="">            vector. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">173</span><span sentence-index="5261" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">173</span><span sentence-index="5261" class="">vForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5261</span><span sentence-index="5261" class="">  is  the  vector  containing  the  net  force            acting  on  the  particle. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">174</span><span sentence-index="5262" class=""> All  of  these  forces  are  aggregated  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">174</span><span sentence-index="5262" class="">CalcLoads</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">174</span><span sentence-index="5262" class="">,  as  shown  by  the  line  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">174</span><span sentence-index="5262" class="">vForces  +=                vGravity</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5262</span><span sentence-index="5262" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">175</span><span sentence-index="5263" class=""> Again,  so  far,  the  only  force  to  aggregate  is  that  due  </span></span></a><a id="I_indexterm2_id322739" class="indexterm"></a><a id="I_indexterm2_id322749" class="indexterm"></a><a id="I_indexterm2_id322758" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5266</span><span sentence-index="5266" class="">to  gravity.</span></span></a></p><div class="sect2" title="Integrator"><div class="titlepage"><div><div><h3 class="title" id="integrator"><a id="I_indexterm2_id322758" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">181</span><span sentence-index="5269" class="">Integrator</span></span></a></h3></div></div></div><p><a id="I_indexterm2_id322758" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">183</span><span sentence-index="5271" class="">The  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">183</span><span sentence-index="5271" class="">UpdateBodyEuler</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">183</span><span sentence-index="5271" class=""> method  </span></span></a><a id="I_indexterm2_id322789" class="indexterm"></a><a id="I_indexterm2_id322799" class="indexterm"></a><a id="I_indexterm2_id322809" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">186</span><span sentence-index="5274" class="">integrates  the  equations  of  motion</span></span></a><a id="I_indexterm2_id322820" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5275</span><span sentence-index="5275" class="">  for  each  particle. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5276</span><span sentence-index="5276" class="">  Since  we&apos;re  dealing  with  particles,  the  only  equation  of                motion  we  need  concern  ourselves  with  is  that  for  translation;  rotation  does  not  matter  for                particles  (at  least  not  for  us  here). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">189</span><span sentence-index="5277" class=""> The  following  code  sample  shows  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">189</span><span sentence-index="5277" class="">UpdateBodyEuler</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5277</span><span sentence-index="5277" class=""> .</span></span></a></p><a id="I_programlisting2_id322841"><pre class="programlisting">void  Particle::UpdateBodyEuler(double dt)
{
    Vector a;
    Vector dv;
    Vector ds;

    // Integrate equation of motion:
    a = vForces / fMass;

    dv = a * dt;
    vVelocity += dv;

    ds = vVelocity * dt;
    vPosition += ds;

    // Misc. calculations:
    fSpeed = vVelocity.Magnitude();
}</pre></a><p><a id="I_programlisting2_id322841"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="5281" class="">As  the  name  of  this  method  implies,  we&apos;ve  implemented  Euler&apos;s  method  </span></span></a><a id="I_indexterm2_id322852" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">194</span><span sentence-index="5282" class="">of  integration  as  described  in  </span></span></a><a class="xref" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Real-Time Simulations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="5284" class="">Chapter&#xA0;7</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5284</span><span sentence-index="5284" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5285</span><span sentence-index="5285" class="">  Using                this  method,  we  simply  need  to  divide  the  aggregate  forces  acting  on  a  particle  by  the  mass                of  the  particle  to  get  the  particle&apos;s  acceleration. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">198</span><span sentence-index="5286" class=""> The  line  of  code  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">198</span><span sentence-index="5286" class="">a  =  vForces  /  fMass</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5286</span><span sentence-index="5286" class="">  does  just  this. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">199</span><span sentence-index="5287" class=""> Notice  here  that  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">199</span><span sentence-index="5287" class="">a</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">199</span><span sentence-index="5287" class=""> is  a  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">199</span><span sentence-index="5287" class="">Vector</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">199</span><span sentence-index="5287" class="">,  as  is  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">199</span><span sentence-index="5287" class="">vForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5287</span><span sentence-index="5287" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5288" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span>fMass</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5288" class=""> is  a  scalar,                and  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5288" class="">/</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5288" class=""> operator  defined  in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5288" class="">Vector</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5288" class=""> class  takes  care  of  dividing  each  component  of  the                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5288" class="">vForces</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5288" class=""> vector  by  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5288" class="">fMass</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5288" class=""> and  setting  the  corresponding  components  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5288" class="">a</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5288</span><span sentence-index="5288" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">201</span><span sentence-index="5289" class=""> The  change  in  velocity,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">201</span><span sentence-index="5289" class="">dv</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">201</span><span sentence-index="5289" class="">,  is  equal  to                acceleration  times  the  change  in  time,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">201</span><span sentence-index="5289" class="">dt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5289</span><span sentence-index="5289" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">202</span><span sentence-index="5290" class=""> The  particle&apos;s                new  velocity  is  then  computed  by  the  line  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">202</span><span sentence-index="5290" class="">vVelocity  +=                dv</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5290</span><span sentence-index="5290" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="5291" class=""> Here  again,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="5291" class="">vVelocity</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="5291" class=""> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="5291" class="">dv</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="5291" class=""> are  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="5291" class="">Vectors</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="5291" class=""> and  the                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">203</span><span sentence-index="5291" class="">+=</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5291</span><span sentence-index="5291" class="">  operator  takes  care  of  the  vector  arithmetic. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5292</span><span sentence-index="5292" class="">  This                is  the  first  actual  integration.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5294</span><span sentence-index="5294" class="">The  second  integration  takes  place  in  the  next  few  lines,  where  we  determine  the                particle&apos;s  displacement  and  new  position  by  integrating  its  velocity. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">207</span><span sentence-index="5295" class=""> The  line  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">207</span><span sentence-index="5295" class="">ds  =  vVelocity  *  dt</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">207</span><span sentence-index="5295" class=""> determines  the  displacement,  or  change  in                the  particle&apos;s  position,  and  the  line  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">207</span><span sentence-index="5295" class="">vPosition  +=  ds</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5295</span><span sentence-index="5295" class="">                computes  the  new  position  by  adding  the  displacement  to  the  particle&apos;s  old  position.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">209</span><span sentence-index="5297" class="">The  last  line  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">209</span><span sentence-index="5297" class="">UpdateBodyEuler</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5297</span><span sentence-index="5297" class="">  computes  the                particle&apos;s  speed  by  taking  the  magnitude  of  its  velocity  vector.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5299</span><span sentence-index="5299" class="">For  demonstration  purposes,  using  Euler&apos;s  method  is  just  fine. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5300" class=""> In  an  actual  game,  the                more  robust  method  described  in  </span></span><a class="xref" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Real-Time Simulations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">213</span><span sentence-index="5301" class="">Chapter&#xA0;7</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5302</span><span sentence-index="5302" class="">  is  advised.</span></span></p></div><div class="sect2" title="Rendering"><div class="titlepage"><div><div><h3 class="title" id="rendering"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">216</span><span sentence-index="5304" class="">Rendering</span></span></h3></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="5305" class="">In  this  example,  rendering  </span></span><a id="I_indexterm2_id323027" class="indexterm"></a><a id="I_indexterm2_id323038" class="indexterm"></a><a id="I_indexterm2_id323048" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5308</span><span sentence-index="5308" class="">the  particles  is  rather  trivial. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5309</span><span sentence-index="5309" class="">  All  we  do  is  draw  little  circles  using  Windows                API  calls  wrapped  in  our  own  functions  to  hide  some  of  the  Windows-specific  code. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5310</span><span sentence-index="5310" class="">  The                following  code  snippet  is  all  we  need  to  render  the  particles.</span></span></a></p><a id="I_programlisting2_id323062"><pre class="programlisting">void  Particle::Draw(void)
{
  RECT   r;
  float  drawRadius = max(2, fRadius);

  SetRect(&amp;r, vPosition.x &#x2212; drawRadius,
          _WINHEIGHT &#x2212; (vPosition.y &#x2212; drawRadius),
          vPosition.x + drawRadius,
      _WINHEIGHT &#x2212; (vPosition.y + drawRadius));
  DrawEllipse(&amp;r, 2, RGB(0,0,0));
}</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5313</span><span sentence-index="5313" class="">You  can  use  your  own  rendering  code  here,  of  course,  and  all  you  really  need  to  pay                close  attention  to  is  converting  from  world  coordinates  to  window  coordinates. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5314</span><span sentence-index="5314" class="">  Remember,                we&apos;ve  assumed  our  world  coordinate  system  origin  is  in  the  lower-left  corner  of  the  window,                whereas  the  window  drawing  coordinate  system  has  its  origin  in  the  upper-left  corner  of  the                window. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5315</span><span sentence-index="5315" class="">  To  transform  coordinates  in  this  example,  all  you  need  to  do  is  subtract  the                particle&apos;s  y-position  from  the  height  of  the  window.</span></span></p></a></div></div><div class="sect1" title="The Basic Simulator"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="the_basic_simulator"><a id="I_programlisting2_id323062"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">230</span><span sentence-index="5318" class="">The  Basic  Simulator</span></span></a></h2></div></div></div><p><a id="I_programlisting2_id323062"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="5320" class="">The  heart  of  this  </span></span></a><a id="pa8.2" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">233</span><span sentence-index="5321" class="">simulation  is  handled  by  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">233</span><span sentence-index="5321" class="">Particle</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5322</span><span sentence-index="5322" class="">  class            described  earlier. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5323</span><span sentence-index="5323" class="">  However,  we  need  to  show  you  how  that  class  is  used  in  the  context  of  the            main  program.</span></span></a></p><p><a id="pa8.2" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="5326" class="">First,  we  define  a  few  global  variables  as  follows:</span></span></a></p><a id="I_programlisting2_id323120"><pre class="programlisting">// Global Variables:
int      FrameCounter = 0;
Particle Units[_MAX_NUM_UNITS];</pre><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">240</span><span sentence-index="5328" class="">FrameCounter</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5328</span><span sentence-index="5328" class="">  counts  the  number  of  time  steps  integrated            before  the  graphics  display  is  updated. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5329</span><span sentence-index="5329" class="">  How  many  time  steps  you  allow  the  simulation  to            integrate  before  updating  the  display  is  a  matter  of  tuning. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">242</span><span sentence-index="5330" class=""> You&apos;ll  see  how  this  is  used            momentarily  when  we  discuss  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">242</span><span sentence-index="5330" class="">UpdateSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5330</span><span sentence-index="5330" class="">  function. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">243</span><span sentence-index="5331" class="">               </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">243</span><span sentence-index="5331" class="">Units</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">243</span><span sentence-index="5331" class=""> is  an  array  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">243</span><span sentence-index="5331" class="">Particle</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5331</span><span sentence-index="5331" class="">  types. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5332</span><span sentence-index="5332" class="">  These  will  represent  moving  particles  in  the  simulation&#x2014;the  ones            that  fall  from  above  and  bounce  off  the  circular  objects  we&apos;ll  add  later.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">246</span><span sentence-index="5334" class="">For  the  most  part,  each  unit  is  initialized  in  accordance  with  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">246</span><span sentence-index="5334" class="">Particle</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5334</span><span sentence-index="5334" class="">  constructor  shown  earlier. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="5335" class=""> However,  their  positions  are            all  at  the  origin,  so  we  make  a  call  to  the  following  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="5335" class="">Initialize</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="5335" class=""> function  to  randomly  distribute  the  particles  in  the  upper-middle            portion  of  the  screen  within  a  rectangle  of  width  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="5335" class="">_SPAWN_AREA_R*4</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="5335" class=""> and  a  height  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span>_SPAWN_AREA_R</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="5335" class="">,            where  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="5335" class="">_SPAWN_AREA_R</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="5335" class=""> is  just  a  global  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="5335" class="">define</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5335</span><span sentence-index="5335" class="">  we  made  up.</span></span></p></a><a id="I_programlisting2_id323198"><pre class="programlisting">bool  Initialize(void)
{
  int i;

  GetRandomNumber(0, _WINWIDTH, true);

  for(i=0; i&lt;_MAX_NUM_UNITS; i++)
  {
    Units[i].vPosition.x = GetRandomNumber(_WINWIDTH/2-_SPAWN_AREA_R*2,
                           _WINWIDTH/2+_SPAWN_AREA_R*2, false);
    Units[i].vPosition.y = _WINHEIGHT &#x2212;
                          GetRandomNumber(_WINHEIGHT/2-_SPAWN_AREA_R,
                          _WINHEIGHT/2, false);
  }

  return true;
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">250</span><span sentence-index="5338" class="">OK,  now  let&apos;s  consider  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">250</span><span sentence-index="5338" class="">UpdateSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5338</span><span sentence-index="5338" class="">  as  shown  in  the            code  snippet  that  follows. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="5339" class=""> This  function  gets  called  every  cycle  through  the  program&apos;s  main            message  loop  and  is  responsible  for  cycling  through  all  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">251</span><span sentence-index="5339" class="">Units</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5339</span><span sentence-index="5339" class=""> ,  making  appropriate  function  calls  to  update  their  positions,  and  rendering            the  scene.</span></span></p></a><a id="I_programlisting2_id323225"><pre class="programlisting">void  UpdateSimulation(void)
{
  double dt = _TIMESTEP;
  int    i;

  // initialize the back buffer
  if(FrameCounter &gt;= _RENDER_FRAME_COUNT)
  {
    ClearBackBuffer();
  }

  // update the particles (Units)
  for(i=0; i&lt;_MAX_NUM_UNITS; i++)
  {
    Units[i].CalcLoads();
    Units[i].UpdateBodyEuler(dt);

    if(FrameCounter &gt;= _RENDER_FRAME_COUNT)
    {
      Units[i].Draw();
    }

    if(Units[i].vPosition.x &gt; _WINWIDTH) Units[i].vPosition.x = 0;
    if(Units[i].vPosition.x &lt; 0) Units[i].vPosition.x = _WINWIDTH;
    if(Units[i].vPosition.y &gt; _WINHEIGHT) Units[i].vPosition.y = 0;
    if(Units[i].vPosition.y &lt; 0) Units[i].vPosition.y = _WINHEIGHT;
  }

  // Render the scene if required
  if(FrameCounter &gt;= _RENDER_FRAME_COUNT) {
    CopyBackBufferToWindow();
    FrameCounter = 0;
  }  else
    FrameCounter++;
}</pre></a><p><a id="I_programlisting2_id323225"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">255</span><span sentence-index="5343" class="">The  two  local  variables  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">255</span><span sentence-index="5343" class="">UpdateSimulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">255</span><span sentence-index="5343" class=""> are                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">255</span><span sentence-index="5343" class="">dt</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">255</span><span sentence-index="5343" class=""> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">255</span><span sentence-index="5343" class="">i</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5343</span><span sentence-index="5343" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">256</span><span sentence-index="5344" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">256</span><span sentence-index="5344" class="">i</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5344</span><span sentence-index="5344" class="">  is  trivial  and  serves  as  a  counter  variable. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">257</span><span sentence-index="5345" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">257</span><span sentence-index="5345" class="">dt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5345</span><span sentence-index="5345" class="">  represents  the  small  yet  finite  amount  of  time,  in  seconds,            over  which  each  integration  step  is  taken. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">258</span><span sentence-index="5346" class=""> The  global  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">258</span><span sentence-index="5346" class="">define_TIMESTEP</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5346</span><span sentence-index="5346" class="">  stores  the  time  step,  which  we  have  set  to  0.1  seconds. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">259</span><span sentence-index="5347" class=""> This            value  is  subject  to  tuning,  which  we&apos;ll  discuss  toward  the  end  of  this  chapter  in  the  section                </span></span></a><a class="xref" href="ch08.html#tuning" title="Tuning"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">260</span><span sentence-index="5348" class="">Tuning</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5349</span><span sentence-index="5349" class=""> .</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="5351" class="">The  next  segment  of  code  checks  the  value  of  the  frame  counter,  and  if  the  frame  counter            has  reached  the  defined  number  of  frames,  stored  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="5351" class="">_RENDER_FRAME_COUNT</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5351</span><span sentence-index="5351" class=""> ,  then  the  back  buffer  is  cleared  to  prepare  it  for  drawing            upon  and  ultimately  copying  to  the  screen.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="5353" class="">The  next  section  of  code  under  the  comment  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="5353" class="">update  the                particles</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="5353" class=""> does  just  that  by  calling  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="5353" class="">CalcLoads</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="5353" class=""> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="5353" class="">UpdateBodyEuler</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="5353" class=""> methods  of  each                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="5353" class="">Unit</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5353</span><span sentence-index="5353" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5354</span><span sentence-index="5354" class="">  These  two  lines  are  responsible  for  updating  all            the  forces  acting  on  each  particle  and  then  integrating  the  equation  of  motion  for  each            particle.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="5356" class="">The  next  few  lines  within  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="5356" class="">for</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5356</span><span sentence-index="5356" class="">  loop  draw  each            particle  if  required  and  wrap  each  particle&apos;s  position  around  the  window  extents  should  they            progress  beyond  the  edges  of  the  window. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="5357" class=""> Note  that  we&apos;re  using  window  coordinates  in  this                </span></span><a id="I_indexterm2_id323336" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5358</span><span sentence-index="5358" class="">example.</span></span></a></p></div><div class="sect1" title="Implementing External Forces"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="implementing_external_forces"><a id="I_indexterm2_id323336" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">273</span><span sentence-index="5361" class="">Implementing  External  Forces</span></span></a></h2></div></div></div><p><a id="I_indexterm2_id323336" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">275</span><span sentence-index="5363" class="">We&apos;ll  add  a  </span></span></a><a id="pa8.3" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">276</span><span sentence-index="5364" class="">couple  of  simple  external  forces  to  start  with&#x2014;</span></span></a><a id="I_indexterm2_id323377" class="indexterm"></a><a id="wi8.3" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5367</span><span sentence-index="5367" class="">still  air  drag,  and  wind  force. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span sentence-index="5368" class=""> We&apos;ll  use  the  formulas  presented  in  </span></span></a><a class="xref" href="ch03.html" title="Chapter&#xA0;3.&#xA0;Force"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">281</span><span sentence-index="5369" class="">Chapter&#xA0;3</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5370</span><span sentence-index="5370" class="">  to  approximate  these  forces,  treating  them  in  a  similar  manner. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5371</span><span sentence-index="5371" class="">  Recall            that  still  air  drag  is  the  aerodynamic  drag  force  acting  against  an  object  moving  at  some            speed  through  still  air. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5372</span><span sentence-index="5372" class="">  Drag  always  acts  to  resist  motion. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5373</span><span sentence-index="5373" class="">  While  we&apos;ll  use  the  same  formulas            to  compute  a  wind  force,  recall  that  wind  force  may  not  necessarily  act  to  impede  motion. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5374</span><span sentence-index="5374" class="">  You            could  have  a  tailwind  pushing  an  object  along,  or  the  wind  could  come  from  any  direction  with            components  that  push  the  object  sideways. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5375</span><span sentence-index="5375" class="">  In  this  example  we&apos;ll  assume  a  side  wind  from  left            to  right,  acting  to  push  the  particles  sideways,  with  the  still  air  drag  resisting  their            falling  motion. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5376</span><span sentence-index="5376" class="">  When  we  add  collisions  later,  this  same  drag  formulation  will  act  to  resist            particle  motion  in  any  direction  in  which  they  travel  as  they  bounce  around.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="5378" class="nonQuoteStr">The  formula  we&apos;ll  use  to  model  still  air  drag  is:</span></span></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="5378" class="nonQuoteStr">F</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span>d</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="5378" class="nonQuoteStr"> =  &#xBD;                &#x3C1;V</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="5378" class="nonQuoteStr">2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="5378" class="nonQuoteStr">AC</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="5378" class="nonQuoteStr">d</span></span></sub></td></tr></tbody></table><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">291</span><span sentence-index="5379" class="">Here  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">291</span><span sentence-index="5379" class="">F</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">291</span><span sentence-index="5379" class="">d</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5379</span><span sentence-index="5379" class="">  is  the  magnitude  of  the  drag  force. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="5380" class="">           Its  direction  is  directly  opposite  the  velocity  of  the  moving  particle.  &#x3C1;  is  the  density  of            air  through  which  the  particle  moves,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="5380" class="">V</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="5380" class=""> is  the  magnitude  of  the            particle&apos;s  velocity  (its  speed),  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="5380" class="">A</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="5380" class=""> is  the  projected  area  of  the  particle            as  though  it&apos;s  a  sphere,  and  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="5380" class="">C</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="5380" class="">d</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5380</span><span sentence-index="5380" class="">  is  a  drag            coefficient.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5382</span><span sentence-index="5382" class="">We  can  use  this  same  formula  to  estimate  the  wind  force  pushing  the  particle  sideways. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">295</span><span sentence-index="5383" class=""> The            only  difference  this  time  is  that  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">295</span><span sentence-index="5383" class="">V</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5383</span><span sentence-index="5383" class="">  is  the  wind  speed,  and  the  direction            of  the  resulting  wind  force  is  from  our  assumed  left-to-right  direction.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">297</span><span sentence-index="5385" class="">To  add  these  two  forces  to  our  simulation,  we  need  to  make  a  few  additions  to  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">297</span><span sentence-index="5385" class="">Particle</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">297</span><span sentence-index="5385" class=""> class&apos;s  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">297</span><span sentence-index="5385" class="">CalcLoads</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5385</span><span sentence-index="5385" class="">            method. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">298</span><span sentence-index="5386" class=""> The  following  code  shows  how  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">298</span><span sentence-index="5386" class="">CalcLoads</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5386</span><span sentence-index="5386" class="">  looks  now. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5387</span><span sentence-index="5387" class="">            Remember,  all  we  had  in  here  originally  were  the  first  three  lines  of  executable  code  shown            next&#x2014;the  code  that  initializes  the  aggregate  force  vector  and  then  the  line  of  code  that  adds            the  force  due  to  gravity  to  the  aggregate  force. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5388</span><span sentence-index="5388" class="">  All  the  rest  of  the  code  in  this  method  is            new.</span></span></p><a id="I_programlisting2_id323501"><pre class="programlisting">void  Particle::CalcLoads(void)
{
  // Reset forces:
  vForces.x = 0.0f;
  vForces.y = 0.0f;

  // Aggregate forces:

  // Gravity
  vForces += vGravity;

  // Still air drag
  Vector  vDrag;
  Float   fDrag;

  vDrag-=vVelocity;
  vDrag.Normalize();
  fDrag = 0.5 * _AIRDENSITY * fSpeed * fSpeed *
          (3.14159 * fRadius * fRadius) * _DRAGCOEFFICIENT;

  vDrag*=fDrag;

  vForces += vDrag;

  // Wind
  Vector  vWind;
  vWind.x = 0.5 * _AIRDENSITY * _WINDSPEED *
            _WINDSPEED * (3.14159 * fRadius * fRadius) *
            _DRAGCOEFFICIENT;
  vForces += vWind;
}</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5391</span><span sentence-index="5391" class="">So  after  the  force  due  to  gravity  is  added  to  the  aggregate,  two  new  local  variables  are            declared. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">304</span><span sentence-index="5392" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">304</span><span sentence-index="5392" class="">vDrag</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5392</span><span sentence-index="5392" class="">  is  a  vector  that  will  represent  the  still            air  drag  force. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="5393" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">305</span><span sentence-index="5393" class="">fDrag</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5393</span><span sentence-index="5393" class="">  is  the  magnitude  of  that  drag  force. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span sentence-index="5394" class="">           Since  we  know  the  drag  force  vector  is  exactly  opposite  to  the  particle&apos;s  velocity  vector,  we            can  equate  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span>vDrag</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span sentence-index="5394" class=""> to  negative  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span sentence-index="5394" class="">vVelocity</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span sentence-index="5394" class=""> and  then  normalize  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span sentence-index="5394" class="">vDrag</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5394</span><span sentence-index="5394" class="">  to  obtain  a            unit  vector  pointing  in  a  direction  opposite  of  the  particle&apos;s  velocity. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5395</span><span sentence-index="5395" class="">  Next  we  compute  the            magnitude  of  the  drag  force  using  the  formula  shown  earlier. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">308</span><span sentence-index="5396" class=""> This  line  handles  that:</span></span></p></a><a id="I_programlisting2_id323550"><pre class="programlisting">fDrag = 0.5 * _AIRDENSITY * fSpeed * fSpeed *
        (3.14159 * fRadius * fRadius) * _DRAGCOEFFICIENT;</pre></a><p><a id="I_programlisting2_id323550"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">311</span><span sentence-index="5399" class="">Here,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">311</span><span sentence-index="5399" class="">_AIRDENSITY</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">311</span><span sentence-index="5399" class=""> is  a  global  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">311</span><span sentence-index="5399" class="">define</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">311</span><span sentence-index="5399" class=""> representing  the  density  of  air,  which  we  have  set  to  1.23                kg/m</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">311</span><span sentence-index="5399" class="">3</span></span></sup><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5399</span><span sentence-index="5399" class="">  (standard  air  at  15&#xB0;C). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">312</span><span sentence-index="5400" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">312</span><span sentence-index="5400" class="">fSpeed</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5400</span><span sentence-index="5400" class="">  is  the  particle&apos;s  speed:  the  magnitude  of  its  velocity. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">313</span><span sentence-index="5401" class=""> The  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">313</span><span sentence-index="5401" class="">3.14159  *  fRadius  *  fRadius</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5401</span><span sentence-index="5401" class="">  line  represents  the  projected  area  of            the  particle  assuming  the  particle  is  a  sphere. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">314</span><span sentence-index="5402" class=""> And  finally,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">314</span><span sentence-index="5402" class="">_DRAGCOEFFICIENT</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5402</span><span sentence-index="5402" class="">  is  a  drag  coefficient  that  we  have  set  to  0.6. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">315</span><span sentence-index="5403" class=""> We  picked  this            value  from  the  chart  of  drag  coefficient  for  a  smooth  sphere  versus  the  Reynolds  number  shown            in  </span></span></a><a class="xref" href="ch06.html" title="Chapter&#xA0;6.&#xA0;Projectiles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="5404" class="">Chapter&#xA0;6</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5405</span><span sentence-index="5405" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5406</span><span sentence-index="5406" class="">  We  simply  eyeballed  a  value  in  the  Reynolds  number  range            from  1e4  to  1e5. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5407</span><span sentence-index="5407" class="">  You  have  a  choice  here  of  tuning  the  drag  coefficient  value  to  achieve  some            desired  effect,  or  you  can  create  a  curve  fit  or  lookup  table  to  select  a  drag  coefficient            corresponding  to  the  Reynolds  number  of  the  moving  particle.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5409</span><span sentence-index="5409" class="">Now  that  we  have  the  magnitude  of  the  drag  force,  we  simply  multiply  that  force  by  the            unit  drag  vector  to  obtain  the  final  drag  force  vector. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">322</span><span sentence-index="5410" class=""> This  vector  then  gets  aggregated  in                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">322</span><span sentence-index="5410" class="">vForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5410</span><span sentence-index="5410" class=""> .</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5412</span><span sentence-index="5412" class="">We  handle  the  wind  force  in  a  similar  manner  with  a  few  differences  in  the  details. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span sentence-index="5413" class=""> First,            since  we  know  the  unit  wind  force  vector  is  in  the  positive  x-direction  (i.e.,  it  acts  from            left  to  right),  we  can  simply  set  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span sentence-index="5413" class="">x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span sentence-index="5413" class=""> component  of  the  wind  force            vector,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">325</span><span sentence-index="5413" class="">vWind</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5413</span><span sentence-index="5413" class=""> ,  to  the  magnitude  of  the  wind  force. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5414</span><span sentence-index="5414" class="">  We            compute  that  wind  force  using  the  same  formula  we  used  for  still  air  drag  with  the  exception            of  using  the  wind  speed  instead  of  the  particle&apos;s  speed. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">327</span><span sentence-index="5415" class=""> We  used  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">327</span><span sentence-index="5415" class="">_WINDSPEED</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">327</span><span sentence-index="5415" class="">,  a  global  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">327</span><span sentence-index="5415" class="">define</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5415</span><span sentence-index="5415" class=""> ,  to  represent  the            wind  speed,  which  we  have  set  to  10  m/s  (about  20  knots).</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">329</span><span sentence-index="5417" class="">Finally,  the  wind  force  is  aggregated  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">329</span><span sentence-index="5417" class="">vForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5417</span><span sentence-index="5417" class=""> .</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5419</span><span sentence-index="5419" class="">At  this  stage  the  particles  will  fall  under  the  influence  of  gravity,  but  not  as  fast  as            they  would  have  without  the  drag  force. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">332</span><span sentence-index="5420" class=""> And  now  they&apos;ll  also  drift  to  the  right  due  to  the            wind  </span></span><a id="I_indexterm2_id323659" class="indexterm"></a><a id="I_indexterm2_id323668" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5422</span><span sentence-index="5422" class="">force.</span></span></a></p></div><div class="sect1" title="Implementing Collisions"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="implementing_collisions"><a id="I_indexterm2_id323668" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">337</span><span sentence-index="5425" class="nonQuoteStr">Implementing  Collisions</span></span></a></h2></div></div></div><p><a id="I_indexterm2_id323668" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">339</span><span sentence-index="5427" class="">Adding  external  forces  </span></span></a><a id="pa8.4" class="indexterm"></a><a id="co8.4" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5429</span><span sentence-index="5429" class="">made  the  simulation  a  little  more  interesting. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5430</span><span sentence-index="5430" class="">  However,  to  really  make  it  pop,            we&apos;re  going  to  add  collisions. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5431</span><span sentence-index="5431" class="">  Specifically,  we&apos;ll  handle  particle-to-ground  collisions  and            particle-to-object  collisions. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">344</span><span sentence-index="5432" class=""> If  you  have  not  yet  read  </span></span></a><a class="xref" href="ch05.html" title="Chapter&#xA0;5.&#xA0;Collisions"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">345</span><span sentence-index="5433" class="">Chapter&#xA0;5</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5434</span><span sentence-index="5434" class=""> ,  which            covers  collisions,  you  should  because  we&apos;ll  implement  principles  covered  in  that  chapter  here            in  the  example. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">347</span><span sentence-index="5435" class=""> We&apos;ll  implement  enough  collision  handling  in  this  example  to  allow  particles            to  bounce  off  the  ground  and  circular  objects,  and  we&apos;ll  come  back  to  collision  handling  in            more  detail  in  </span></span><a class="xref" href="ch10.html" title="Chapter&#xA0;10.&#xA0;Implementing Collision Response"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">348</span><span sentence-index="5436" class="">Chapter&#xA0;10</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5437</span><span sentence-index="5437" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5438</span><span sentence-index="5438" class="">  The  material  in  this  chapter            should  whet  your  appetite. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5439</span><span sentence-index="5439" class="">  We&apos;ll  start  with  the  easier  case  of  particle-to-ground            collisions.</span></span></p><div class="sect2" title="Particle-to-Ground Collisions"><div class="titlepage"><div><div><h3 class="title" id="particle-to-ground_collisions"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">353</span><span sentence-index="5441" class="nonQuoteStr">Particle-to-Ground  Collisions</span></span></h3></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">354</span><span sentence-index="5442" class="">Essentially  what  we&apos;re  aiming  to  achieve  with  </span></span><a id="pa8.4.1" class="indexterm"></a><a id="co8.4.1" class="indexterm"></a><a id="cor8.4.1" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">357</span><span sentence-index="5445" class="">particle-to-ground  collision  detection  is  to  prevent  the  particles  from  passing                through  a  ground  plane  specified  at  some  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">357</span><span sentence-index="5445" class="">y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5445</span><span sentence-index="5445" class="">  coordinate. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5446</span><span sentence-index="5446" class="">  Imagine  a                horizontal  impenetrable  surface  that  the  particles  cannot  pass  through. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">359</span><span sentence-index="5447" class=""> There  are  several                things  we  must  do  in  order  to  detect  whether  a  particle  is  indeed  colliding  with  the                    </span></span></a><a id="gr8.4.1" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5448</span><span sentence-index="5448" class="">ground  plane. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5449</span><span sentence-index="5449" class="">  If  so,  then  we  need  to  handle  the  collision,  making  the  particles                respond  in  a  suitable  manner.</span></span></a></p><p><a id="gr8.4.1" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">364</span><span sentence-index="5452" class="">The  left  side  of  </span></span></a><a class="xref" href="ch08.html#particle-to-ground_collision" title="Figure&#xA0;8-5.&#xA0;Particle-to-ground collision"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">365</span><span sentence-index="5453" class="">Figure&#xA0;8-5</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5454</span><span sentence-index="5454" class="">  illustrates  a  collision                scenario. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5455</span><span sentence-index="5455" class="">  It&apos;s  easy  to  determine  whether  or  not  a  collision  has  taken  place. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5456</span><span sentence-index="5456" class="">  Over  a  given                simulation  time  step,  a  particle  may  have  moved  from  some  previous  position  (its  position  at                the  previous  time  step)  to  its  current  position. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5457</span><span sentence-index="5457" class="">  If  this  current  position  puts  the  centroid                coordinate  of  the  particle  within  one  particle  radius  of  the  ground  plane,  then  a  collision                might  be  occurring. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">370</span><span sentence-index="5458" class=""> We  say  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">370</span><span sentence-index="5458" class="">might</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5458</span><span sentence-index="5458" class="">  because  the  other  criteria  we  need  to                check  in  order  to  determine  whether  or  not  a  collision  is  happening  is  whether  or  not  the                particle  is  moving  toward  the  ground  plane. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5459</span><span sentence-index="5459" class="">  If  the  particle  is  moving  toward  the  ground                plane  and  it&apos;s  within  one  radius  of  the  ground  plane,  then  a  collision  is  occurring. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5460</span><span sentence-index="5460" class="">  It  may                also  be  the  case  that  the  particle  has  passed  completely  through  the  ground  plane,  in  which                case  we  assume  a  collision  has  occurred.</span></span></p><div class="figure"><a id="particle-to-ground_collision"></a><div class="figure-contents"><a id="particle-to-ground_collision"></a><div class="mediaobject"><a id="particle-to-ground_collision"></a><a id="I_mediaobject2_id323849"><img src="httpatomoreillycomsourceoreillyimages1598938.png" alt="Particle-to-ground collision"></a></div></div><div class="figure-title"><a id="I_mediaobject2_id323849"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">378</span><span sentence-index="5466" class="nonQuoteStr">Figure&#xA0;8-5.&#xA0;Particle-to-ground  collision</span></span></a></div></div><p><a id="I_mediaobject2_id323849"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5468</span><span sentence-index="5468" class="">To  prevent  such  penetration  of  the  ground  plane,  we  need  to  do  two  things. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">381</span><span sentence-index="5469" class=""> First,  we                must  reposition  the  particle  so  that  it  is  just  touching  the  ground  plane,  as  shown  on  the                right  side  of  </span></span></a><a class="xref" href="ch08.html#particle-to-ground_collision" title="Figure&#xA0;8-5.&#xA0;Particle-to-ground collision"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="5470" class="">Figure&#xA0;8-5</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5471</span><span sentence-index="5471" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5472</span><span sentence-index="5472" class="">  Second,  we  must  apply  some                impact  force  resulting  from  the  collision  in  order  to  force  the  particle  to  either  stop                moving  down  into  the  ground  plane  or  to  move  away  from  the  ground  plane. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5473</span><span sentence-index="5473" class="">  All  these  steps                make  up  collision  detection  and  response.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5475</span><span sentence-index="5475" class="">There  are  several  changes  and  additions  that  we  must  make  to  the  example  code  in  order                to  implement  particle-to-ground  collision  detection  and  response. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">388</span><span sentence-index="5476" class=""> Let&apos;s  begin  with  the                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">388</span><span sentence-index="5476" class="">Particle</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5476</span><span sentence-index="5476" class="">  class.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="5478" class="">We&apos;ve  added  three  new  properties  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="5478" class="">Particle</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="5478" class="">,  as                follows:</span></span></p><a id="I_programlisting2_id323909"><pre class="programlisting">class Particle {
  .
  .
  .
  Vector  vPreviousPosition;
  Vector  vImpactForces;
  bool    bCollision;
  .
  .
  .
};</pre><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="5480" class="">vPreviousPosition</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="5480" class=""> is  used  to  store  the  particle&apos;s                position  at  the  previous  time  step&#x2014;that  is,  at  time  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">392</span><span sentence-index="5480" class="">t-dt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5480</span><span sentence-index="5480" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">393</span><span sentence-index="5481" class="">                   </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">393</span><span sentence-index="5481" class="">vImpactForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5481</span><span sentence-index="5481" class="">  is  used  to  aggregate  all  of  the  impact                forces  acting  on  a  particle. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5482</span><span sentence-index="5482" class="">  You&apos;ll  see  later  that  it  is  possible  for  a  particle  to  collide                with  more  than  one  object  at  the  same  time. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">395</span><span sentence-index="5483" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">395</span><span sentence-index="5483" class="">bCollision</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5483</span><span sentence-index="5483" class="">  is                simply  a  flag  that  is  used  to  indicate  whether  or  not  a  collision  has  been  detected  with  the                particle  at  the  current  time  step. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5484</span><span sentence-index="5484" class="">  This  is  important  because  when  a  collision  occurs,  at                that  instant  in  time,  we  assume  that  the  only  forces  acting  on  the  particle  are  the  impact                forces;  all  of  the  other  forces&#x2014;gravity,  drag,  and  wind&#x2014;are  ignored  for  that  time  instant. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">397</span><span sentence-index="5485" class="">               We  use  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">397</span><span sentence-index="5485" class="">bCollision</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">397</span><span sentence-index="5485" class=""> in  the  updated  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">397</span><span sentence-index="5485" class="">CalcLoads</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">397</span><span sentence-index="5485" class=""> method:</span></span></p></a><a id="I_programlisting2_id323960"><pre class="programlisting">void  Particle::CalcLoads(void)
{
  // Reset forces:
  vForces.x = 0.0f;
  vForces.y = 0.0f;

  // Aggregate forces:
  if(bCollision) {
    // Add Impact forces (if any)
    vForces += vImpactForces;
  } else {
    // Gravity
    vForces += vGravity;

    // Still air drag
    Vector  vDrag;
    float  fDrag;

    vDrag -= vVelocity;
    vDrag.Normalize();
    fDrag = 0.5 * _AIRDENSITY * fSpeed * fSpeed *
           (3.14159 * fRadius * fRadius) * _DRAGCOEFFICIENT;
    vDrag *= fDrag;
    vForces += vDrag;

    // Wind
    Vector  vWind;
    vWind.x = 0.5 * _AIRDENSITY * _WINDSPEED * _WINDSPEED *
             (3.14159 * fRadius * fRadius) * _DRAGCOEFFICIENT;
    vForces += vWind;
  }
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">399</span><span sentence-index="5487" class="">The  only  difference  between  this  version  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">399</span><span sentence-index="5487" class="">CalcLoads</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">399</span><span sentence-index="5487" class="">               and  the  previous  one  is  that  we  added  the  conditional  </span></span><code class="literal"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5487</span><span sentence-index="5487" class="">if(bCollision)  {  ... </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5488</span><span sentence-index="5488" class="">  }  else  {  ... </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">401</span><span sentence-index="5489" class=""> }</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5489</span><span sentence-index="5489" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">402</span><span sentence-index="5490" class=""> If  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">402</span><span sentence-index="5490" class="">bCollision</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5490</span><span sentence-index="5490" class="">  is  true,  then  we  have  a  collision  to  deal  with  and  the  only  forces                that  get  aggregated  are  the  impact  forces. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">403</span><span sentence-index="5491" class=""> If  there  is  no  collision,  if  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">403</span><span sentence-index="5491" class="">bCollision</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5491</span><span sentence-index="5491" class="">  is  false,  then  the  non-impact  forces  are  aggregated                in  the  usual  manner.</span></span></p></a><p><a id="I_programlisting2_id323960"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5494</span><span sentence-index="5494" class="">You  may  have  caught  that  we  are  aggregating  impact  forces  in  this  example. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">407</span><span sentence-index="5495" class=""> This  is  an                alternate  approach  to  the  one  shown  in  </span></span></a><a class="xref" href="ch05.html" title="Chapter&#xA0;5.&#xA0;Collisions"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">408</span><span sentence-index="5496" class="">Chapter&#xA0;5</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5497</span><span sentence-index="5497" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5498</span><span sentence-index="5498" class="">  There  we  showed  you  how                to  calculate  an  impulse  and  change  an  object&apos;s  velocity  in  response  to  a  collision,  using                conservation  of  momentum. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">411</span><span sentence-index="5499" class=""> Well,  we&apos;re  still  calculating  impulses  just  like  in  </span></span><a class="xref" href="ch05.html" title="Chapter&#xA0;5.&#xA0;Collisions"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">412</span><span sentence-index="5500" class="">Chapter&#xA0;5</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5501</span><span sentence-index="5501" class=""> ;  however,  in  this  example,  we&apos;re  going  to  compute  the  impact  force                based  on  that  impulse  and  apply  that  force  to  the  colliding  objects. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5502</span><span sentence-index="5502" class="">  We&apos;ll  let  the  numerical                integrator  integrate  that  force  to  derive  the  colliding  particle&apos;s  new  velocities. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5503</span><span sentence-index="5503" class="">  Either                method  works,  and  we&apos;ll  show  you  an  example  of  the  former  method  later. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5504</span><span sentence-index="5504" class="">  We&apos;re  showing  the                latter  method  here  just  to  illustrate  some  alternatives. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5505</span><span sentence-index="5505" class="">  The  advantage  of  this  latter  method                is  that  it  is  easy  to  compute  impact  forces  due  to  multiple  impacts  and  let  the  integrator                take  care  of  them  all  at  once.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">419</span><span sentence-index="5507" class="">Now,  with  these  changes  made  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">419</span><span sentence-index="5507" class="">Particle</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">419</span><span sentence-index="5507" class="">,  we  need  to                add  a  line  of  code  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">419</span><span sentence-index="5507" class="">Update</span></span></code><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">419</span><span sentence-index="5507" class="">Simulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">419</span><span sentence-index="5507" class="">,  as  shown                here:</span></span></p><a id="I_programlisting2_id324041"><pre class="programlisting">void  UpdateSimulation(void)
{
  .
  .
  .

  // update computer controlled units:
  for(i=0; i&lt;_MAX_NUM_UNITS; i++)
  {
    Units[i].bCollision = CheckForCollisions(&amp;(Units[i]));
    Units[i].CalcLoads();
    Units[i].UpdateBodyEuler(dt);
    .
    .
    .
  } // end i-loop

  .
  .
  .
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">421</span><span sentence-index="5509" class="">The  new  line  is  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">421</span><span sentence-index="5509" class="">Units[i].bCollision  =                    CheckForCollisions(&amp;(Units[i]));</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5509</span><span sentence-index="5509" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">422</span><span sentence-index="5510" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">422</span><span sentence-index="5510" class="">CheckForCollisions</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5510</span><span sentence-index="5510" class="">  is  a  new  function  that  takes  the  given  unit,  whose  pointer                is  passed  as  an  argument,  and  checks  to  see  if  it&apos;s  colliding  with  anything&#x2014;in  this  case,                the  ground. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">423</span><span sentence-index="5511" class=""> If  a  collision  is  detected,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">423</span><span sentence-index="5511" class="">CheckForCollisions</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">423</span><span sentence-index="5511" class=""> also  computes  the  impact  force  and  returns  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">423</span><span sentence-index="5511" class="">true</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5511</span><span sentence-index="5511" class="">  to  let  us  know  a  collision  has  occurred. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">424</span><span sentence-index="5512" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">424</span><span sentence-index="5512" class="">CheckForCollisions</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">424</span><span sentence-index="5512" class=""> is  as  follows:</span></span></p></a><a id="I_programlisting2_id324086"><pre class="programlisting">bool  CheckForCollisions(Particle* p)
{
  Vector  n;
  Vector  vr;
  float   vrn;
  float   J;
  Vector  Fi;
  bool    hasCollision = false;


    // Reset aggregate impact force
    p-&gt;vImpactForces.x = 0;
    p-&gt;vImpactForces.y = 0;

    // check for collisions with ground plane
    if(p-&gt;vPosition.y &lt;= (_GROUND_PLANE+p-&gt;fRadius)) {
      n.x = 0;
      n.y = 1;
      vr = p-&gt;vVelocity;
      vrn = vr * n;
      // check to see if the particle is moving toward the ground
      if(vrn &lt; 0.0) {
        J = -(vr*n) * (_RESTITUTION + 1) * p-&gt;fMass;
        Fi = n;
        Fi *= J/_TIMESTEP;
        p-&gt;vImpactForces += Fi;

        p-&gt;vPosition.y = _GROUND_PLANE + p-&gt;fRadius;
        p-&gt;vPosition.x = ((_GROUND_PLANE + p-&gt;fRadius &#x2212;
                         p-&gt;vPreviousPosition.y) /
                        (p-&gt;vPosition.y - p-&gt;vPreviousPosition.y) *
                        (p-&gt;vPosition.x - p-&gt;vPreviousPosition.x)) +
                        p-&gt;vPreviousPosition.x;

        hasCollision = true;
      }
    }

  return hasCollision;
}</pre><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">426</span><span sentence-index="5514" class="">CheckForCollisions</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5514</span><span sentence-index="5514" class="">  makes  two  checks:  1)  it  checks  to                see  whether  or  not  the  particle  is  making  contact  or  passing  through  the  ground  plane;  and                2)  it  checks  to  make  sure  the  particle  is  actually  moving  toward  the  ground  plane. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5515</span><span sentence-index="5515" class="">  Keep  in                mind  a  particle  could  be  in  contact  with  the  ground  plane  right  after  a  collision  has  been                handled  with  the  particle  moving  away  from  the  ground. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5516</span><span sentence-index="5516" class="">  In  this  case,  we  don&apos;t  want  to                register  another  collision.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5518</span><span sentence-index="5518" class="">Let&apos;s  consider  the  details  of  this  function,  starting  with  the  local  variables. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">431</span><span sentence-index="5519" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">431</span><span sentence-index="5519" class="">n</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5519</span><span sentence-index="5519" class="">  is  a  vector  that  represents  the  unit  normal  vector  pointing                from  the  ground  plane  to  the  particle  colliding  with  it. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5520</span><span sentence-index="5520" class="">  For  ground  collisions,  in  this                example,  the  unit  normal  vector  is  always  straight  up  since  the  ground  plane  is  flat. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">433</span><span sentence-index="5521" class=""> This                means  the  unit  normal  vector  will  always  have  an  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">433</span><span sentence-index="5521" class="">x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">433</span><span sentence-index="5521" class=""> component  of  0  and                its  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">433</span><span sentence-index="5521" class="">y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5521</span><span sentence-index="5521" class="">  component  will  be  1.</span></span></p></a><p><a id="I_programlisting2_id324086"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">436</span><span sentence-index="5524" class="">The  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">436</span><span sentence-index="5524" class="">Vector  vr</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5524</span><span sentence-index="5524" class="">  is  the  relative  velocity  vector  between                the  particle  and  the  ground. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">437</span><span sentence-index="5525" class=""> Since  the  ground  isn&apos;t  moving,  the  relative  velocity</span></span></a><a id="I_indexterm2_id324145" class="indexterm"></a><a id="I_indexterm2_id324155" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5527</span><span sentence-index="5527" class="">  is  simply  the  velocity  of  the  particle. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">440</span><span sentence-index="5528" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">440</span><span sentence-index="5528" class="">vrn</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5528</span><span sentence-index="5528" class="">                is  a  scalar  that&apos;s  used  to  store  the  component  of  the  relative  velocity  in  the  direction  of                the  collision  unit  normal  vector. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">441</span><span sentence-index="5529" class=""> We  compute  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">441</span><span sentence-index="5529" class="">vrn</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5529</span><span sentence-index="5529" class="">  by                taking  the  dot  product  of  the  relative  velocity  with  the  unit  normal  vector. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">442</span><span sentence-index="5530" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">442</span><span sentence-index="5530" class="">J</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5530</span><span sentence-index="5530" class="">  is  a  scalar  that  stores  the  impulse  resulting  from  the                collision. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">443</span><span sentence-index="5531" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">443</span><span sentence-index="5531" class="">Fi</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">443</span><span sentence-index="5531" class=""> is  a  vector  that  stores  the  impact  force  as                derived  from  the  impulse  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">443</span><span sentence-index="5531" class="">J</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5531</span><span sentence-index="5531" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">444</span><span sentence-index="5532" class=""> Finally,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">444</span><span sentence-index="5532" class="">hasCollision</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5532</span><span sentence-index="5532" class="">  is  a  flag  that&apos;s  set  based  on  whether  or  not  a                collision  has  been  detected.</span></span></a></p><p><a id="I_indexterm2_id324155" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">447</span><span sentence-index="5535" class="">Now  we&apos;ll  look  at  the  details  within  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">447</span><span sentence-index="5535" class="">CheckForCollisions</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5535</span><span sentence-index="5535" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">448</span><span sentence-index="5536" class=""> The  first  task  is  to  initialize  the  impact  force  vector,                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">448</span><span sentence-index="5536" class="">vImpactForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5536</span><span sentence-index="5536" class=""> ,  to  0. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5537</span><span sentence-index="5537" class="">  Next,  we  make  the  first  collision                check  by  determining  if  the  y-position  of  the  particle  is  less  than  the  ground  plane  height                plus  the  particles  radius. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5538</span><span sentence-index="5538" class="">  If  it  is,  then  we  know  a  collision  may  have  occurred. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">451</span><span sentence-index="5539" class=""> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">451</span><span sentence-index="5539" class="">(_GROUND_PLANE</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">451</span><span sentence-index="5539" class=""> represents  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">451</span><span sentence-index="5539" class="">y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5539</span><span sentence-index="5539" class="">  coordinate                of  the  ground  plane,  which  we  have  set  to  100.)  If  a  collision  may  have  occurred,  then  we                make  the  next  check&#x2014;to  determine  if  the  particle  is  moving  toward  the  ground  plane.</span></span></a></p><p><a id="I_indexterm2_id324155" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5542</span><span sentence-index="5542" class="">To  perform  this  second  check,  we  compute  the  unit  normal  vector,  relative  velocity,  and                relative  velocity  component  in  the  collision  normal  direct  as  described  earlier. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">455</span><span sentence-index="5543" class=""> If  the                relative  velocity  in  the  normal  direction  is  negative  (i.e.,  if  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">455</span><span sentence-index="5543" class="">vrn</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5543</span><span sentence-index="5543" class="">  &lt;  0),  then  a  collision  has  occurred. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">456</span><span sentence-index="5544" class=""> If  either  of  these  checks  is                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">456</span><span>false</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">456</span><span sentence-index="5544" class="">,  then  a  collision  has  not  occurred  and  the                function  exits,  returning  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">456</span><span sentence-index="5544" class="">false</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5544</span><span sentence-index="5544" class=""> .</span></span></a></p><p><a id="I_indexterm2_id324155" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5547</span><span sentence-index="5547" class="">The  interesting  stuff  happens  if  the  second  check  passes. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5548</span><span sentence-index="5548" class="">  This  is  where  we  have  to                determine  the  impact  force  that  will  cause  the  particle  to  bounce  off  the  ground  plane. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">461</span><span sentence-index="5549" class="">               Here&apos;s  the  specific  code  that  computes  the  impact  force:</span></span></a></p><a id="I_programlisting2_id324265"><pre class="programlisting">        J = -(vr*n) * (_RESTITUTION + 1) * p-&gt;fMass;
        Fi = n;
        Fi *= J/_TIMESTEP;
        p-&gt;vImpactForces += Fi;

        p-&gt;vPosition.y = _GROUND_PLANE + p-&gt;fRadius;
        p-&gt;vPosition.x = (_GROUND_PLANE + p-&gt;fRadius &#x2212;
                         p-&gt;vPreviousPosition.y) /
                        (p-&gt;vPosition.y - p-&gt;vPreviousPosition.y) *
                        (p-&gt;vPosition.x - p-&gt;vPreviousPosition.x) +
                         p-&gt;vPreviousPosition.x;

        hasCollision = true;</pre></a><p><a id="I_programlisting2_id324265"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">464</span><span sentence-index="5552" class="">We  compute  the  impulse  using  the  formulas  presented  in  </span></span></a><a class="xref" href="ch05.html" title="Chapter&#xA0;5.&#xA0;Collisions"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">465</span><span sentence-index="5553" class="">Chapter&#xA0;5</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5554</span><span sentence-index="5554" class=""> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">467</span><span sentence-index="5555" class="">                   </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">467</span><span sentence-index="5555" class="">J</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5555</span><span sentence-index="5555" class="">  is  a  scalar  equal  to  the  negative  of  the  relative                velocity  in  the  normal  direction  times  the  coefficient  of  restitution  plus  1  times  the                particle  mass. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">468</span><span sentence-index="5556" class=""> Recall  that  the  coefficient  of  restitution,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">468</span><span sentence-index="5556" class="">_RESTITUTION</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5556</span><span sentence-index="5556" class=""> ,  governs  how  elastic  or  inelastic  the  collision  is,  or  in  other                words,  how  much  energy  is  transferred  back  to  the  particle  during  the  impact. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5557</span><span sentence-index="5557" class="">  We  have  this                value  set  to  0.6,  but  it  is  tunable  depending  on  what  effect  you&apos;re  trying  to  achieve. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5558</span><span sentence-index="5558" class="">  A                value  of  1  makes  the  particles  very  bouncy,  while  a  value  of,  say,  0.1  makes  them  sort  of                stick  to  the  ground  upon  impact.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">472</span><span sentence-index="5560" class="">Now,  to  compute  the  impact  force,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">472</span><span>Fi</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">472</span><span sentence-index="5560" class="">,  that  will  act                on  the  particle  during  the  next  time  step,  making  it  bounce  off  the  ground,  we  set  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">472</span><span sentence-index="5560" class="">Fi</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5560</span><span sentence-index="5560" class="">  equal  to  the  collision  normal  vector. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">473</span><span sentence-index="5561" class=""> The  magnitude  of  the                impact  force  is  equal  to  the  impulse,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">473</span><span sentence-index="5561" class="">J</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5561</span><span sentence-index="5561" class=""> ,  divided  by  the                time  step  in  seconds. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">474</span><span sentence-index="5562" class=""> The  line  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">474</span><span sentence-index="5562" class="">Fi  *=  J/_TIMESTEP;</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5562</span><span sentence-index="5562" class="">  takes                care  of  calculating  the  final  impact  force.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5564</span><span sentence-index="5564" class="">To  keep  the  particle  from  penetrating  the  ground,  we  reposition  it  so  that  it&apos;s  just                resting  on  the  ground. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5565</span><span sentence-index="5565" class="">  The  y-position  is  easy  to  compute  as  the  ground  plane  elevation  plus                the  radius  of  the  particle. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5566</span><span sentence-index="5566" class="">  We  compute  the  x-position  by  linearly  interpolating  between  the                particle&apos;s  previous  position  and  its  current  position  using  the  newly  computed  y-position. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5567</span><span sentence-index="5567" class="">                This  effectively  backs  up  the  particle  along  the  line  of  action  of  its  velocity  to  the  point                where  it  is  just  touching  the  ground  plane.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5569</span><span sentence-index="5569" class="">When  you  run  the  simulation  now,  you&apos;ll  see  the  particles  fall,  drifting  a  bit  from  left                to  right  until  they  hit  the  ground  plane. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5570</span><span sentence-index="5570" class="">  Once  they  hit,  they&apos;ll  bounce  on  the  ground,                eventually  coming  to  rest. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5571</span><span sentence-index="5571" class="">  Their  specific  behavior  in  this  regard  depends  on  what  drag                coefficient  you  use  and  what  coefficient  of  restitution  you  use. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">484</span><span sentence-index="5572" class=""> If  you  have  wind  applied,                when  the  particles  do  come  to  rest,  vertically,  they  should  still  drift  to  the  right  as                though  they  are  sliding  on  the  ground  </span></span><a id="I_indexterm2_id324348" class="indexterm"></a><a id="I_indexterm2_id324357" class="indexterm"></a><a id="I_indexterm2_id324367" class="indexterm"></a><a id="I_indexterm2_id324376" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5576</span><span sentence-index="5576" class="">plane.</span></span></a></p></div><div class="sect2" title="Particle-to-Obstacle Collisions"><div class="titlepage"><div><div><h3 class="title" id="particle-to-obstacle_collisions"><a id="I_indexterm2_id324376" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">491</span><span sentence-index="5579" class="nonQuoteStr">Particle-to-Obstacle  Collisions</span></span></a></h3></div></div></div><p><a id="I_indexterm2_id324376" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">493</span><span sentence-index="5581" class="">To  make  things  </span></span></a><a id="pa8.4.2" class="indexterm"></a><a id="co8.4.2" class="indexterm"></a><a id="cor8.4.2" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">496</span><span sentence-index="5584" class="">really  interesting,  we&apos;ll  now  add  those  circular  obstacles  you  saw  in  </span></span></a><a class="xref" href="ch08.html#particles_falling_under_the_influence_of" title="Figure&#xA0;8-1.&#xA0;Particles falling under the influence of gravity"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">497</span><span sentence-index="5585" class="">Figure&#xA0;8-1</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">497</span><span sentence-index="5585" class=""> through  </span></span><a class="xref" href="ch08.html#particles_coming_to_rest_on_the_ground" title="Figure&#xA0;8-4.&#xA0;Particles coming to rest on the ground plane"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">499</span><span sentence-index="5587" class="">Figure&#xA0;8-4</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5587</span><span sentence-index="5587" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5588</span><span sentence-index="5588" class="">  The  particles  will  be  able  to  hit  them                and  bounce  off  or  even  settle  down  into  crevasses  made  by  overlapping  obstacles. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5589</span><span sentence-index="5589" class="">  The                obstacles  are  simply  static  particles. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5590</span><span sentence-index="5590" class="">  We&apos;ll  define  them  as  particles  and  initialize  them                but  then  skip  them  when  integrating  the  equations  of  motion  of  the  dynamic  particles. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">503</span><span sentence-index="5591" class=""> Here&apos;s                the  declaration  for  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">503</span><span sentence-index="5591" class="">Obstacles</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">503</span><span sentence-index="5591" class=""> array:</span></span></p><a id="I_programlisting2_id324462"><pre class="programlisting">Particle      Obstacles[_NUM_OBSTACLES];</pre></a><p><a id="I_programlisting2_id324462"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5594</span><span sentence-index="5594" class="">Initializing  the  obstacles  is  a  matter  of  assigning  them  positions  and  a  common  radius                and  a  mass. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">507</span><span sentence-index="5595" class=""> The  few  lines  of  code  shown  next  were  added  to  the  main  program&apos;s  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">507</span><span sentence-index="5595" class="">Initialize</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5595</span><span sentence-index="5595" class="">  function  to  randomly  position  obstacles  in  the  lower,                middle  portion  of  the  window  above  the  ground  plane. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">508</span><span sentence-index="5596" class=""> </span></span></a><a class="xref" href="ch08.html#particles_falling_under_the_influence_of" title="Figure&#xA0;8-1.&#xA0;Particles falling under the influence of gravity"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">509</span><span sentence-index="5597" class="">Figure&#xA0;8-1</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">509</span><span sentence-index="5597" class=""> through  </span></span><a class="xref" href="ch08.html#particles_coming_to_rest_on_the_ground" title="Figure&#xA0;8-4.&#xA0;Particles coming to rest on the ground plane"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">510</span><span sentence-index="5598" class="">Figure&#xA0;8-4</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5599</span><span sentence-index="5599" class="">  illustrate  how  they  are                distributed.</span></span></p><a id="I_programlisting2_id324490"><pre class="programlisting">bool  Initialize(void)
{
  .
  .
  .

  for(i=0; i&lt;_NUM_OBSTACLES; i++)
  {
    Obstacles[i].vPosition.x = GetRandomNumber(_WINWIDTH/2 &#x2212;
                               _OBSTACLE_RADIUS*10,
                               _WINWIDTH/2 +
                               _OBSTACLE_RADIUS*10, false);
    Obstacles[i].vPosition.y = GetRandomNumber(_GROUND_PLANE +
                               _OBSTACLE_RADIUS, _WINHEIGHT/2 &#x2212;
                               _OBSTACLE_RADIUS*4, false);
    Obstacles[i].fRadius = _OBSTACLE_RADIUS;
    Obstacles[i].fMass = 100;
  }
  .
  .
  .
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">514</span><span sentence-index="5602" class="">Drawing  the  obstacles  is  easy  since  they  are  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">514</span><span sentence-index="5602" class="">Particle</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">514</span><span sentence-index="5602" class="">               types  with  a  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">514</span><span sentence-index="5602" class="">Draw</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5602</span><span sentence-index="5602" class="">  method  that  already  draws  circular                shapes. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">515</span><span sentence-index="5603" class=""> We  created  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">515</span><span sentence-index="5603" class="">DrawObstacles</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">515</span><span sentence-index="5603" class=""> to  iterate  through  the                    </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">515</span><span sentence-index="5603" class="">Obstacles</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">515</span><span sentence-index="5603" class=""> array,  calling  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">515</span><span sentence-index="5603" class="">Draw</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5603</span><span sentence-index="5603" class="">  method  of  each  obstacle.</span></span></p></a><a id="I_programlisting2_id324535"><pre class="programlisting">void DrawObstacles(void)
{
  int    i;

  for(i=0; i&lt;_NUM_OBSTACLES; i++)
  {
    Obstacles[i].Draw();
  }

}</pre><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">518</span><span sentence-index="5606" class="">DrawObstacles</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">518</span><span sentence-index="5606" class=""> is  then  called  from  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">518</span><span sentence-index="5606" class="">UpdateSimulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">518</span><span sentence-index="5606" class="">:</span></span></p></a><a id="I_programlisting2_id324556"><pre class="programlisting">void  UpdateSimulation(void)
{
  .
  .
  .

  // initialize the back buffer
  if(FrameCounter &gt;= _RENDER_FRAME_COUNT)
  {
    ClearBackBuffer();
    // Draw ground plane
    DrawLine(0, _WINHEIGHT - _GROUND_PLANE,
             _WINWIDTH, _WINHEIGHT - _GROUND_PLANE,
             3, RGB(0,0,0));

    DrawObstacles();
  }
  .
  .
  .
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">520</span><span sentence-index="5608" class="">The  last  bit  of  code  we  need  to  add  to  have  fully  functioning  collisions  with  obstacles                involves  adding  more  collision  detection  and  handling  code  to  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">520</span><span sentence-index="5608" class="">CheckForCollisions</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5608</span><span sentence-index="5608" class="">  function. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">521</span><span sentence-index="5609" class=""> Before  we  look  at  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">521</span><span sentence-index="5609" class="">CheckForCollisions</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5609</span><span sentence-index="5609" class=""> ,  let&apos;s  consider  colliding  circles  in  general  to  gain  a                better  understanding  of  what  the  new  code  will  do.</span></span></p></a><p><a id="I_programlisting2_id324556"></a><a class="xref" href="ch08.html#collision_states" title="Figure&#xA0;8-6.&#xA0;Collision states"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">525</span><span sentence-index="5613" class="">Figure&#xA0;8-6</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5613</span><span sentence-index="5613" class="">  illustrates  two  circles  colliding. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5614</span><span sentence-index="5614" class="">  We  aim  to  detect                whether  or  not  these  circles  are  colliding  by  checking  the  distance  between  their  centers. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5615</span><span sentence-index="5615" class="">                If  the  distance  between  the  two  centers  is  greater  than  the  sum  of  the  radii  of  the  circles,                then  the  particles  are  not  colliding. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">528</span><span sentence-index="5616" class=""> The  topmost  illustration  in  </span></span><a class="xref" href="ch08.html#collision_states" title="Figure&#xA0;8-6.&#xA0;Collision states"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">529</span><span sentence-index="5617" class="">Figure&#xA0;8-6</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">529</span><span sentence-index="5617" class=""> shows  the  distance,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">529</span><span sentence-index="5617" class="">d</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">529</span><span sentence-index="5617" class="">,  between  centers                and  the  distance,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">529</span><span>s</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">529</span><span sentence-index="5617" class="">,  between  the  edges  of  the  circles;                    </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">529</span><span sentence-index="5617" class="">s</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5618</span><span sentence-index="5618" class="">  is  the  gap  between  the  two. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">531</span><span sentence-index="5619" class=""> Another  way  to  think  about  this  is  that                if  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">531</span><span sentence-index="5619" class="">s</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5619</span><span sentence-index="5619" class="">  is  positive,  then  there&apos;s  no  collision. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">532</span><span sentence-index="5620" class=""> Referring  to  the  middle                illustration  in  </span></span><a class="xref" href="ch08.html#collision_states" title="Figure&#xA0;8-6.&#xA0;Collision states"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">533</span><span sentence-index="5621" class="">Figure&#xA0;8-6</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">533</span><span sentence-index="5621" class="">,  if  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">533</span><span sentence-index="5621" class="">s</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5622</span><span sentence-index="5622" class="">  is  equal  to  0,                then  the  circles  are  in  contact. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">535</span><span sentence-index="5623" class=""> If  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">535</span><span sentence-index="5623" class="">s</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5623</span><span sentence-index="5623" class="">  is  a  negative  number,  as  shown  in                the  bottommost  illustration,  then  the  circles  are  penetrating.</span></span></p><div class="figure"><a id="collision_states"></a><div class="figure-contents"><a id="collision_states"></a><div class="mediaobject"><a id="collision_states"></a><a id="I_mediaobject2_id324641"><img src="httpatomoreillycomsourceoreillyimages1598939.png" alt="Collision states"></a></div></div><div class="figure-title"><a id="I_mediaobject2_id324641"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">541</span><span sentence-index="5629" class="">Figure&#xA0;8-6.&#xA0;Collision  states</span></span></a></div></div><p><a id="I_mediaobject2_id324641"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5631</span><span sentence-index="5631" class="">We&apos;ll  apply  these  principles  for  detecting  colliding  circles  to  detecting  collisions                between  our  particles  and  obstacles  since  they  are  both  circles. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">544</span><span sentence-index="5632" class=""> </span></span></a><a class="xref" href="ch08.html#particle-to-obstacle_collision" title="Figure&#xA0;8-7.&#xA0;Particle-to-obstacle collision"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">545</span><span sentence-index="5633" class="">Figure&#xA0;8-7</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5634</span><span sentence-index="5634" class="">  illustrates  how  our  particle-to-obstacle                collisions  might  look.</span></span></p><div class="figure"><a id="particle-to-obstacle_collision"></a><div class="figure-contents"><a id="particle-to-obstacle_collision"></a><div class="mediaobject"><a id="particle-to-obstacle_collision"></a><a id="I_mediaobject2_id324680"><img src="httpatomoreillycomsourceoreillyimages1598940.png" alt="Particle-to-obstacle collision"></a></div></div><div class="figure-title"><a id="I_mediaobject2_id324680"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">552</span><span sentence-index="5640" class="nonQuoteStr">Figure&#xA0;8-7.&#xA0;Particle-to-obstacle  collision</span></span></a></div></div><p><a id="I_mediaobject2_id324680"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">554</span><span sentence-index="5642" class="">We&apos;ll  calculate  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">554</span><span sentence-index="5642" class="">s</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5642</span><span sentence-index="5642" class="">  for  each  particle  against  each  obstacle  to                determine  contact  or  penetration. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5643</span><span sentence-index="5643" class="">  If  we  find  either,  then  we&apos;ll  perform  the  relative                velocity  check  in  the  same  manner  we  did  for  particle-to-ground  collisions  to  see  if  the                particle  is  moving  toward  the  obstacle. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5644</span><span sentence-index="5644" class="">  If  it  is,  then  we  have  a  collision  and  we&apos;ll  back  up                the  particle  along  the  collision  normal  vector  line  of  action,  which  is  simply  the  line                connecting  the  centers  of  the  particle  and  the  obstacle. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5645</span><span sentence-index="5645" class="">  We&apos;ll  also  compute  the  impact  force                like  we  did  earlier  and  let  the  integrator  take  care  of  the  rest.</span></span></a></p><p><a id="I_mediaobject2_id324680"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">560</span><span sentence-index="5648" class="">OK,  now  let&apos;s  look  at  the  new  code  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">560</span><span sentence-index="5648" class="">CheckForCollisions</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">560</span><span sentence-index="5648" class="">:</span></span></a></p><a id="I_programlisting2_id324729"><pre class="programlisting">bool  CheckForCollisions(Particle* p)
{
  .
  .
  .

    // Check for collisions with obstacles
    float r;
    Vector d;
    float s;

    for(i=0; i&lt;_NUM_OBSTACLES; i++)
    {
      r = p-&gt;fRadius + Obstacles[i].fRadius;
      d = p-&gt;vPosition - Obstacles[i].vPosition;
      s = d.Magnitude() - r;

      if(s &lt;= 0.0)
      {
        d.Normalize();
        n = d;
        vr = p-&gt;vVelocity - Obstacles[i].vVelocity;
        vrn = vr*n;


        if(vrn &lt; 0.0)
        {
          J = -(vr*n) * (_RESTITUTION + 1) /
             (1/p-&gt;fMass + 1/Obstacles[i].fMass);
          Fi = n;
          Fi *= J/_TIMESTEP;
          p-&gt;vImpactForces += Fi;

          p-&gt;vPosition -= n*s;
          hasCollision = true;
        }
      }
    }
  .
  .
  .
}</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5650</span><span sentence-index="5650" class="">The  new  code  is  nearly  the  same  as  the  code  that  checks  for  and  handles                particle-to-ground  collisions. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5651</span><span sentence-index="5651" class="">  The  only  major  differences  are  in  how  we  compute  the  distance                between  the  particle  and  the  obstacle  and  how  we  adjust  the  colliding  particle&apos;s  position  to                prevent  it  from  penetrating  an  obstacle,  since  the  unit  normal  vector  may  not  be  straight  up                as  it  was  before. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5652</span><span sentence-index="5652" class="">  The  rest  of  the  code  is  the  same,  so  let&apos;s  focus  on  the                differences.</span></span></p></a><p><a id="I_programlisting2_id324729"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">567</span><span sentence-index="5655" class="">As  explained  earlier  and  illustrated  in  </span></span></a><a class="xref" href="ch08.html#collision_states" title="Figure&#xA0;8-6.&#xA0;Collision states"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">568</span><span sentence-index="5656" class="">Figure&#xA0;8-6</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">568</span><span sentence-index="5656" class="">,  we  need  to                compute  the  separation,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">568</span><span sentence-index="5656" class="">s</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5657</span><span sentence-index="5657" class=""> ,  between  the  particle  and  the                obstacle. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">570</span><span sentence-index="5658" class=""> So  to  get  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">570</span><span sentence-index="5658" class="">s</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">570</span><span sentence-index="5658" class="">,  we  declare  a  variable  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">570</span><span sentence-index="5658" class="">r</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5658</span><span sentence-index="5658" class="">  and  equate  it  to  the  sum  of  radii  of  the  particle  and  the                obstacle  against  which  we&apos;re  checking  for  a  collision. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">571</span><span sentence-index="5659" class=""> We  define  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">571</span><span sentence-index="5659" class="">d</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">571</span><span sentence-index="5659" class="">,  a  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">571</span><span sentence-index="5659" class="">Vector</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5659</span><span sentence-index="5659" class=""> ,  as  the  difference  between  the                positions  of  the  particle  and  obstacle. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">572</span><span sentence-index="5660" class=""> The  magnitude  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">572</span><span sentence-index="5660" class="">d</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">572</span><span sentence-index="5660" class=""> minus  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">572</span><span sentence-index="5660" class="">r</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">572</span><span sentence-index="5660" class=""> yields  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">572</span><span sentence-index="5660" class="">s</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5660</span><span sentence-index="5660" class=""> .</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">574</span><span sentence-index="5662" class="">If  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">574</span><span sentence-index="5662" class="">s</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5662</span><span sentence-index="5662" class="">  is  less  than  0,  then  we  make  the  relative                velocity  check. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5663</span><span sentence-index="5663" class="">  Now,  in  this  case  the  collision  normal  vector  is  along  the  line  connecting                the  centers  of  the  two  circles  representing  the  particle  and  the  obstacle. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">576</span><span sentence-index="5664" class=""> Well,  that&apos;s  just                the  vector  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">576</span><span sentence-index="5664" class="">d</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5664</span><span sentence-index="5664" class="">  we  already  calculated. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">577</span><span sentence-index="5665" class=""> To  get  the  unit                normal  vector,  we  simply  normalize  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">577</span><span sentence-index="5665" class="">d</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5665</span><span sentence-index="5665" class=""> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5666</span><span sentence-index="5666" class="">  The  relative                velocity  vector  is  simply  the  difference  in  velocities  of  the  particle  and  the  obstacle. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5667</span><span sentence-index="5667" class="">                Since  the  obstacles  are  static,  the  relative  velocity  is  just  the  particle&apos;s  velocity. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">580</span><span sentence-index="5668" class=""> But                we  calculated  the  relative  velocity  by  taking  the  vector  difference  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">580</span><span sentence-index="5668" class="">vr  =  p-&gt;vVelocity  &#x2013;  Obstacles[i].vVelocity</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5668</span><span sentence-index="5668" class=""> ,  because  in  a  more  advanced                scenario,  you  might  have  moving  obstacles.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">582</span><span sentence-index="5670" class="">Taking  the  dot  product  of  the  relative  velocity  vector,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">582</span><span sentence-index="5670" class="">vr</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5670</span><span sentence-index="5670" class=""> ,  with  the  unit  normal  vector  yields  the  relative  velocity  in  the  collision                normal  direction. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5671</span><span sentence-index="5671" class="">  If  that  relative  velocity  is  less  than  0,  then  the  particle  and  the  object                are  colliding  and  the  code  goes  on  to  calculate  the  impact  force  in  a  manner  similar  to  that                described  earlier  for  the  particle-to-ground  collisions. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5672</span><span sentence-index="5672" class="">  The  only  difference  here  is  that                both  the  particle&apos;s  and  object&apos;s  masses  appear  in  the  impulse  formula. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">585</span><span sentence-index="5673" class=""> Earlier  we  assumed                the  ground  was  infinitely  massive  relative  to  the  particle&apos;s  mass,  so  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">585</span><span sentence-index="5673" class="">1/m</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5673</span><span sentence-index="5673" class="">  term  for  the  ground  went  to  0,  essentially  dropping  out  of                the  equation. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">586</span><span sentence-index="5674" class=""> Refer  back  to  </span></span><a class="xref" href="ch05.html" title="Chapter&#xA0;5.&#xA0;Collisions"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">587</span><span sentence-index="5675" class="">Chapter&#xA0;5</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5676</span><span sentence-index="5676" class="">  to  recall  the  impulse                formulas.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">590</span><span sentence-index="5678" class="nonQuoteStr">Once  the  impact  force  is  calculated,  the  code  backs  up  the  particle  by  a  distance  equal                to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">590</span><span sentence-index="5678" class="nonQuoteStr">s</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">590</span><span sentence-index="5678" class="nonQuoteStr">,  the  penetration,  along  the  line  of  action  of  the                collision  normal  vector,  giving  us  what  we  desire  (as  shown  in  </span></span><a class="xref" href="ch08.html#particle-to-obstacle_collision" title="Figure&#xA0;8-7.&#xA0;Particle-to-obstacle collision"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">591</span><span sentence-index="5679" class="">Figure&#xA0;8-7</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5680</span><span sentence-index="5680" class=""> ).</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5682</span><span sentence-index="5682" class="">Now,  when  you  run  this  simulation  you&apos;ll  see  the  particles  falling  down,  bouncing  off                the  obstacles  or  flowing  around  them  depending  on  the  value  you&apos;re  using  for  coefficient  of                restitution,  ultimately  bouncing  and  coming  to  rest  on  the  ground  plane. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">595</span><span sentence-index="5683" class=""> If  you  have  a  wind                speed  greater  than  0,  then  the  particles  will  still  drift  along  the  ground  plane  from  left                to  </span></span><a id="I_indexterm2_id324889" class="indexterm"></a><a id="I_indexterm2_id324899" class="indexterm"></a><a id="I_indexterm2_id324908" class="indexterm"></a><a id="I_indexterm2_id324917" class="indexterm"></a><a id="I_indexterm2_id324927" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5688</span><span sentence-index="5688" class="">right.</span></span></a></p></div></div><div class="sect1" title="Tuning"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="tuning"><a id="I_indexterm2_id324927" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">603</span><span sentence-index="5691" class="">Tuning</span></span></a></h2></div></div></div><p><a id="I_indexterm2_id324927" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">605</span><span sentence-index="5693" class="">Tuning  is  an  </span></span></a><a id="I_indexterm2_id324947" class="indexterm"></a><a id="I_indexterm2_id324957" class="indexterm"><span class="nonQuoteStr" gspkNameUnknown="formulas" gsIndex="1"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5695</span><span sentence-index="5695" class="">important  part  of  developing  any  simulator. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5696</span><span sentence-index="5696" class="">  Tuning  means  different  things  to            different  people. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5697</span><span sentence-index="5697" class=""><span> For some, tuning is adjusting </span><span class="personQuoteSpeaker" whospk="formulas">Formulas</span><span> and coefficients to make your simulation match some specific </span></span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5698</span><span sentence-index="5698" style="border-bottom: solid orange 4px;" class="" gspkNameUnknown="formulas" gsIndex="1"> &quot;right  answer,&quot; </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5699</span><span sentence-index="5699" class="">  while  to  others  tuning  is  adjusting  parameters            to  make  the  simulation  look  and  behave  how  you  want  it  to,  whether  or  not  it&apos;s  technically  the            right  answer. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5700</span><span sentence-index="5700" class="">  After  all,  the  right  answer  for  a  game  is  that  it&apos;s  fun  and  robust. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5701</span><span sentence-index="5701" class="">  Speaking  of            robustness,  other  folks  view  tuning  in  the  sense  of  adjusting  parameters  to  make  the            simulation  stable. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5702</span><span sentence-index="5702" class="">  In  reality,  this  is  all  tuning  and  you  should  think  of  it  as  a  necessary            part  of  developing  your  simulation. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5703</span><span sentence-index="5703" class="">  It&apos;s  the  process  by  which  you  tweak,  nudge,  and  adjust            things  to  make  the  simulation  do  what  you  want  it  to  do.</span></span></a></p><p><a id="I_indexterm2_id324957" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5706</span><span sentence-index="5706" class="">For  example,  you  can  use  this  same  example  simulation  to  model  very  springy  rubber  balls. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5707</span><span sentence-index="5707" class="">            To  achieve  this,  you&apos;ll  probably  adjust  the  coefficient  of  restitution  toward  a  value            approaching  1  and  perhaps  lower  the  drag  coefficient. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5708</span><span sentence-index="5708" class="">  The  particles  will  bounce  all  over  the            place  with  a  lot  of  energy. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5709</span><span sentence-index="5709" class="">  If,  on  the  other  hand,  you  want  to  model  something  along  the  lines            of  mud,  then  you&apos;ll  lower  the  coefficient  of  restitution  and  increase  the  drag  coefficient. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5710</span><span sentence-index="5710" class="">            There  is  no  right  or  wrong  combination  of  coefficient  of  restitution  or  drag  coefficient  to            use,  so  long  as  you  are  pleased  with  the  results.</span></span></a></p><p><a id="I_indexterm2_id324957" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5713</span><span sentence-index="5713" class="">Another  aspect  you  might  tune  is  the  number  of  simulation  frames  per  rendering  frame. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5714</span><span sentence-index="5714" class="">  You            may  find  the  simulation  calculations  take  so  long  that  your  resulting  animations  are  too  jerky            because  you  aren&apos;t  updating  the  display  enough. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5715</span><span sentence-index="5715" class="">  The  converse  may  be  true  in  other  cases. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5716</span><span sentence-index="5716" class="">  An            important  parameter  that  plays  into  this  is  the  time  step  size  you  take  at  each  simulation            iteration. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5717</span><span sentence-index="5717" class="">  If  the  step  size  is  too  small,  you&apos;ll  perform  a  lot  of  simulation  steps,  slowing            the  animation  down. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5718</span><span sentence-index="5718" class="">  On  the  other  hand,  a  small  time  step  can  keep  the  simulation  numerically            stable. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5719</span><span sentence-index="5719" class="">  Your  chosen  integrator  plays  a  huge  role  here.</span></span></a></p><p><a id="I_indexterm2_id324957" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5722</span><span sentence-index="5722" class="">If  you  make  your  time  step  too  large,  the  simulation  may  just  blow  up  and  not  work. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5723</span><span sentence-index="5723" class="">  It            will  be  numerically  unstable. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5724</span><span sentence-index="5724" class="">  Even  if  it  doesn&apos;t  blow  up,  you  might  see  weird  results. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5725</span><span sentence-index="5725" class="">  For            example,  if  the  time  step  in  the  example  simulation  discussed  in  this  chapter  is  too  large,            then  particles  may  completely  step  over  obstacles  in  a  single  time  step,  missing  the  collision            that  would  otherwise  have  happened. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">638</span><span sentence-index="5726" class=""> (We&apos;ll  show  you  in  </span></span></a><a class="xref" href="ch10.html" title="Chapter&#xA0;10.&#xA0;Implementing Collision Response"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">639</span><span sentence-index="5727" class="">Chapter&#xA0;10</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">639</span><span sentence-index="5727" class=""> how  to  deal  with  that  situation.)</span></span></p><p><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5729</span><span sentence-index="5729" class="">In  general,  tuning  is  a  necessary  part  of  developing  physics-based  simulations,  and  we            encourage  you  to  experiment&#x2014;trying  different  combinations  of  parameters  to  see  what  results            you  can  achieve. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">642</span><span sentence-index="5730" class=""> You  should  even  try  combinations  that  may  break  the  example  in  this  chapter            to  see  what  happens  and  what  you  should  try  to  avoid  in  a  deployed  </span></span><a id="I_indexterm2_id325012" class="indexterm"><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5731</span><span sentence-index="5731" class="">game.</span></span></a></p></div></section><a id="I_indexterm2_id325012" class="indexterm">
</a></body></html>