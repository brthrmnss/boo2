<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><html><head><title>Chapter&#xA0;9.&#xA0;2D Rigid-Body Simulator</title><link rel="stylesheet" type="text/css" href="core.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="up" href="pt02.html" title="Part&#xA0;II.&#xA0;Rigid-Body Dynamics"><link rel="prev" href="ch08.html" title="Chapter&#xA0;8.&#xA0;Particles"><link rel="next" href="ch10.html" title="Chapter&#xA0;10.&#xA0;Implementing Collision Response"></head><body>
         
        <script>
        function ok(){ 
            window.gggs()
            return;
            //$('#musicPlayer').parent().remove();
            //speakTransportPanelDialogV2.closeEmoteDialog()
            //speakTransportPanelDialog.closeEmoteDialog()
            //
            debugger
            let url = 'http://127.0.0.1:8080/uploads/extracted/' +
             'Crazy Rich Asians  Kevin Kwanepub/' +
              'jsonSets/OEBPS/Kwan_9780385536981_epub_prl_r1.htm.html.sentences.json'
            speakTransportPanelDialogV2.sideLoadSentences2(null, null, null, url)
            
        }
        setTimeout(ok, 1500)
        </script>
        <div style="background:white">````````</div><section class="chapter" title="Chapter&#xA0;9.&#xA0;2D Rigid-Body Simulator" epub:type="chapter" id="d_rigid-body_simulator"><div class="titlepage"><div><div><h2 class="title"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">1</span><span sentence-index="5734" class="highlight2">Chapter&#xA0;9.&#xA0;2D  Rigid-Body  Simulator</span></span></h2></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">2</span><span sentence-index="5735" class="highlight3">After  reading  </span></span><a class="xref" href="ch08.html" title="Chapter&#xA0;8.&#xA0;Particles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">3</span><span sentence-index="5736" class="highlight4">Chapter&#xA0;8</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">3</span><span sentence-index="5736" class="highlight2">,  </span></span><a id="si9.0" class="indexterm"></a><a id="ri9.0" class="indexterm"></a><a id="I_indexterm3_id325070" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5740</span><span sentence-index="5740" class="highlight3">you&apos;ve  learned  the  main  ingredients  that  go  into  a  simulator,    specifically  a  particle  simulator. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5741</span><span sentence-index="5741" class="highlight4">  In  this  chapter  we&apos;ll  look  beyond    particles  at  2D  rigid  bodies. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5742</span><span sentence-index="5742" class="highlight2">  The  main  difference  here  is  that  rigid  bodies    rotate,  and  you  must  deal  with  an  additional  equation  of  motion&#x2014;namely,  the    angular  equation  of  motion  relating  a  rigid  body&apos;s  angular  acceleration  and    inertia  to  the  sum  of  all  moments  (torques)  acting  on  the  rigid  body. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5743</span><span sentence-index="5743" class="highlight3">  The    fundamental  elements  of  the  simulator&#x2014;the  model,  integrator,  renderer,    etc.&#x2014;are  the  same  as  before;  you  just  have  to  deal  with  rotation. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5744</span><span sentence-index="5744" class="highlight4">  In  two    dimensions,  handling  rotation  is  simple. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">12</span><span sentence-index="5745" class="highlight2"> Things  get  a  bit  more  involved  when    handling  rotation  in  three  dimensions,  and  we&apos;ll  treat  that  problem  in  </span></span></a><a class="xref" href="ch11.html" title="Chapter&#xA0;11.&#xA0;Rotation in 3D Rigid-Body Simulators"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">13</span><span sentence-index="5746" class="highlight3">Chapter&#xA0;11</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5747</span><span sentence-index="5747" class="highlight4"> .</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5749</span><span sentence-index="5749" class="highlight2">The  example  we&apos;ll  take  a  close  look  at  in  this  chapter  is  simple  by    design. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5750</span><span sentence-index="5750" class="highlight3">  We  want  to  focus  on  the  differences  between  the  particle  simulator    and  a  2D  rigid-body  simulator. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">18</span><span sentence-index="5751" class="highlight4"> In  </span></span><a class="xref" href="ch10.html" title="Chapter&#xA0;10.&#xA0;Implementing Collision Response"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">19</span><span sentence-index="5752" class="highlight2">Chapter&#xA0;10</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5753</span><span sentence-index="5753" class="highlight3"> ,  we&apos;ll  extend  this  simple    example  to  deal  with  multiple  rigid  bodies  and  collisions. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5754</span><span sentence-index="5754" class="highlight4">  That&apos;s  where    things  really  get  interesting. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5755</span><span sentence-index="5755" class="highlight2">  For  now,  we&apos;ll  consider  a  single  rigid  body,    a  virtual  hovercraft,  that  moves  around  the  screen  under  the  influences  of    thrust  forces  that  you  can  control  with  the  keyboard. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5756</span><span sentence-index="5756" class="highlight3">  While  simple,  this    example  covers  the  most  fundamental  aspects  of  simulating  2D  rigid    bodies.</span></span></p><p><a class="xref" href="ch09.html#d_rigid-body_example" title="Figure&#xA0;9-1.&#xA0;2D rigid-body example"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">26</span><span sentence-index="5759" class="highlight4">Figure&#xA0;9-1</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">26</span><span sentence-index="5759" class="highlight2"> shows  our  virtual  </span></span><a id="ho9.0" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5760</span><span sentence-index="5760" class="highlight3">hovercraft. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5761</span><span sentence-index="5761" class="highlight4">  The  pointy  end  is  the  front,  and  the  hovercraft    will  start  off  moving  from  the  left  side  of  the  screen  to  the  right. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5762</span><span sentence-index="5762" class="highlight2">  Using    the  arrow  keys,  you  can  increase  or  decrease  its  speed  and  make  it  turn  left    or  right  (port  or  starboard).</span></span></a></p><div class="figure"><a id="d_rigid-body_example"></a><div class="figure-contents"><a id="d_rigid-body_example"></a><div class="mediaobject"><a id="d_rigid-body_example"></a><a id="I_mediaobject3_id325146"><img src="httpatomoreillycomsourceoreillyimages1598941.png" alt="2D rigid-body example"></a></div></div><div class="figure-title"><a id="I_mediaobject3_id325146"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">35</span><span sentence-index="5768" class="highlight3">Figure&#xA0;9-1.&#xA0;2D  rigid-body  example</span></span></a></div></div><p><a id="I_mediaobject3_id325146"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5770</span><span sentence-index="5770" class="highlight4">In  this  simulation,  the  world  coordinate  system  has  its  x-axis    pointing  to  the  right,  its  y-axis  pointing  down  toward  the  bottom  of  the    screen,  and  the  z-axis  pointing  into  the  screen. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5771</span><span sentence-index="5771" class="highlight2">  Even  though  this  is  a  2D    example  where  all  motion  is  confined  to  the  x-y  plane,  you  still  need  a    z-axis  about  which  the  hovercraft  will  rotate. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5772</span><span sentence-index="5772" class="highlight3">  Also,  the  local,  or    body-fixed,  coordinate  system  has  its  x-axis  pointing  toward  the  front  of    the  hovercraft,  its  y-axis  pointing  to  the  starboard  side,  and  its  z-axis    into  the  screen. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5773</span><span sentence-index="5773" class="highlight4">  The  local  coordinate  system  is  fixed  to  the  rigid  body  at    its  center  of  gravity  location.</span></span></a></p><div class="sect1" title="Model"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="model"><a id="I_mediaobject3_id325146"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">43</span><span sentence-index="5776" class="highlight2">Model</span></span></a></h2></div></div></div><p><a id="I_mediaobject3_id325146"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">45</span><span sentence-index="5778" class="highlight3">The  hovercraft  </span></span></a><a id="tw9.1" class="indexterm"></a><a id="mo9.1" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">47</span><span sentence-index="5780" class="highlight4">modeled  in  this  simulation  is  a  simplified  version  of  the        hovercraft  we&apos;ll  model  in  </span></span></a><a class="xref" href="ch17.html" title="Chapter&#xA0;17.&#xA0;Cars and Hovercraft"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">48</span><span sentence-index="5781" class="highlight2">Chapter&#xA0;17</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5782</span><span sentence-index="5782" class="highlight3"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">50</span><span sentence-index="5783" class="highlight4"> You  can        refer  to  </span></span><a class="xref" href="ch17.html" title="Chapter&#xA0;17.&#xA0;Cars and Hovercraft"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">51</span><span sentence-index="5784" class="highlight2">Chapter&#xA0;17</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5785</span><span sentence-index="5785" class="highlight3">  for  more  details  on  that        model. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5786</span><span sentence-index="5786" class="highlight4">  For  convenience  we  repeat  some  of  the  basic  properties  of  the  model        here. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">54</span><span sentence-index="5787" class="highlight2"> </span></span><a class="xref" href="ch09.html#simple_hovercraft_model" title="Figure&#xA0;9-2.&#xA0;Simple hovercraft model"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="5788" class="highlight3">Figure&#xA0;9-2</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5789</span><span sentence-index="5789" class="highlight4">  illustrates  the  main        features  of  the  model.</span></span></p><div class="figure"><a id="simple_hovercraft_model"></a><div class="figure-contents"><a id="simple_hovercraft_model"></a><div class="mediaobject"><a id="simple_hovercraft_model"></a><a id="I_mediaobject3_id325253"><img src="httpatomoreillycomsourceoreillyimages1598942.png" alt="Simple hovercraft model"></a></div></div><div class="figure-title"><a id="I_mediaobject3_id325253"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">62</span><span sentence-index="5795" class="highlight2">Figure&#xA0;9-2.&#xA0;Simple  hovercraft  model</span></span></a></div></div><p><a id="I_mediaobject3_id325253"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5797</span><span sentence-index="5797" class="highlight3">We&apos;re  assuming  this  hovercraft  operates  over  smooth  land  and  is        fitted  with  a  single  airscrew  propeller,  located  toward  the  aft  end  of  the        craft,  that  provides  forward  thrust. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5798</span><span sentence-index="5798" class="highlight4">  For  controllability,  the  craft  is        fitted  with  two  bow  thrusters,  one  to  port  and  the  other  to  starboard. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5799</span><span sentence-index="5799" class="highlight2">        These  bow  thrusters  are  used  to  steer  the  hovercraft.</span></span></a></p><p><a id="I_mediaobject3_id325253"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5802</span><span sentence-index="5802" class="highlight3">We  use  a  simplified  drag  model  where  the  only  drag  component  is  due        to  aerodynamic  drag  on  the  entire  craft  with  a  constant  projected  area. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">70</span><span sentence-index="5803" class="highlight4">       This  model  is  similar  to  the  one  used  in  </span></span></a><a class="xref" href="ch08.html" title="Chapter&#xA0;8.&#xA0;Particles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">71</span><span sentence-index="5804" class="highlight2">Chapter&#xA0;8</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5805</span><span sentence-index="5805" class="highlight3">  for        particle  drag. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">73</span><span sentence-index="5806" class="highlight4"> A  more  rigorous  model  would  consider  the  actual  projected        area  of  the  craft  as  a  function  of  the  direction  of  relative  velocity,  as        in  the  flight  simulator  example  discussed  in  </span></span><a class="xref" href="ch15.html" title="Chapter&#xA0;15.&#xA0;Aircraft"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">74</span><span sentence-index="5807" class="highlight2">Chapter&#xA0;15</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5808</span><span sentence-index="5808" class="highlight3"> ,        as  well  as  the  frictional  drag  between  the  bottom  of  the  craft&apos;s  skirt  and        the  ground. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5809</span><span sentence-index="5809" class="highlight4">  We  also  assume  that  the  center  of  drag&#x2014;the  point  through  which        we  can  assume  the  drag  force  vector  is  applied&#x2014;is  located  some  distance        aft  of  the  center  of  gravity  so  as  to  give  a  little  directional  stability        (that  is,  to  counteract  rotation). </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5810</span><span sentence-index="5810" class="highlight2">  This  serves  the  same  function  as  the        vertical  tail  fins  on  aircraft. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5811</span><span sentence-index="5811" class="highlight3">  Again,  a  more  rigorous  model  would  include        the  effects  of  rotation  on  aerodynamic  drag,  but  we  ignore  that        here.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5813</span><span sentence-index="5813" class="highlight4">In  code,  the  first  thing  you  need  to  do  to  represent  this  vehicle  is        define  a  rigid-body  class  that  contains  all  of  the  information  you&apos;ll  need        to  track  it  and  calculate  the  forces  and  moments  acting  on  it. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">81</span><span sentence-index="5814" class="highlight2"> This        </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">81</span><span sentence-index="5814" class="highlight3">RigidBody2D</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">81</span><span sentence-index="5814" class="highlight4"> class  is  very  similar  to        the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">81</span><span sentence-index="5814" class="highlight2">Particle</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">81</span><span sentence-index="5814" class="highlight3"> class  from  </span></span><a class="xref" href="ch08.html" title="Chapter&#xA0;8.&#xA0;Particles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span sentence-index="5815" class="highlight4">Chapter&#xA0;8</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5816</span><span sentence-index="5816" class="highlight2"> ,  but  with  some  additions  mostly  dealing  with        rotation. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">84</span><span sentence-index="5817" class="highlight3"> Here&apos;s  how  we  did  it:</span></span></p><a id="I_programlisting3_id325329"><pre class="programlisting">class RigidBody2D {
public:
    float    fMass;       // total mass (constant)
    float    fInertia;    // mass moment of inertia
    float    fInertiaInverse;   // inverse of mass moment of inertia
    Vector    vPosition;        // position in earth coordinates
    Vector    vVelocity;        // velocity in earth coordinates
    Vector    vVelocityBody;    // velocity in body coordinates
    Vector    vAngularVelocity; // angular velocity in body coordinates

    float    fSpeed;            // speed
    float    fOrientation;      // orientation

    Vector    vForces;          // total force on body
    Vector    vMoment;          // total moment on body

    float    ThrustForce;       // Magnitude of the thrust force
    Vector    PThrust, SThrust; // bow thruster forces

    float    fWidth;            // bounding dimensions
    float    fLength;
    float    fHeight;

    Vector    CD; // location of center of drag in body coordinates
    Vector    CT; // location of center of propeller thrust in body coords.
    Vector    CPT; // location of port bow thruster thrust in body coords.
    Vector    CST; // location of starboard bow thruster thrust in body
                   // coords.

    float    ProjectedArea;     // projected area of the body

    RigidBody2D(void);
    void    CalcLoads(void);
    void    UpdateBodyEuler(double dt);
    void    SetThrusters(bool p, bool s);
    void    ModulateThrust(bool up);
};</pre></a><p><a id="I_programlisting3_id325329"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5820</span><span sentence-index="5820" class="highlight4">The  code  comments  briefly  explain  each  property,  and  so  far  you&apos;ve        seen  all  these  properties  somewhere  in  this  book,  so  we  won&apos;t  explain  them        again  here. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">88</span><span sentence-index="5821" class="highlight2"> That  said,  notice  that  several  of  these  properties  are  the        same  as  those  shown  in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">88</span><span sentence-index="5821" class="highlight3">Particle</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">88</span><span sentence-index="5821" class="highlight4">       class  from  </span></span></a><a class="xref" href="ch08.html" title="Chapter&#xA0;8.&#xA0;Particles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">89</span><span sentence-index="5822" class="highlight2">Chapter&#xA0;8</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5823</span><span sentence-index="5823" class="highlight3"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="5824" class="highlight4"> These  properties  include  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="5824" class="highlight2">fMass</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span>,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="5824" class="highlight4">vPosition</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span>,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="5824" class="highlight2">vVelocity</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span>,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="5824" class="highlight3">fSpeed</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="5824" class="highlight3">,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="5824" class="highlight4">vForces</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="5824" class="highlight2">,  and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="5824" class="highlight3">fRadius</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5824</span><span sentence-index="5824" class="highlight4"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5825</span><span sentence-index="5825" class="highlight2">  All  of  the  other  properties  are  new  and        required  to  handle  the  rotational  motion  aspects  of  rigid  bodies.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span sentence-index="5827" class="highlight3">The  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span sentence-index="5827" class="highlight4">RigidBody2D</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5827</span><span sentence-index="5827" class="highlight2">  constructor  is        straightforward,  as  shown  next,  and  simply  initializes  all  the  properties        to  some  arbitrarily  tuned  values  we  decided  worked  well. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">95</span><span sentence-index="5828" class="highlight3"> In  </span></span><a class="xref" href="ch17.html" title="Chapter&#xA0;17.&#xA0;Cars and Hovercraft"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">96</span><span sentence-index="5829" class="highlight4">Chapter&#xA0;17</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5830</span><span sentence-index="5830" class="highlight2"> ,  you&apos;ll  see  how  we  model  a  more  realistic        hovercraft.</span></span></p><a id="I_programlisting3_id325416"><pre class="programlisting">RigidBody2D::RigidBody2D(void)
{
    fMass = 100;
    fInertia = 500;
    fInertiaInverse = 1/fInertia;
    vPosition.x = 0;
    vPosition.y = 0;
    fWidth = 10;
    fLength = 20;
    fHeight = 5;
    fOrientation = 0;

    CD.x = &#x2212;0.25*fLength;
    CD.y = 0.0f;
    CD.z = 0.0f;

    CT.x = &#x2212;0.5*fLength;
    CT.y = 0.0f;
    CT.z = 0.0f;

    CPT.x = 0.5*fLength;
    CPT.y = &#x2212;0.5*fWidth;
    CPT.z = 0.0f;

    CST.x = 0.5*fLength;
    CST.y = 0.5*fWidth;
    CST.z = 0.0f;

    ProjectedArea = (fLength + fWidth)/2 * fHeight; // an approximation
    ThrustForce = _THRUSTFORCE;
}</pre></a><p><a id="I_programlisting3_id325416"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">101</span><span sentence-index="5834" class="highlight3">As  in  the  particle  simulator  of  </span></span></a><a class="xref" href="ch08.html" title="Chapter&#xA0;8.&#xA0;Particles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">102</span><span sentence-index="5835" class="highlight4">Chapter&#xA0;8</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">102</span><span sentence-index="5835" class="highlight2">,  you&apos;ll        notice  here  that  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">102</span><span sentence-index="5835" class="highlight3">Vector</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">102</span><span sentence-index="5835" class="highlight4"> class  is        actually  a  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">102</span><span sentence-index="5835" class="highlight2">triple</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5836</span><span sentence-index="5836" class="highlight3">  (that  is,  it  has  three        components&#x2014;x,  y,  and  z). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">104</span><span sentence-index="5837" class="highlight4"> Since  this  is  a  2D  example,  the        </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">104</span><span>z</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">104</span><span sentence-index="5837" class="highlight3"> components  will  always  be  0,  except  in  the  case  of        the  angular  velocity  vector  where  only  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">104</span><span sentence-index="5837" class="highlight2">z</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5837</span><span sentence-index="5837" class="highlight4">        component  will  be  used  (since  rotation  occurs  only  about  the  z-axis). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">105</span><span sentence-index="5838" class="highlight2"> The        class  that  we  use  in  this  example  is  discussed  in  </span></span><a class="xref" href="apa.html" title="Appendix&#xA0;A.&#xA0;Vector Operations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">106</span><span sentence-index="5839" class="highlight3">Appendix&#xA0;A</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5840</span><span sentence-index="5840" class="highlight4"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">108</span><span sentence-index="5841" class="highlight2"> The  reason  we  didn&apos;t  write  a  separate  2D        vector  class,  one  with  only  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">108</span><span sentence-index="5841" class="highlight3">x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">108</span><span sentence-index="5841" class="highlight4"> and        </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">108</span><span sentence-index="5841" class="highlight2">y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5841</span><span sentence-index="5841" class="highlight3">  components,  is  because  we&apos;ll  extend  this  code  to  3D        later  and  wanted  to  get  you  accustomed  to  using  the  3D  vector  class. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">109</span><span sentence-index="5842" class="highlight4">       Besides,  it&apos;s  pretty  easy  to  create  a  2D  vector  class  from  the  3D  class  by        simply  stripping  out  the  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">109</span><span sentence-index="5842" class="highlight2">z</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5842</span><span sentence-index="5842" class="highlight3">  component.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">111</span><span sentence-index="5844" class="highlight4">As  with  the  particle  example  of  </span></span><a class="xref" href="ch08.html" title="Chapter&#xA0;8.&#xA0;Particles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">112</span><span sentence-index="5845" class="highlight2">Chapter&#xA0;8</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">112</span><span sentence-index="5845" class="highlight3">,  we        need  a  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">112</span><span sentence-index="5845" class="highlight4">CalcLoads</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5846</span><span sentence-index="5846" class="highlight2">  method  for  the  rigid        body. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5847</span><span sentence-index="5847" class="highlight3">  As  before,  this  method  will  compute  all  the  loads  acting  on  the        rigid  body,  but  now  these  loads  include  both  forces  and  moments  that  will        cause  rotation. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">115</span><span sentence-index="5848" class="highlight4"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">115</span><span sentence-index="5848" class="highlight2">CalcLoads</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">115</span><span sentence-index="5848" class="highlight3"> looks  like        this:</span></span></p><a id="I_programlisting3_id325495"><pre class="programlisting">void    RigidBody2D::CalcLoads(void)
{
    Vector    Fb;        // stores the sum of forces
    Vector    Mb;        // stores the sum of moments
    Vector    Thrust;    // thrust vector

    // reset forces and moments:
    vForces.x = 0.0f;
    vForces.y = 0.0f;
    vForces.z = 0.0f;    // always zero in 2D

    vMoment.x = 0.0f;    // always zero in 2D
    vMoment.y = 0.0f;    // always zero in 2D
    vMoment.z = 0.0f;

    Fb.x = 0.0f;
    Fb.y = 0.0f;
    Fb.z = 0.0f;

    Mb.x = 0.0f;
    Mb.y = 0.0f;
    Mb.z = 0.0f;

    // Define the thrust vector, which acts through the craft&apos;s CG
    Thrust.x = 1.0f;
    Thrust.y = 0.0f;
    Thrust.z = 0.0f;     // zero in 2D
    Thrust *= ThrustForce;

    // Calculate forces and moments in body space:
    Vector   vLocalVelocity;
    float    fLocalSpeed;
    Vector   vDragVector;
    float    tmp;
    Vector   vResultant;
    Vector   vtmp;

    // Calculate the aerodynamic drag force:
        // Calculate local velocity:
        // The local velocity includes the velocity due to
        // linear motion of the craft,
        // plus the velocity at each element
        // due to the rotation of the craft.

        vtmp = vAngularVelocity^CD; // rotational part
        vLocalVelocity = vVelocityBody + vtmp;

        // Calculate local air speed
        fLocalSpeed = vLocalVelocity.Magnitude();

        // Find the direction in which drag will act.
        // Drag always acts in line with the relative
        // velocity but in the opposing direction
        if(fLocalSpeed &gt; tol)
        {
            vLocalVelocity.Normalize();
            vDragVector = -vLocalVelocity;

            // Determine the resultant force on the element.
            tmp = 0.5f * rho * fLocalSpeed*fLocalSpeed
                         * ProjectedArea;
            vResultant = vDragVector * _LINEARDRAGCOEFFICIENT * tmp;

            // Keep a running total of these resultant forces
            Fb += vResultant;

            // Calculate the moment about the CG
            // and keep a running total of these moments

            vtmp = CD^vResultant;
            Mb += vtmp;
        }

        // Calculate the Port &amp; Starboard bow thruster forces:
        // Keep a running total of these resultant forces

        Fb += PThrust;


        // Calculate the moment about the CG of this element&apos;s force
        // and keep a running total of these moments (total moment)
        vtmp = CPT^PThrust;
        Mb += vtmp;

        // Keep a running total of these resultant forces (total force)
        Fb += SThrust;

        // Calculate the moment about the CG of this element&apos;s force
        // and keep a running total of these moments (total moment)
        vtmp = CST^SThrust;
        Mb += vtmp;

    // Now add the propulsion thrust
    Fb += Thrust; // no moment since line of action is through CG

    // Convert forces from model space to earth space
    vForces = VRotate2D(fOrientation, Fb);

    vMoment += Mb;
}</pre></a><p><a id="I_programlisting3_id325495"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">118</span><span sentence-index="5851" class="highlight4">The  first  thing  that  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">118</span><span sentence-index="5851" class="highlight2">CalcLoads</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5851</span><span sentence-index="5851" class="highlight3">        does  is  initialize  the  force  and  moment  variables  that  will  contain  the        total  of  all  forces  and  moments  acting  on  the  craft  at  any  instant  in        time. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5852</span><span sentence-index="5852" class="highlight4">  Just  as  we  must  aggregate  forces,  we  must  also  aggregate  moments. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">120</span><span sentence-index="5853" class="highlight2">       The  forces  will  be  used  along  with  the  linear  equation  of  motion  to        compute  the  linear  displacement  of  the  rigid  body,  while  the  moments  will        be  used  with  the  angular  equation  of  motion  to  compute  </span></span></a><a id="I_indexterm3_id325538" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5854</span><span sentence-index="5854" class="highlight3">the  orientation  of  the  body.</span></span></a></p><p><a id="I_indexterm3_id325538" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">124</span><span sentence-index="5857" class="highlight4">The  function  then  goes  on  to  define  a  vector  representing  the        propeller  thrust,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">124</span><span sentence-index="5857" class="highlight2">Thrust</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5857</span><span sentence-index="5857" class="highlight3"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">125</span><span sentence-index="5858" class="highlight4"> The  propeller        thrust  vector  acts  in  the  positive  (local)  x-direction  and  has  a  magnitude        defined  by  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">125</span><span sentence-index="5858" class="highlight2">ThrustForce</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5858</span><span sentence-index="5858" class="highlight3"> ,  which  the  user        sets  via  the  keyboard  interface  (we&apos;ll  get  to  that  later). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">126</span><span sentence-index="5859" class="highlight4"> Note  that  if        </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">126</span><span sentence-index="5859" class="highlight2">ThrustForce</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5859</span><span sentence-index="5859" class="highlight3">  is  negative,  then  the        thrust  will  actually  be  a  reversing  thrust  instead  of  a  forward        thrust.</span></span></a></p><p><a id="I_indexterm3_id325538" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5862</span><span sentence-index="5862" class="highlight4">After  defining  the  thrust  vector,  this  function  goes  on  to  calculate        the  aerodynamic  drag  acting  on  the  hovercraft. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">130</span><span sentence-index="5863" class="highlight2"> These  calculations  are  very        similar  to  those  discussed  in  </span></span></a><a class="xref" href="ch17.html" title="Chapter&#xA0;17.&#xA0;Cars and Hovercraft"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">131</span><span sentence-index="5864" class="highlight3">Chapter&#xA0;17</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5865</span><span sentence-index="5865" class="highlight4"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5866</span><span sentence-index="5866" class="highlight2">  The        first  thing  to  do  is  determine  the  relative  velocity  at  the  center  of        drag,  considering  both  linear  and  angular  motion. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5867</span><span sentence-index="5867" class="highlight3">  You&apos;ll  need  the        magnitude  of  the  relative  velocity  vector  when  calculating  the  magnitude        of  the  drag  force,  and  you&apos;ll  need  the  direction  of  the  relative  velocity        vector  to  determine  the  direction  of  the  drag  force  since  it  always        opposes  the  velocity  vector. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">135</span><span sentence-index="5868" class="highlight4"> The  line  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">135</span><span sentence-index="5868" class="highlight2">vtmp  =        vAngularVelocity^CD</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">135</span><span sentence-index="5868" class="highlight3"> computes  the  linear  velocity  at  the  drag        center  by  taking  the  vector  cross  product  of  the  angular  velocity  vector        with  the  position  vector  of  the  drag  center,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">135</span><span sentence-index="5868" class="highlight4">CD</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5868</span><span sentence-index="5868" class="highlight2"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">136</span><span sentence-index="5869" class="highlight3"> The  result  is  stored  in  a  temporary  vector,        </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">136</span><span sentence-index="5869" class="highlight4">vtmp</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">136</span><span sentence-index="5869" class="highlight2">,  and  then  added  vectorially  to  the        body  velocity  vector,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">136</span><span sentence-index="5869" class="highlight3">vVelocityBody</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5869</span><span sentence-index="5869" class="highlight4"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">137</span><span sentence-index="5870" class="highlight2">       The  result  of  this  vector  addition  is  a  velocity  vector  representing  the        velocity  of  the  point  defined  by  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">137</span><span sentence-index="5870" class="highlight3">CD</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5870</span><span sentence-index="5870" class="highlight4"> ,        including  contributions  from  the  body&apos;s  linear  and  angular  motion. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5871</span><span sentence-index="5871" class="highlight2">  We        compute  the  actual  drag  force,  which  acts  in  line  with  but  in  a  direction        opposing  the  velocity  vector,  in  a  manner  similar  to  that  for  particles,        using  a  simple  formula  relating  the  drag  force  to  the  speed  squared,        density  of  air,  projected  area,  and  a  drag  coefficient. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="5872" class="highlight3"> The  following  code        performs  this  calculation:</span></span></p><a id="I_programlisting3_id325624"><pre class="programlisting">            vLocalVelocity.Normalize();
            vDragVector = -vLocalVelocity;

            // Determine the resultant force on the element.
            tmp = 0.5f * rho * fLocalSpeed*fLocalSpeed
                         * ProjectedArea;
            vResultant = vDragVector * _LINEARDRAGCOEFFICIENT * tmp;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">141</span><span sentence-index="5874" class="highlight4 nonQuoteStr">Note  that  the  drag  coefficient,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">141</span><span sentence-index="5874" class="highlight2 nonQuoteStr">LINEARDRAGCOEFFICIENT</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">141</span><span sentence-index="5874" class="highlight3 nonQuoteStr">,  is  defined  as        follows:</span></span></p></a><a id="I_programlisting3_id325642"><pre class="programlisting">#define LINEARDRAGCOEFFICIENT     1.25f</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">143</span><span sentence-index="5876" class="highlight4 nonQuoteStr">Once  the  drag  force  is  determined,  it  gets  aggregated  in  the  total        force  vector  as  follows:</span></span></p></a><a id="I_programlisting3_id325653"><pre class="programlisting">              Fb += vResultant;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">145</span><span sentence-index="5878" class="highlight2">In  addition  to  aggregating  this  force,  we  must  aggregate  the  moment        due  to  that  force  in  the  total  moment  vector  as  follows:</span></span></p></a><a id="I_programlisting3_id325664"><pre class="programlisting">              vtmp = CD^vResultant;
              Mb += vtmp;</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5880</span><span sentence-index="5880" class="highlight3">The  first  line  computes  the  moment  due  to  the  drag  force  by  taking        the  vector  cross  product  of  the  position  vector,  to  the  center  of  drag,        with  the  drag  force  vector. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5881</span><span sentence-index="5881" class="highlight4">  The  second  line  adds  this  force  to  the        variable,  accumulating  these  moments.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">150</span><span sentence-index="5883" class="highlight2">With  the  drag  calculation  complete,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">150</span><span sentence-index="5883" class="highlight3">CalcLoads</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5883</span><span sentence-index="5883" class="highlight4">  proceeds  to  calculate  the  forces  and        moments  due  to  the  bow  thrusters,  which  may  be  active  or  inactive  at  any        given  time.</span></span></p></a><a id="I_programlisting3_id325687"><pre class="programlisting">        Fb += PThrust;

        vtmp = CPT^PThrust;
        Mb += vtmp;</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="5886" class="highlight2">The  first  line  aggregates  the  port  bow  thruster  force  into  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="5886" class="highlight3">Fb</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5886</span><span sentence-index="5886" class="highlight4"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">154</span><span sentence-index="5887" class="highlight2"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">154</span><span sentence-index="5887" class="highlight3">PThrust</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">154</span><span sentence-index="5887" class="highlight4">       is  a  force  vector  computed  in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">154</span><span sentence-index="5887" class="highlight2">SetThrusters</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5887</span><span sentence-index="5887" class="highlight3">  method  in  response  to  your  keyboard        input. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5888</span><span sentence-index="5888" class="highlight4">  The  next  two  lines  compute  and  aggregate  the  moment  due  to  the        thruster  force. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5889</span><span sentence-index="5889" class="highlight2">  A  similar  set  of  code  lines  follows,  computing  the  force        and  moment  due  to  the  starboard  bow  thruster.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5891</span><span sentence-index="5891" class="highlight3">Next,  the  propeller  thrust  force  is  added  to  the  running  total  of        forces. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5892</span><span sentence-index="5892" class="highlight4">  Remember,  since  the  propeller  thrust  force  acts  through  the  center        of  gravity,  there  is  no  moment  to  worry  about. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">160</span><span sentence-index="5893" class="highlight2"> Thus,  all  we  need        is:</span></span></p></a><a id="I_programlisting3_id325723"><pre class="programlisting">    Fb += Thrust; // no moment since line of action is through CG</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5895</span><span sentence-index="5895" class="highlight3">Finally,  the  total  force  is  transformed  from  local  coordinates  to        world  coordinates  via  a  vector  rotation  given  the  orientation  of  the        hovercraft,  and  the  total  forces  and  moments  are  stored  so  they  are        available  when  it  comes  time  to  integrate  the  equations  of  motion  at  each        time  step.</span></span></p></a><p><a id="I_programlisting3_id325723"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5898</span><span sentence-index="5898" class="highlight4">As  you  can  see,  computing  loads  on  a  rigid  body  is  a  bit  more        complex  than  what  you  saw  earlier  when  dealing  with  particles. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5899</span><span sentence-index="5899" class="highlight2">  This,  of        course,  is  due  to  the  nature  of  rigid  bodies  being  able  to  rotate. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">167</span><span sentence-index="5900" class="highlight3"> What&apos;s        nice,  though,  is  that  all  this  new  complexity  is  encapsulated  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">167</span><span sentence-index="5900" class="highlight4">CalcLoads</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">167</span><span sentence-index="5900" class="highlight2">,  and  the  rest  of  the  simulator  is        pretty  much  the  same  as  when  we&apos;re  dealing  with  </span></span></a><a id="I_indexterm3_id325747" class="indexterm"></a><a id="I_indexterm3_id325756" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5902</span><span sentence-index="5902" class="highlight3">particles.</span></span></a></p><div class="sect2" title="Transforming Coordinates"><div class="titlepage"><div><div><h3 class="title" id="transforming_coordinates"><a id="I_indexterm3_id325756" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">172</span><span sentence-index="5905" class="highlight4">Transforming  Coordinates</span></span></a></h3></div></div></div><p><a id="I_indexterm3_id325756" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">174</span><span sentence-index="5907" class="highlight2">Let&apos;s  talk  about  </span></span></a><a id="I_indexterm3_id325781" class="indexterm"></a><a id="I_indexterm3_id325788" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5909</span><span sentence-index="5909" class="highlight3">transformation  from  local  to  world  coordinates  a  bit  more            since  you&apos;ll  see  this  sort  of  transform  again  in  a  few  places. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5910</span><span sentence-index="5910" class="highlight4">  When            computing  forces  acting  on  the  rigid  body,  we  want  those  forces  in  a            vector  form  relative  to  the  coordinates  that  are  fixed  with  respect  to            the  hovercraft  (e.g.,  relative  to  the  body&apos;s  center  of  gravity  with  the            x-axis  pointing  toward  the  front  of  the  body  and  the  y-axis  pointing            toward  the  starboard  side). </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5911</span><span sentence-index="5911" class="highlight2">  This  simplifies  our  calculations  of  forces            and  moments. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="5912" class="highlight3"> However,  when  integrating  the  equation  of  motion  to  see  how            the  body  translates  in  world  coordinates,  we  use  the  </span></span></a><a id="I_indexterm3_id325801" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5913</span><span sentence-index="5913" class="highlight4">equations  of  motion  in  world  coordinates,  requiring  us  to            represent  the  aggregate  force  in  world  coordinates. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">181</span><span sentence-index="5914" class="highlight2"> That&apos;s  why  we            rotated  the  aggregate  force  at  the  end  of  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">181</span><span sentence-index="5914" class="highlight3">CalcLoads</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5914</span><span sentence-index="5914" class="highlight4">  method.</span></span></a></p><p><a id="I_indexterm3_id325801" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="5917" class="highlight2">In  two  dimensions,  the  coordinate  transformation  involves  a  little            trigonometry  as  shown  in  the  following  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="5917" class="highlight3">VRotate2D</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="5917" class="highlight4"> function:</span></span></a></p><a id="I_programlisting3_id325835"><pre class="programlisting">Vector    VRotate2D( float angle, Vector u)
{
    float    x,y;

    x = u.x * cos(DegreesToRadians(-angle)) +
        u.y * sin(DegreesToRadians(-angle));
    y = -u.x * sin(DegreesToRadians(-angle)) +
        u.y * cos(DegreesToRadians(-angle));

    return Vector( x, y, 0);
}</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5919</span><span sentence-index="5919" class="highlight2">The  angle  here  represents  the  orientation  of  the  local,  body  fixed            coordinate  system  with  respect  to  the  world  coordinate  system. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5920</span><span sentence-index="5920" class="highlight3">  When            converting  from  local  coordinates  to  world  coordinates,  use  a  positive            angle;  use  a  negative  angle  when  going  the  other  way. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5921</span><span sentence-index="5921" class="highlight4">  This  is  just  the            convention  we&apos;ve  adopted  so  transformations  from  local  coordinates  to            world  coordinates  are  positive. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">189</span><span sentence-index="5922" class="highlight2"> You  can  see  we  actually  take  the            negative  of  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">189</span><span sentence-index="5922" class="highlight3">angle</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5922</span><span sentence-index="5922" class="highlight4">  parameter,  so            in  reality  you  could  do  away  with  that  negative,  and  then            transformations  from  local  coordinates  to  world  coordinates  would            actually  be  negative. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5923</span><span sentence-index="5923" class="highlight2">  It&apos;s  your  preference. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5924</span><span sentence-index="5924" class="highlight3">  You&apos;ll  see  this  function            used  a  few  more  times  in  different  situations  before  the  end  of  this            chapter.</span></span></p></a></div><div class="sect2" title="Integrator"><div class="titlepage"><div><div><h3 class="title" id="integrator-id1"><a id="I_programlisting3_id325835"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">194</span><span sentence-index="5927" class="highlight4">Integrator</span></span></a></h3></div></div></div><p><a id="I_programlisting3_id325835"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="5929" class="highlight2">The  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="5929" class="highlight3">UpdateBodyEuler</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">196</span><span sentence-index="5929" class="highlight4"> method            </span></span></a><a id="tw9.1.2" class="indexterm"></a><a id="in9.1.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5931</span><span sentence-index="5931" class="highlight2">actually  integrates  the  equations  of  motion  for  the  rigid            body. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5932</span><span sentence-index="5932" class="highlight3">  Since  we&apos;re  dealing  with  a  rigid  body,  unlike  a  particle,  we  have            two  equations  of  motion:  one  for  translation,  and  the  other  for            rotation. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5933" class="highlight4"> The  following  code  sample  shows  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">200</span><span sentence-index="5933" class="highlight2">UpdateBodyEuler</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5933</span><span sentence-index="5933" class="highlight3"> .</span></span></a></p><a id="I_programlisting3_id325922"><pre class="programlisting">void    RigidBody2D::UpdateBodyEuler(double dt)
{
        Vector a;
        Vector dv;
        Vector ds;
        float  aa;
        float  dav;
        float  dr;

        // Calculate forces and moments:
        CalcLoads();

        // Integrate linear equation of motion:
        a = vForces / fMass;

        dv = a * dt;
        vVelocity += dv;

        ds = vVelocity * dt;
        vPosition += ds;

        // Integrate angular equation of motion:
        aa = vMoment.z / fInertia;

        dav = aa * dt;

        vAngularVelocity.z += dav;

        dr = RadiansToDegrees(vAngularVelocity.z * dt);
        fOrientation += dr;

        // Misc. calculations:
        fSpeed = vVelocity.Magnitude();
        vVelocityBody = VRotate2D(-fOrientation, vVelocity);
}</pre></a><p><a id="I_programlisting3_id325922"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">204</span><span sentence-index="5937" class="highlight4">As  the  name  of  this  method  implies,  we&apos;ve  implemented  Euler&apos;s            </span></span></a><a id="I_indexterm3_id325937" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">205</span><span sentence-index="5938" class="highlight2">method  of  integration  as  described  in  </span></span></a><a class="xref" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Real-Time Simulations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">207</span><span sentence-index="5940" class="highlight3">Chapter&#xA0;7</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5940</span><span sentence-index="5940" class="highlight4"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5941</span><span sentence-index="5941" class="highlight2">  Integrating  the  linear  equation  of            motion  for  a  rigid  body  follows  exactly  the  same  steps  we  used  for            integrating  the  linear  equation  of  motion  for  particles. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5942</span><span sentence-index="5942" class="highlight3">  All  that&apos;s            required  is  to  divide  the  aggregate  forces  acting  on  a  body  by  the  mass            of  the  body  to  get  the  body&apos;s  acceleration. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">210</span><span sentence-index="5943" class="highlight4"> The  line  of  code  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">210</span><span sentence-index="5943" class="highlight2">a  =  vForces  /  fMass</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5943</span><span sentence-index="5943" class="highlight3">  does  just  this. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">211</span><span sentence-index="5944" class="highlight4"> Notice            here  that  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">211</span><span sentence-index="5944" class="highlight2">a</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">211</span><span sentence-index="5944" class="highlight3"> is  a  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">211</span><span sentence-index="5944" class="highlight4">Vector</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">211</span><span sentence-index="5944" class="highlight2">,  as  is  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">211</span><span sentence-index="5944" class="highlight3">vForces</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5944</span><span sentence-index="5944" class="highlight4"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5945" class="highlight2"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span>fMass</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5945" class="highlight4"> is  a  scalar,  and  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5945" class="highlight2">/</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5945" class="highlight3"> operator  defined  in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5945" class="highlight4">Vector</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5945" class="highlight2"> class  takes  care  of  dividing  each            component  of  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5945" class="highlight3">vForces</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5945" class="highlight4"> vector  by            </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5945" class="highlight3">fMass</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5945" class="highlight2"> and  setting  the  corresponding            components  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="5945" class="highlight3">a</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5945</span><span sentence-index="5945" class="highlight4"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">213</span><span sentence-index="5946" class="highlight2"> The  change  in            velocity,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">213</span><span sentence-index="5946" class="highlight3">dv</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">213</span><span sentence-index="5946" class="highlight4">,  is  equal  to            acceleration  times  the  change  in  time,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">213</span><span sentence-index="5946" class="highlight2">dt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5946</span><span sentence-index="5946" class="highlight3"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">214</span><span sentence-index="5947" class="highlight4"> The  body&apos;s  new  velocity  is  then  computed            by  the  line  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">214</span><span sentence-index="5947" class="highlight2">vVelocity  +=  dv</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5947</span><span sentence-index="5947" class="highlight3"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="5948" class="highlight4"> Here            again,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="5948" class="highlight2">vVelocity</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="5948" class="highlight3"> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="5948" class="highlight4">dv</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="5948" class="highlight2"> are  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="5948" class="highlight3">Vector</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="5948" class="highlight4">s  and  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="5948" class="highlight2">+=</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5948</span><span sentence-index="5948" class="highlight3">  operator  takes  care  of  the  vector            arithmetic. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5949</span><span sentence-index="5949" class="highlight4">  This  is  the  first  actual  integration  for  translation.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5951</span><span sentence-index="5951" class="highlight2">The  second  integration  takes  place  in  the  next  few  lines,  where  we            determine  the  body&apos;s  displacement  and  new  position  by  integrating  its            velocity. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">219</span><span sentence-index="5952" class="highlight3"> The  line  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">219</span><span sentence-index="5952" class="highlight4">ds  =  vVelocity  *            dt</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">219</span><span sentence-index="5952" class="highlight2"> determines  the  displacement,  or  change  in  the  body&apos;s            position,  and  the  line  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">219</span><span sentence-index="5952" class="highlight3">vPosition  +=            ds</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5952</span><span sentence-index="5952" class="highlight4">  computes  the  new  position  by  adding  the  displacement  to  the            body&apos;s  old  position. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5953</span><span sentence-index="5953" class="highlight2">  That&apos;s  it  for  translation.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">222</span><span sentence-index="5955" class="highlight3">The  next  order  of  business  is  to  integrate  the  angular  equation  of            motion  to  find  the  body&apos;s  </span></span><a id="I_indexterm3_id326087" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5956</span><span sentence-index="5956" class="highlight4">new  orientation. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">224</span><span sentence-index="5957" class="highlight2"> The  line  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">224</span><span sentence-index="5957" class="highlight3">aa  =            vMoment.z  /  fInertia;</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5957</span><span sentence-index="5957" class="highlight4">  computes  the  body&apos;s  angular  acceleration            by  dividing  the  aggregate  moment  acting  on  the  body  by  its  mass  moment            of  inertia. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">225</span><span sentence-index="5958" class="highlight2"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">225</span><span sentence-index="5958" class="highlight3">aa</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">225</span><span sentence-index="5958" class="highlight4"> is  a  scalar,  as  is            </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">225</span><span sentence-index="5958" class="highlight2">fInertia</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5958</span><span sentence-index="5958" class="highlight3">  since  this  is  a  2D  problem. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">226</span><span sentence-index="5959" class="highlight4">           In  3D,  things  are  a  bit  more  complicated,  and  we&apos;ll  get  to  that  in  </span></span></a><a class="xref" href="ch11.html" title="Chapter&#xA0;11.&#xA0;Rotation in 3D Rigid-Body Simulators"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">227</span><span sentence-index="5960" class="highlight2">Chapter&#xA0;11</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5961</span><span sentence-index="5961" class="highlight3"> .</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">230</span><span sentence-index="5963" class="highlight4">We  compute  the  change  in  angular  velocity,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">230</span><span sentence-index="5963" class="highlight2">dav</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">230</span><span sentence-index="5963" class="highlight3">,  a  scalar,  by  multiplying  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">230</span><span sentence-index="5963" class="highlight4">aa</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">230</span><span sentence-index="5963" class="highlight2"> by  the  time  step  size,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">230</span><span sentence-index="5963" class="highlight3">dt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5963</span><span sentence-index="5963" class="highlight4"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">231</span><span sentence-index="5964" class="highlight2"> The  new  angular  velocity  is  simply  the  old            velocity  plus  the  change:  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">231</span><span sentence-index="5964" class="highlight3">vAngularVelocity.z  +=            dav</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5964</span><span sentence-index="5964" class="highlight4"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="5965" class="highlight2"> The  change  in  orientation  is  equal  to  the  new  angular            velocity  multiplied  by  the  time  step:  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="5965" class="highlight3">vAngularVelocity.z  *  dt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5965</span><span sentence-index="5965" class="highlight4"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5966</span><span sentence-index="5966" class="highlight2">  Notice  that  we            convert  the  change  in  orientation  from  radians  to  degrees  here  since            we&apos;re  keeping  track  of  orientation  in  degrees. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5967</span><span sentence-index="5967" class="highlight3">  You  don&apos;t  really  have  to,            so  long  as  you&apos;re  consistent.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">236</span><span sentence-index="5969" class="highlight4">The  last  line  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">236</span><span sentence-index="5969" class="highlight2">UpdateBodyEuler</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5969</span><span sentence-index="5969" class="highlight3">  computes  the  body&apos;s  linear            speed  by  transforming  the  magnitude  of  its  velocity  vector  to  local,            body  coordinates. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">237</span><span sentence-index="5970" class="highlight4"> Recall  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">237</span><span sentence-index="5970" class="highlight2">CalcLoads</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">237</span><span sentence-index="5970" class="highlight3">           that  we  require  the  body&apos;s  velocity  in  body-fixed  coordinates  in  order            to  compute  the  </span></span><a id="I_indexterm3_id326176" class="indexterm"></a><a id="I_indexterm3_id326186" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5972</span><span sentence-index="5972" class="highlight4">drag  force  on  the  body.</span></span></a></p></div><div class="sect2" title="Rendering"><div class="titlepage"><div><div><h3 class="title" id="rendering-id1"><a id="I_indexterm3_id326186" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">242</span><span sentence-index="5975" class="highlight2">Rendering</span></span></a></h3></div></div></div><p><a id="I_indexterm3_id326186" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">244</span><span sentence-index="5977" class="highlight3">In  this  simple  example,  rendering  the  </span></span></a><a id="I_indexterm3_id326210" class="indexterm"></a><a id="I_indexterm3_id326223" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">246</span><span sentence-index="5979" class="highlight4">virtual  hovercraft  is  just  a  little  more  involved  than            rendering  the  particles  in  the  example  from  </span></span></a><a class="xref" href="ch08.html" title="Chapter&#xA0;8.&#xA0;Particles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">247</span><span sentence-index="5980" class="highlight2">Chapter&#xA0;8</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5981</span><span sentence-index="5981" class="highlight3"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5982</span><span sentence-index="5982" class="highlight4">  All  we  do  is  draw  a  few  connected  lines  using            Windows  API  calls  wrapped  in  our  own  functions  to  hide  some  of  the            Windows-specific  code. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">250</span><span sentence-index="5983" class="highlight2"> The  following  code  snippet  is  all  we  need  to            render  the  hovercraft:</span></span></p><a id="I_programlisting3_id326245"><pre class="programlisting">void    DrawCraft(RigidBody2D    craft, COLORREF clr)
{
    Vector    vList[5];
    double    wd, lg;
    int       i;
    Vector    v1;

    wd = craft.fWidth;
    lg = craft.fLength;
    vList[0].x = lg/2;     vList[0].y = wd/2;
    vList[1].x = -lg/2;    vList[1].y = wd/2;
    vList[2].x = -lg/2;    vList[2].y = -wd/2;
    vList[3].x = lg/2;     vList[3].y = -wd/2;
    vList[4].x = lg/2*1.5; vList[4].y = 0;
    for(i=0; i&lt;5; i++)
    {
        v1 = VRotate2D(craft.fOrientation, vList[i]);
        vList[i] = v1 + craft.vPosition;
    }

    DrawLine(vList[0].x, vList[0].y, vList[1].x, vList[1].y, 2, clr);
    DrawLine(vList[1].x, vList[1].y, vList[2].x, vList[2].y, 2, clr);
    DrawLine(vList[2].x, vList[2].y, vList[3].x, vList[3].y, 2, clr);
    DrawLine(vList[3].x, vList[3].y, vList[4].x, vList[4].y, 2, clr);
    DrawLine(vList[4].x, vList[4].y, vList[0].x, vList[0].y, 2, clr);
}</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5985</span><span sentence-index="5985" class="highlight3">You  can  use  your  own  rendering  code  here,  of  course,  and  all  you            really  need  to  pay  close  attention  to  is  transforming  the  coordinates            for  the  outline  of  the  hovercraft  from  body  to  world  coordinates. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">253</span><span sentence-index="5986" class="highlight4"> This            involves  rotating  the  vertex  coordinates  from  body-fixed  space  using  the            </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">253</span><span sentence-index="5986" class="highlight2">VRotate2D</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5986</span><span sentence-index="5986" class="highlight3">  function  and  then  adding            the  position  of  the  center  of  gravity  of  the  hovercraft  to  each            transformed  vertex. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="5987" class="highlight4"> These  lines  take  care  of  this  coordinate            transformation:</span></span></p></a><a id="I_programlisting3_id326272"><pre class="programlisting">    for(i=0; i&lt;5; i++)
    {
        v1 = VRotate2D(craft.fOrientation, vList[i]);
        vList[i] = v1 + craft.vPosition;
    }</pre></a></div></div><div class="sect1" title="The Basic Simulator"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="the_basic_simulator-id1"><a id="I_programlisting3_id326272"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">257</span><span sentence-index="5990" class="highlight2">The  Basic  Simulator</span></span></a></h2></div></div></div><p><a id="I_programlisting3_id326272"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">259</span><span sentence-index="5992" class="highlight3">The  heart  of  this</span></span></a><a id="tw9.2" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">260</span><span sentence-index="5993" class="highlight4"> simulation  is  handled  by  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">260</span><span sentence-index="5993" class="highlight2">RigidBody2D</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5994</span><span sentence-index="5994" class="highlight3">  class  described  earlier. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5995</span><span sentence-index="5995" class="highlight4">  However,  we        need  to  show  you  how  that  class  is  used  in  the  context  of  the  main        program. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="5996" class="highlight2"> This  simulator  is  very  similar  to  that  shown  in  </span></span></a><a class="xref" href="ch08.html" title="Chapter&#xA0;8.&#xA0;Particles"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">264</span><span sentence-index="5997" class="highlight3">Chapter&#xA0;8</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">5998</span><span sentence-index="5998" class="highlight4">  for  particles,  so  if  you&apos;ve  read  that  chapter        already  you  can  breeze  through  this  section.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">267</span><span sentence-index="6000" class="highlight2">First,  we  define  a  few  global  variables  as  follows:</span></span></p><a id="I_programlisting3_id326327"><pre class="programlisting">// Global Variables:
int            FrameCounter = 0;
RigidBody2D    Craft;</pre><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">269</span><span sentence-index="6002" class="highlight3">FrameCounter</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6002</span><span sentence-index="6002" class="highlight4">  counts  the  number  of        time  steps  integrated  before  the  graphics  display  is  updated. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6003</span><span sentence-index="6003" class="highlight2">  How  many        time  steps  you  allow  the  simulation  to  integrate  before  updating  the        display  is  a  matter  of  tuning. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">271</span><span sentence-index="6004" class="highlight3"> You&apos;ll  see  how  this  is  used  momentarily        when  we  discuss  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">271</span><span sentence-index="6004" class="highlight4">UpdateSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6004</span><span sentence-index="6004" class="highlight2">        function. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">272</span><span sentence-index="6005" class="highlight3"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">272</span><span sentence-index="6005" class="highlight4">Craft</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">272</span><span sentence-index="6005" class="highlight2"> is  a  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">272</span><span sentence-index="6005" class="highlight3">RigidBody2D</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6005</span><span sentence-index="6005" class="highlight4">  type  that  will  represent  our  virtual        hovercraft.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="6007" class="highlight2">For  the  most  part,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="6007" class="highlight3">Craft</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="6007" class="highlight4"> is        initialized  in  accordance  with  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">274</span><span sentence-index="6007" class="highlight2">RigidBody2D</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6007</span><span sentence-index="6007" class="highlight3">  constructor  shown  earlier. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">275</span><span sentence-index="6008" class="highlight4"> However,        its  position  is  at  the  origin,  so  we  make  a  call  to  the  following  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">275</span><span sentence-index="6008" class="highlight2">Initialize</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">275</span><span sentence-index="6008" class="highlight3"> function  to  locate  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">275</span><span sentence-index="6008" class="highlight4">Craft</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6008</span><span sentence-index="6008" class="highlight2">  in  the  middle  of  the  screen  vertically  and        on  the  left  side. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">276</span><span sentence-index="6009" class="highlight3"> We  set  its  orientation  to  0  degrees  so  it  points  toward        the  right  side  of  the  screen:</span></span></p></a><a id="I_programlisting3_id326391"><pre class="programlisting">bool    Initialize(void)
{
    Craft.vPosition.x = _WINWIDTH/10;
    Craft.vPosition.y = _WINHEIGHT/2;
    Craft.fOrientation = 0;

    return true;
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">278</span><span sentence-index="6011" class="highlight4">OK,  now  let&apos;s  consider  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">278</span><span sentence-index="6011" class="highlight2">UpdateSimulation</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6011</span><span sentence-index="6011" class="highlight3">  as  shown  in  the  code  snippet        below. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6012</span><span sentence-index="6012" class="highlight4">  This  function  gets  called  every  cycle  through  the  program&apos;s  main        message  loop  and  is  responsible  for  making  appropriate  function  calls  to        update  the  hovercraft&apos;s  position  and  orientation,  as  well  as  rendering  the        scene. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span sentence-index="6013" class="highlight2"> It  also  checks  the  states  of  the  keyboard  arrow  keys  and  makes        appropriate  function  calls:</span></span></p></a><a id="I_programlisting3_id326411"><pre class="programlisting">void    UpdateSimulation(void)
{
    double  dt = _TIMESTEP;
    RECT    r;

    Craft.SetThrusters(false, false);

    if (IsKeyDown(VK_UP))
        Craft.ModulateThrust(true);

    if (IsKeyDown(VK_DOWN))
        Craft.ModulateThrust(false);

    if (IsKeyDown(VK_RIGHT))
        Craft.SetThrusters(true, false);

    if (IsKeyDown(VK_LEFT))
        Craft.SetThrusters(false, true);

    // update the simulation
    Craft.UpdateBodyEuler(dt);

    if(FrameCounter &gt;= _RENDER_FRAME_COUNT)
    {
        // update the display
        ClearBackBuffer();

        DrawCraft(Craft, RGB(0,0,255));

        CopyBackBufferToWindow();
        FrameCounter = 0;
    } else
        FrameCounter++;

    if(Craft.vPosition.x &gt; _WINWIDTH) Craft.vPosition.x = 0;
    if(Craft.vPosition.x &lt; 0) Craft.vPosition.x = _WINWIDTH;
    if(Craft.vPosition.y &gt; _WINHEIGHT) Craft.vPosition.y = 0;
    if(Craft.vPosition.y &lt; 0) Craft.vPosition.y = _WINHEIGHT;
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">282</span><span sentence-index="6015" class="highlight3">The  local  variable  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">282</span><span sentence-index="6015" class="highlight4">dt</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6015</span><span sentence-index="6015" class="highlight2">  represents        the  small  yet  finite  amount  of  time,  in  seconds,  over  which  each        integration  step  is  taken. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6016" class="highlight3"> The  global  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6016" class="highlight4">define        _TIMESTEP</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6016</span><span sentence-index="6016" class="highlight2">  stores  the  time  step,  which  we  have  set  to  0.001        seconds. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6017</span><span sentence-index="6017" class="highlight3">  This  value  is  subject  to  tuning.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">286</span><span sentence-index="6019" class="highlight4">The  first  action  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">286</span><span sentence-index="6019" class="highlight2">UpdateSimulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">286</span><span sentence-index="6019" class="highlight3">       takes  is  to  reset  the  states  of  the  bow  thrusters  to  inactive  by  calling        the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">286</span><span sentence-index="6019" class="highlight4">SetThrusters</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">286</span><span sentence-index="6019" class="highlight2"> method  as        follows:</span></span></p></a><a id="I_programlisting3_id326458"><pre class="programlisting">Craft.SetThrusters(false, false);</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">288</span><span sentence-index="6021" class="highlight3">Next,  the  keyboard  is  polled  using  the  function  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">288</span><span sentence-index="6021" class="highlight4">IsKeyDown</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6021</span><span sentence-index="6021" class="highlight2"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6022</span><span sentence-index="6022" class="highlight3">  This  is  a  wrapper  function  we  created        to  encapsulate  the  necessary  Windows  API  calls  used  to  check  key  states. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="6023" class="highlight4">       If  the  up  arrow  key  is  pressed,  then  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="6023" class="highlight2">RigidBody2D</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="6023" class="highlight3"> method  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="6023" class="highlight4">ModulateThrust</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="6023" class="highlight2"> is  called,  as  shown  here:</span></span></p></a><a id="I_programlisting3_id326488"><pre class="programlisting">Craft.ModulateThrust(true);</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="6025" class="highlight3">If  the  down  arrow  key  is  pressed,  then  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="6025" class="highlight4">ModulateThrust</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="6025" class="highlight2"> is  called,  passing  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="6025" class="highlight3">false</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="6025" class="highlight4"> instead  of  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">292</span><span sentence-index="6025" class="highlight2">true</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6025</span><span sentence-index="6025" class="highlight3"> .</span></span></p><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">294</span><span sentence-index="6027" class="highlight4 nonQuoteStr">ModulateThrust</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">294</span><span sentence-index="6027" class="highlight2 nonQuoteStr"> looks  like        this:</span></span></p></a><a id="I_programlisting3_id326524"><pre class="programlisting">void    RigidBody2D::ModulateThrust(bool up)
{
    double    dT = up ? _DTHRUST:-_DTHRUST;

    ThrustForce += dT;

    if(ThrustForce &gt; _MAXTHRUST) ThrustForce = _MAXTHRUST;
    if(ThrustForce &lt; _MINTHRUST) ThrustForce = _MINTHRUST;
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="6029" class="highlight3">All  it  does  is  increment  the  propeller  thrust  force  by  a  small        amount,  either  increasing  it  or  decreasing  it,  depending  on  the  value  of        the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="6029" class="highlight4">up</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6029</span><span sentence-index="6029" class="highlight2">  parameter.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">298</span><span sentence-index="6031" class="highlight3">Getting  back  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">298</span><span sentence-index="6031" class="highlight4">UpdateSimulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">298</span><span sentence-index="6031" class="highlight2">,        we  make  a  couple  more  calls  to  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">298</span><span sentence-index="6031" class="highlight3">IsKeyDown</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6031</span><span sentence-index="6031" class="highlight4"> ,  checking  the  states  of  the  left  and        right  arrow  keys. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">299</span><span sentence-index="6032" class="highlight2"> If  the  left  arrow  key  is  down,  then  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">299</span><span sentence-index="6032" class="highlight3">RigidBody2D</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">299</span><span sentence-index="6032" class="highlight4"> method  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">299</span><span sentence-index="6032" class="highlight2">SetThrusters</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">299</span><span sentence-index="6032" class="highlight3"> is  called,  passing  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">299</span><span sentence-index="6032" class="highlight4">false</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">299</span><span sentence-index="6032" class="highlight2"> as  the  first  parameter  and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">299</span><span sentence-index="6032" class="highlight3">true</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6032</span><span sentence-index="6032" class="highlight4">  as  the  second  parameter. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6033</span><span sentence-index="6033" class="highlight2">  If  the  right  arrow        key  is  down,  these  parameter  values  are  reversed. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">301</span><span sentence-index="6034" class="highlight3"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">301</span><span sentence-index="6034" class="highlight4">SetThrusters</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">301</span><span sentence-index="6034" class="highlight2"> looks  like  this:</span></span></p></a><a id="I_programlisting3_id326591"><pre class="programlisting">void    RigidBody2D::SetThrusters(bool p, bool s)
{
    PThrust.x = 0;
    PThrust.y = 0;
    SThrust.x = 0;
    SThrust.y = 0;

    if(p)
        PThrust.y = _STEERINGFORCE;
    if(s)
        SThrust.y = -_STEERINGFORCE;
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">303</span><span sentence-index="6036" class="highlight3">It  resets  the  port  and  starboard  bow  thruster  thrust  vectors  and        then  sets  them  according  to  the  parameters  passed  in  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">303</span><span sentence-index="6036" class="highlight4">SetThrusters</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6036</span><span sentence-index="6036" class="highlight2"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">304</span><span sentence-index="6037" class="highlight3"> If  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">304</span><span sentence-index="6037" class="highlight4">p</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">304</span><span sentence-index="6037" class="highlight2"> is  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">304</span><span sentence-index="6037" class="highlight3">true</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">304</span><span sentence-index="6037" class="highlight4">,        then  a  right  turn  is  desired  and  a  port  thrust  force,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">304</span><span sentence-index="6037" class="highlight2">PThrust</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6037</span><span sentence-index="6037" class="highlight3"> ,  is  created,  pointing  toward  the        starboard  side. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6038</span><span sentence-index="6038" class="highlight4">  This  seems  opposite  of  what  you&apos;d  expect,  but  it  is  the        port  bow  thruster  that  is  fired,  pushing  the  bow  of  the  hovercraft  toward        the  right  (starboard)  side. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span sentence-index="6039" class="highlight2"> Similarly,  if  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span sentence-index="6039" class="highlight3">s</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span sentence-index="6039" class="highlight4"> is  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">306</span><span sentence-index="6039" class="highlight2">true</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6039</span><span sentence-index="6039" class="highlight3"> ,  a        thrust  force  is  created  that  will  push  the  bow  of  the  hovercraft  to  the        left  (port)  side.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">308</span><span sentence-index="6041" class="highlight4">Now  with  the  thrust  forces  managed,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">308</span><span sentence-index="6041" class="highlight2">UpdateSimulation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">308</span><span sentence-index="6041" class="highlight3"> makes  the  call:</span></span></p></a><a id="I_programlisting3_id326652"><pre class="programlisting">Craft.UpdateBodyEuler(dt)</pre><p><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">310</span><span sentence-index="6043" class="highlight4">UpdateBodyEuler</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6043</span><span sentence-index="6043" class="highlight2">  integrates  the        equations  of  motion  as  discussed  earlier.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6045</span><span sentence-index="6045" class="highlight3">The  next  segment  of  code  checks  the  value  of  the  frame  counter. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">313</span><span sentence-index="6046" class="highlight4"> If        the  frame  counter  has  reached  the  defined  number  of  frames  (stored  in        </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">313</span><span sentence-index="6046" class="highlight2">_RENDER_FRAME_COUNT</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6046</span><span sentence-index="6046" class="highlight3"> ),  then  the  back        buffer  is  cleared  to  prepare  it  for  drawing  upon  and  ultimately  copying  to        the  screen.</span></span></p></a><p><a id="I_programlisting3_id326652"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6049" class="highlight4">Finally,  the  last  four  lines  of  code  wrap  the  hovercraft&apos;s  position        around  the  edges  of  the  </span></span></a><a id="I_indexterm3_id326682" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6050</span><span sentence-index="6050" class="highlight2">screen.</span></span></a></p></div><div class="sect1" title="Tuning"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="tuning-id1"><a id="I_indexterm3_id326682" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">320</span><span sentence-index="6053" class="highlight3">Tuning</span></span></a></h2></div></div></div><p><a id="I_indexterm3_id326682" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">322</span><span sentence-index="6055" class="highlight4">You&apos;ll  probably</span></span></a><a id="I_indexterm3_id326702" class="indexterm"></a><a id="I_indexterm3_id326715" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6057</span><span sentence-index="6057" class="highlight2">  want  to  tune  this  example  to  run  well  on  your  computer        since  we  didn&apos;t  implement  any  profiling  for  processor  speed. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6058</span><span sentence-index="6058" class="highlight3">  Moreover,  you        should  tune  the  various  parameters  governing  the  behavior  of  the        hovercraft  to  see  how  it  responds. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6059</span><span sentence-index="6059" class="highlight4">  The  way  we  have  it  set  up  now  makes  the        hovercraft  exhibit  a  soft  sort  of  response  to  turning&#x2014;that  is,  upon        application  of  turning  forces,  the  craft  will  tend  to  keep  tracking  in  its        original  heading  for  a  bit  even  while  yawed. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6060</span><span sentence-index="6060" class="highlight2">  It  will  not  respond  like  a        car  would  turn. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6061</span><span sentence-index="6061" class="highlight3">  You  can  change  this  behavior,  of  course.</span></span></a></p><p><a id="I_indexterm3_id326715" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">331</span><span sentence-index="6064" class="highlight4">Some  things  we  suggest  you  play  with  include  the  time  step  size  and        the  various  constants  we&apos;ve  defined  as  follows:</span></span></a></p><a id="I_programlisting3_id326739"><pre class="programlisting">#define  _THRUSTFORCE      5.0f
#define  _MAXTHRUST        10.0f
#define  _MINTHRUST        0.0f
#define  _DTHRUST          0.001f
#define  _STEERINGFORCE    3.0f
#define  _LINEARDRAGCOEFFICIENT    1.25f</pre></a><p><a id="I_programlisting3_id326739"><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="6067" class="highlight2">_THRUSTFORCE</span></span></code><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6067</span><span sentence-index="6067" class="highlight3">  is  the  initial        magnitude  of  the  propeller  thrust  force. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">335</span><span sentence-index="6068" class="highlight4"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">335</span><span sentence-index="6068" class="highlight2">_MAXTHRUST</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">335</span><span sentence-index="6068" class="highlight3"> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">335</span><span sentence-index="6068" class="highlight4">_MINTHRUST</span></span></code><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6068</span><span sentence-index="6068" class="highlight2">  set  upper  and  lower  bounds  to  this        force,  which  is  modulated  by  the  user  pressing  the  up  and  down  arrow  keys. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6069" class="highlight3">       </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6069" class="highlight4">_DTHRUST</span></span></code><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6069</span><span sentence-index="6069" class="highlight2">  is  the  incremental  change  in        thrust  in  response  to  the  user  pressing  the  up  and  down  arrow  keys. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">337</span><span sentence-index="6070" class="highlight3">       </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">337</span><span sentence-index="6070" class="highlight4">_STEERINGFORCE</span></span></code><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6070</span><span sentence-index="6070" class="highlight2">  is  the  magnitude  of  the        bow  thruster  forces. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6071</span><span sentence-index="6071" class="highlight3">  You  should  definitely  play  with  this  value  to  see  how        the  behavior  of  the  hovercraft  changes. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">339</span><span sentence-index="6072" class="highlight4"> Finally,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">339</span><span sentence-index="6072" class="highlight2">_LINEARDRAGCOEFFICIENT</span></span></code><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6072</span><span sentence-index="6072" class="highlight3">  is  the  drag  coefficient        used  to  compute  aerodynamic  drag. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6073</span><span sentence-index="6073" class="highlight4">  This  is  another  good  value  to  play  with        to  see  how  behavior  is  affected. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">341</span><span sentence-index="6074" class="highlight2"> Speaking  of  drag,  the  location  of  the        center  of  drag  that&apos;s  initialized  in  the  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">341</span><span sentence-index="6074" class="highlight3">RigidBody2D</span></span></code><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6074</span><span sentence-index="6074" class="highlight4">  constructor  is  a  good  parameter  to        change  in  order  to  understand  how  it  affects  the  behavior  of  the        hovercraft. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">342</span><span sentence-index="6075" class="highlight2"> It  influences  the  craft&apos;s  directional  stability,  which  affects        its  turning  radius&#x2014;particularly  at  higher  </span></span></a><a id="I_indexterm3_id326799" class="indexterm"></a><a id="I_indexterm3_id326808" class="indexterm"></a><a id="I_indexterm3_id326818" class="indexterm"><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6078</span><span sentence-index="6078" class="highlight3">speeds.</span></span></a></p></div></section><a id="I_indexterm3_id326818" class="indexterm">
</a></body></html>