<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><html><head><title>Chapter&#xA0;11.&#xA0;Rotation in 3D Rigid-Body Simulators</title><link rel="stylesheet" type="text/css" href="core.css"><meta name="generator" content="DocBook XSL Stylesheets V1.76.1"><link rel="up" href="pt02.html" title="Part&#xA0;II.&#xA0;Rigid-Body Dynamics"><link rel="prev" href="ch10.html" title="Chapter&#xA0;10.&#xA0;Implementing Collision Response"><link rel="next" href="ch12.html" title="Chapter&#xA0;12.&#xA0;3D Rigid-Body Simulator"></head><body>
         
        <script>
        function ok(){ 
            window.gggs()
            return;
            //$('#musicPlayer').parent().remove();
            //speakTransportPanelDialogV2.closeEmoteDialog()
            //speakTransportPanelDialog.closeEmoteDialog()
            //
            debugger
            let url = 'http://127.0.0.1:8080/uploads/extracted/' +
             'Crazy Rich Asians  Kevin Kwanepub/' +
              'jsonSets/OEBPS/Kwan_9780385536981_epub_prl_r1.htm.html.sentences.json'
            speakTransportPanelDialogV2.sideLoadSentences2(null, null, null, url)
            
        }
        setTimeout(ok, 1500)
        </script>
        <div style="background:white">````````</div><section class="chapter" title="Chapter&#xA0;11.&#xA0;Rotation in 3D Rigid-Body Simulators" epub:type="chapter" id="rotation_in_3d_rigid-body_simulators"><div class="titlepage"><div><div><h2 class="title"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">1</span><span sentence-index="6467" class="highlight2">Chapter&#xA0;11.&#xA0;Rotation  in  3D  Rigid-Body  Simulators</span></span></h2></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">2</span><span sentence-index="6468" class="highlight3">A  fundamental  difference  between  </span></span><a id="th11.0" class="indexterm"></a><a id="I_indexterm5_id328892" class="indexterm"></a><a id="si11.0" class="indexterm"></a><a id="ri11.0" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6472</span><span sentence-index="6472" class="highlight4">particles  and  rigid  bodies  is  that  we  cannot  ignore  rotation  of  rigid  bodies. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6473</span><span sentence-index="6473" class="highlight2">  This        applies  to  both  2D  and  3D  rigid  bodies. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">8</span><span sentence-index="6474" class="highlight3"> In  two  dimensions,  it&apos;s  quite  easy  to  express  the  </span></span></a><a id="I_indexterm5_id328936" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6475</span><span sentence-index="6475" class="highlight4">orientation  of  a  rigid  body;  you  need  only  a  single  scalar  to  represent  the  body&apos;s        rotation  about  a  single  axis. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6476</span><span sentence-index="6476" class="highlight2">  In  three  dimensions,  however,  there  are  three  primary  coordinate        axes  about  each  of  which  a  rigid  body  may  rotate. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6477</span><span sentence-index="6477" class="highlight3">  Moreover,  a  rigid  body  in  three  dimensions  may        rotate  about  any  arbitrary  axis,  not  necessarily  one  of  the  coordinate  axes.</span></span></a></p><p><a id="I_indexterm5_id328936" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">14</span><span sentence-index="6480" class="highlight4">In  two  dimensions,  we  say  that  a  rigid  body  has  only  one  rotational  degree  of  freedom,        whereas  in  three  dimensions  we  say  that  a  rigid  body  has  three  rotational  </span></span></a><a id="I_indexterm5_id328955" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6481</span><span sentence-index="6481" class="highlight2">degrees  of  freedom. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6482</span><span sentence-index="6482" class="highlight3">  This  may  lead  you  to  infer  that  in  three  dimensions,  you  must        have  three  scalar  quantities  to  represent  a  body&apos;s  rotation. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">17</span><span sentence-index="6483" class="highlight4"> Indeed,  this  is  a  minimum        requirement,  and  you&apos;re  probably  already  familiar  with  a  set  of  angles  that  represent  the        orientation  of  a  rigid  body  in  3D&#x2014;namely,  the  three  </span></span></a><a id="I_indexterm5_id328969" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">18</span><span sentence-index="6484" class="highlight2">Euler  angles  (roll,  pitch,  and  yaw)  that  we&apos;ll  talk  about  in  </span></span></a><a class="xref" href="ch15.html" title="Chapter&#xA0;15.&#xA0;Aircraft"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">20</span><span sentence-index="6486" class="highlight3">Chapter&#xA0;15</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6486</span><span sentence-index="6486" class="highlight4"> .</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6488</span><span sentence-index="6488" class="highlight2">These  three  angles&#x2014;roll,  pitch,  and  yaw&#x2014;are  very  intuitive  and  easy  for  us  to  visualize. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">23</span><span sentence-index="6489" class="highlight3"> For        example,  in  an  airplane  the  nose  </span></span><a id="I_indexterm5_id328992" class="indexterm"></a><a id="I_indexterm5_id328999" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">25</span><span sentence-index="6491" class="highlight4">pitches  up  or  down,  the  plane  </span></span></a><a id="I_indexterm5_id329010" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">26</span><span sentence-index="6492" class="highlight2">rolls  (or  banks)  left  or  right,  and  the  </span></span></a><a id="I_indexterm5_id329022" class="indexterm"></a><a id="I_indexterm5_id329032" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6495</span><span sentence-index="6495" class="highlight3">yaw  (or  heading)  changes  to  the  left  or  right. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6496</span><span sentence-index="6496" class="highlight4">  Unfortunately,  there&apos;s  a  problem  with        using  these  three  Euler  angles  in  rigid-body  simulations. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6497</span><span sentence-index="6497" class="highlight2">  The  problem  is  a  numerical  one  that        occurs  when  the  pitch  angle  reaches  plus  or  minus  90  degrees  (&#x3C0;/2). </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6498</span><span sentence-index="6498" class="highlight3">  When  this  happens,  roll  and        yaw  become  ambiguous. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6499</span><span sentence-index="6499" class="highlight4">  Worse  yet,  the  angular  equations  of  motion  written  in  terms  of  Euler        angles  contain  terms  involving  the  cosine  of  the  pitch  angle  in  the  denominator,  which  means        that  when  the  pitch  angle  is  plus  or  minus  90  degrees  the  equations  become  singular  (i.e.,        there&apos;s  division  by  0). </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6500</span><span sentence-index="6500" class="highlight2">  If  this  happens  in  your  simulation,  the  results  would  be  unpredictable        to  say  the  least. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6501</span><span sentence-index="6501" class="highlight3">  Given  this  problem  with  Euler  angles,  you  must  use  some  other  means  of  keeping        track  of  orientation  in  your  simulation. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6502</span><span sentence-index="6502" class="highlight4">  We&apos;ll  discuss  two  such  means  in  this        chapter&#x2014;specifically,  rotation  matrices  and  quaternions.</span></span></a></p><p><a id="I_indexterm5_id329032" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6505</span><span sentence-index="6505" class="highlight2">Virtually  every  computer  graphics  book  that  we&apos;ve  read  contains  a  chapter  or  section  on        using  rotation  matrices. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6506</span><span sentence-index="6506" class="highlight3">  Far  fewer  discuss  quaternions,  but  if  you&apos;re  familiar  with  quaternions,        it&apos;s  probably  in  the  same  context  as  rotation  matrices&#x2014;that  is,  how  they  are  used  to  rotate  3D        points,  objects,  scenes,  and  points  of  view. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6507</span><span sentence-index="6507" class="highlight4">  In  a  simulation,  however,  you  need  to  get  a  little        more  out  of  rotation  matrices  or  quaternions  and  will  use  them  in  a  different  context  than  what        you  might  be  accustomed  to. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6508</span><span sentence-index="6508" class="highlight2">  Specifically,  you  need  to  keep  track  of  a  body&apos;s  orientation  in        space  and,  moreover,  the  change  in  orientation  over  time. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6509</span><span sentence-index="6509" class="highlight3">  So  it&apos;s  in  this  light  that  we&apos;ll        discuss  rotation  matrices  and  quaternions. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">44</span><span sentence-index="6510" class="highlight4"> We&apos;ll  try  to  be  as  concise  as  possible  so  as  not  to        cloud  the  water  with  the  proofs  and  derivations  that  you  can  find  in  the  texts  referred  to  in        the  </span></span></a><a class="link" href="apd.html" title="Appendix&#xA0;D.&#xA0;Bibliography"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">45</span><span sentence-index="6511" class="highlight2">Bibliography</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6512</span><span sentence-index="6512" class="highlight3"> .</span></span></p><div class="sect1" title="Rotation Matrices"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="rotation_matrices"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">48</span><span sentence-index="6514" class="highlight4">Rotation  Matrices</span></span></h2></div></div></div><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">49</span><span sentence-index="6515" class="highlight2">A  rotation  matrix  is  a  3&#xD7;3  matrix  that,  </span></span><a id="ro11.1" class="indexterm"></a><a id="rom11.1" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6517</span><span sentence-index="6517" class="highlight3">when  multiplied  with  a  point  or  vector,  results  in  the  rotation  of  that  point            about  some  axis,  yielding  a  new  set  of  coordinates. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6518</span><span sentence-index="6518" class="highlight4">  You  can  rotate  points  about  axes  in  one            coordinate  system  or  you  can  use  rotation  matrices  to  convert  points  from  one  coordinate            system  to  another,  where  one  is  rotated  relative  to  the  other.</span></span></a></p><p><a id="rom11.1" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="6521" class="highlight2">Rotating  a  vector  by  a  rotation  matrix  is  typically  written  as  follows:  if  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span>v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="6521" class="highlight4"> is  a  vector,  and  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span>R</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="6521" class="highlight3"> is  a            rotation  matrix,  then  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span>v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="6521" class="highlight4">&apos;  is  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span>v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="6521" class="highlight2"> rotated  by  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="6521" class="highlight2">R</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="6521" class="highlight3"> according  to  the            formula:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="6521" class="highlight3">v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="6521" class="highlight4">&apos;  =  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">55</span><span sentence-index="6521" class="highlight2">R                v</span></span></strong></span></td></tr></tbody></table><p><a id="rom11.1" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6523</span><span sentence-index="6523" class="highlight3">You  can  combine  multiple  rotation  matrices  reflecting  multiple  sequential  rotations  into  a            single  rotation  matrix  using  usual  matrix  multiplication. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">58</span><span sentence-index="6524" class="highlight3"> If  the  rotation  matrices  are            expressed  in  terms  of  fixed,  global  coordinates,  then  they  are  combined  as  follows:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">58</span><span>R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">58</span><span sentence-index="6524" class="highlight2">c</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">58</span><span sentence-index="6524" class="highlight3"> =  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">58</span><span>R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">58</span><span sentence-index="6524" class="highlight4">1</span></span></sub>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">58</span><span sentence-index="6524" class="highlight4">R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">58</span><span sentence-index="6524" class="highlight2">2</span></span></sub></td></tr></tbody></table><p><a id="rom11.1" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span sentence-index="6526" class="highlight3">Here  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span>R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span sentence-index="6526" class="highlight2">c</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span sentence-index="6526" class="highlight3"> is  the  combined  rotation            matrix  reflecting  a  rotation  first  by  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span>R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span sentence-index="6526" class="highlight4">1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span sentence-index="6526" class="highlight4"> and  then  by  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span sentence-index="6526" class="highlight4">R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">60</span><span sentence-index="6526" class="highlight2">2</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6526</span><span sentence-index="6526" class="highlight2"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="6527" class="highlight2"> If  the  rotation  matrices  are  expressed  in  terms  of            rotating,  body-fixed  coordinates,  then  they  are  combined  in  the  reverse  order  as            follows:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span>R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="6527" class="highlight4">c</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="6527" class="highlight2"> =  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span>R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="6527" class="highlight4">2</span></span></sub>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="6527" class="highlight3">R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">61</span><span sentence-index="6527" class="highlight3">1</span></span></sub></td></tr></tbody></table><p><a id="rom11.1" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6529</span><span sentence-index="6529" class="highlight3">We  won&apos;t  go  into  the  proof  of  this  relation,  but  the  reason  it&apos;s  different  depending  on            how  you&apos;ve  defined  your  rotation  matrices  is  that  rotation  matrices  defined  in  fixed            coordinates  are  unaffected  by  the  rotation  itself  since  the  coordinate  axes  stay  fixed. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6530</span><span sentence-index="6530" class="highlight4">  On  the            other  hand,  if  the  rotation  matrices  are  defined  relative  to  a  coordinate  system  that  is            rotating  due  to  sequential  application  of  rotation  matrices,  then  all  rotation  matrices  after            the  first  will  be  affected  since  they  were  first  defined  relative  to  the  original  state  of  the            coordinate  system&#x2014;that  is,  before  the  first  rotation  matrix  was  applied. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6531</span><span sentence-index="6531" class="highlight2">  This  means  that  the            subsequent  rotation  matrices  must  be  corrected  to  reflect  the  new  system  as  affected  by  the            previous  rotation  before  they  can  be  correctly  applied. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">66</span><span sentence-index="6532" class="highlight2"> In  other  words,  you  have  to  rotate                </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">66</span><span>R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">66</span><span>2</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">66</span><span sentence-index="6532" class="highlight4"> by  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">66</span><span>R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">66</span><span sentence-index="6532" class="highlight3">1</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">66</span><span sentence-index="6532" class="highlight2"> to  get  a  new  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">66</span><span sentence-index="6532" class="highlight3">R</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">66</span><span sentence-index="6532" class="highlight4">2</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6532</span><span sentence-index="6532" class="highlight3">  before  applying  it. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">67</span><span sentence-index="6533" class="highlight4"> All  this  happens  to  work  out  in            such  a  way  that  you  reverse  the  order  of  multiplication  of  rotation  matrices  when  they  are            defined  in  a  r</span></span></a><a id="I_indexterm5_id329310" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6534</span><span sentence-index="6534" class="highlight2">otating  coordinate  system.</span></span></a></p><p><a class="xref" href="ch11.html#right-handed_coordinate_system-id1" title="Figure&#xA0;11-1.&#xA0;Right-handed coordinate system"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">71</span><span sentence-index="6537" class="highlight3">Figure&#xA0;11-1</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6537</span><span sentence-index="6537" class="highlight4">  shows  a  right-handed  coordinate            system  that  illustrates  the  directions  of  positive  rotation  about  each  coordinate  axis.</span></span></p><div class="figure"><a id="right-handed_coordinate_system-id1"></a><div class="figure-contents"><a id="right-handed_coordinate_system-id1"></a><div class="mediaobject"><a id="right-handed_coordinate_system-id1"></a><a id="I_mediaobject5_id329340"><img src="httpatomoreillycomsourceoreillyimages1598946.png" alt="Right-handed coordinate system"></a></div></div><div class="figure-title"><a id="I_mediaobject5_id329340"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">77</span><span sentence-index="6543" class="highlight2">Figure&#xA0;11-1.&#xA0;Right-handed  coordinate  system</span></span></a></div></div><p><a id="I_mediaobject5_id329340"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">79</span><span sentence-index="6545" class="highlight3">Let&apos;s  consider  rotation  around  the</span></span></a><a id="I_indexterm5_id329360" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">80</span><span sentence-index="6546" class="highlight4"> z-axis  where  the  point  shown  in  </span></span></a><a class="xref" href="ch11.html#rotation_around_the_z-axis" title="Figure&#xA0;11-2.&#xA0;Rotation around the z-axis"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">82</span><span sentence-index="6548" class="highlight2">Figure&#xA0;11-2</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6548</span><span sentence-index="6548" class="highlight3">  is            rotated  through  an  angle  &#x3B8;.</span></span></p><div class="figure"><a id="rotation_around_the_z-axis"></a><div class="figure-contents"><a id="rotation_around_the_z-axis"></a><div class="mediaobject"><a id="rotation_around_the_z-axis"></a><a id="I_mediaobject5_id329385"><img src="httpatomoreillycomsourceoreillyimages1598947.png" alt="Rotation around the z-axis"></a></div></div><div class="figure-title"><a id="I_mediaobject5_id329385"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">88</span><span sentence-index="6554" class="highlight4">Figure&#xA0;11-2.&#xA0;Rotation  around  the  z-axis</span></span></a></div></div><p><a id="I_mediaobject5_id329385"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span sentence-index="6556" class="highlight2">The  coordinates  of  the  point  before  the  rotation  are                (</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span>x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span>,</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span>y</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span sentence-index="6556" class="highlight4">,</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span>z</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span sentence-index="6556" class="highlight4">)  and  after  the            rotation  the  coordinates  are  (</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span sentence-index="6556" class="highlight3">x</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span>r</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span>,                </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span sentence-index="6556" class="highlight2">y</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span>r</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span sentence-index="6556" class="highlight3">,                </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span sentence-index="6556" class="highlight3">z</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">90</span><span sentence-index="6556" class="highlight2">r</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6556</span><span sentence-index="6556" class="highlight4"> ). </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="6557" class="highlight2 nonQuoteStr"> The  rotated  coordinates  are  related  to  the            original  coordinates  and  the  rotation  angle  by  the  following:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="6557" class="highlight3 nonQuoteStr">x</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span>r</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="6557" class="highlight2 nonQuoteStr"> =  x  cos  &#x3B8;  &#x2212;  y  sin  &#x3B8;</span></span></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="6557" class="highlight3 nonQuoteStr">y</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span>r</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="6557" class="highlight4 nonQuoteStr"> =  x  sin  &#x3B8;  +  y  cos  &#x3B8;</span></span></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="6557" class="highlight2 nonQuoteStr">z</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="6557" class="highlight4 nonQuoteStr">r</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">91</span><span sentence-index="6557" class="highlight3 nonQuoteStr"> =  z</span></span></td></tr></tbody></table><p><a id="I_mediaobject5_id329385"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">93</span><span sentence-index="6559" class="highlight4">Notice  that  since  the  point  is  rotating  about  the  z-axis,  its  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">93</span><span sentence-index="6559" class="highlight2">z</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6559</span><span sentence-index="6559" class="highlight3">            coordinate  remains  unchanged. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span sentence-index="6560" class="highlight4"> To  write  this  in  the  vector-matrix  notation,  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span>v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span sentence-index="6560" class="highlight3">&apos;  =  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span sentence-index="6560" class="highlight4">R  v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span sentence-index="6560" class="highlight2">,  let  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span sentence-index="6560" class="highlight2">v</span></span></strong></span>
      <span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span sentence-index="6560" class="highlight3">=  [x  y  z]</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span sentence-index="6560" class="highlight4"> and  let  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span sentence-index="6560" class="highlight2">R</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">94</span><span sentence-index="6560" class="highlight3"> be  the            matrix:</span></span></a></p><div class="informalfigure"><a id="chapter11matrix1"></a><div class="mediaobject"><a id="chapter11matrix1"></a><a id="I_mediaobject5_id329509"><img src="httpatomoreillycomsourceoreillyimages1598948.png" alt="image with no caption"></a></div></div><p><a id="I_mediaobject5_id329509"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span sentence-index="6565" class="highlight4">Here  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span sentence-index="6565" class="highlight2">v&apos;</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span sentence-index="6565" class="highlight3"> will  be  the  new,  rotated  vector,  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span sentence-index="6565" class="highlight4">v</span></span></strong></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span sentence-index="6565" class="highlight2">&apos;  =  [x</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span>r</span></span></sub>
      <span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span sentence-index="6565" class="highlight4">y</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span>r</span></span></sub>
      <span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span sentence-index="6565" class="highlight2">z</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span sentence-index="6565" class="highlight3">r</span></span></sub><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">99</span><span sentence-index="6565" class="highlight3">]</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6565</span><span sentence-index="6565" class="highlight4"> .</span></span></a></p><p><a id="I_mediaobject5_id329509"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">102</span><span sentence-index="6568" class="highlight2">Rotation  about  </span></span></a><a id="I_indexterm5_id329565" class="indexterm"></a><a id="I_indexterm5_id329572" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">104</span><span sentence-index="6570" class="highlight3">the  x-  and  y-axes  is  similar  to  the  z-axis;  however,  in  those  cases  the                </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">104</span><span sentence-index="6570" class="highlight4">x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">104</span><span sentence-index="6570" class="highlight2"> and  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">104</span><span sentence-index="6570" class="highlight3">y</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6570</span><span sentence-index="6570" class="highlight4">  coordinates  remain  constant  during            rotations  about  each  axis,  respectively. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6571</span><span sentence-index="6571" class="highlight2">  Looking  at  rotation  about  each  axis  separately  will            yield  three  rotation  matrices  similar  to  the  one  we  just  showed  you  for  rotation  about  the            z-axis.</span></span></a></p><p><a id="I_indexterm5_id329572" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">108</span><span sentence-index="6574" class="highlight3">For  rotation  about  the  x-axis,  the  matrix  is:</span></span></a></p><div class="informalfigure"><a id="chapter11matrix2"></a><div class="mediaobject"><a id="chapter11matrix2"></a><a id="I_mediaobject5_id329600"><img src="httpatomoreillycomsourceoreillyimages1598949.png" alt="image with no caption"></a></div></div><p><a id="I_mediaobject5_id329600"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">113</span><span sentence-index="6579" class="highlight4">And  for  rotation  about  the  y-axis,  the  matrix  is:</span></span></a></p><div class="informalfigure"><a id="chapter11matrix3"></a><div class="mediaobject"><a id="chapter11matrix3"></a><a id="I_mediaobject5_id329630"><img src="httpatomoreillycomsourceoreillyimages1598950.png" alt="image with no caption"></a></div></div><p><a id="I_mediaobject5_id329630"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6584</span><span sentence-index="6584" class="highlight2">These  are  the  rotation  matrices  you  typically  see  in  computer  graphics  texts  in  the            context  of  matrix  transforms,  such  as  translation,  scaling,  and  rotation. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6585</span><span sentence-index="6585" class="highlight3">  You  can  combine  all            three  of  these  matrices  into  a  single  rotation  matrix  to  represent  combinations  of  rotations            about  each  coordinate  axis,  using  matrix  multiplication  as  mentioned  earlier.</span></span></a></p><p><a id="I_mediaobject5_id329630"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">122</span><span sentence-index="6588" class="highlight4">In  rigid-body  simulations,  you  can  use  a  rotation  matrix  to  represent  the  </span></span></a><a id="I_indexterm5_id329657" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6589</span><span sentence-index="6589" class="highlight2">orientation  of  a  rigid  body. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6590</span><span sentence-index="6590" class="highlight3">  Another  way  to  think  of  it  is  the  rotation  matrix,            when  applied  to  the  unrotated  rigid  body  aligned  with  the  fixed  global  coordinate  system,  will            rotate  the  rigid  body&apos;s  coordinates  so  as  to  resemble  the  body&apos;s  current  orientation  at  any            given  time. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6591</span><span sentence-index="6591" class="highlight4">  This  leads  to  another  important  consideration  when  using  rotation  matrices  to  keep            track  of  orientation  in  rigid-body  simulations:  the  fact  that  the  rotation  matrix  will  be  a            function  of  time.</span></span></a></p><p><a id="I_indexterm5_id329657" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">128</span><span sentence-index="6594" class="highlight2">Once  you  set  up  your  initial  rotation  matrix  for  the  rigid  body,  you&apos;ll  never  directly            calculate  it  again  from  orientation  angles;  instead,  the  forces  and  moments  applied  to  the            rigid  body  will  change  the  body&apos;s  angular  velocity,  </span></span></a><a id="I_indexterm5_id329679" class="indexterm"></a><a id="I_indexterm5_id329689" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6596</span><span sentence-index="6596" class="highlight3">likewise  causing  small  changes  in  orientation  at  each  time  step  throughout  the            simulation. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6597</span><span sentence-index="6597" class="highlight4">  Thus,  you  can  see  that  you  must  have  a  means  of  relating  the  rotation  matrix  to            angular  velocity  so  that  you  can  update  the  orientation  accordingly. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">132</span><span sentence-index="6598" class="highlight2"> The  formula  you  need  is            as  follows:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">132</span><span sentence-index="6598" class="highlight3">d  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">132</span><span sentence-index="6598" class="highlight4">R</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">132</span><span sentence-index="6598" class="highlight2"> /  dt  =  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">132</span><span sentence-index="6598" class="highlight3">&#x3A9;                R</span></span></strong></span></td></tr></tbody></table><p><a id="I_indexterm5_id329689" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">134</span><span sentence-index="6600" class="highlight4">Here,  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">134</span><span sentence-index="6600" class="highlight2">&#x3A9;</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">134</span><span sentence-index="6600" class="highlight3"> is  a  skew  symmetric  matrix  built  from  the            angular  velocity  vector  components  as  follows:</span></span></a></p><div class="informalfigure"><a id="chapter11matrix4"></a><div class="mediaobject"><a id="chapter11matrix4"></a><a id="I_mediaobject5_id329741"><img src="httpatomoreillycomsourceoreillyimages1598951.png" alt="image with no caption"></a></div></div><p><a id="I_mediaobject5_id329741"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="6605" class="highlight4">Notwithstanding  a  rigorous  proof  of  this  relation,  it&apos;s  easy  to  see  its  beauty,  which  is            that  you  can  differentiate  the  rotation  matrix  by  simply  matrix  multiplying  by  the  angular            velocity  (in  the  form  of  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">139</span><span sentence-index="6605" class="highlight2">&#x3A9;</span></span></strong></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6605</span><span sentence-index="6605" class="highlight3"> ). </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6606</span><span sentence-index="6606" class="highlight4">  In  a  simulation  you&apos;ll  know            your  initial  rotation  matrix,  and  you&apos;ll  calculate  the  angular  velocity  at  each  time  step;            thus,  you  can  easily  progress,  or  integrate,  the  rotation  matrix.</span></span></a></p><p><a id="I_mediaobject5_id329741"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6609</span><span sentence-index="6609" class="highlight2">You  should  be  able  to  see  here  that  since  you&apos;ll  only  explicitly  calculate  the  rotation            matrix  once  and  will  update  it  with  a  matrix  multiply,  you  won&apos;t  have  to  use  computationally            expensive  trigonometric  functions  during  each  time  step. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6610</span><span sentence-index="6610" class="highlight3">  Further,  you  avoid  the  singularity            problem  mentioned  in  the  introduction  to  this  chapter.</span></span></a></p><p><a id="I_mediaobject5_id329741"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6613</span><span sentence-index="6613" class="highlight4">It  should  also  be  obvious  that  you  gain  these  benefits  at  some  price. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6614</span><span sentence-index="6614" class="highlight2">  First,  you  have  to            deal  with  nine  parameters  in  the  rotation  matrix  (each  element  in  the  3&#xD7;3  rotation  matrix)  to            represent  three  angular  degrees  of  freedom. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">149</span><span sentence-index="6615" class="highlight3"> Secondly,  in  order  to  do  that,  you  need  to  impose            constraints  on  the  rotation  matrix;  specifically,  you  need  to  enforce  the  constraint  that  the            matrix  be  orthogonal  with  a  determinant  of  1  so  that  it  satisfies  the  following  (each  column            in  the  matrix  </span></span></a><a id="I_indexterm5_id329786" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">150</span><span sentence-index="6616" class="highlight4">represents  a  unit  vector,  and  they  are  all  at  right  angles  to  each                other):</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">150</span><span sentence-index="6616" class="highlight2">[</span></span></sup></a><a id="CHP-11-FN-1" href="#ftn.CHP-11-FN-1" epub:type="noteref" class="footnote"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">152</span><span sentence-index="6618" class="highlight3">20</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">152</span><span sentence-index="6618" class="highlight4">]</span></span></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">152</span><span>R</span></span></strong></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">152</span><span sentence-index="6618" class="highlight3">T</span></span></sup>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">152</span><span sentence-index="6618" class="highlight2">R</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">152</span><span sentence-index="6618" class="highlight4"> =  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">152</span><span sentence-index="6618" class="highlight2">I</span></span></strong></span></td></tr></tbody></table><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="6619" class="highlight3">Here  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span>R</span></span></strong></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="6619" class="highlight2">T</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="6619" class="highlight3">is  the  transpose  of                </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="6619" class="highlight4">R</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="6619" class="highlight4">,  and  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">153</span><span sentence-index="6619" class="highlight2">I</span></span></strong></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6619</span><span sentence-index="6619" class="highlight3">  is  the            identity  matrix. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6620</span><span sentence-index="6620" class="highlight4">  Due  to  numerical  errors  such  as  roundoff  and  truncation,  you&apos;ll  have  to            enforce  this  constraint  very  often  in  your  simulation. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6621</span><span sentence-index="6621" class="highlight2">  Otherwise,  your  rotation  matrix  will  do            more  than  rotate  your  objects,  it  may  scale  or  translate  them  too.</span></span></p><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6623</span><span sentence-index="6623" class="highlight3">Instead  of  dealing  with  nine  parameters  and  trying  to  constrain  six  degrees  of  freedom  so            that  only  the  three  you  want  can  be  represented,  you  could  take  an  alternative  approach  that            lets  you  keep  the  advantages  rotation  matrices  have  to  offer,  but  at  a  cheaper  price. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">158</span><span sentence-index="6624" class="highlight4"> That            alternative,  quaternions,  is  the  subject  of  the  next  </span></span><a id="I_indexterm5_id329866" class="indexterm"></a><a id="I_indexterm5_id329876" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6626</span><span sentence-index="6626" class="highlight2">section.</span></span></a></p></div><div class="sect1" title="Quaternions"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="quaternions"><a id="I_indexterm5_id329876" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">163</span><span sentence-index="6629" class="highlight3">Quaternions</span></span></a></h2></div></div></div><p><a id="I_indexterm5_id329876" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">165</span><span sentence-index="6631" class="highlight4">Quaternions  are  somewhat  of  a  </span></span></a><a id="ro11.2" class="indexterm"></a><a id="qu11.2" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6633</span><span sentence-index="6633" class="highlight2">mathematical  oddity. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">168</span><span sentence-index="6634" class="highlight3"> They  were  developed  over  100  years  ago  by  </span></span></a><a id="I_indexterm5_id329931" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6635</span><span sentence-index="6635" class="highlight4">William  Hamilton  through  his  work  in  complex  (imaginary)  math  but  have  found  very            little  practical  use. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6636</span><span sentence-index="6636" class="highlight2">  A  quaternion  is  a  quantity,  kind  of  like  a  vector,  but  made  up  of  four            components. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight4"> It  is  typically  written  in  the  form:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight2">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight3"> =  q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight3">0</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight4"> +                    q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight2">x</span></span></sub>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight3">i</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span> +  q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight2">y</span></span></sub>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight3">j</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight4"> +  q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight4">z</span></span></sub>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">171</span><span sentence-index="6637" class="highlight2">k</span></span></strong></span></td></tr></tbody></table><p><a id="I_indexterm5_id329931" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">173</span><span sentence-index="6639" class="highlight3">A  quaternion  is  really  a  four-dimensional  </span></span></a><a id="I_indexterm5_id329992" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6640</span><span sentence-index="6640" class="highlight4">quantity  in  complex  space  and,  unfortunately,  does  not  lend  itself  to            visualization. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">175</span><span sentence-index="6641" class="highlight2"> Don&apos;t  worry,  though:  our  use  of  quaternions  to  </span></span></a><a id="I_indexterm5_id330001" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6642</span><span sentence-index="6642" class="highlight3">represent  orientation  in  three  dimensions  does  allow  us  to  attach  a  physical            meaning  to  them,  as  you&apos;ll  see  in  a  moment.</span></span></a></p><p><a id="I_indexterm5_id330001" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="6645" class="highlight3 nonQuoteStr">Of  particular  interest  to  us  is  what&apos;s  known  as  a  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="6645" class="highlight4 nonQuoteStr">unit  quaternion</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="6645" class="highlight2 nonQuoteStr">           that  satisfies  the  following:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="6645" class="highlight3 nonQuoteStr">q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="6645" class="highlight4 nonQuoteStr">0</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span> +                    q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="6645" class="highlight2 nonQuoteStr">x</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span> +                    q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="6645" class="highlight3 nonQuoteStr">y</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="6645" class="highlight4 nonQuoteStr"> +                    q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="6645" class="highlight4 nonQuoteStr">z</span></span></sub><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="6645" class="highlight2 nonQuoteStr">2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">179</span><span sentence-index="6645" class="highlight2 nonQuoteStr"> =  1</span></span></td></tr></tbody></table><p><a id="I_indexterm5_id330001" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6647</span><span sentence-index="6647" class="highlight3">This  is  analogous  to  a  normalized,  or  unit,  vector.</span></span></a></p><p><a id="I_indexterm5_id330001" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight2">You  can  also  write  a  quaternion  in  the  form  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span>q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight4"> =                [</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span>q</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span>0</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight2">,  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span>v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight4">],            where  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight3">v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight2"> is  the  vector,                </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span>q</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight3">x</span></span></sub>
      <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight4">i</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span> +  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span>q</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight3">y</span></span></sub>
      <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight4">j</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight2"> +  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span>q</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight2">z</span></span></sub>
      <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight3">k</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight4">,  and  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight3">q</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">184</span><span sentence-index="6650" class="highlight4">0</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6650</span><span sentence-index="6650" class="highlight2">  is  a            scalar. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">185</span><span sentence-index="6651" class="highlight3"> In  the  context  of  rotation,  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">185</span><span sentence-index="6651" class="highlight4">v</span></span></strong></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6651</span><span sentence-index="6651" class="highlight2">  represents  the            direction  in  which  the  axis  of  rotation  points. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">186</span><span sentence-index="6652" class="highlight3"> For  a  given  rotation,  &#x3B8;,  about  an  arbitrary            axis  represented  by  the  unit  vector  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">186</span><span>u</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">186</span><span sentence-index="6652" class="highlight2">,  the  representative            quaternion  can  be  written  as  follows:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">186</span><span sentence-index="6652" class="highlight3">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">186</span><span sentence-index="6652" class="highlight4"> =  [cos(&#x3B8;/2)  ,  sin(&#x3B8;/2)  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">186</span><span sentence-index="6652" class="highlight4">u</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">186</span><span sentence-index="6652" class="highlight2">]</span></span></td></tr></tbody></table><p><a id="I_indexterm5_id330001" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">188</span><span sentence-index="6654" class="highlight3">This  is  illustrated  in  </span></span></a><a class="xref" href="ch11.html#quaternion_rotation" title="Figure&#xA0;11-3.&#xA0;Quaternion rotation"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">189</span><span sentence-index="6655" class="highlight4">Figure&#xA0;11-3</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">189</span><span sentence-index="6655" class="highlight2"> for  an  arbitrary  rigid  body            rotating  about  an  axis  passing  through  its  </span></span><a id="I_indexterm5_id330172" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6657</span><span sentence-index="6657" class="highlight3">center  of  gravity. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6658</span><span sentence-index="6658" class="highlight4">  The  rigid  body  rotates  through  an  angle  &#x3B8;  from  the  position            shown  in  light  gray  to  the  position  shown  in  dark  gray. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="6659" class="highlight2"> Here,  the  unit  vector  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="6659" class="highlight3">u</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="6659" class="highlight4"> is  the  vector  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">193</span><span sentence-index="6659" class="highlight2">v</span></span></strong></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6659</span><span sentence-index="6659" class="highlight3">  normalized  to            unit  length.</span></span></a></p><div class="figure"><a id="quaternion_rotation"></a><div class="figure-contents"><a id="quaternion_rotation"></a><div class="mediaobject"><a id="quaternion_rotation"></a><a id="I_mediaobject5_id330209"><img src="httpatomoreillycomsourceoreillyimages1598952.png" alt="Quaternion rotation"></a></div></div><div class="figure-title"><a id="I_mediaobject5_id330209"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">199</span><span sentence-index="6665" class="highlight4">Figure&#xA0;11-3.&#xA0;Quaternion  rotation</span></span></a></div></div><p><a id="I_mediaobject5_id330209"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6667</span><span sentence-index="6667" class="highlight2">You  can  readily  see  that  quaternions,  when  used  to  represent  rotation  or  orientation,            require  you  to  deal  with  only  four  parameters  instead  of  nine,  subject  to  the  easily  satisfied            constraint  that  the  quaternion  be  a  unit  quaternion.</span></span></a></p><p><a id="I_mediaobject5_id330209"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6670</span><span sentence-index="6670" class="highlight3">The  use  of  quaternions  to  represent  orientation  is  similar  to  how  you  would  use  rotation            matrices. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6671</span><span sentence-index="6671" class="highlight4">  First,  you  set  up  a  quaternion  that  represents  the  initial  orientation  of  the  rigid            body  at  time  0  (this  is  the  only  time  you&apos;ll  calculate  the  quaternion  explicitly). </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6672</span><span sentence-index="6672" class="highlight2">  Then  you            update  the  orientation  to  reflect  the  new  orientation  at  a  given  instant  in  time  using  the            angular  velocities  that  are  calculated  for  that  instant. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">207</span><span sentence-index="6673" class="highlight3"> As  you  can  see  here,  the  differential            equation  relating  an  orientation  quaternion  to  </span></span></a><a id="I_indexterm5_id330240" class="indexterm"></a><a id="I_indexterm5_id330250" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">209</span><span sentence-index="6675" class="highlight4">angular  velocity  is  very  similar  to  that  for  rotation  matrices:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">209</span><span sentence-index="6675" class="highlight2">d</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">209</span><span sentence-index="6675" class="highlight3">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">209</span><span sentence-index="6675" class="highlight4">/dt  =  (1/2)  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">209</span><span sentence-index="6675" class="highlight2">&#x3C9;                    q</span></span></strong></span></td></tr></tbody></table><p><a id="I_indexterm5_id330250" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">211</span><span sentence-index="6677" class="highlight3">Here,  the  angular  velocity  is  written  in  quaternion  form  as  [0,  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">211</span><span sentence-index="6677" class="highlight4">&#x3C9;</span></span></strong></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6677</span><span sentence-index="6677" class="highlight2"> ]  and  is  expressed  in  fixed,  global  coordinates. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="6678" class="highlight3"> (</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span>&#x3C9;</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="6678" class="highlight2"> is  still  angular  velocity,  but  you  have  to  put  it  in  quaternion  form  instead            of  vector  form  when  multiplying  it  by  a  quaternion  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span>q</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="6678" class="highlight4">.)  If  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="6678" class="highlight4">&#x3C9;</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="6678" class="highlight2"> is  expressed  in  rotating,  body-fixed  coordinates,  then  you  need            to  use  this  equation:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="6678" class="highlight3">d</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="6678" class="highlight3">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="6678" class="highlight4">/dt  =  (1/2)  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">212</span><span sentence-index="6678" class="highlight2">q                    &#x3C9;</span></span></strong></span></td></tr></tbody></table><p><a id="I_indexterm5_id330250" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6680</span><span sentence-index="6680" class="highlight3">As  with  rotation  matrices,  you  can  use  quaternions  to  rotate  points  or  vectors. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="6681" class="highlight4"> If                </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span>v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="6681" class="highlight3"> is  a  vector,  then  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span>v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="6681" class="highlight4">&apos;            is  the  rotated  vector  subject  to  the  quaternion  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="6681" class="highlight2">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="6681" class="highlight3">:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="6681" class="highlight2">v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="6681" class="highlight4">&apos;  =  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="6681" class="highlight2">qvq</span></span></strong></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">215</span><span sentence-index="6681" class="highlight3">*</span></span></sup></td></tr></tbody></table><p><a id="I_indexterm5_id330250" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight2">Here  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span>q</span></span></strong></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight4">*</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight2"> is  the  conjugate  of  the            quaternion  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span>q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight3"> defined  as:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight3">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight4">*  =  q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight4">0</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight2"> &#x2013;                    q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight3">x</span></span></sub>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight4">i</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span> &#x2013;  q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight3">y</span></span></sub>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight4">j</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight2"> &#x2013;  q</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight2">z</span></span></sub>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">217</span><span sentence-index="6683" class="highlight3">k</span></span></strong></span></td></tr></tbody></table><p><a id="I_indexterm5_id330250" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6685</span><span sentence-index="6685" class="highlight4">You  can  also  use  the  preceding  formula  to  convert  vectors  from  one  coordinate  system  to            another,  where  one  is  rotated  relative  to  the  other. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6686</span><span sentence-index="6686" class="highlight2">  You  have  to  do  this,  for  example,  in  your            simulations  where  you  are  converting  forces  defined  in  fixed,  global  coordinates  to  rotating,            body-fixed  coordinates  so  that  you  can  apply  the  forces  to  the  body;  or  you  might  have  to            convert  a  body&apos;s  velocity  defined  in  global  coordinates  to  body  coordinates  so  that  you  can            use  the  velocity  in  force  calculations.</span></span></a></p><div class="sect2" title="Quaternion Operations"><div class="titlepage"><div><div><h3 class="title" id="quaternion_operations"><a id="I_indexterm5_id330250" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">223</span><span sentence-index="6689" class="highlight3">Quaternion  Operations</span></span></a></h3></div></div></div><p><a id="I_indexterm5_id330250" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6691</span><span sentence-index="6691" class="highlight4">As  with  vectors  and  matrices,  quaternions  have  their  own  rules  for  the  various                operations  that  you&apos;ll  need,  such  as  multiplication,  addition,  subtraction,  and  so  on. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">226</span><span sentence-index="6692" class="highlight2"> To                make  it  easy  on  you,  we&apos;ve  included  sample  code  in  </span></span></a><a class="xref" href="apc.html" title="Appendix&#xA0;C.&#xA0;Quaternion Operations"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">227</span><span sentence-index="6693" class="highlight3">Appendix&#xA0;C</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6694</span><span sentence-index="6694" class="highlight4">  that  implements  all  of  the  quaternion  operations  you&apos;ll  need;  however,  we  want  to                highlight  a  few  of  the  more  important  ones  here.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">230</span><span sentence-index="6696" class="highlight2">The  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">230</span><span sentence-index="6696" class="highlight3">Quaternion</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">230</span><span sentence-index="6696" class="highlight4"> class  is  </span></span><a id="I_indexterm5_id330482" class="indexterm"></a><a id="I_indexterm5_id330493" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight2">defined  with  a  scalar  component,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight3">n</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight4">,  and  vector  component,                    </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span>v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight3">,  where  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight2">v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight4"> is  the                vector,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight2">x</span></span></em></span>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight3">i</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span> +  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight2">y</span></span></em></span>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight3">j</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight4"> +  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight4">z</span></span></em></span>
        <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">232</span><span sentence-index="6698" class="highlight2">k</span></span></strong></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6698</span><span sentence-index="6698" class="highlight3"> . </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">233</span><span sentence-index="6699" class="highlight4"> The  class  has  two  constructors,  one  of  which                initializes  the  quaternion  to  0,  and  the  other  of  which  initializes  the  elements  to  those                passed  to  the  constructor:</span></span></a></p><a id="I_programlisting5_id330476"><pre class="programlisting">class Quaternion {
public:
     float      n;     // number (scalar) part
     Vector     v;     // vector part: v.x, v.y, v.z

     Quaternion(void);
     Quaternion(float e0, float e1, float e2, float e3);

.
.
.

};</pre></a><div class="sect3" title="Magnitude"><a id="I_programlisting5_id330476"><div class="titlepage"><div><div><h4 class="title" id="magnitude"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">236</span><span sentence-index="6702" class="highlight2">Magnitude</span></span></h4></div></div></div></a><p><a id="I_programlisting5_id330476"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="6704" class="highlight3">The  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="6704" class="highlight4">Magnitude</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">238</span><span sentence-index="6704" class="highlight2"> method  </span></span></a><a id="I_indexterm5_id330574" class="indexterm"></a><a id="I_indexterm5_id330587" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">240</span><span sentence-index="6706" class="highlight3">returns  the  magnitude  of  the  quaternion  according  to  the  following                    formula:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">240</span><span sentence-index="6706" class="highlight4">|</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">240</span><span sentence-index="6706" class="highlight2">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">240</span><span sentence-index="6706" class="highlight3">|  =                                              </span></span><span class="inlinemediaobject"><img src="inleq_1101.png" alt=""></span>   
          
          </td></tr></tbody></table><p><a id="I_indexterm5_id330587" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">242</span><span sentence-index="6708" class="highlight4">This  is  similar  to  calculating  the  magnitude  of  a  vector,  except  that  for  quaternions                    you  have  to  take  the  fourth  term,  the  scalar  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">242</span><span sentence-index="6708" class="highlight2">n</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6708</span><span sentence-index="6708" class="highlight3"> ,  into  account.</span></span></a></p><p><a id="I_indexterm5_id330587" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">245</span><span sentence-index="6711" class="highlight4">Here&apos;s  the  code  that  calculates  the  magnitude  for  our  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">245</span><span sentence-index="6711" class="highlight2">Quaternion</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">245</span><span sentence-index="6711" class="highlight3"> class:</span></span></a></p><a id="I_programlisting5_id330645"><pre class="programlisting">inline     float     Quaternion::Magnitude(void)
{
     return (float) sqrt(n*n + v.x*v.x + v.y*v.y + v.z*v.z);
}</pre></a></div><div class="sect3" title="Conjugate: The ~ operator"><div class="titlepage"><div><div><h4 class="title" id="conjugate_colon_the_tilde_operator"><a id="I_programlisting5_id330645"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">248</span><span sentence-index="6714" class="highlight4">Conjugate:  The  ~  operator</span></span></a></h4></div></div></div><p><a id="I_programlisting5_id330645"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">250</span><span sentence-index="6716" class="highlight2">The  conjugate  of  the  product  of  </span></span></a><a id="I_indexterm5_id330665" class="indexterm"></a><a id="I_indexterm5_id330672" class="indexterm"></a><a id="I_indexterm5_id330682" class="indexterm"></a><a id="I_indexterm5_id330691" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="6720" class="highlight3">quaternions  is  equal  to  the  product  of  the  quaternion  conjugates,  but  in                    reverse  order:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="6720" class="highlight4">~(</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="6720" class="highlight2">qp</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="6720" class="highlight3">)  =  (~</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="6720" class="highlight4">p</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="6720" class="highlight2">)(~</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="6720" class="highlight3">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">254</span><span sentence-index="6720" class="highlight4">)</span></span></td></tr></tbody></table><p><a id="I_indexterm5_id330691" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">256</span><span sentence-index="6722" class="highlight2">Here&apos;s  the  code  that  computes  the  conjugate  for  our  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">256</span><span sentence-index="6722" class="highlight3">Quaternion</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">256</span><span sentence-index="6722" class="highlight4"> class:</span></span></a></p><a id="I_programlisting5_id330742"><pre class="programlisting">     Quaternion operator~(void) const { return Quaternion( n,
                                                           -v.x,
                                                           -v.y,
                                                           -v.z);}</pre></a></div><div class="sect3" title="QVRotate"><div class="titlepage"><div><div><h4 class="title" id="qvrotate"><a id="I_programlisting5_id330742"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">259</span><span sentence-index="6725" class="highlight2">QVRotate</span></span></a></h4></div></div></div><p><a id="I_programlisting5_id330742"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">261</span><span sentence-index="6727" class="highlight3">This  function  rotates  </span></span></a><a id="I_indexterm5_id330762" class="indexterm"></a><a id="I_indexterm5_id330772" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="6729" class="highlight4">the  vector  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span>v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="6729" class="highlight3"> by  the  unit  quaternion                        </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span>q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="6729" class="highlight2"> according  to  this  formula:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="6729" class="highlight3">p</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="6729" class="highlight4">&apos;  =  (</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span>q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="6729" class="highlight2">)(</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="6729" class="highlight2">v</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="6729" class="highlight3">)(~</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="6729" class="highlight4">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">263</span><span sentence-index="6729" class="highlight4">)</span></span></td></tr></tbody></table><p><a id="I_indexterm5_id330772" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="6731" class="highlight2">Here,  ~</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span>q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="6731" class="highlight4"> is  the  conjugate  of  the  unit  quaternion,                        </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="6731" class="highlight3">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">265</span><span sentence-index="6731" class="highlight2">:</span></span></a></p><a id="I_programlisting5_id330841"><pre class="programlisting">inline     Vector     QVRotate(Quaternion q, Vector v)
{
     Quaternion t;

     t = q*v*(~q);

     return     t.GetVector();
}</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">267</span><span sentence-index="6733" class="highlight3">This  operator  takes  the  conjugate  of  the  quaternion,  ~</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">267</span><span sentence-index="6733" class="highlight4">q</span></span></strong></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6733</span><span sentence-index="6733" class="highlight2"> ,  which  is  simply  the  negative  of  the  vector  part. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight3"> If  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span>q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight2"> =  [</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span>n</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight4">,  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span>x</span></span></em></span>
          <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span>i</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span> +  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span>y</span></span></em></span>
          <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span>j</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight4"> +  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span>z</span></span></em></span>
          <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span>k</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight3">],  then  ~</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight4">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight4"> =                        [</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight3">n</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight2">,  (&#x2212;</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight2">x</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span>)  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight3">i</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight4">                   +  (&#x2212;</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight2">y</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span>)  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight3">j</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight2"> +                        (&#x2212;</span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight4">z</span></span></em></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight3">)  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">268</span><span sentence-index="6734" class="highlight2">k</span></span></strong></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6734</span><span sentence-index="6734" class="highlight3"> ].</span></span></p></a></div><div class="sect3" title="Quaternion multiplication: The * operator"><div class="titlepage"><div><div><h4 class="title" id="quaternion_multiplication_colon_the_aste"><a id="I_programlisting5_id330841"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">271</span><span sentence-index="6737" class="highlight4">Quaternion  multiplication:  The  *  operator</span></span></a></h4></div></div></div><p><a id="I_programlisting5_id330841"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">273</span><span sentence-index="6739" class="highlight2">This  operator  performs  </span></span></a><a id="I_indexterm5_id330950" class="indexterm"></a><a id="I_indexterm5_id330960" class="indexterm"></a><a id="I_indexterm5_id330970" class="indexterm"></a><a id="I_indexterm5_id330977" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight3">quaternion  multiplication  according  to  the  following  formula:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight4">q  p</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight2"> =  n</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>q</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight4">                           n</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>p</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight3"> &#x2212;  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>q</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight2"> &#x2022;  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>p</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span> +  n</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>q</span></span></sub>
            <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>p</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight3"> +  n</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>p</span></span></sub>
            <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>q</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight4"> +  (</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight3">q</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight2"> &#xD7;  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight4">v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight2">p</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">277</span><span sentence-index="6743" class="highlight3">)</span></span></td></tr></tbody></table><p><a id="I_indexterm5_id330977" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="6745" class="highlight4">Here,                        </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>n</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>q</span></span></sub><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>n</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>p</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="6745" class="highlight2">                   &#x2212;  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>q</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="6745" class="highlight4"> &#x2022;  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>p</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="6745" class="highlight2"> is  the  scalar  part  of  the  result  while                        </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>n</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>q</span></span></sub>
          <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>p</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="6745" class="highlight3"> +                        </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="6745" class="highlight2">n</span></span></em></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>p</span></span></sub>
          <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>q</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="6745" class="highlight4"> +  (</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="6745" class="highlight3">q</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="6745" class="highlight2"> &#xD7;  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="6745" class="highlight3">v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">279</span><span sentence-index="6745" class="highlight4">p</span></span></sub><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6745</span><span sentence-index="6745" class="highlight3"> )  is  the  vector  part. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span sentence-index="6746" class="highlight4"> Also  note  that  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span>v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span>q</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span> and  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span sentence-index="6746" class="highlight2">v</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span>p</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span sentence-index="6746" class="highlight3"> are  the  vector  parts  of  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span sentence-index="6746" class="highlight3">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span sentence-index="6746" class="highlight4"> and  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">280</span><span sentence-index="6746" class="highlight2">p</span></span></strong></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6746</span><span sentence-index="6746" class="highlight4"> ,  respectively,  &#x2022;  is  the  vector                    dot  product  operator,  and  &#xD7;  is  the  vector  cross  product  operator.</span></span></a></p><p><a id="I_indexterm5_id330977" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6749" class="highlight2">Quaternion  multiplication  is  associative  but  not  commutative,  thus:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6749" class="highlight3">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6749" class="highlight4">(</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6749" class="highlight2">ph</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6749" class="highlight3">)  =                            (</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span>qp</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6749" class="highlight2">)</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6749" class="highlight3">h</span></span></strong></span></td></tr><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6749" class="highlight4">qp</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6749" class="highlight4"> &#x2260;  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">283</span><span sentence-index="6749" class="highlight2">pq</span></span></strong></span></td></tr></tbody></table><p><a id="I_indexterm5_id330977" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">285</span><span sentence-index="6751" class="highlight3">Here&apos;s  the  code  that  multiplies  two  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">285</span><span sentence-index="6751" class="highlight4">Quaternion</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">285</span><span sentence-index="6751" class="highlight2">s,                        </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">285</span><span sentence-index="6751" class="highlight3">q1</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">285</span><span sentence-index="6751" class="highlight4"> and  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">285</span><span sentence-index="6751" class="highlight2">q2</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">285</span><span sentence-index="6751" class="highlight3">:</span></span></a></p><a id="I_programlisting5_id331246"><pre class="programlisting">inline     Quaternion operator*(Quaternion q1, Quaternion q2)
{
     return     Quaternion(q1.n*q2.n - q1.v.x*q2.v.x
                               - q1.v.y*q2.v.y - q1.v.z*q2.v.z,
                           q1.n*q2.v.x + q1.v.x*q2.n
                               + q1.v.y*q2.v.z - q1.v.z*q2.v.y,
                           q1.n*q2.v.y + q1.v.y*q2.n
                               + q1.v.z*q2.v.x - q1.v.x*q2.v.z,
                           q1.n*q2.v.z + q1.v.z*q2.n
                               + q1.v.x*q2.v.y - q1.v.y*q2.v.x);
}</pre></a></div><div class="sect3" title="Vector multiplication: The * operator"><div class="titlepage"><div><div><h4 class="title" id="vector_multiplication_colon_the_aste"><a id="I_programlisting5_id331246"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">288</span><span sentence-index="6754" class="highlight4">Vector  multiplication:  The  *  operator</span></span></a></h4></div></div></div><p><a id="I_programlisting5_id331246"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">290</span><span sentence-index="6756" class="highlight2">This  operator  </span></span></a><a id="I_indexterm5_id331270" class="indexterm"></a><a id="I_indexterm5_id331280" class="indexterm"></a><a id="I_indexterm5_id331290" class="indexterm"></a><a id="I_indexterm5_id331300" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">294</span><span sentence-index="6760" class="highlight3">multiplies  the  quaternion,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">294</span><span sentence-index="6760" class="highlight4">q</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">294</span><span sentence-index="6760" class="highlight2">,  by  the  vector                        </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">294</span><span>v</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">294</span><span sentence-index="6760" class="highlight4"> as  though  the  vector  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">294</span><span sentence-index="6760" class="highlight3">v</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6760</span><span sentence-index="6760" class="highlight2">  were  a  quaternion  with  its  scalar  component  equal  to  0. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6761</span><span sentence-index="6761" class="highlight3">  There  are  two  forms                    of  this  operator  depending  on  the  order  in  which  the  quaternion  and  vector  are                    encountered. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="6762" class="highlight4"> Since  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="6762" class="highlight2">v</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">296</span><span sentence-index="6762" class="highlight3"> is  assumed  to  be  a  quaternion  with                    its  scalar  part  equal  to  0,  the  rules  of  multiplication  follow  those  outlined  earlier  for                    quaternion  multiplication:</span></span></a></p><a id="I_programlisting5_id331338"><pre class="programlisting">inline     Quaternion operator*(Quaternion q, Vector v)
{
     return     Quaternion(     -(q.v.x*v.x + q.v.y*v.y + q.v.z*v.z),
                                   q.n*v.x + q.v.y*v.z - q.v.z*v.y,
                                   q.n*v.y + q.v.z*v.x - q.v.x*v.z,
                                   q.n*v.z + q.v.x*v.y - q.v.y*v.x);
}
inline     Quaternion operator*(Vector v, Quaternion q)
{
     return     Quaternion(     -(q.v.x*v.x + q.v.y*v.y + q.v.z*v.z),
                                   q.n*v.x + q.v.z*v.y - q.v.y*v.z,
                                   q.n*v.y + q.v.x*v.z - q.v.z*v.x,
                                   q.n*v.z + q.v.y*v.x - q.v.x*v.y);
}</pre></a></div><div class="sect3" title="MakeQFromEulerAngles"><div class="titlepage"><div><div><h4 class="title" id="makeqfromeulerangles"><a id="I_programlisting5_id331338"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">299</span><span sentence-index="6765" class="highlight4">MakeQFromEulerAngles</span></span></a></h4></div></div></div><p><a id="I_programlisting5_id331338"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">301</span><span sentence-index="6767" class="highlight2">This  function  </span></span></a><a id="I_indexterm5_id331365" class="indexterm"></a><a id="I_indexterm5_id331375" class="indexterm"></a><a id="I_indexterm5_id331381" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6770</span><span sentence-index="6770" class="highlight3">constructs  a  quaternion  from  a  set  of  Euler  angles.</span></span></a></p><p><a id="I_indexterm5_id331381" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6773</span><span sentence-index="6773" class="highlight4">For  a  given  set  of  Euler  angles,  yaw  (&#x3C8;),  pitch  (&#x3C4;),  and  roll  (&#x3C6;),  defining  rotation                    about  the  z-axis,  then  the  y-axis,  and  then  the  x-axis,  you  can  construct  the                    representative  rotation  quaternion. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6774</span><span sentence-index="6774" class="highlight2">  You  do  this  by  first  constructing  a  quaternion  for                    each  Euler  angle  and  then  multiplying  the  three  quaternions  following  the  rules  of                    quaternion  multiplication. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight3"> Here  are  the  three  quaternions  representing  each  Euler  rotation                    angle:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span>q</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight2">roll</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight3"> =  [cos(&#x3C6;/2),                        (sin(&#x3C6;/2))  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span>i</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span> +  0  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span>j</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight4">                       +  0  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span>k</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span>]</span></span></td></tr><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span>q</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight4">pitch</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight2"> =  [cos(&#x3C4;  /2),  0                            </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span>i</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight3"> +  (sin(&#x3C4;  /2))  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span>j</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span> +  0  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span>k</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span>]</span></span></td></tr><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight4">q</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight4">yaw</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight2"> =  [cos(&#x3C8;  /2),  0                            </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight4">i</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight2"> +  0  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight3">j</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight3"> +  (sin(&#x3C8;                        /2))  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight2">k</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">309</span><span sentence-index="6775" class="highlight3">]</span></span></td></tr></tbody></table><p><a id="I_indexterm5_id331381" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6777</span><span sentence-index="6777" class="highlight4">Each  one  of  these  quaternions  is  of  unit  length.</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">312</span><span sentence-index="6778" class="highlight2">[</span></span></sup></a><a id="CHP-11-FN-2" href="#ftn.CHP-11-FN-2" epub:type="noteref" class="footnote"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">313</span><span sentence-index="6779" class="highlight3">21</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">313</span><span sentence-index="6779" class="highlight4">]</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">315</span><span sentence-index="6781" class="highlight2">Now  you  can  multiply  these  quaternions  to  obtain  a  single  one  that  represents  the                    rotation,  or  orientation,  defined  by  the  three  Euler  angles:</span></span></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">315</span><span>q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">315</span><span sentence-index="6781" class="highlight4"> =  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">315</span><span>q</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">315</span><span sentence-index="6781" class="highlight2">yaw</span></span></sub>
            <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">315</span><span>q</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">315</span><span sentence-index="6781" class="highlight3">pitch</span></span></sub>
            <span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">315</span><span sentence-index="6781" class="highlight3">q</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">315</span><span sentence-index="6781" class="highlight4">roll</span></span></sub></td></tr></tbody></table><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6782" class="highlight2">Performing  this  multiplication  yields:</span></span></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6782" class="highlight3">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6782" class="highlight4"> =  [{cos(&#x3C6;/2)  cos(&#x3C4;  /2)  cos(&#x3C8;  /2)  +  sin(&#x3C6;/2)                        sin(&#x3C4;  /2)  sin(&#x3C8;  /2)},</span></span></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6782" class="highlight2">{sin(&#x3C6;/2)  cos(&#x3C4;  /2)  cos(&#x3C8;  /2)  &#x2212;  cos(&#x3C6;/2)  sin(&#x3C4;  /2)  sin(&#x3C8;  /2)}  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6782" class="highlight3">i</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span> +</span></span></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6782" class="highlight2">{cos(&#x3C6;/2)  sin(&#x3C4;  /2)  cos(&#x3C8;  /2)  +  sin(&#x3C6;/2)  cos(&#x3C4;  /2)  sin(&#x3C8;  /2)}  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6782" class="highlight3">j</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6782" class="highlight4"> +</span></span></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6782" class="highlight4">{cos(&#x3C6;/2)  cos(&#x3C4;  /2)  sin(&#x3C8;  /2)  &#x2212;  sin(&#x3C6;/2)  sin(&#x3C4;  /2)  cos(&#x3C8;  /2)}  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6782" class="highlight2">k</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">316</span><span sentence-index="6782" class="highlight3">]</span></span></td></tr></tbody></table><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">317</span><span sentence-index="6783" class="highlight4">Here&apos;s  the  code  that  takes  three  Euler  angles  and  returns  a  quaternion:</span></span></p><a id="I_programlisting5_id331610"><pre class="programlisting">inline     Quaternion     MakeQFromEulerAngles(float x, float y, float z)
{
     Quaternion     q;
     double     roll = DegreesToRadians(x);
     double     pitch = DegreesToRadians(y);
     double     yaw = DegreesToRadians(z);

     double     cyaw, cpitch, croll, syaw, spitch, sroll;
     double     cyawcpitch, syawspitch, cyawspitch, syawcpitch;

     cyaw = cos(0.5f * yaw);
     cpitch = cos(0.5f * pitch);
     croll = cos(0.5f * roll);
     syaw = sin(0.5f * yaw);
     spitch = sin(0.5f * pitch);
     sroll = sin(0.5f * roll);

     cyawcpitch = cyaw*cpitch;
     syawspitch = syaw*spitch;
     cyawspitch = cyaw*spitch;
     syawcpitch = syaw*cpitch;

     q.n = (float) (cyawcpitch * croll + syawspitch * sroll);
     q.v.x = (float) (cyawcpitch * sroll - syawspitch * croll);
     q.v.y = (float) (cyawspitch * croll + syawcpitch * sroll);
     q.v.z = (float) (syawcpitch * croll - cyawspitch * sroll);

     return q;
}</pre></a></div><div class="sect3" title="MakeEulerAnglesFromQ"><div class="titlepage"><div><div><h4 class="title" id="makeeuleranglesfromq"><a id="I_programlisting5_id331610"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">320</span><span sentence-index="6786" class="highlight2">MakeEulerAnglesFromQ</span></span></a></h4></div></div></div><p><a id="I_programlisting5_id331610"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">322</span><span sentence-index="6788" class="highlight3">This  function  </span></span></a><a id="I_indexterm5_id331636" class="indexterm"></a><a id="I_indexterm5_id331647" class="indexterm"></a><a id="I_indexterm5_id331653" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6791</span><span sentence-index="6791" class="highlight4">extracts  the  three  Euler  angles  from  a  given  quaternion.</span></span></a></p><p><a id="I_indexterm5_id331653" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6794</span><span sentence-index="6794" class="highlight2">You  can  extract  the  three  Euler  angles  from  a  quaternion  by  first  converting  the                    quaternion  to  a  rotation  matrix  and  then  extracting  the  Euler  angles  from  the  rotation                    matrix. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">329</span><span sentence-index="6795" class="highlight3"> Let  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">329</span><span sentence-index="6795" class="highlight4">R</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">329</span><span sentence-index="6795" class="highlight2"> be  a  nine-element  rotation  matrix:</span></span></a></p><div class="informalfigure"><a id="chapter11matrix5"></a><div class="mediaobject"><a id="chapter11matrix5"></a><a id="I_mediaobject5_id331684"><img src="httpatomoreillycomsourceoreillyimages1598953.png" alt="image with no caption"></a></div></div><p><a id="I_mediaobject5_id331684"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="6800" class="highlight3">and  let  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span>q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="6800" class="highlight2"> be  a  quaternion:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="6800" class="highlight4">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="6800" class="highlight3"> =  [n,  x  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="6800" class="highlight4">i</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="6800" class="highlight2">                       +  y  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="6800" class="highlight3">j</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="6800" class="highlight4"> +  z  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="6800" class="highlight2">k</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">334</span><span sentence-index="6800" class="highlight3">]</span></span></td></tr></tbody></table><p><a id="I_mediaobject5_id331684"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight2">Then  each  element  in  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight3">R</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight4"> is  calculated  from  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight2">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight3"> as  follows:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight2">11</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span> =  n</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight3"> +                            x</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span> &#x2212;  y</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span> &#x2212;                            z</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>2</span></span></sup></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight2">21</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight3"> =  2xy+2zn</span></span></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight2">31</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight4"> =  2zx  &#x2212;  2yn</span></span></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight3">12</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight2"> =  2xy  &#x2212;  2zn</span></span></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight3">22</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span> =  n</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span> &#x2212;                            x</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight4"> +  y</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight2"> &#x2212;                            z</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>2</span></span></sup></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight3">32</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight2"> =  2zy  +  2xn</span></span></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight4">13</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight3"> =  2xz  +  2yn</span></span></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight4">23</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight4"> =  2yz  &#x2212;  2xn</span></span></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight4">r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight4">33</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight2"> =  n</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight3"> &#x2212;                            x</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight4"> &#x2212;  y</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight2"> +                            z</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">336</span><span sentence-index="6802" class="highlight4">2</span></span></sup></td></tr></tbody></table><p><a id="I_mediaobject5_id331684"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight2">To  extract  the  Euler  angles,  yaw  (&#x3C8;),  pitch  (&#x3C4;),  and  roll  (&#x3C6;),  from  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight3">R</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight4">,  you  can  use  these  relations:</span></span></a></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight2">tan  &#x3C8;  =  r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight4">21</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span> /  r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight3">11</span></span></sub></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight4">sin  &#x3C4;  =  &#x2013;r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight2">31</span></span></sub></td></tr><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight2">tan  &#x3C6;  =  r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight3">32</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight3"> /  r</span></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">338</span><span sentence-index="6804" class="highlight4">33</span></span></sub></td></tr></tbody></table><p><a id="I_mediaobject5_id331684"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">340</span><span sentence-index="6806" class="highlight3">Here&apos;s  the  code  that  extracts  the  three  Euler  angles,  returned  in  the  form  of  a                        </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">340</span><span sentence-index="6806" class="highlight4">Vector</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">340</span><span sentence-index="6806" class="highlight2">,  from  a  given  </span></span></a><a id="I_indexterm5_id331925" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">341</span><span sentence-index="6807" class="highlight3">quaternion:</span></span></a></p><a id="I_programlisting5_id331937"><pre class="programlisting">inline     Vector     MakeEulerAnglesFromQ(Quaternion q)
{
     double     r11, r21, r31, r32, r33, r12, r13;
     double     q00, q11, q22, q33;
     double     tmp;
     Vector     u;

     q00 = q.n * q.n;
     q11 = q.v.x * q.v.x;
     q22 = q.v.y * q.v.y;
     q33 = q.v.z * q.v.z;

     r11 = q00 + q11 - q22 - q33;
     r21 = 2 * (q.v.x*q.v.y + q.n*q.v.z);
     r31 = 2 * (q.v.x*q.v.z - q.n*q.v.y);
     r32 = 2 * (q.v.y*q.v.z + q.n*q.v.x);
     r33 = q00 - q11 - q22 + q33;

     tmp = fabs(r31);
     if(tmp &gt; 0.999999)
     {
          r12 = 2 * (q.v.x*q.v.y - q.n*q.v.z);
          r13 = 2 * (q.v.x*q.v.z + q.n*q.v.y);

          u.x = RadiansToDegrees(0.0f); //roll
          u.y = RadiansToDegrees((float) (-(pi/2) * r31/tmp));   // pitch
          u.z = RadiansToDegrees((float) atan2(-r12, -r31*r13)); // yaw
          return u;
     }

     u.x = RadiansToDegrees((float) atan2(r32, r33)); // roll
     u.y = RadiansToDegrees((float) asin(-r31));      // pitch
     u.z = RadiansToDegrees((float) atan2(r21, r11)); // yaw
     return u;


}</pre></a></div></div></div><div class="sect1" title="Quaternions in 3D Simulators"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="quaternions_in_3d_simulators"><a id="I_programlisting5_id331937"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">345</span><span sentence-index="6811" class="highlight4">Quaternions  in  3D  Simulators</span></span></a></h2></div></div></div><p><a id="I_programlisting5_id331937"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">347</span><span sentence-index="6813" class="highlight2">The  quaternion  operations  just  </span></span></a><a id="th11.3" class="indexterm"></a><a id="qu11.3" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">349</span><span sentence-index="6815" class="highlight3">presented  are  required  when  you  are  using  </span></span></a><a id="or11.3" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6816</span><span sentence-index="6816" class="highlight4">quaternions  to  represent  orientation  in  3D  simulations. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">351</span><span sentence-index="6817" class="highlight2"> All  the  3D  simulations            discussed  in  this  book  use  these  quaternion  operations,  and  in  this  section  we&apos;ll  highlight            where  they  are  used  in  the  context  of  the  airplane  example  presented  in  </span></span></a><a class="xref" href="ch15.html" title="Chapter&#xA0;15.&#xA0;Aircraft"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">352</span><span sentence-index="6818" class="highlight3">Chapter&#xA0;15</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6819</span><span sentence-index="6819" class="highlight4"> .</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">355</span><span sentence-index="6821" class="highlight2">When  initializing  the  </span></span><a id="ai11.3" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6822</span><span sentence-index="6822" class="highlight3">orientation  of  the  airplane,  you  have  to  set  its  orientation  quaternion  to            something  corresponding  to  the  Euler  angles  you  desire. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">357</span><span sentence-index="6823" class="highlight4"> You  do  so  as  follows:</span></span></a></p><a id="I_programlisting5_id332038"><pre class="programlisting">Airplane.qOrientation = MakeQFromEulerAngles(iRoll, iPitch, iYaw);</pre><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">359</span><span sentence-index="6825" class="highlight2">In  this  code  sample,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">359</span><span sentence-index="6825" class="highlight3">Airplane</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">359</span><span sentence-index="6825" class="highlight4"> is  a  rigid-body  class            with  the  property  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">359</span><span sentence-index="6825" class="highlight2">qOrientation</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">359</span><span sentence-index="6825" class="highlight3">,  which  represents  the            orientation  quaternion,  which  is  a  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">359</span><span sentence-index="6825" class="highlight4">Quaternion</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6825</span><span sentence-index="6825" class="highlight2">  class. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">360</span><span sentence-index="6826" class="highlight3">               </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">360</span><span sentence-index="6826" class="highlight4">iRoll</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">360</span><span sentence-index="6826" class="highlight2">,  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">360</span><span sentence-index="6826" class="highlight3">iPitch</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">360</span><span sentence-index="6826" class="highlight4">,  and                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">360</span><span sentence-index="6826" class="highlight2">iYaw</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6826</span><span sentence-index="6826" class="highlight3">  are  the  three  Euler  angles  describing  the            orientation  of  the  airplane.</span></span></p><p><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">362</span><span sentence-index="6828" class="highlight4 nonQuoteStr">If  at  any  time  you  want  to  report  the  Euler  angles&#x2014;for  example,  in  a  heads-up  display-like            interface  for  the  game  player&#x2014;you  can  use  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">362</span><span sentence-index="6828" class="highlight2 nonQuoteStr">MakeEulerAnglesFromQ</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">362</span><span sentence-index="6828" class="highlight3 nonQuoteStr">,  as  follows:</span></span></p></a><a id="I_programlisting5_id332096"><pre class="programlisting">// get the Euler angles for our information
          Vector u;

          u = MakeEulerAnglesFromQ(Airplane.qOrientation);
          Airplane.vEulerAngles.x = u.x;     // roll
          Airplane.vEulerAngles.y = u.y;     // pitch
          Airplane.vEulerAngles.z = u.z;     // yaw</pre></a><p><a id="I_programlisting5_id332096"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6831</span><span sentence-index="6831" class="highlight4">Very  often,  it&apos;s  more  convenient  to  calculate  loads  on  an  object  like  the  airplane  using            body-fixed  coordinates. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6832</span><span sentence-index="6832" class="highlight2">  For  example,  when  computing  aerodynamic  drag  on  the  airplane,  you&apos;ll            want  to  know  the  relative  air  velocity  over  the  aircraft  in  body-fixed  coordinates. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6833</span><span sentence-index="6833" class="highlight3">  The            resulting  drag  force  will  also  be  in  body-fixed  coordinates. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6834</span><span sentence-index="6834" class="highlight4">  However,  when  resolving  all  the            loads  on  the  aircraft  to  determine  its  motion  in  earth-fixed  coordinates,  you&apos;ll  want  to            convert  those  forces  from  body-fixed  coordinates  to  earth-fixed  coordinates. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">369</span><span sentence-index="6835" class="highlight2"> You  can  use                </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">369</span><span sentence-index="6835" class="highlight3">QVRotate</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6835</span><span sentence-index="6835" class="highlight4">  to  rotate  any  vector,  such  as  a  force  vector,            from  one  coordinate  system  to  another. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">370</span><span sentence-index="6836" class="highlight2"> The  following  code  sample  </span></span></a><a id="I_indexterm5_id332119" class="indexterm"></a><a id="I_indexterm5_id332129" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">372</span><span sentence-index="6838" class="highlight3">shows  how  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">372</span><span sentence-index="6838" class="highlight4">QVRotate</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6838</span><span sentence-index="6838" class="highlight2">  is  used  to  convert  a  force            vector  in  body-fixed  coordinates  to  the  equivalent  force  in  earth-fixed  coordinates.</span></span></a></p><a id="I_programlisting5_id332144"><pre class="programlisting">void     CalcAirplaneLoads(void)
{
     .
     .
     .

     // Convert forces from model space to earth space
     Airplane.vForces = QVRotate(Airplane.qOrientation, Fb);
     .
     .
     .
}</pre><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6841</span><span sentence-index="6841" class="highlight3">Throughout  the  simulation,  you&apos;ll  have  to  update  the  airplane&apos;s  orientation  by  integrating            the  angular  equations  of  motion. </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6842</span><span sentence-index="6842" class="highlight4">  The  first  step  in  handling  angular  motion  is  to  calculate  the            new  angular  velocity  at  a  given  time  step  based  on  the  previously  calculated  moments  acting  on            the  airplane  and  its  mass  properties. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight2"> We  do  this  in  body  coordinates  using  the  angular            equation  of  motion:</span></span></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight3">&#x2211;  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight4">M</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span>cg</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight3"> =  d</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight4">H</span></span></strong></span><sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight2">cg</span></span></sub><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight2">/dt  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight3">=                    I</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight4"> (d</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span>&#x3C9;</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight3">/dt)  +  (</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight2">&#x3C9;</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight4"> &#xD7;  (</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight2">I  &#x3C9;</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">377</span><span sentence-index="6843" class="highlight3">))</span></span></td></tr></tbody></table><p><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6844</span><span sentence-index="6844" class="highlight4">The  next  step  is  to  integrate  again  to  update  the  airplane&apos;s  orientation,  which  is            expressed  as  a  quaternion. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">379</span><span sentence-index="6845" class="highlight2"> Here,  you  need  to  use  the  differential  equation  relating  an            orientation  quaternion  to  angular  velocity  that  we  discussed  earlier:</span></span></p><table style="border: 0; " class="simplelist"><tbody><tr><td><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">379</span><span sentence-index="6845" class="highlight3">d</span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">379</span><span sentence-index="6845" class="highlight4">q</span></span></strong></span><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">379</span><span sentence-index="6845" class="highlight2">/dt  =  (1/2)  </span></span><span class="strong"><strong><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">379</span><span sentence-index="6845" class="highlight3">&#x3C9;                    q</span></span></strong></span></td></tr></tbody></table></a><p><a id="I_programlisting5_id332144"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">381</span><span sentence-index="6847" class="highlight4">Next,  to  enforce  the  constraint  that  this  orientation  quaternion  </span></span></a><a id="I_indexterm5_id332239" class="indexterm"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="6848" class="highlight2">be  a  </span></span><span class="emphasis"><em><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">382</span><span sentence-index="6848" class="highlight3">unit</span></span></em></span><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6849</span><span sentence-index="6849" class="highlight4">  quaternion,  you  must  normalize  the  orientation            quaternion. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">384</span><span sentence-index="6850" class="highlight2"> The  following  code  sample  illustrates  these  steps:</span></span></a></p><a id="I_programlisting5_id332252"><pre class="programlisting">.
.
.
          // calculate the angular velocity of the airplane in body space:
          Airplane.vAngularVelocity += Airplane.mInertiaInverse *
                                       (Airplane.vMoments -
                                       (Airplane.vAngularVelocity^
                                       (Airplane.mInertia *
                                         Airplane.vAngularVelocity)))
                                        * dt;

          // calculate the new rotation quaternion:
          Airplane.qOrientation += (Airplane.qOrientation *
                                    Airplane.vAngularVelocity) *
                                   (0.5f * dt);

          // now normalize the orientation quaternion:
          mag = Airplane.qOrientation.Magnitude();
          if (mag != 0)
               Airplane.qOrientation /= mag;

          // calculate the velocity in body space:
          // (we&apos;ll need this to calculate lift and drag forces)
          Airplane.vVelocityBody = QVRotate(~Airplane.qOrientation,
                                            Airplane.vVelocity);
.
.
.</pre></a><p><a id="I_programlisting5_id332252"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6853</span><span sentence-index="6853" class="highlight3">Notice  the  last  line  of  code  in  the  preceding  sample. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">388</span><span sentence-index="6854" class="highlight4"> That  line  converts  the  airplane&apos;s            velocity  vector  from  earth-fixed  coordinates  to  body-fixed  coordinates  using  </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">388</span><span sentence-index="6854" class="highlight2">QVRotate</span></span></code><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6854</span><span sentence-index="6854" class="highlight3"> . </span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6855</span><span sentence-index="6855" class="highlight4">  Recall  that  it&apos;s  more  convenient  to  compute  body  forces            in  body-fixed  coordinates. </span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="6856" class="highlight2"> </span></span><code class="literal"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="6856" class="highlight3">QVRotate</span></span></code><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">390</span><span sentence-index="6856" class="highlight4"> allows  you  to  work  with            vectors  back  and  forth  from  body-fixed  to  earth-fixed  </span></span></a><a id="I_indexterm5_id332284" class="indexterm"></a><a id="I_indexterm5_id332295" class="indexterm"></a><a id="I_indexterm5_id332304" class="indexterm"></a><a id="I_indexterm5_id332313" class="indexterm"></a><a id="I_indexterm5_id332323" class="indexterm"></a><a id="I_indexterm5_id332332" class="indexterm"></a><a id="I_indexterm5_id332341" class="indexterm"></a><a id="I_indexterm5_id332351" class="indexterm"><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6864</span><span sentence-index="6864" class="highlight2">coordinates.</span></span></a></p></div><div class="footnotes" epub:type="footnotes"><a id="I_indexterm5_id332351" class="indexterm"><br><hr style="width: 100; align: left;"></a><div class="footnote" epub:type="footnote" id="ftn.CHP-11-FN-1"><a id="I_indexterm5_id332351" class="indexterm"></a><p><a id="I_indexterm5_id332351" class="indexterm"><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">404</span><span sentence-index="6870" class="highlight3">[</span></span></sup></a><a href="#CHP-11-FN-1" class="para"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">405</span><span sentence-index="6871" class="highlight4">20</span></span></a><span class="nonQuoteStr"><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6872</span><span sentence-index="6872" class="highlight2"> ]  Two  vectors  are  orthogonal  if  their  dot  product  is  0.</span></span></p></div><div class="footnote" epub:type="footnote" id="ftn.CHP-11-FN-2"><p><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">408</span><span sentence-index="6874" class="highlight3">[</span></span><a href="#CHP-11-FN-2" class="para"><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">409</span><span sentence-index="6875" class="highlight2">21</span></span></a><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">409</span><span sentence-index="6875" class="highlight3">]  </span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">409</span><span sentence-index="6875" class="highlight4">You  can  verify  this  by  recalling  the  trigonometric  relation                                cos</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">409</span><span>2</span></span></sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">409</span><span sentence-index="6875" class="highlight2">&#x3B8;  +  sin</span></span><sup><span><span style="background-color: lightgray; padding: 4px;" class="spanSentenceIndexNumber">409</span><span sentence-index="6875" class="highlight4">2</span></span></sup><span><span style="margin-right: 5px; margin-left: 5px;" class="spanSentenceIndexNumber">6876</span><span sentence-index="6876" class="highlight3">  &#x3B8;  =  1.</span></span></p></div></div></section>
</body></html>